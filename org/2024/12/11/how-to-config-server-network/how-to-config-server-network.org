#+OPTIONS: author:nil ^:{}
#+HUGO_BASE_DIR: ../../../../../
#+HUGO_SECTION: post/2024/12
#+HUGO_CUSTOM_FRONT_MATTER: :toc false
#+HUGO_AUTO_SET_LASTMOD: t
#+HUGO_DRAFT: false
#+DATE: [2024-12-11 三 19:55]
#+TITLE: 如何配置多网卡服务器的网络
#+HUGO_TAGS:
#+HUGO_CATEGORIES: kernel
#+HUGO_CUSTOM_FRONT_MATTER: :image https://r2.guolongji.xyz/allinaent/2024/06/92a1feeab471b12646b9c76edccc1546.jpg


* NetworkManager 配置文件

在 centos 当中是： =/etc/sysconfig/network-scripts/ifcfg-xxx=

在 debian 当中是： =/etc/network/= 当中

也有可能在： =/etc/systemd/network/= 当中

在 UOS 当中是： /etc/NetworkManager/system-connections

#+begin_src
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
IPADDR=10.10.xx.xx
PREFIX=24
GATEWAY=10.10.xx.1
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME="有线连接 1"
UUID=88b5a874-9d58-4da6-9923-248e1470ad39
DEVICE=enp5s0f2
ONBOOT=yes
DNS1=10.10.0.xx
DNS2=10.10.0.xx
PEERDNS=no
#+end_src




保证重启网络正常，比较重要的两点是：DEVICE 这个是绑定设备的，另一个是 ONBOOT=yes ，这两个配对了，网络就没有
问题了。


* BMC 配置

@@hugo:{{< slideshow "https://r2.guolongji.xyz/bmc%20%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%85%B6%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95%E5%88%86%E4%BA%AB.pdf">}}@@


ipmitool ，什么是 ipmi ？这个是智慧管理平台，需要内核打开对这个驱动的支持，ipim 才能使用。才能够通过
ipimtool 来设置 bmc 的 ip 。

有些机器使用 impitool 的话会报错，需要手动执行一下下面的命令：

modprobe ipmi_devintf

modprobe ipmi_msghandler

modprobe ipmi_si type=kcs ports=0xca2 regspacings=1

设置方法：

查看BMC网络信息（通常配置通道1, 第一个网卡）：ipmitool lan print 1
- 设置BMC使用IP地址：ipmitool lan set 1 ipaddr 172.16.21.98
- 设置BMC使用子网掩码：ipmitool lan set 1 netmask 255.255.255.0
- 设置BMC使用网关：ipmitool lan set 1 defgw ipaddr 172.16.21.205


其它的一些命令，转载自： https://forum.cambricon.com/index.php?m=content&c=index&a=show&catid=186&id=628

查看整机状态:  ipmitool chassis power status

系统开机:  ipmitool chassis power on

系统关机:  ipmitool chassis power off

系统重启:  ipmitool chassis power reset

查看网络信息:  ipmitool lan print 1

设置网络为DHCP模式:  ipmitool lan set 1 ipsrc dhcp

设置网络为Static模式:  ipmitool lan set 1 ipsrc static

修改IP地址:  ipmitool lan set 1 ipaddr 新地址

修改子网掩码:  ipmitool lan set 1 netmask 255.255.255.0

修改网关:  ipmitool lan set 1 defgw ipaddr 新的网关地址

查看SEL日志: ipmitool sel list

查看SEL日志详情: ipmitool sel elist

查看Sensor信息: ipmitool sensor list

查看SDR信息:  ipmitool sdr list

重启BMC:  ipmitool mc reset < warm | cold >  warm表示软重启，cold表示硬重启

查看FRU信息: ipmitool fru

* 大型交换机的一些配置


大型的交换机一般看 H3C 的手册就知道了，这个比家用的功能多很多了吧。感觉主要就是 vlan 的一些管理功能。

https://www.h3c.com/cn/Service/Document_Software/Document_Center/Switches/Catalog/S5600/S5600/Command/Command_Manual/H3C_S5600_CM-Release_1702(V1.00)/
