<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-11-01 五 15:30 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>linux 用户输入增强交接文档</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="https://orgmode.org/worg/style/worg.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">linux 用户输入增强交接文档</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org4198cc3">1. 一期</a>
<ul>
<li><a href="#orgf967af6">1.1. 实现功能代码</a></li>
<li><a href="#org6c77db4">1.2. 配置内核</a></li>
<li><a href="#orgedac1c3">1.3. 编译并替换内核</a></li>
<li><a href="#orgbb93e06">1.4. 编译libinput_enhance库</a></li>
<li><a href="#org64e9fdd">1.5. 编写测试用例</a></li>
<li><a href="#orgf1087d9">1.6. 查看效果</a></li>
<li><a href="#orgea04498">1.7. 退出</a></li>
</ul>
</li>
<li><a href="#orgd0240aa">2. 二期</a>
<ul>
<li><a href="#org9cf0396">2.1. 内核修改</a></li>
<li><a href="#org00f94f0">2.2. 用户态库的修改</a></li>
<li><a href="#orgd6bfcd0">2.3. 对接人</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org4198cc3" class="outline-2">
<h2 id="org4198cc3"><span class="section-number-2">1.</span> 一期</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgf967af6" class="outline-3">
<h3 id="orgf967af6"><span class="section-number-3">1.1.</span> 实现功能代码</h3>
<div class="outline-text-3" id="text-1-1">
<p>
drivers &gt;&gt; input &gt;&gt; input-enhance.h
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #5B6268;">/* </span><span style="color: #5B6268;">SPDX-License-Identifier: GPL-2.0-only</span><span style="color: #5B6268;"> */</span>
<span style="color: #51afef; font-weight: bold;">#if</span><span style="color: #51afef; font-weight: bold;">n</span><span style="color: #51afef; font-weight: bold;">def</span> _INPUT_ENHANCE_H
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">_INPUT_ENHANCE_H</span>

<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">linux/ioctl.h</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">long enhance_state = 0; // 0 close; 1 open</span>
<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span> <span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">enhance_state</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">encrypt_type</span>;
        <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">public_key</span>;
<span style="color: #51afef;">}</span>;

<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">CMD_IOC_MAGIC</span> <span style="color: #98be65;">'a'</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">CMD_IOC_0</span> _IOR<span style="color: #51afef;">(</span>CMD_IOC_MAGIC, 0, <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span><span style="color: #51afef;">)</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">CMD_IOC_1</span> _IOW<span style="color: #51afef;">(</span>CMD_IOC_MAGIC, 1, <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span><span style="color: #51afef;">)</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">CMD_IOC_2</span> _IOW<span style="color: #51afef;">(</span>CMD_IOC_MAGIC, 2, <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span><span style="color: #51afef;">)</span>

<span style="color: #51afef; font-weight: bold;">#endif</span> <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">_INPUT_ENHANCE_H</span><span style="color: #5B6268;"> */</span>
</pre>
</div>

<p>
drivers &gt;&gt; input &gt;&gt; input-enhance.c
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">linux/module.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">linux/kernel.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">linux/init.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">linux/scpi_protocol.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">asm/io.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">linux/slab.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">linux/fs.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">linux/device.h</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #98be65;">"input-enhance.h"</span>

MODULE_LICENSE<span style="color: #51afef;">(</span><span style="color: #98be65;">"GPL"</span><span style="color: #51afef;">)</span>;
MODULE_AUTHOR<span style="color: #51afef;">(</span><span style="color: #98be65;">"guolongij@uniontech.com"</span><span style="color: #51afef;">)</span>;
MODULE_DESCRIPTION<span style="color: #51afef;">(</span><span style="color: #98be65;">"Driver to enhance input"</span><span style="color: #51afef;">)</span>;

<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span>      <span style="color: #dcaeea;">majorNumber</span>;
<span style="color: #51afef;">static</span> <span style="color: #51afef;">struct</span>   <span style="color: #ECBE7B;">class</span>*  <span style="color: #dcaeea;">enhance_module_class</span> = <span style="color: #a9a1e1;">NULL</span>;
<span style="color: #51afef;">static</span> <span style="color: #51afef;">struct</span>   <span style="color: #ECBE7B;">device</span>* <span style="color: #dcaeea;">enhance_module_device</span> = <span style="color: #a9a1e1;">NULL</span>;
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">DEVICE_NAME</span> <span style="color: #98be65;">"input_enhance"</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">CLASS_NAME</span>  <span style="color: #98be65;">"enhance_module"</span>


<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span> <span style="color: #dcaeea;">enhance_param_data</span> = <span style="color: #51afef;">{</span>
        0,
        0,
<span style="color: #51afef;">}</span>;
<span style="color: #c678dd;">EXPORT_SYMBOL</span><span style="color: #51afef;">(</span>enhance_param_data<span style="color: #51afef;">)</span>;


<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">long</span> <span style="color: #c678dd;">enhance_module_ioctl</span><span style="color: #51afef;">(</span><span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">file</span> *, <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span>, <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">long</span><span style="color: #51afef;">)</span>;
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">__init</span> enhance_init<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>;
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">void</span> <span style="color: #dcaeea;">__exit</span> enhance_exit<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>;


<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">file_operations</span> <span style="color: #dcaeea;">enhance_module_fo</span> = <span style="color: #51afef;">{</span>
        .owner = THIS_MODULE,
        .unlocked_ioctl = enhance_module_ioctl,
<span style="color: #51afef;">}</span>;


<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">long</span> <span style="color: #c678dd;">enhance_module_ioctl</span><span style="color: #51afef;">(</span><span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">file</span> *<span style="color: #dcaeea;">file</span>,
                 <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">cmd</span>,
                 <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">long</span> <span style="color: #dcaeea;">arg</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>

        <span style="color: #51afef;">switch</span><span style="color: #c678dd;">(</span>cmd<span style="color: #c678dd;">){</span>
        <span style="color: #51afef;">case</span> CMD_IOC_0:
        <span style="color: #98be65;">{</span>
                printk<span style="color: #a9a1e1;">(</span>KERN_INFO <span style="color: #98be65;">"[EnhanceModule:] Inner function (CMD_IOC_0) finished.\n"</span><span style="color: #a9a1e1;">)</span>;
                <span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>copy_to_user<span style="color: #4db5bd;">(</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span> <span style="color: #dcaeea;">__user</span> *<span style="color: #51afef;">)</span>arg, &amp;enhance_param_data, <span style="color: #51afef;">sizeof</span><span style="color: #51afef;">(</span><span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span><span style="color: #51afef;">)</span><span style="color: #4db5bd;">)</span><span style="color: #a9a1e1;">)</span>
                        <span style="color: #51afef;">return</span> -EFAULT;
                <span style="color: #51afef;">break</span>;
        <span style="color: #98be65;">}</span>
        <span style="color: #51afef;">case</span> CMD_IOC_1:
        <span style="color: #98be65;">{</span>
                printk<span style="color: #a9a1e1;">(</span>KERN_INFO <span style="color: #98be65;">"[EnhanceModule:] Inner function (CMD_IOC_1) finished.\n"</span><span style="color: #a9a1e1;">)</span>;
                <span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>copy_from_user<span style="color: #4db5bd;">(</span>&amp;enhance_param_data, <span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span> <span style="color: #dcaeea;">__user</span> *<span style="color: #51afef;">)</span>arg, <span style="color: #51afef;">sizeof</span><span style="color: #51afef;">(</span><span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span><span style="color: #51afef;">)</span><span style="color: #4db5bd;">)</span><span style="color: #a9a1e1;">)</span>
                        <span style="color: #51afef;">return</span> -EFAULT;
                <span style="color: #51afef;">break</span>;
        <span style="color: #98be65;">}</span>
        <span style="color: #51afef;">default</span>:
                printk<span style="color: #98be65;">(</span>KERN_INFO <span style="color: #98be65;">"[EnhanceModule:] Unknown ioctl cmd!\n"</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> -EINVAL;
        <span style="color: #c678dd;">}</span>
        <span style="color: #51afef;">return</span> 0;
<span style="color: #51afef;">}</span>


<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">__init</span> enhance_init<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
        printk<span style="color: #c678dd;">(</span>KERN_INFO <span style="color: #98be65;">"[EnhanceModule:] Entering test module. \n"</span><span style="color: #c678dd;">)</span>;
        majorNumber = register_chrdev<span style="color: #c678dd;">(</span>0, DEVICE_NAME, &amp;enhance_module_fo<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span><span style="color: #c678dd;">(</span>majorNumber &lt; 0<span style="color: #c678dd;">){</span>
                printk<span style="color: #98be65;">(</span>KERN_INFO <span style="color: #98be65;">"[EnhanceModule:] Failed to register a major number. \n"</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> majorNumber;
        <span style="color: #c678dd;">}</span>
        printk<span style="color: #c678dd;">(</span>KERN_INFO <span style="color: #98be65;">"[EnhanceModule:] Successful to register a major number %d. \n"</span>, majorNumber<span style="color: #c678dd;">)</span>;

        enhance_module_class = class_create<span style="color: #c678dd;">(</span>THIS_MODULE, CLASS_NAME<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span><span style="color: #c678dd;">(</span>IS_ERR<span style="color: #98be65;">(</span>enhance_module_class<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                unregister_chrdev<span style="color: #98be65;">(</span>majorNumber, DEVICE_NAME<span style="color: #98be65;">)</span>;
                printk<span style="color: #98be65;">(</span>KERN_INFO <span style="color: #98be65;">"[EnhanceModule:] Class device register failed!\n"</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> PTR_ERR<span style="color: #98be65;">(</span>enhance_module_class<span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span>
        printk<span style="color: #c678dd;">(</span>KERN_INFO <span style="color: #98be65;">"[EnhanceModule:] Class device register success!\n"</span><span style="color: #c678dd;">)</span>;

        enhance_module_device = device_create<span style="color: #c678dd;">(</span>enhance_module_class, <span style="color: #a9a1e1;">NULL</span>, MKDEV<span style="color: #98be65;">(</span>majorNumber, 0<span style="color: #98be65;">)</span>, <span style="color: #a9a1e1;">NULL</span>, DEVICE_NAME<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>IS_ERR<span style="color: #98be65;">(</span>enhance_module_device<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                class_destroy<span style="color: #98be65;">(</span>enhance_module_class<span style="color: #98be65;">)</span>;
                unregister_chrdev<span style="color: #98be65;">(</span>majorNumber, DEVICE_NAME<span style="color: #98be65;">)</span>;
                printk<span style="color: #98be65;">(</span>KERN_ALERT <span style="color: #98be65;">"Failed to create the device\n"</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> PTR_ERR<span style="color: #98be65;">(</span>enhance_module_device<span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span>
        printk<span style="color: #c678dd;">(</span>KERN_INFO <span style="color: #98be65;">"[EnhanceModule:] Test module register successful. \n"</span><span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">return</span> 0;
<span style="color: #51afef;">}</span>


<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">void</span> <span style="color: #dcaeea;">__exit</span> enhance_exit<span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        printk<span style="color: #c678dd;">(</span>KERN_INFO <span style="color: #98be65;">"[EnhanceModule:] Start to clean up module.\n"</span><span style="color: #c678dd;">)</span>;
        device_destroy<span style="color: #c678dd;">(</span>enhance_module_class, MKDEV<span style="color: #98be65;">(</span>majorNumber, 0<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>;
        class_destroy<span style="color: #c678dd;">(</span>enhance_module_class<span style="color: #c678dd;">)</span>;
        unregister_chrdev<span style="color: #c678dd;">(</span>majorNumber, DEVICE_NAME<span style="color: #c678dd;">)</span>;
        printk<span style="color: #c678dd;">(</span>KERN_INFO <span style="color: #98be65;">"[EnhanceModule:] Clean up successful. Bye.\n"</span><span style="color: #c678dd;">)</span>;

<span style="color: #51afef;">}</span>

<span style="color: #c678dd;">module_init</span><span style="color: #51afef;">(</span>enhance_init<span style="color: #51afef;">)</span>;
<span style="color: #c678dd;">module_exit</span><span style="color: #51afef;">(</span>enhance_exit<span style="color: #51afef;">)</span>;

</pre>
</div>


<p>
在drivers &gt;&gt; inoput &gt;&gt; input.c文件内添加内容
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #5B6268;">// </span><span style="color: #5B6268;">...</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #98be65;">"input-poller.h"</span>
<span style="color: #5B6268;">//</span><span style="color: #5B6268;">&#26032;&#22686;&#20869;&#23481;&#24320;&#22987;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #98be65;">"input-enhance.h"</span>

<span style="color: #51afef;">extern</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span> <span style="color: #dcaeea;">enhance_param_data</span>;
<span style="color: #5B6268;">//</span><span style="color: #5B6268;">&#26032;&#22686;&#20869;&#23481;&#32467;&#23614;</span>

MODULE_AUTHOR<span style="color: #51afef;">(</span><span style="color: #98be65;">"Vojtech Pavlik <a href="mailto:vojtech%40suse.cz">&lt;vojtech@suse.cz&gt;</a>"</span><span style="color: #51afef;">)</span>;
MODULE_DESCRIPTION<span style="color: #51afef;">(</span><span style="color: #98be65;">"Input core"</span><span style="color: #51afef;">)</span>;
MODULE_LICENSE<span style="color: #51afef;">(</span><span style="color: #98be65;">"GPL"</span><span style="color: #51afef;">)</span>;


<span style="color: #5B6268;">// </span><span style="color: #5B6268;">...</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">input_event</span><span style="color: #51afef;">(</span><span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">input_dev</span> *<span style="color: #dcaeea;">dev</span>,
                 <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">type</span>, <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">code</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">value</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">long</span> <span style="color: #dcaeea;">flags</span>;
    <span style="color: #5B6268;">//</span><span style="color: #5B6268;">&#26032;&#22686;&#20869;&#23481;&#24320;&#22987;</span>
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>enhance_param_data.enhance_state == 1 &amp;&amp; type == 0x01
                        &amp;&amp; code != 272 &amp;&amp; code != 273 &amp;&amp; code != 274<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                                code = code +1;
                        <span style="color: #c678dd;">}</span>
    <span style="color: #5B6268;">//</span><span style="color: #5B6268;">&#26032;&#22686;&#20869;&#23481;&#32467;&#23614;</span>

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>is_event_supported<span style="color: #98be65;">(</span>type, dev-&gt;evbit, EV_MAX<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>

                spin_lock_irqsave<span style="color: #98be65;">(</span>&amp;dev-&gt;event_lock, flags<span style="color: #98be65;">)</span>;
                input_handle_event<span style="color: #98be65;">(</span>dev, type, code, value<span style="color: #98be65;">)</span>;
                spin_unlock_irqrestore<span style="color: #98be65;">(</span>&amp;dev-&gt;event_lock, flags<span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>

</pre>
</div>
</div>
</div>

<div id="outline-container-org6c77db4" class="outline-3">
<h3 id="org6c77db4"><span class="section-number-3">1.2.</span> 配置内核</h3>
<div class="outline-text-3" id="text-1-2">
<p>
将input_enhance.h和input_enhance.c文件拷贝至linux内核源码下的drivers&gt;&gt;input目录下，
修改drivers&gt;&gt;input&gt;&gt;Makefile文件
</p>

<pre class="example">
#原先内容
input-core-y := input.o input-compat.o input-mt.o input-poller.o ff-core.o

#修改后的内容
input-core-y := input.o input-compat.o input-mt.o input-poller.o ff-core.o input-enhance.o
</pre>

<p>
修改drivers&gt;&gt;input&gt;&gt;Kconfig文件，增加如下内容
</p>

<pre class="example">
config INPUT_ENHANCE
        bool "Input Enhance"
        default y
        help
                Say y herel if you want enhance input.
                To compile this driver as a module,choose M here: the module will be called input_enhance.
</pre>
</div>
</div>

<div id="outline-container-orgedac1c3" class="outline-3">
<h3 id="orgedac1c3"><span class="section-number-3">1.3.</span> 编译并替换内核</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-bash">make
make modules
make install
make modules_install
reboot
<span style="color: #5B6268;">#</span><span style="color: #5B6268;">&#37325;&#21551;&#21518;&#65292;&#36873;&#25321;&#26032;&#32534;&#35793;&#30340;&#20869;&#26680;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb93e06" class="outline-3">
<h3 id="orgbb93e06"><span class="section-number-3">1.4.</span> 编译libinput_enhance库</h3>
<div class="outline-text-3" id="text-1-4">
<p>
libinput_enhance.h
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #51afef; font-weight: bold;">#if</span><span style="color: #51afef; font-weight: bold;">n</span><span style="color: #51afef; font-weight: bold;">def</span> _LIBINPUT_ENHANCE_H
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">_LIBINPUT_ENHANCE_H</span>

<span style="color: #51afef; font-weight: bold;">#ifdef</span> __cplusplus
<span style="color: #51afef;">extern</span> <span style="color: #98be65;">"C"</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #c678dd;">&lt;</span><span style="color: #98be65;">stdlib.h</span><span style="color: #c678dd;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #c678dd;">&lt;</span><span style="color: #98be65;">stdint.h</span><span style="color: #c678dd;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #c678dd;">&lt;</span><span style="color: #98be65;">stdarg.h</span><span style="color: #c678dd;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #c678dd;">&lt;</span><span style="color: #98be65;">stdbool.h</span><span style="color: #c678dd;">&gt;</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@ingroup</span><span style="color: #83898d;"> config</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * Set kernel input enhance public key</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * Todo</span>
<span style="color: #83898d;"> */</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@ingroup</span><span style="color: #83898d;"> config</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * Get kernel input enhance state</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> true if kernel input enhance is open</span>
<span style="color: #83898d;"> */</span>
<span style="color: #ECBE7B;">bool</span> <span style="color: #c678dd;">libinput_enhance_is_enhance</span><span style="color: #c678dd;">()</span>;

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@ingroup</span><span style="color: #83898d;"> config</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * Decrypt the reported code value</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> keycode The encryted code</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> The decrypt code value</span>
<span style="color: #83898d;"> */</span>
<span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">short</span> <span style="color: #c678dd;">libinput_enhance_decode_keycode</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">short</span> <span style="color: #dcaeea;">keycode</span><span style="color: #c678dd;">)</span>;


<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@ingroup</span><span style="color: #83898d;"> config</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * Set kernel start or stop enhance process</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> start True is start, false is stop</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> 0 is success</span>
<span style="color: #83898d;"> */</span>
<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">libinput_enhance_start_or_stop_enhance</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">bool</span> <span style="color: #dcaeea;">start</span><span style="color: #c678dd;">)</span>;


<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@ingroup</span><span style="color: #83898d;"> config</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * Set kernel encrypt data by specific algrithm</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> type algrithm type</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> pkey optional public key for some algrithms</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> 0 is success</span>
<span style="color: #83898d;"> */</span>
<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">libinput_enhance_set_encrypt_info</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">type</span>, <span style="color: #ECBE7B;">char</span> * <span style="color: #dcaeea;">pkey</span><span style="color: #c678dd;">)</span>;


<span style="color: #51afef; font-weight: bold;">#ifdef</span> __cplusplus
<span style="color: #51afef;">}</span>
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef; font-weight: bold;">#endif</span> <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">_LIBINPUT_ENHANCE_H</span><span style="color: #5B6268;"> */</span>
</pre>
</div>

<p>
libinput_enhance.c
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">errno.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">inttypes.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdlib.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdint.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdarg.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">fcntl.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">unistd.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">sys/ioctl.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdbool.h</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span> <span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">enhance_state</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">encrypt_type</span>;
        <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">public_key</span>;
<span style="color: #51afef;">}</span>;

<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">CMD_IOC_MAGIC</span>   <span style="color: #98be65;">'a'</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">CMD_IOC_0</span>       _IOR<span style="color: #51afef;">(</span>CMD_IOC_MAGIC, 0, <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span><span style="color: #51afef;">)</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">CMD_IOC_1</span>       _IOW<span style="color: #51afef;">(</span>CMD_IOC_MAGIC, 1, <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span><span style="color: #51afef;">)</span>

<span style="color: #ECBE7B;">bool</span>
<span style="color: #c678dd;">libinput_enhance_is_enhance</span><span style="color: #51afef;">()</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span>;
        <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span> <span style="color: #dcaeea;">p</span>;
        fd = open<span style="color: #c678dd;">(</span><span style="color: #98be65;">"/dev/input_enhance"</span>, O_RDWR<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>fd &lt; 0<span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">false</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">ret</span> = ioctl<span style="color: #c678dd;">(</span>fd, CMD_IOC_0, &amp;p<span style="color: #c678dd;">)</span>;
        close<span style="color: #c678dd;">(</span>fd<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>p.enhance_state == 1<span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">true</span>;
        <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">false</span>;
<span style="color: #51afef;">}</span>


<span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">short</span>
<span style="color: #c678dd;">libinput_enhance_decode_keycode</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">short</span> <span style="color: #dcaeea;">keycode</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #51afef;">return</span> <span style="color: #c678dd;">(</span>keycode - 1<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>



<span style="color: #ECBE7B;">int</span>
<span style="color: #c678dd;">libinput_enhance_start_or_stop_enhance</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">bool</span> <span style="color: #dcaeea;">start</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span>;
        <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span> <span style="color: #dcaeea;">p</span>;
        <span style="color: #51afef;">if</span><span style="color: #c678dd;">(</span>start<span style="color: #c678dd;">)</span>
                p.enhance_state = 1;
        <span style="color: #51afef;">else</span>
                p.enhance_state = 0;
        fd = open<span style="color: #c678dd;">(</span><span style="color: #98be65;">"/dev/input_enhance"</span>, O_RDWR<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>fd &lt; 0<span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">return</span> 1;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">ret</span> = ioctl<span style="color: #c678dd;">(</span>fd, CMD_IOC_1, &amp;p<span style="color: #c678dd;">)</span>;
        close<span style="color: #c678dd;">(</span>fd<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">return</span> ret;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span>
<span style="color: #c678dd;">libinput_enhance_set_encrypt_info</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">type</span>, <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">pkey</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span>;
        <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">enhance_param</span> <span style="color: #dcaeea;">p</span>;
        fd = open<span style="color: #c678dd;">(</span><span style="color: #98be65;">"/dev/input_enhance"</span>, O_RDWR<span style="color: #c678dd;">)</span>;
        p.encrypt_type = type;
        p.public_key = pkey;
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>fd &lt; 0<span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">false</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">ret</span> = ioctl<span style="color: #c678dd;">(</span>fd, CMD_IOC_1, &amp;p<span style="color: #c678dd;">)</span>;
        close<span style="color: #c678dd;">(</span>fd<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>p.enhance_state == 1<span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">true</span>;
        <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">false</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
编译
</p>

<pre class="example">
#编译成动态库：
gcc -c libinput_enhance.c -o libinput_enhance.o -fPIC
gcc libinput_enhance.o -o libinput_enhance.so -shared

#编译成静态库：
ar -crv libinput_enhance.a libinput_enhance.o
</pre>
</div>
</div>

<div id="outline-container-org64e9fdd" class="outline-3">
<h3 id="org64e9fdd"><span class="section-number-3">1.5.</span> 编写测试用例</h3>
<div class="outline-text-3" id="text-1-5">
<p>
demo.c
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #98be65;">"libinput_enhance.h"</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">_GNU_SOURCE</span> <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">for asprintf</span><span style="color: #5B6268;"> */</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdio.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdint.h</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef; font-weight: bold;">#if</span> HAVE_CONFIG_H
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">config.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">linux/input.h</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">string.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">fcntl.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">unistd.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdlib.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">dirent.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">errno.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">getopt.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">ctype.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">signal.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">limits.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">sys/time.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">sys/types.h</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef; font-weight: bold;">#if</span><span style="color: #51afef; font-weight: bold;">n</span><span style="color: #51afef; font-weight: bold;">def</span> input_event_sec
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">input_event_sec</span> time.tv_sec
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">input_event_usec</span> time.tv_usec
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">BITS_PER_LONG</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">sizeof</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">long</span><span style="color: #c678dd;">)</span> * 8<span style="color: #51afef;">)</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">NBITS</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">x</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span>-1<span style="color: #98be65;">)</span>/BITS_PER_LONG<span style="color: #c678dd;">)</span>+1<span style="color: #51afef;">)</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">OFF</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">x</span><span style="color: #51afef;">)</span>  <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>%BITS_PER_LONG<span style="color: #51afef;">)</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">BIT</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">x</span><span style="color: #51afef;">)</span>  <span style="color: #51afef;">(</span>1UL&lt;&lt;OFF<span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">LONG</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">x</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>/BITS_PER_LONG<span style="color: #51afef;">)</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">test_bit</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">bit</span>, <span style="color: #dcaeea;">array</span><span style="color: #51afef;">)</span>    <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>array<span style="color: #98be65;">[</span>LONG<span style="color: #a9a1e1;">(</span>bit<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">]</span> &gt;&gt; OFF<span style="color: #98be65;">(</span>bit<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> &amp; 1<span style="color: #51afef;">)</span>

<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">DEV_INPUT_EVENT</span> <span style="color: #98be65;">"/dev/input"</span>
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">EVENT_DEV_NAME</span> <span style="color: #98be65;">"event"</span>

<span style="color: #51afef; font-weight: bold;">#if</span><span style="color: #51afef; font-weight: bold;">n</span><span style="color: #51afef; font-weight: bold;">def</span> EV_SYN
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">EV_SYN</span> 0
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#if</span><span style="color: #51afef; font-weight: bold;">n</span><span style="color: #51afef; font-weight: bold;">def</span> SYN_MAX
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">SYN_MAX</span> 3
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">SYN_CNT</span> <span style="color: #51afef;">(</span>SYN_MAX + 1<span style="color: #51afef;">)</span>
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#if</span><span style="color: #51afef; font-weight: bold;">n</span><span style="color: #51afef; font-weight: bold;">def</span> SYN_MT_REPORT
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">SYN_MT_REPORT</span> 2
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#if</span><span style="color: #51afef; font-weight: bold;">n</span><span style="color: #51afef; font-weight: bold;">def</span> SYN_DROPPED
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">SYN_DROPPED</span> 3
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">NAME_ELEMENT</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">element</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">[</span>element<span style="color: #51afef;">]</span> = #element

<span style="color: #51afef;">enum</span> <span style="color: #ECBE7B;">evtest_mode</span> <span style="color: #51afef;">{</span>
        <span style="color: #dcaeea;">MODE_CAPTURE</span>,
        <span style="color: #dcaeea;">MODE_QUERY</span>,
        <span style="color: #dcaeea;">MODE_VERSION</span>,
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">query_mode</span> <span style="color: #51afef;">{</span>
        <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">name</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">event_type</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">max</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">rq</span>;
<span style="color: #51afef;">}</span> <span style="color: #dcaeea;">query_modes</span><span style="color: #51afef;">[]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">{</span> <span style="color: #98be65;">"EV_KEY"</span>, EV_KEY, KEY_MAX, EVIOCGKEY<span style="color: #98be65;">(</span>KEY_MAX<span style="color: #98be65;">)</span> <span style="color: #c678dd;">}</span>,
        <span style="color: #c678dd;">{</span> <span style="color: #98be65;">"EV_LED"</span>, EV_LED, LED_MAX, EVIOCGLED<span style="color: #98be65;">(</span>LED_MAX<span style="color: #98be65;">)</span> <span style="color: #c678dd;">}</span>,
        <span style="color: #c678dd;">{</span> <span style="color: #98be65;">"EV_SND"</span>, EV_SND, SND_MAX, EVIOCGSND<span style="color: #98be65;">(</span>SND_MAX<span style="color: #98be65;">)</span> <span style="color: #c678dd;">}</span>,
        <span style="color: #c678dd;">{</span> <span style="color: #98be65;">"EV_SW"</span>,  EV_SW, SW_MAX, EVIOCGSW<span style="color: #98be65;">(</span>SW_MAX<span style="color: #98be65;">)</span> <span style="color: #c678dd;">}</span>,
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">grab_flag</span> = 0;
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">char</span>* <span style="color: #dcaeea;">progname</span>;
<span style="color: #51afef;">static</span> <span style="color: #51afef;">volatile</span> <span style="color: #ECBE7B;">sig_atomic_t</span> <span style="color: #dcaeea;">stop</span> = 0;

<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">interrupt_handler</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">sig</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        stop = 1;
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Look up an entry in the query_modes table by its textual name.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> mode The name of the entry to be found.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> The requested query_mode, or NULL if it could not be found.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">query_mode</span> *<span style="color: #c678dd;">find_query_mode_by_name</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">name</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>;
        <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span>i = 0; i &lt; <span style="color: #51afef;">sizeof</span><span style="color: #98be65;">(</span>query_modes<span style="color: #98be65;">)</span> / <span style="color: #51afef;">sizeof</span><span style="color: #98be65;">(</span>*query_modes<span style="color: #98be65;">)</span>; i++<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                <span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">query_mode</span> *<span style="color: #dcaeea;">mode</span> = &amp;query_modes<span style="color: #98be65;">[</span>i<span style="color: #98be65;">]</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>strcmp<span style="color: #a9a1e1;">(</span>mode-&gt;name, name<span style="color: #a9a1e1;">)</span> == 0<span style="color: #98be65;">)</span>
                        <span style="color: #51afef;">return</span> mode;
        <span style="color: #c678dd;">}</span>
        <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">NULL</span>;
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Look up an entry in the query_modes table by value.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> event_type The value of the entry to be found.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> The requested query_mode, or NULL if it could not be found.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">query_mode</span> *<span style="color: #c678dd;">find_query_mode_by_value</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">event_type</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>;
        <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span>i = 0; i &lt; <span style="color: #51afef;">sizeof</span><span style="color: #98be65;">(</span>query_modes<span style="color: #98be65;">)</span> / <span style="color: #51afef;">sizeof</span><span style="color: #98be65;">(</span>*query_modes<span style="color: #98be65;">)</span>; i++<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                <span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">query_mode</span> *<span style="color: #dcaeea;">mode</span> = &amp;query_modes<span style="color: #98be65;">[</span>i<span style="color: #98be65;">]</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>mode-&gt;event_type == event_type<span style="color: #98be65;">)</span>
                        <span style="color: #51afef;">return</span> mode;
        <span style="color: #c678dd;">}</span>
        <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">NULL</span>;
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Find a query_mode based on a string identifier. The string can either</span>
<span style="color: #83898d;"> * be a numerical value (e.g. "5") or the name of the event type in question</span>
<span style="color: #83898d;"> * (e.g. "EV_SW").</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> query_mode The mode to search for</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> The requested code's numerical value, or negative on error.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">query_mode</span> *<span style="color: #c678dd;">find_query_mode</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">query_mode</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>isdigit<span style="color: #98be65;">(</span>query_mode<span style="color: #a9a1e1;">[</span>0<span style="color: #a9a1e1;">]</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">long</span> <span style="color: #dcaeea;">val</span>;
                errno = 0;
                val = strtoul<span style="color: #98be65;">(</span>query_mode, <span style="color: #a9a1e1;">NULL</span>, 0<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>errno<span style="color: #98be65;">)</span>
                        <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">NULL</span>;
                <span style="color: #51afef;">return</span> find_query_mode_by_value<span style="color: #98be65;">(</span>val<span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span> <span style="color: #51afef;">else</span> <span style="color: #c678dd;">{</span>
                <span style="color: #51afef;">return</span> find_query_mode_by_name<span style="color: #98be65;">(</span>query_mode<span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">events</span><span style="color: #51afef;">[</span>EV_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... EV_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_SYN<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_KEY<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_REL<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_ABS<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_MSC<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_LED<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_SND<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_REP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_FF<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_PWR<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_FF_STATUS<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>EV_SW<span style="color: #c678dd;">)</span>,
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">maxval</span><span style="color: #51afef;">[</span>EV_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... EV_MAX<span style="color: #c678dd;">]</span> = -1,
        <span style="color: #c678dd;">[</span>EV_SYN<span style="color: #c678dd;">]</span> = SYN_MAX,
        <span style="color: #c678dd;">[</span>EV_KEY<span style="color: #c678dd;">]</span> = KEY_MAX,
        <span style="color: #c678dd;">[</span>EV_REL<span style="color: #c678dd;">]</span> = REL_MAX,
        <span style="color: #c678dd;">[</span>EV_ABS<span style="color: #c678dd;">]</span> = ABS_MAX,
        <span style="color: #c678dd;">[</span>EV_MSC<span style="color: #c678dd;">]</span> = MSC_MAX,
        <span style="color: #c678dd;">[</span>EV_SW<span style="color: #c678dd;">]</span> = SW_MAX,
        <span style="color: #c678dd;">[</span>EV_LED<span style="color: #c678dd;">]</span> = LED_MAX,
        <span style="color: #c678dd;">[</span>EV_SND<span style="color: #c678dd;">]</span> = SND_MAX,
        <span style="color: #c678dd;">[</span>EV_REP<span style="color: #c678dd;">]</span> = REP_MAX,
        <span style="color: #c678dd;">[</span>EV_FF<span style="color: #c678dd;">]</span> = FF_MAX,
        <span style="color: #c678dd;">[</span>EV_FF_STATUS<span style="color: #c678dd;">]</span> = FF_STATUS_MAX,
<span style="color: #51afef;">}</span>;


<span style="color: #51afef; font-weight: bold;">#ifdef</span> INPUT_PROP_SEMI_MT
<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">props</span><span style="color: #51afef;">[</span>INPUT_PROP_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... INPUT_PROP_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>INPUT_PROP_POINTER<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>INPUT_PROP_DIRECT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>INPUT_PROP_BUTTONPAD<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>INPUT_PROP_SEMI_MT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> INPUT_PROP_TOPBUTTONPAD
        NAME_ELEMENT<span style="color: #c678dd;">(</span>INPUT_PROP_TOPBUTTONPAD<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> INPUT_PROP_POINTING_STICK
        NAME_ELEMENT<span style="color: #c678dd;">(</span>INPUT_PROP_POINTING_STICK<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> INPUT_PROP_ACCELEROMETER
        NAME_ELEMENT<span style="color: #c678dd;">(</span>INPUT_PROP_ACCELEROMETER<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef;">}</span>;
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">keys</span><span style="color: #51afef;">[</span>KEY_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... KEY_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RESERVED<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ESC<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_1<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_2<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_3<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_4<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_5<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_6<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_7<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_8<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_9<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_0<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MINUS<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_EQUAL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BACKSPACE<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TAB<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_Q<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_W<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_E<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_R<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_T<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_Y<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_U<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_I<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_O<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_P<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LEFTBRACE<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RIGHTBRACE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ENTER<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LEFTCTRL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_A<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_S<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_D<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_G<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_H<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_J<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_K<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_L<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SEMICOLON<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_APOSTROPHE<span style="color: #c678dd;">)</span>,           NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_GRAVE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LEFTSHIFT<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BACKSLASH<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_Z<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_X<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_C<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_V<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_B<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_N<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_M<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_COMMA<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DOT<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SLASH<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RIGHTSHIFT<span style="color: #c678dd;">)</span>,           NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPASTERISK<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LEFTALT<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SPACE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CAPSLOCK<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F1<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F2<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F3<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F4<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F5<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F6<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F7<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F8<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F9<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F10<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMLOCK<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SCROLLLOCK<span style="color: #c678dd;">)</span>,           NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KP7<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KP8<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KP9<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPMINUS<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KP4<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KP5<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KP6<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPPLUS<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KP1<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KP2<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KP3<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KP0<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPDOT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ZENKAKUHANKAKU<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_102ND<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F11<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F12<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RO<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KATAKANA<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_HIRAGANA<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_HENKAN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KATAKANAHIRAGANA<span style="color: #c678dd;">)</span>,     NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MUHENKAN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPJPCOMMA<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPENTER<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RIGHTCTRL<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPSLASH<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SYSRQ<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RIGHTALT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LINEFEED<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_HOME<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_UP<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PAGEUP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LEFT<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RIGHT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_END<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DOWN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PAGEDOWN<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_INSERT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DELETE<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MACRO<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MUTE<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VOLUMEDOWN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VOLUMEUP<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_POWER<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPEQUAL<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPPLUSMINUS<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PAUSE<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPCOMMA<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_HANGUEL<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_HANJA<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_YEN<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LEFTMETA<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RIGHTMETA<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_COMPOSE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_STOP<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_AGAIN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PROPS<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_UNDO<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FRONT<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_COPY<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_OPEN<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PASTE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FIND<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CUT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_HELP<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MENU<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CALC<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SETUP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SLEEP<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_WAKEUP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FILE<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SENDFILE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DELETEFILE<span style="color: #c678dd;">)</span>,           NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_XFER<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PROG1<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PROG2<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_WWW<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MSDOS<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_COFFEE<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DIRECTION<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CYCLEWINDOWS<span style="color: #c678dd;">)</span>,         NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MAIL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BOOKMARKS<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_COMPUTER<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BACK<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FORWARD<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CLOSECD<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_EJECTCD<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_EJECTCLOSECD<span style="color: #c678dd;">)</span>,         NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NEXTSONG<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PLAYPAUSE<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PREVIOUSSONG<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_STOPCD<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RECORD<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_REWIND<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PHONE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ISO<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CONFIG<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_HOMEPAGE<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_REFRESH<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_EXIT<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MOVE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_EDIT<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SCROLLUP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SCROLLDOWN<span style="color: #c678dd;">)</span>,           NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPLEFTPAREN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KPRIGHTPAREN<span style="color: #c678dd;">)</span>,         NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F13<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F14<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F15<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F16<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F17<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F18<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F19<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F20<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F21<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F22<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F23<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_F24<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PLAYCD<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PAUSECD<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PROG3<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PROG4<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SUSPEND<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CLOSE<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PLAY<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FASTFORWARD<span style="color: #c678dd;">)</span>,          NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BASSBOOST<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PRINT<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_HP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CAMERA<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SOUND<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_QUESTION<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_EMAIL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CHAT<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SEARCH<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CONNECT<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FINANCE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SPORT<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SHOP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ALTERASE<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CANCEL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRIGHTNESSDOWN<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRIGHTNESSUP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MEDIA<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_UNKNOWN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_OK<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SELECT<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_GOTO<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CLEAR<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_POWER2<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_OPTION<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_INFO<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TIME<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VENDOR<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ARCHIVE<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PROGRAM<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CHANNEL<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FAVORITES<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_EPG<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PVR<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MHP<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LANGUAGE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TITLE<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SUBTITLE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ANGLE<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ZOOM<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MODE<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KEYBOARD<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SCREEN<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PC<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TV<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TV2<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VCR<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VCR2<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SAT<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SAT2<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CD<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TAPE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RADIO<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TUNER<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PLAYER<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TEXT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DVD<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_AUX<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MP3<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_AUDIO<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VIDEO<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DIRECTORY<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LIST<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MEMO<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CALENDAR<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RED<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_GREEN<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_YELLOW<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BLUE<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CHANNELUP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CHANNELDOWN<span style="color: #c678dd;">)</span>,          NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FIRST<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LAST<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_AB<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NEXT<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RESTART<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SLOW<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SHUFFLE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BREAK<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PREVIOUS<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DIGITS<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TEEN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TWEN<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DEL_EOL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DEL_EOS<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_INS_LINE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DEL_LINE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VIDEOPHONE<span style="color: #c678dd;">)</span>,           NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_GAMES<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ZOOMIN<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ZOOMOUT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ZOOMRESET<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_WORDPROCESSOR<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_EDITOR<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SPREADSHEET<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_GRAPHICSEDITOR<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PRESENTATION<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DATABASE<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NEWS<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VOICEMAIL<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ADDRESSBOOK<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MESSENGER<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DISPLAYTOGGLE<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_SPELLCHECK
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SPELLCHECK<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_LOGOFF
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LOGOFF<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_DOLLAR
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DOLLAR<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_EURO
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_EURO<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_FRAMEBACK
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FRAMEBACK<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_FRAMEFORWARD
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FRAMEFORWARD<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_CONTEXT_MENU
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CONTEXT_MENU<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_MEDIA_REPEAT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MEDIA_REPEAT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_10CHANNELSUP
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_10CHANNELSUP<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_10CHANNELSDOWN
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_10CHANNELSDOWN<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_IMAGES
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_IMAGES<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DEL_EOL<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DEL_EOS<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_INS_LINE<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DEL_LINE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_ESC<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F1<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F2<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F3<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F4<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F5<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F6<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F7<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F8<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F9<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F10<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F11<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F12<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_1<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_2<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_D<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_E<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_F<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_S<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FN_B<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRL_DOT1<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRL_DOT2<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRL_DOT3<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRL_DOT4<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRL_DOT5<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRL_DOT6<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRL_DOT7<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRL_DOT8<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRL_DOT9<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRL_DOT10<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_NUMERIC_0
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_0<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_1<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_2<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_3<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_4<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_5<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_6<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_7<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_8<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_9<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_STAR<span style="color: #c678dd;">)</span>,         NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_POUND<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_NUMERIC_11
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_11<span style="color: #c678dd;">)</span>,           NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NUMERIC_12<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BATTERY<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BLUETOOTH<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRIGHTNESS_CYCLE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRIGHTNESS_ZERO<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_DASHBOARD
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DASHBOARD<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DISPLAY_OFF<span style="color: #c678dd;">)</span>,          NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DOCUMENTS<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FORWARDMAIL<span style="color: #c678dd;">)</span>,          NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NEW<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KBDILLUMDOWN<span style="color: #c678dd;">)</span>,         NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KBDILLUMUP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KBDILLUMTOGGLE<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_REDO<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_REPLY<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SAVE<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_SCALE
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SCALE<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SEND<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SCREENLOCK<span style="color: #c678dd;">)</span>,           NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SWITCHVIDEOMODE<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_UWB
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_UWB<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_VIDEO_NEXT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VIDEO_NEXT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_VIDEO_PREV
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VIDEO_PREV<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_WIMAX
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_WIMAX<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_WLAN
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_WLAN<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_RFKILL
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RFKILL<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_MICMUTE
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MICMUTE<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_CAMERA_FOCUS
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CAMERA_FOCUS<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_WPS_BUTTON
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_WPS_BUTTON<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_TOUCHPAD_TOGGLE
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TOUCHPAD_TOGGLE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TOUCHPAD_ON<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TOUCHPAD_OFF<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_CAMERA_ZOOMIN
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CAMERA_ZOOMIN<span style="color: #c678dd;">)</span>,        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CAMERA_ZOOMOUT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CAMERA_UP<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CAMERA_DOWN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CAMERA_LEFT<span style="color: #c678dd;">)</span>,          NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CAMERA_RIGHT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_ATTENDANT_ON
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ATTENDANT_ON<span style="color: #c678dd;">)</span>,         NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ATTENDANT_OFF<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ATTENDANT_TOGGLE<span style="color: #c678dd;">)</span>,     NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LIGHTS_TOGGLE<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>

        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_0<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_1<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_2<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_3<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_4<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_5<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_6<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_7<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_8<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_9<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_LEFT<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_RIGHT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_MIDDLE<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_SIDE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_EXTRA<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_FORWARD<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_BACK<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TASK<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_THUMB<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_THUMB2<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOP2<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_PINKIE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_BASE<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_BASE2<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_BASE3<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_BASE4<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_BASE5<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_BASE6<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_DEAD<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_C<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> BTN_SOUTH
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_SOUTH<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_EAST<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_NORTH<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_WEST<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#else</span>
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_A<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_B<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_X<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_Y<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_Z<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TR<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TL2<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TR2<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_SELECT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_START<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_MODE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_THUMBL<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_THUMBR<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_PEN<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_RUBBER<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_BRUSH<span style="color: #c678dd;">)</span>,           NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_PENCIL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_AIRBRUSH<span style="color: #c678dd;">)</span>,        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_FINGER<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_MOUSE<span style="color: #c678dd;">)</span>,           NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_LENS<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> BTN_STYLUS3
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_STYLUS3<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOUCH<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_STYLUS<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_STYLUS2<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_DOUBLETAP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_TRIPLETAP<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> BTN_TOOL_QUADTAP
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_QUADTAP<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_GEAR_DOWN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_GEAR_UP<span style="color: #c678dd;">)</span>,

<span style="color: #51afef; font-weight: bold;">#ifdef</span> BTN_DPAD_UP
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_DPAD_UP<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_DPAD_DOWN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_DPAD_LEFT<span style="color: #c678dd;">)</span>,            NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_DPAD_RIGHT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_ALS_TOGGLE
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ALS_TOGGLE<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_BUTTONCONFIG
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BUTTONCONFIG<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_TASKMANAGER
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_TASKMANAGER<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_JOURNAL
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_JOURNAL<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_CONTROLPANEL
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_CONTROLPANEL<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_APPSELECT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_APPSELECT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_SCREENSAVER
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SCREENSAVER<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_VOICECOMMAND
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VOICECOMMAND<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_ASSISTANT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ASSISTANT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_BRIGHTNESS_MIN
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRIGHTNESS_MIN<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_BRIGHTNESS_MAX
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_BRIGHTNESS_MAX<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_KBDINPUTASSIST_PREV
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KBDINPUTASSIST_PREV<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_KBDINPUTASSIST_NEXT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KBDINPUTASSIST_NEXT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_KBDINPUTASSIST_PREVGROUP
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KBDINPUTASSIST_PREVGROUP<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_KBDINPUTASSIST_NEXTGROUP
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KBDINPUTASSIST_NEXTGROUP<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_KBDINPUTASSIST_ACCEPT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KBDINPUTASSIST_ACCEPT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_KBDINPUTASSIST_CANCEL
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_KBDINPUTASSIST_CANCEL<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_RIGHT_UP
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RIGHT_UP<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_RIGHT_DOWN<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LEFT_UP<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_LEFT_DOWN<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_ROOT_MENU
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ROOT_MENU<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_MEDIA_TOP_MENU<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_AUDIO_DESC<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_3D_MODE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_NEXT_FAVORITE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_STOP_RECORD<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_PAUSE_RECORD<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_VOD<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_UNMUTE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_FASTREVERSE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_SLOWREVERSE<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_DATA
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_DATA<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef; font-weight: bold;">#ifdef</span> KEY_ONSCREEN_KEYBOARD
        NAME_ELEMENT<span style="color: #c678dd;">(</span>KEY_ONSCREEN_KEYBOARD<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef; font-weight: bold;">#ifdef</span> BTN_TRIGGER_HAPPY
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY1<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY11<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY2<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY12<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY3<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY13<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY4<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY14<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY5<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY15<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY6<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY16<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY7<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY17<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY8<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY18<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY9<span style="color: #c678dd;">)</span>,       NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY19<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY10<span style="color: #c678dd;">)</span>,      NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY20<span style="color: #c678dd;">)</span>,

        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY21<span style="color: #c678dd;">)</span>,      NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY31<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY22<span style="color: #c678dd;">)</span>,      NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY32<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY23<span style="color: #c678dd;">)</span>,      NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY33<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY24<span style="color: #c678dd;">)</span>,      NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY34<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY25<span style="color: #c678dd;">)</span>,      NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY35<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY26<span style="color: #c678dd;">)</span>,      NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY36<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY27<span style="color: #c678dd;">)</span>,      NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY37<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY28<span style="color: #c678dd;">)</span>,      NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY38<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY29<span style="color: #c678dd;">)</span>,      NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY39<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY30<span style="color: #c678dd;">)</span>,      NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TRIGGER_HAPPY40<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> BTN_TOOL_QUINTTAP
        NAME_ELEMENT<span style="color: #c678dd;">(</span>BTN_TOOL_QUINTTAP<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">absval</span><span style="color: #51afef;">[</span>6<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span> <span style="color: #98be65;">"Value"</span>, <span style="color: #98be65;">"Min  "</span>, <span style="color: #98be65;">"Max  "</span>, <span style="color: #98be65;">"Fuzz "</span>, <span style="color: #98be65;">"Flat "</span>, <span style="color: #98be65;">"Resolution "</span><span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">relatives</span><span style="color: #51afef;">[</span>REL_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... REL_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_X<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_Y<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_Z<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_RX<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_RY<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_RZ<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_HWHEEL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_DIAL<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_WHEEL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_MISC<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> REL_WHEEL_HI_RES
        NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_WHEEL_HI_RES<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>REL_HWHEEL_HI_RES<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">absolutes</span><span style="color: #51afef;">[</span>ABS_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... ABS_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_X<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_Y<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_Z<span style="color: #c678dd;">)</span>,                    NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_RX<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_RY<span style="color: #c678dd;">)</span>,                   NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_RZ<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_THROTTLE<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_RUDDER<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_WHEEL<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_GAS<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_BRAKE<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_HAT0X<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_HAT0Y<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_HAT1X<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_HAT1Y<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_HAT2X<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_HAT2Y<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_HAT3X<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_HAT3Y<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_PRESSURE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_DISTANCE<span style="color: #c678dd;">)</span>,             NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_TILT_X<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_TILT_Y<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_TOOL_WIDTH<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_VOLUME<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MISC<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> ABS_MT_BLOB_ID
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_TOUCH_MAJOR<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_TOUCH_MINOR<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_WIDTH_MAJOR<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_WIDTH_MINOR<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_ORIENTATION<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_POSITION_X<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_POSITION_Y<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_TOOL_TYPE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_BLOB_ID<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> ABS_MT_TRACKING_ID
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_TRACKING_ID<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> ABS_MT_PRESSURE
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_PRESSURE<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> ABS_MT_SLOT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_SLOT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> ABS_MT_TOOL_X
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_TOOL_X<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_TOOL_Y<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>ABS_MT_DISTANCE<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">misc</span><span style="color: #51afef;">[</span>MSC_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span> 0 ... MSC_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>MSC_SERIAL<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>MSC_PULSELED<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>MSC_GESTURE<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>MSC_RAW<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>MSC_SCAN<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> MSC_TIMESTAMP
        NAME_ELEMENT<span style="color: #c678dd;">(</span>MSC_TIMESTAMP<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">leds</span><span style="color: #51afef;">[</span>LED_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... LED_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>LED_NUML<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>LED_CAPSL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>LED_SCROLLL<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>LED_COMPOSE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>LED_KANA<span style="color: #c678dd;">)</span>,                 NAME_ELEMENT<span style="color: #c678dd;">(</span>LED_SLEEP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>LED_SUSPEND<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>LED_MUTE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>LED_MISC<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> LED_MAIL
        NAME_ELEMENT<span style="color: #c678dd;">(</span>LED_MAIL<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> LED_CHARGING
        NAME_ELEMENT<span style="color: #c678dd;">(</span>LED_CHARGING<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">repeats</span><span style="color: #51afef;">[</span>REP_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... REP_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>REP_DELAY<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>REP_PERIOD<span style="color: #c678dd;">)</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">sounds</span><span style="color: #51afef;">[</span>SND_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... SND_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SND_CLICK<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>SND_BELL<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SND_TONE<span style="color: #c678dd;">)</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">syns</span><span style="color: #51afef;">[</span>SYN_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... SYN_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SYN_REPORT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SYN_CONFIG<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SYN_MT_REPORT<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SYN_DROPPED<span style="color: #c678dd;">)</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">switches</span><span style="color: #51afef;">[</span>SW_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... SW_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_LID<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_TABLET_MODE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_HEADPHONE_INSERT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#ifdef</span> SW_RFKILL_ALL
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_RFKILL_ALL<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> SW_MICROPHONE_INSERT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_MICROPHONE_INSERT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> SW_DOCK
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_DOCK<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> SW_LINEOUT_INSERT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_LINEOUT_INSERT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> SW_JACK_PHYSICAL_INSERT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_JACK_PHYSICAL_INSERT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> SW_VIDEOOUT_INSERT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_VIDEOOUT_INSERT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> SW_CAMERA_LENS_COVER
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_CAMERA_LENS_COVER<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_KEYPAD_SLIDE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_FRONT_PROXIMITY<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> SW_ROTATE_LOCK
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_ROTATE_LOCK<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> SW_LINEIN_INSERT
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_LINEIN_INSERT<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> SW_MUTE_DEVICE
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_MUTE_DEVICE<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> SW_PEN_INSERTED
        NAME_ELEMENT<span style="color: #c678dd;">(</span>SW_PEN_INSERTED<span style="color: #c678dd;">)</span>,
<span style="color: #51afef; font-weight: bold;">#endif</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">force</span><span style="color: #51afef;">[</span>FF_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... FF_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_RUMBLE<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_PERIODIC<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_CONSTANT<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_SPRING<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_FRICTION<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_DAMPER<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_INERTIA<span style="color: #c678dd;">)</span>,               NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_RAMP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_SQUARE<span style="color: #c678dd;">)</span>,                NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_TRIANGLE<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_SINE<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_SAW_UP<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_SAW_DOWN<span style="color: #c678dd;">)</span>,              NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_CUSTOM<span style="color: #c678dd;">)</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_GAIN<span style="color: #c678dd;">)</span>,                  NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_AUTOCENTER<span style="color: #c678dd;">)</span>,
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">forcestatus</span><span style="color: #51afef;">[</span>FF_STATUS_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... FF_STATUS_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_STATUS_STOPPED<span style="color: #c678dd;">)</span>,        NAME_ELEMENT<span style="color: #c678dd;">(</span>FF_STATUS_PLAYING<span style="color: #c678dd;">)</span>,
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> * <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">names</span><span style="color: #51afef;">[</span>EV_MAX + 1<span style="color: #51afef;">]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">[</span>0 ... EV_MAX<span style="color: #c678dd;">]</span> = <span style="color: #a9a1e1;">NULL</span>,
        <span style="color: #c678dd;">[</span>EV_SYN<span style="color: #c678dd;">]</span> = syns,                        <span style="color: #c678dd;">[</span>EV_KEY<span style="color: #c678dd;">]</span> = keys,
        <span style="color: #c678dd;">[</span>EV_REL<span style="color: #c678dd;">]</span> = relatives,                   <span style="color: #c678dd;">[</span>EV_ABS<span style="color: #c678dd;">]</span> = absolutes,
        <span style="color: #c678dd;">[</span>EV_MSC<span style="color: #c678dd;">]</span> = misc,                        <span style="color: #c678dd;">[</span>EV_LED<span style="color: #c678dd;">]</span> = leds,
        <span style="color: #c678dd;">[</span>EV_SND<span style="color: #c678dd;">]</span> = sounds,                      <span style="color: #c678dd;">[</span>EV_REP<span style="color: #c678dd;">]</span> = repeats,
        <span style="color: #c678dd;">[</span>EV_SW<span style="color: #c678dd;">]</span> = switches,
        <span style="color: #c678dd;">[</span>EV_FF<span style="color: #c678dd;">]</span> = force,                        <span style="color: #c678dd;">[</span>EV_FF_STATUS<span style="color: #c678dd;">]</span> = forcestatus,
<span style="color: #51afef;">}</span>;

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Convert a string to a specific key/snd/led/sw code. The string can either</span>
<span style="color: #83898d;"> * be the name of the key in question (e.g. "SW_DOCK") or the numerical</span>
<span style="color: #83898d;"> * value, either as decimal (e.g. "5") or as hex (e.g. "0x5").</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> mode The mode being queried (key, snd, led, sw)</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> kstr The string to parse and convert</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> The requested code's numerical value, or negative on error.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">get_keycode</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">query_mode</span> *<span style="color: #dcaeea;">query_mode</span>, <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">kstr</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>isdigit<span style="color: #98be65;">(</span>kstr<span style="color: #a9a1e1;">[</span>0<span style="color: #a9a1e1;">]</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">long</span> <span style="color: #dcaeea;">val</span>;
                errno = 0;
                val = strtoul<span style="color: #98be65;">(</span>kstr, <span style="color: #a9a1e1;">NULL</span>, 0<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>errno<span style="color: #98be65;">)</span> <span style="color: #98be65;">{</span>
                        fprintf<span style="color: #a9a1e1;">(</span>stderr, <span style="color: #98be65;">"Could not interpret value %s\n"</span>, kstr<span style="color: #a9a1e1;">)</span>;
                        <span style="color: #51afef;">return</span> -1;
                <span style="color: #98be65;">}</span>
                <span style="color: #51afef;">return</span> <span style="color: #98be65;">(</span><span style="color: #ECBE7B;">int</span><span style="color: #98be65;">)</span> val;
        <span style="color: #c678dd;">}</span> <span style="color: #51afef;">else</span> <span style="color: #c678dd;">{</span>
                <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> * <span style="color: #51afef;">const</span> *<span style="color: #dcaeea;">keynames</span> = names<span style="color: #98be65;">[</span>query_mode-&gt;event_type<span style="color: #98be65;">]</span>;
                <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>;

                <span style="color: #51afef;">for</span> <span style="color: #98be65;">(</span>i = 0; i &lt; query_mode-&gt;max; i++<span style="color: #98be65;">)</span> <span style="color: #98be65;">{</span>
                        <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">name</span> = keynames<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span>;
                        <span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>name &amp;&amp; strcmp<span style="color: #4db5bd;">(</span>name, kstr<span style="color: #4db5bd;">)</span> == 0<span style="color: #a9a1e1;">)</span>
                                <span style="color: #51afef;">return</span> i;
                <span style="color: #98be65;">}</span>

                <span style="color: #51afef;">return</span> -1;
        <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Filter for the AutoDevProbe scandir on /dev/input.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> dir The current directory entry provided by scandir.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> Non-zero if the given directory entry starts with "event", or zero</span>
<span style="color: #83898d;"> * otherwise.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">is_event_device</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">dirent</span> *<span style="color: #dcaeea;">dir</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
        <span style="color: #51afef;">return</span> strncmp<span style="color: #c678dd;">(</span>EVENT_DEV_NAME, dir-&gt;d_name, 5<span style="color: #c678dd;">)</span> == 0;
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Scans all /dev/input/event*, display them and ask the user which one to</span>
<span style="color: #83898d;"> * open.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> The event device file name of the device file selected. This</span>
<span style="color: #83898d;"> * string is allocated and must be freed by the caller.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">char</span>* <span style="color: #c678dd;">scan_devices</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">dirent</span> **<span style="color: #dcaeea;">namelist</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>, <span style="color: #dcaeea;">ndev</span>, <span style="color: #dcaeea;">devnum</span>, <span style="color: #dcaeea;">match</span>;
        <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">filename</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">max_device</span> = 0;

        ndev = scandir<span style="color: #c678dd;">(</span>DEV_INPUT_EVENT, &amp;namelist, is_event_device, alphasort<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>ndev &lt;= 0<span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">NULL</span>;

        fprintf<span style="color: #c678dd;">(</span>stderr, <span style="color: #98be65;">"Available devices:\n"</span><span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span>i = 0; i &lt; ndev; i++<span style="color: #c678dd;">)</span>
        <span style="color: #c678dd;">{</span>
                <span style="color: #ECBE7B;">char</span> <span style="color: #dcaeea;">fname</span><span style="color: #98be65;">[</span>4096<span style="color: #98be65;">]</span>;
                <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span> = -1;
                <span style="color: #ECBE7B;">char</span> <span style="color: #dcaeea;">name</span><span style="color: #98be65;">[</span>256<span style="color: #98be65;">]</span> = <span style="color: #98be65;">"???"</span>;

                snprintf<span style="color: #98be65;">(</span>fname, <span style="color: #51afef;">sizeof</span><span style="color: #a9a1e1;">(</span>fname<span style="color: #a9a1e1;">)</span>,
                         <span style="color: #98be65;">"%s/%s"</span>, DEV_INPUT_EVENT, namelist<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span>-&gt;d_name<span style="color: #98be65;">)</span>;
                fd = open<span style="color: #98be65;">(</span>fname, O_RDONLY<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>fd &lt; 0<span style="color: #98be65;">)</span>
                        <span style="color: #51afef;">continue</span>;
                ioctl<span style="color: #98be65;">(</span>fd, EVIOCGNAME<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">sizeof</span><span style="color: #4db5bd;">(</span>name<span style="color: #4db5bd;">)</span><span style="color: #a9a1e1;">)</span>, name<span style="color: #98be65;">)</span>;

                fprintf<span style="color: #98be65;">(</span>stderr, <span style="color: #98be65;">"%s:    %s\n"</span>, fname, name<span style="color: #98be65;">)</span>;
                close<span style="color: #98be65;">(</span>fd<span style="color: #98be65;">)</span>;

                match = sscanf<span style="color: #98be65;">(</span>namelist<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span>-&gt;d_name, <span style="color: #98be65;">"event%d"</span>, &amp;devnum<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>match &gt;= 1 &amp;&amp; devnum &gt; max_device<span style="color: #98be65;">)</span>
                        max_device = devnum;

                free<span style="color: #98be65;">(</span>namelist<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span><span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span>

        fprintf<span style="color: #c678dd;">(</span>stderr, <span style="color: #98be65;">"Select the device event number [0-%d]: "</span>, max_device<span style="color: #c678dd;">)</span>;

        <span style="color: #5B6268;">//</span><span style="color: #5B6268;">match = scanf("%d", &amp;devnum);</span>

        <span style="color: #5B6268;">//</span><span style="color: #5B6268;">if (match &lt; 1 || devnum &gt; max_device || devnum &lt; 0)</span>
        <span style="color: #5B6268;">//      </span><span style="color: #5B6268;">return NULL;</span>


        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">force set value</span>
        devnum = 1;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>asprintf<span style="color: #98be65;">(</span>&amp;filename, <span style="color: #98be65;">"%s/%s%d"</span>,
                     DEV_INPUT_EVENT, EVENT_DEV_NAME,
                     devnum<span style="color: #98be65;">)</span> &lt; 0<span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">NULL</span>;

        <span style="color: #51afef;">return</span> filename;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">version</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
<span style="color: #51afef; font-weight: bold;">#if</span><span style="color: #51afef; font-weight: bold;">n</span><span style="color: #51afef; font-weight: bold;">def</span> PACKAGE_VERSION
<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #dcaeea;">PACKAGE_VERSION</span> <span style="color: #98be65;">"&lt;version undefined&gt;"</span>
<span style="color: #51afef; font-weight: bold;">#endif</span>
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"%s %s\n"</span>, progname, PACKAGE_VERSION<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">return</span> EXIT_SUCCESS;
<span style="color: #51afef;">}</span>


<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Print usage information.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">usage</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"USAGE:\n"</span><span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">" Capture mode:\n"</span><span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"   %s [--grab] /dev/input/eventX\n"</span>, progname<span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"     --grab  grab the device for exclusive access\n"</span><span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"\n"</span><span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">" Query mode: (check exit code)\n"</span><span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"   %s --query /dev/input/eventX &lt;type&gt; &lt;value&gt;\n"</span>, progname<span style="color: #c678dd;">)</span>;

        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"\n"</span><span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"&lt;type&gt; is one of: EV_KEY, EV_SW, EV_LED, EV_SND\n"</span><span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"&lt;value&gt; can either be a numerical value, or the textual name of the\n"</span><span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"key/switch/LED/sound being queried (e.g. SW_DOCK).\n"</span><span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">return</span> EXIT_FAILURE;
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Print additional information for absolute axes (min/max, current value,</span>
<span style="color: #83898d;"> * etc.).</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> fd The file descriptor to the device.</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> axis The axis identifier (e.g. ABS_X).</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print_absdata</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">axis</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">abs</span><span style="color: #c678dd;">[</span>6<span style="color: #c678dd;">]</span> = <span style="color: #c678dd;">{</span>0<span style="color: #c678dd;">}</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">k</span>;

        ioctl<span style="color: #c678dd;">(</span>fd, EVIOCGABS<span style="color: #98be65;">(</span>axis<span style="color: #98be65;">)</span>, abs<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span>k = 0; k &lt; 6; k++<span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>k &lt; 3<span style="color: #98be65;">)</span> || abs<span style="color: #98be65;">[</span>k<span style="color: #98be65;">]</span><span style="color: #c678dd;">)</span>
                        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"      %s %6d\n"</span>, absval<span style="color: #98be65;">[</span>k<span style="color: #98be65;">]</span>, abs<span style="color: #98be65;">[</span>k<span style="color: #98be65;">]</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print_repdata</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>;
        <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">rep</span><span style="color: #c678dd;">[</span>2<span style="color: #c678dd;">]</span>;

        ioctl<span style="color: #c678dd;">(</span>fd, EVIOCGREP, rep<span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span>i = 0; i &lt;= REP_MAX; i++<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                printf<span style="color: #98be65;">(</span><span style="color: #98be65;">"    Repeat code %d (%s)\n"</span>, i, names<span style="color: #a9a1e1;">[</span>EV_REP<span style="color: #a9a1e1;">]</span> ? <span style="color: #a9a1e1;">(</span>names<span style="color: #4db5bd;">[</span>EV_REP<span style="color: #4db5bd;">][</span>i<span style="color: #4db5bd;">]</span> ? names<span style="color: #4db5bd;">[</span>EV_REP<span style="color: #4db5bd;">][</span>i<span style="color: #4db5bd;">]</span> : <span style="color: #98be65;">"?"</span><span style="color: #a9a1e1;">)</span> : <span style="color: #98be65;">"?"</span><span style="color: #98be65;">)</span>;
                printf<span style="color: #98be65;">(</span><span style="color: #98be65;">"      Value %6d\n"</span>, rep<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span><span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span>

<span style="color: #51afef;">}</span>

<span style="color: #51afef;">static</span> <span style="color: #51afef;">inline</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span>* <span style="color: #c678dd;">typename</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">type</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #51afef;">return</span> <span style="color: #c678dd;">(</span>type &lt;= EV_MAX &amp;&amp; events<span style="color: #98be65;">[</span>type<span style="color: #98be65;">]</span><span style="color: #c678dd;">)</span> ? events<span style="color: #c678dd;">[</span>type<span style="color: #c678dd;">]</span> : <span style="color: #98be65;">"?"</span>;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">static</span> <span style="color: #51afef;">inline</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span>* <span style="color: #c678dd;">codename</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">type</span>, <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">code</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #51afef;">return</span> <span style="color: #c678dd;">(</span>type &lt;= EV_MAX &amp;&amp; code &lt;= maxval<span style="color: #98be65;">[</span>type<span style="color: #98be65;">]</span> &amp;&amp; names<span style="color: #98be65;">[</span>type<span style="color: #98be65;">]</span> &amp;&amp; names<span style="color: #98be65;">[</span>type<span style="color: #98be65;">][</span>code<span style="color: #98be65;">]</span><span style="color: #c678dd;">)</span> ? names<span style="color: #c678dd;">[</span>type<span style="color: #c678dd;">][</span>code<span style="color: #c678dd;">]</span> : <span style="color: #98be65;">"?"</span>;
<span style="color: #51afef;">}</span>

<span style="color: #51afef; font-weight: bold;">#ifdef</span> INPUT_PROP_SEMI_MT
<span style="color: #51afef;">static</span> <span style="color: #51afef;">inline</span> <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span>* <span style="color: #c678dd;">propname</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">prop</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #51afef;">return</span> <span style="color: #c678dd;">(</span>prop &lt;= INPUT_PROP_MAX &amp;&amp; props<span style="color: #98be65;">[</span>prop<span style="color: #98be65;">]</span><span style="color: #c678dd;">)</span> ? props<span style="color: #c678dd;">[</span>prop<span style="color: #c678dd;">]</span> : <span style="color: #98be65;">"?"</span>;
<span style="color: #51afef;">}</span>
<span style="color: #51afef; font-weight: bold;">#endif</span>

<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">get_state</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span>, <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">type</span>, <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">long</span> *<span style="color: #dcaeea;">array</span>, <span style="color: #ECBE7B;">size_t</span> <span style="color: #dcaeea;">size</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">rc</span>;

        <span style="color: #51afef;">switch</span><span style="color: #c678dd;">(</span>type<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
        <span style="color: #51afef;">case</span> EV_LED:
                rc = ioctl<span style="color: #98be65;">(</span>fd, EVIOCGLED<span style="color: #a9a1e1;">(</span>size<span style="color: #a9a1e1;">)</span>, array<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">break</span>;
        <span style="color: #51afef;">case</span> EV_SND:
                rc = ioctl<span style="color: #98be65;">(</span>fd, EVIOCGSND<span style="color: #a9a1e1;">(</span>size<span style="color: #a9a1e1;">)</span>, array<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">break</span>;
        <span style="color: #51afef;">case</span> EV_SW:
                rc = ioctl<span style="color: #98be65;">(</span>fd, EVIOCGSW<span style="color: #a9a1e1;">(</span>size<span style="color: #a9a1e1;">)</span>, array<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">break</span>;
        <span style="color: #51afef;">case</span> EV_KEY:
                <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">intentionally not printing the value for EV_KEY, let the</span>
<span style="color: #5B6268;">                 * repeat handle this</span><span style="color: #5B6268;"> */</span>
        <span style="color: #51afef;">default</span>:
                <span style="color: #51afef;">return</span> 1;
        <span style="color: #c678dd;">}</span>
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>rc == -1<span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">return</span> 1;

        <span style="color: #51afef;">return</span> 0;
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Print static device information (no events). This information includes</span>
<span style="color: #83898d;"> * version numbers, device name and all bits supported by this device.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> fd The file descriptor to the device.</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> 0 on success or 1 otherwise.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">print_device_info</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">type</span>, <span style="color: #dcaeea;">code</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">version</span>;
        <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">short</span> <span style="color: #dcaeea;">id</span><span style="color: #c678dd;">[</span>4<span style="color: #c678dd;">]</span>;
        <span style="color: #ECBE7B;">char</span> <span style="color: #dcaeea;">name</span><span style="color: #c678dd;">[</span>256<span style="color: #c678dd;">]</span> = <span style="color: #98be65;">"Unknown"</span>;
        <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">long</span> <span style="color: #dcaeea;">bit</span><span style="color: #c678dd;">[</span>EV_MAX<span style="color: #c678dd;">][</span>NBITS<span style="color: #98be65;">(</span>KEY_MAX<span style="color: #98be65;">)</span><span style="color: #c678dd;">]</span>;
        <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">long</span> <span style="color: #dcaeea;">state</span><span style="color: #c678dd;">[</span>KEY_CNT<span style="color: #c678dd;">]</span> = <span style="color: #c678dd;">{</span>0<span style="color: #c678dd;">}</span>;
<span style="color: #51afef; font-weight: bold;">#ifdef</span> INPUT_PROP_SEMI_MT
        <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">prop</span>;
        <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">long</span> <span style="color: #dcaeea;">propbits</span><span style="color: #c678dd;">[</span>INPUT_PROP_MAX<span style="color: #c678dd;">]</span>;
<span style="color: #51afef; font-weight: bold;">#endif</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">stateval</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">have_state</span>;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>ioctl<span style="color: #98be65;">(</span>fd, EVIOCGVERSION, &amp;version<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                perror<span style="color: #98be65;">(</span><span style="color: #98be65;">"evtest: can't get version"</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> 1;
        <span style="color: #c678dd;">}</span>

        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"Input driver version is %d.%d.%d\n"</span>,
                version &gt;&gt; 16, <span style="color: #98be65;">(</span>version &gt;&gt; 8<span style="color: #98be65;">)</span> &amp; 0xff, version &amp; 0xff<span style="color: #c678dd;">)</span>;

        ioctl<span style="color: #c678dd;">(</span>fd, EVIOCGID, id<span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"Input device ID: bus 0x%x vendor 0x%x product 0x%x version 0x%x\n"</span>,
                id<span style="color: #98be65;">[</span>ID_BUS<span style="color: #98be65;">]</span>, id<span style="color: #98be65;">[</span>ID_VENDOR<span style="color: #98be65;">]</span>, id<span style="color: #98be65;">[</span>ID_PRODUCT<span style="color: #98be65;">]</span>, id<span style="color: #98be65;">[</span>ID_VERSION<span style="color: #98be65;">]</span><span style="color: #c678dd;">)</span>;

        ioctl<span style="color: #c678dd;">(</span>fd, EVIOCGNAME<span style="color: #98be65;">(</span><span style="color: #51afef;">sizeof</span><span style="color: #a9a1e1;">(</span>name<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>, name<span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"Input device name: \"%s\"\n"</span>, name<span style="color: #c678dd;">)</span>;

        memset<span style="color: #c678dd;">(</span>bit, 0, <span style="color: #51afef;">sizeof</span><span style="color: #98be65;">(</span>bit<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>;
        ioctl<span style="color: #c678dd;">(</span>fd, EVIOCGBIT<span style="color: #98be65;">(</span>0, EV_MAX<span style="color: #98be65;">)</span>, bit<span style="color: #98be65;">[</span>0<span style="color: #98be65;">]</span><span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"Supported events:\n"</span><span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span>type = 0; type &lt; EV_MAX; type++<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>test_bit<span style="color: #a9a1e1;">(</span>type, bit<span style="color: #4db5bd;">[</span>0<span style="color: #4db5bd;">]</span><span style="color: #a9a1e1;">)</span> &amp;&amp; type != EV_REP<span style="color: #98be65;">)</span> <span style="color: #98be65;">{</span>
                        have_state = <span style="color: #a9a1e1;">(</span>get_state<span style="color: #4db5bd;">(</span>fd, type, state, <span style="color: #51afef;">sizeof</span><span style="color: #51afef;">(</span>state<span style="color: #51afef;">)</span><span style="color: #4db5bd;">)</span> == 0<span style="color: #a9a1e1;">)</span>;

                        printf<span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"  Event type %d (%s)\n"</span>, type, typename<span style="color: #4db5bd;">(</span>type<span style="color: #4db5bd;">)</span><span style="color: #a9a1e1;">)</span>;
                        <span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>type == EV_SYN<span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">continue</span>;
                        ioctl<span style="color: #a9a1e1;">(</span>fd, EVIOCGBIT<span style="color: #4db5bd;">(</span>type, KEY_MAX<span style="color: #4db5bd;">)</span>, bit<span style="color: #4db5bd;">[</span>type<span style="color: #4db5bd;">]</span><span style="color: #a9a1e1;">)</span>;
                        <span style="color: #51afef;">for</span> <span style="color: #a9a1e1;">(</span>code = 0; code &lt; KEY_MAX; code++<span style="color: #a9a1e1;">)</span>
                                <span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>test_bit<span style="color: #4db5bd;">(</span>code, bit<span style="color: #51afef;">[</span>type<span style="color: #51afef;">]</span><span style="color: #4db5bd;">)</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">{</span>
                                        <span style="color: #51afef;">if</span> <span style="color: #4db5bd;">(</span>have_state<span style="color: #4db5bd;">)</span> <span style="color: #4db5bd;">{</span>
                                                stateval = test_bit<span style="color: #51afef;">(</span>code, state<span style="color: #51afef;">)</span>;
                                                printf<span style="color: #51afef;">(</span><span style="color: #98be65;">"    Event code %d (%s) state %d\n"</span>,
                                                       code, codename<span style="color: #c678dd;">(</span>type, code<span style="color: #c678dd;">)</span>, stateval<span style="color: #51afef;">)</span>;
                                        <span style="color: #4db5bd;">}</span> <span style="color: #51afef;">else</span> <span style="color: #4db5bd;">{</span>
                                                printf<span style="color: #51afef;">(</span><span style="color: #98be65;">"    Event code %d (%s)\n"</span>, code, codename<span style="color: #c678dd;">(</span>type, code<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>;
                                        <span style="color: #4db5bd;">}</span>
                                        <span style="color: #51afef;">if</span> <span style="color: #4db5bd;">(</span>type == EV_ABS<span style="color: #4db5bd;">)</span>
                                                print_absdata<span style="color: #4db5bd;">(</span>fd, code<span style="color: #4db5bd;">)</span>;
                                <span style="color: #a9a1e1;">}</span>
                <span style="color: #98be65;">}</span>
        <span style="color: #c678dd;">}</span>

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>test_bit<span style="color: #98be65;">(</span>EV_REP, bit<span style="color: #a9a1e1;">[</span>0<span style="color: #a9a1e1;">]</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                printf<span style="color: #98be65;">(</span><span style="color: #98be65;">"Key repeat handling:\n"</span><span style="color: #98be65;">)</span>;
                printf<span style="color: #98be65;">(</span><span style="color: #98be65;">"  Repeat type %d (%s)\n"</span>, EV_REP, events<span style="color: #a9a1e1;">[</span>EV_REP<span style="color: #a9a1e1;">]</span> ?  events<span style="color: #a9a1e1;">[</span>EV_REP<span style="color: #a9a1e1;">]</span> : <span style="color: #98be65;">"?"</span><span style="color: #98be65;">)</span>;
                print_repdata<span style="color: #98be65;">(</span>fd<span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span>
<span style="color: #51afef; font-weight: bold;">#ifdef</span> INPUT_PROP_SEMI_MT
        memset<span style="color: #c678dd;">(</span>propbits, 0, <span style="color: #51afef;">sizeof</span><span style="color: #98be65;">(</span>propbits<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>;
        ioctl<span style="color: #c678dd;">(</span>fd, EVIOCGPROP<span style="color: #98be65;">(</span><span style="color: #51afef;">sizeof</span><span style="color: #a9a1e1;">(</span>propbits<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>, propbits<span style="color: #c678dd;">)</span>;
        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"Properties:\n"</span><span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span>prop = 0; prop &lt; INPUT_PROP_MAX; prop++<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>test_bit<span style="color: #a9a1e1;">(</span>prop, propbits<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                        printf<span style="color: #98be65;">(</span><span style="color: #98be65;">"  Property type %d (%s)\n"</span>, prop, propname<span style="color: #a9a1e1;">(</span>prop<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span>
<span style="color: #51afef; font-weight: bold;">#endif</span>

        <span style="color: #51afef;">return</span> 0;
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Print device events as they come in.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> fd The file descriptor to the device.</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> 0 on success or 1 otherwise.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">print_events</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">input_event</span> <span style="color: #dcaeea;">ev</span><span style="color: #c678dd;">[</span>64<span style="color: #c678dd;">]</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>, <span style="color: #dcaeea;">rd</span>;
        <span style="color: #ECBE7B;">fd_set</span> <span style="color: #dcaeea;">rdfs</span>;

        FD_ZERO<span style="color: #c678dd;">(</span>&amp;rdfs<span style="color: #c678dd;">)</span>;
        FD_SET<span style="color: #c678dd;">(</span>fd, &amp;rdfs<span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">while</span> <span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>stop<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                select<span style="color: #98be65;">(</span>fd + 1, &amp;rdfs, <span style="color: #a9a1e1;">NULL</span>, <span style="color: #a9a1e1;">NULL</span>, <span style="color: #a9a1e1;">NULL</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>stop<span style="color: #98be65;">)</span>
                        <span style="color: #51afef;">break</span>;
                rd = read<span style="color: #98be65;">(</span>fd, ev, <span style="color: #51afef;">sizeof</span><span style="color: #a9a1e1;">(</span>ev<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>;

                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>rd &lt; <span style="color: #a9a1e1;">(</span><span style="color: #ECBE7B;">int</span><span style="color: #a9a1e1;">)</span> <span style="color: #51afef;">sizeof</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">input_event</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> <span style="color: #98be65;">{</span>
                        printf<span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"expected %d bytes, got %d\n"</span>, <span style="color: #4db5bd;">(</span><span style="color: #ECBE7B;">int</span><span style="color: #4db5bd;">)</span> <span style="color: #51afef;">sizeof</span><span style="color: #4db5bd;">(</span><span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">input_event</span><span style="color: #4db5bd;">)</span>, rd<span style="color: #a9a1e1;">)</span>;
                        perror<span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"\nevtest: error reading"</span><span style="color: #a9a1e1;">)</span>;
                        <span style="color: #51afef;">return</span> 1;
                <span style="color: #98be65;">}</span>

                <span style="color: #51afef;">for</span> <span style="color: #98be65;">(</span>i = 0; i &lt; rd / <span style="color: #51afef;">sizeof</span><span style="color: #a9a1e1;">(</span><span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">input_event</span><span style="color: #a9a1e1;">)</span>; i++<span style="color: #98be65;">)</span> <span style="color: #98be65;">{</span>
                        <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">type</span>, <span style="color: #dcaeea;">code</span>;

                        type = ev<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span>.type;
                        code = ev<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span>.code;

                        <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">decode here</span><span style="color: #5B6268;"> */</span>
                        code = libinput_enhance_decode_keycode<span style="color: #a9a1e1;">(</span>code<span style="color: #a9a1e1;">)</span>;

                        printf<span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"Event: time %ld.%06ld, "</span>, ev<span style="color: #4db5bd;">[</span>i<span style="color: #4db5bd;">]</span>.input_event_sec, ev<span style="color: #4db5bd;">[</span>i<span style="color: #4db5bd;">]</span>.input_event_usec<span style="color: #a9a1e1;">)</span>;

                        <span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>type == EV_SYN<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">{</span>
                                <span style="color: #51afef;">if</span> <span style="color: #4db5bd;">(</span>code == SYN_MT_REPORT<span style="color: #4db5bd;">)</span>
                                        printf<span style="color: #4db5bd;">(</span><span style="color: #98be65;">"++++++++++++++ %s ++++++++++++\n"</span>, codename<span style="color: #51afef;">(</span>type, code<span style="color: #51afef;">)</span><span style="color: #4db5bd;">)</span>;
                                <span style="color: #51afef;">else</span> <span style="color: #51afef;">if</span> <span style="color: #4db5bd;">(</span>code == SYN_DROPPED<span style="color: #4db5bd;">)</span>
                                        printf<span style="color: #4db5bd;">(</span><span style="color: #98be65;">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; %s &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;\n"</span>, codename<span style="color: #51afef;">(</span>type, code<span style="color: #51afef;">)</span><span style="color: #4db5bd;">)</span>;
                                <span style="color: #51afef;">else</span>
                                        printf<span style="color: #4db5bd;">(</span><span style="color: #98be65;">"-------------- %s ------------\n"</span>, codename<span style="color: #51afef;">(</span>type, code<span style="color: #51afef;">)</span><span style="color: #4db5bd;">)</span>;
                        <span style="color: #a9a1e1;">}</span> <span style="color: #51afef;">else</span> <span style="color: #a9a1e1;">{</span>
                                printf<span style="color: #4db5bd;">(</span><span style="color: #98be65;">"type %d (%s), code %d (%s), "</span>,
                                        type, typename<span style="color: #51afef;">(</span>type<span style="color: #51afef;">)</span>,
                                        code, codename<span style="color: #51afef;">(</span>type, code<span style="color: #51afef;">)</span><span style="color: #4db5bd;">)</span>;
                                <span style="color: #51afef;">if</span> <span style="color: #4db5bd;">(</span>type == EV_MSC &amp;&amp; <span style="color: #51afef;">(</span>code == MSC_RAW || code == MSC_SCAN<span style="color: #51afef;">)</span><span style="color: #4db5bd;">)</span>
                                        printf<span style="color: #4db5bd;">(</span><span style="color: #98be65;">"value %02x\n"</span>, ev<span style="color: #51afef;">[</span>i<span style="color: #51afef;">]</span>.value<span style="color: #4db5bd;">)</span>;
                                <span style="color: #51afef;">else</span>
                                        printf<span style="color: #4db5bd;">(</span><span style="color: #98be65;">"value %d\n"</span>, ev<span style="color: #51afef;">[</span>i<span style="color: #51afef;">]</span>.value<span style="color: #4db5bd;">)</span>;
                        <span style="color: #a9a1e1;">}</span>
                <span style="color: #98be65;">}</span>

        <span style="color: #c678dd;">}</span>

        ioctl<span style="color: #c678dd;">(</span>fd, EVIOCGRAB, <span style="color: #98be65;">(</span><span style="color: #ECBE7B;">void</span>*<span style="color: #98be65;">)</span>0<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">return</span> EXIT_SUCCESS;
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Grab and immediately ungrab the device.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> fd The file descriptor to the device.</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> 0 if the grab was successful, or 1 otherwise.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">test_grab</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">grab_flag</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">rc</span>;

        rc = ioctl<span style="color: #c678dd;">(</span>fd, EVIOCGRAB, <span style="color: #98be65;">(</span><span style="color: #ECBE7B;">void</span>*<span style="color: #98be65;">)</span>1<span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>rc == 0 &amp;&amp; <span style="color: #51afef; font-weight: bold;">!</span>grab_flag<span style="color: #c678dd;">)</span>
                ioctl<span style="color: #c678dd;">(</span>fd, EVIOCGRAB, <span style="color: #98be65;">(</span><span style="color: #ECBE7B;">void</span>*<span style="color: #98be65;">)</span>0<span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">return</span> rc;
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Enter capture mode. The requested event device will be monitored, and any</span>
<span style="color: #83898d;"> * captured events will be decoded and printed on the console.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> device The device to monitor, or NULL if the user should be prompted.</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> 0 on success, non-zero on error.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">do_capture</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">device</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">grab_flag</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span>;
        <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">filename</span> = <span style="color: #a9a1e1;">NULL</span>;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>device<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                fprintf<span style="color: #98be65;">(</span>stderr, <span style="color: #98be65;">"No device specified, trying to scan all of %s/%s*\n"</span>,
                        DEV_INPUT_EVENT, EVENT_DEV_NAME<span style="color: #98be65;">)</span>;

                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>getuid<span style="color: #a9a1e1;">()</span> != 0<span style="color: #98be65;">)</span>
                        fprintf<span style="color: #98be65;">(</span>stderr, <span style="color: #98be65;">"Not running as root, no devices may be available.\n"</span><span style="color: #98be65;">)</span>;

                filename = scan_devices<span style="color: #98be65;">()</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #51afef; font-weight: bold;">!</span>filename<span style="color: #98be65;">)</span>
                        <span style="color: #51afef;">return</span> usage<span style="color: #98be65;">()</span>;
        <span style="color: #c678dd;">}</span> <span style="color: #51afef;">else</span>
                filename = strdup<span style="color: #c678dd;">(</span>device<span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>filename<span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">return</span> EXIT_FAILURE;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>fd = open<span style="color: #a9a1e1;">(</span>filename, O_RDONLY<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span> &lt; 0<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                perror<span style="color: #98be65;">(</span><span style="color: #98be65;">"evtest"</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>errno == EACCES &amp;&amp; getuid<span style="color: #a9a1e1;">()</span> != 0<span style="color: #98be65;">)</span>
                        fprintf<span style="color: #98be65;">(</span>stderr, <span style="color: #98be65;">"You do not have access to %s. Try "</span>
                                        <span style="color: #98be65;">"running as root instead.\n"</span>,
                                        filename<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">goto</span> <span style="color: #a9a1e1;">error</span>;
        <span style="color: #c678dd;">}</span>

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>isatty<span style="color: #98be65;">(</span>fileno<span style="color: #a9a1e1;">(</span>stdout<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                setbuf<span style="color: #c678dd;">(</span>stdout, <span style="color: #a9a1e1;">NULL</span><span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>print_device_info<span style="color: #98be65;">(</span>fd<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">goto</span> <span style="color: #a9a1e1;">error</span>;

        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"Testing ... (interrupt to exit)\n"</span><span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>test_grab<span style="color: #98be65;">(</span>fd, grab_flag<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
        <span style="color: #c678dd;">{</span>
                printf<span style="color: #98be65;">(</span><span style="color: #98be65;">"***********************************************\n"</span><span style="color: #98be65;">)</span>;
                printf<span style="color: #98be65;">(</span><span style="color: #98be65;">"  This device is grabbed by another process.\n"</span><span style="color: #98be65;">)</span>;
                printf<span style="color: #98be65;">(</span><span style="color: #98be65;">"  No events are available to evtest while the\n"</span>
                       <span style="color: #98be65;">"  other grab is active.\n"</span><span style="color: #98be65;">)</span>;
                printf<span style="color: #98be65;">(</span><span style="color: #98be65;">"  In most cases, this is caused by an X driver,\n"</span>
                       <span style="color: #98be65;">"  try VT-switching and re-run evtest again.\n"</span><span style="color: #98be65;">)</span>;
                printf<span style="color: #98be65;">(</span><span style="color: #98be65;">"  Run the following command to see processes with\n"</span>
                       <span style="color: #98be65;">"  an open fd on this device\n"</span>
                       <span style="color: #98be65;">" \"fuser -v %s\"\n"</span>, filename<span style="color: #98be65;">)</span>;
                printf<span style="color: #98be65;">(</span><span style="color: #98be65;">"***********************************************\n"</span><span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span>

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>grab_flag<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                signal<span style="color: #98be65;">(</span>SIGINT, interrupt_handler<span style="color: #98be65;">)</span>;
                signal<span style="color: #98be65;">(</span>SIGTERM, interrupt_handler<span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span>

        free<span style="color: #c678dd;">(</span>filename<span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">return</span> print_events<span style="color: #c678dd;">(</span>fd<span style="color: #c678dd;">)</span>;

<span style="color: #a9a1e1;">error</span>:
        free<span style="color: #c678dd;">(</span>filename<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">return</span> EXIT_FAILURE;
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Perform a one-shot state query on a specific device. The query can be of</span>
<span style="color: #83898d;"> * any known mode, on any valid keycode.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> device Path to the evdev device node that should be queried.</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> query_mode The event type that is being queried (e.g. key, switch)</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> keycode The code of the key/switch/sound/LED to be queried</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> 0 if the state bit is unset, 10 if the state bit is set, 1 on error.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">query_device</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">device</span>, <span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">query_mode</span> *<span style="color: #dcaeea;">query_mode</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">keycode</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">fd</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">r</span>;
        <span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">long</span> <span style="color: #dcaeea;">state</span><span style="color: #c678dd;">[</span>NBITS<span style="color: #98be65;">(</span>query_mode-&gt;max<span style="color: #98be65;">)</span><span style="color: #c678dd;">]</span>;

        fd = open<span style="color: #c678dd;">(</span>device, O_RDONLY<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>fd &lt; 0<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                perror<span style="color: #98be65;">(</span><span style="color: #98be65;">"open"</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> EXIT_FAILURE;
        <span style="color: #c678dd;">}</span>
        memset<span style="color: #c678dd;">(</span>state, 0, <span style="color: #51afef;">sizeof</span><span style="color: #98be65;">(</span>state<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>;
        r = ioctl<span style="color: #c678dd;">(</span>fd, query_mode-&gt;rq, state<span style="color: #c678dd;">)</span>;
        close<span style="color: #c678dd;">(</span>fd<span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>r == -1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                perror<span style="color: #98be65;">(</span><span style="color: #98be65;">"ioctl"</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> EXIT_FAILURE;
        <span style="color: #c678dd;">}</span>

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>test_bit<span style="color: #98be65;">(</span>keycode, state<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">return</span> 10; <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">different from EXIT_FAILURE</span><span style="color: #5B6268;"> */</span>
        <span style="color: #51afef;">else</span>
                <span style="color: #51afef;">return</span> 0;
<span style="color: #51afef;">}</span>

<span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Enter query mode. The requested event device will be queried for the state</span>
<span style="color: #83898d;"> * of a particular switch/key/sound/LED.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> device The device to query.</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> mode The mode (event type) that is to be queried (snd, sw, key, led)</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@param</span><span style="color: #83898d;"> keycode The key code to query the state of.</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@return</span><span style="color: #83898d;"> 0 if the state bit is unset, 10 if the state bit is set.</span>
<span style="color: #83898d;"> */</span>
<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">do_query</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">device</span>, <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">event_type</span>, <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">keyname</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">query_mode</span> *<span style="color: #dcaeea;">query_mode</span>;
        <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">keycode</span>;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>device<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                fprintf<span style="color: #98be65;">(</span>stderr, <span style="color: #98be65;">"Device argument is required for query.\n"</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> usage<span style="color: #98be65;">()</span>;
        <span style="color: #c678dd;">}</span>

        query_mode = find_query_mode<span style="color: #c678dd;">(</span>event_type<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>query_mode<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                fprintf<span style="color: #98be65;">(</span>stderr, <span style="color: #98be65;">"Unrecognised event type: %s\n"</span>, event_type<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> usage<span style="color: #98be65;">()</span>;
        <span style="color: #c678dd;">}</span>

        keycode = get_keycode<span style="color: #c678dd;">(</span>query_mode, keyname<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>keycode &lt; 0<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                fprintf<span style="color: #98be65;">(</span>stderr, <span style="color: #98be65;">"Unrecognised key name: %s\n"</span>, keyname<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> usage<span style="color: #98be65;">()</span>;
        <span style="color: #c678dd;">}</span> <span style="color: #51afef;">else</span> <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>keycode &gt; query_mode-&gt;max<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                fprintf<span style="color: #98be65;">(</span>stderr, <span style="color: #98be65;">"Key %d is out of bounds.\n"</span>, keycode<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> EXIT_FAILURE;
        <span style="color: #c678dd;">}</span>

        <span style="color: #51afef;">return</span> query_device<span style="color: #c678dd;">(</span>device, query_mode, keycode<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">static</span> <span style="color: #51afef;">const</span> <span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">option</span> <span style="color: #dcaeea;">long_options</span><span style="color: #51afef;">[]</span> = <span style="color: #51afef;">{</span>
        <span style="color: #c678dd;">{</span> <span style="color: #98be65;">"grab"</span>, no_argument, &amp;grab_flag, 1 <span style="color: #c678dd;">}</span>,
        <span style="color: #c678dd;">{</span> <span style="color: #98be65;">"query"</span>, no_argument, <span style="color: #a9a1e1;">NULL</span>, MODE_QUERY <span style="color: #c678dd;">}</span>,
        <span style="color: #c678dd;">{</span> <span style="color: #98be65;">"version"</span>, no_argument, <span style="color: #a9a1e1;">NULL</span>, MODE_VERSION <span style="color: #c678dd;">}</span>,
        <span style="color: #c678dd;">{</span> 0, <span style="color: #c678dd;">}</span>,
<span style="color: #51afef;">}</span>;

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span> <span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">argc</span>, <span style="color: #ECBE7B;">char</span> **<span style="color: #dcaeea;">argv</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
        <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">device</span> = <span style="color: #a9a1e1;">NULL</span>;
        <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">keyname</span>;
        <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">event_type</span>;
        <span style="color: #51afef;">enum</span> <span style="color: #ECBE7B;">evtest_mode</span> <span style="color: #dcaeea;">mode</span> = MODE_CAPTURE;

        progname = argv<span style="color: #c678dd;">[</span>0<span style="color: #c678dd;">]</span>;

        <span style="color: #ECBE7B;">char</span> <span style="color: #dcaeea;">yorn</span>;

        printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"open input enhance (Y/N)? "</span><span style="color: #c678dd;">)</span>;
        scanf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"%c"</span>,&amp;yorn<span style="color: #c678dd;">)</span>;
        <span style="color: #51afef;">if</span><span style="color: #c678dd;">(</span>yorn == <span style="color: #98be65;">'Y'</span> || yorn == <span style="color: #98be65;">'y'</span><span style="color: #c678dd;">)</span>
        <span style="color: #c678dd;">{</span>
                <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">ret</span> = libinput_enhance_start_or_stop_enhance<span style="color: #98be65;">(</span><span style="color: #a9a1e1;">true</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>ret<span style="color: #98be65;">)</span> <span style="color: #98be65;">{</span>
                        printf<span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"ioctl error, ret=%d\n"</span>, ret<span style="color: #a9a1e1;">)</span>;
                        <span style="color: #51afef;">return</span> ret;
                <span style="color: #98be65;">}</span>
        <span style="color: #c678dd;">}</span>
        <span style="color: #51afef;">else</span> <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>yorn == <span style="color: #98be65;">'N'</span> || yorn == <span style="color: #98be65;">'n'</span><span style="color: #c678dd;">)</span>
        <span style="color: #c678dd;">{</span>
                <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">ret</span> = libinput_enhance_start_or_stop_enhance<span style="color: #98be65;">(</span><span style="color: #a9a1e1;">false</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>ret<span style="color: #98be65;">)</span> <span style="color: #98be65;">{</span>
                        printf<span style="color: #a9a1e1;">(</span><span style="color: #98be65;">"ioctl error, ret=%d\n"</span>, ret<span style="color: #a9a1e1;">)</span>;
                        <span style="color: #51afef;">return</span> ret;
                <span style="color: #98be65;">}</span>
        <span style="color: #c678dd;">}</span>
        <span style="color: #51afef;">else</span>
        <span style="color: #c678dd;">{</span>
                puts<span style="color: #98be65;">(</span><span style="color: #98be65;">"can only be&#65306; Y or N "</span><span style="color: #98be65;">)</span>;
        <span style="color: #c678dd;">}</span>

        <span style="color: #51afef;">while</span> <span style="color: #c678dd;">(</span>1<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">option_index</span> = 0;
                <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">c</span> = getopt_long<span style="color: #98be65;">(</span>argc, argv, <span style="color: #98be65;">""</span>, long_options, &amp;option_index<span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>c == -1<span style="color: #98be65;">)</span>
                        <span style="color: #51afef;">break</span>;
                <span style="color: #51afef;">switch</span> <span style="color: #98be65;">(</span>c<span style="color: #98be65;">)</span> <span style="color: #98be65;">{</span>
                <span style="color: #51afef;">case</span> 0:
                        <span style="color: #51afef;">break</span>;
                <span style="color: #51afef;">case</span> MODE_QUERY:
                        mode = c;
                        <span style="color: #51afef;">break</span>;
                <span style="color: #51afef;">case</span> MODE_VERSION:
                        <span style="color: #51afef;">return</span> version<span style="color: #a9a1e1;">()</span>;
                <span style="color: #51afef;">default</span>:
                        <span style="color: #51afef;">return</span> usage<span style="color: #a9a1e1;">()</span>;
                <span style="color: #98be65;">}</span>
        <span style="color: #c678dd;">}</span>

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>optind &lt; argc<span style="color: #c678dd;">)</span>
                device = argv<span style="color: #c678dd;">[</span>optind++<span style="color: #c678dd;">]</span>;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>mode == MODE_CAPTURE<span style="color: #c678dd;">)</span>
                <span style="color: #51afef;">return</span> do_capture<span style="color: #c678dd;">(</span>device, grab_flag<span style="color: #c678dd;">)</span>;

        <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>argc - optind<span style="color: #98be65;">)</span> &lt; 2<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
                fprintf<span style="color: #98be65;">(</span>stderr, <span style="color: #98be65;">"Query mode requires device, type and key parameters\n"</span><span style="color: #98be65;">)</span>;
                <span style="color: #51afef;">return</span> usage<span style="color: #98be65;">()</span>;
        <span style="color: #c678dd;">}</span>

        event_type = argv<span style="color: #c678dd;">[</span>optind++<span style="color: #c678dd;">]</span>;
        keyname = argv<span style="color: #c678dd;">[</span>optind++<span style="color: #c678dd;">]</span>;
        <span style="color: #51afef;">return</span> do_query<span style="color: #c678dd;">(</span>device, event_type, keyname<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
编译
</p>

<div class="org-src-container">
<pre class="src src-bash">gcc demo.c -o demo -L . -l input_enhance
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1087d9" class="outline-3">
<h3 id="orgf1087d9"><span class="section-number-3">1.6.</span> 查看效果</h3>
<div class="outline-text-3" id="text-1-6">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #5B6268;">#</span><span style="color: #5B6268;">&#36816;&#34892;&#31243;&#24207;</span>
./demo
<span style="color: #5B6268;">#</span><span style="color: #5B6268;">&#36755;&#20837;y</span>

<span style="color: #5B6268;">#</span><span style="color: #5B6268;">&#27492;&#26102;&#22312;&#20219;&#20309;&#36755;&#20837;&#31471;&#37117;&#21487;&#20197;&#30475;&#21040;&#36755;&#20837;&#30340;&#20869;&#23481;&#21644;&#26174;&#31034;&#30340;&#20869;&#23481;&#19981;&#19968;&#33268;&#12290;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea04498" class="outline-3">
<h3 id="orgea04498"><span class="section-number-3">1.7.</span> 退出</h3>
<div class="outline-text-3" id="text-1-7">
<div class="org-src-container">
<pre class="src src-bash">&#36828;&#31243;ssh&#21040;&#35813;&#26426;&#22120;&#19978;&#65292;&#20351;&#29992;kill&#26432;&#27515;./demo&#31243;&#24207;
&#20877;&#27425;&#36816;&#34892;./demo&#65292;&#36873;&#25321;n
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd0240aa" class="outline-2">
<h2 id="orgd0240aa"><span class="section-number-2">2.</span> 二期</h2>
<div class="outline-text-2" id="text-2">

<div id="org37b2169" class="figure">
<p><img src="https://r2.guolongji.xyz/allinaent/2024/10/3228b3deaf28a3ba6ee97c71412e90de.png" alt="3228b3deaf28a3ba6ee97c71412e90de.png" />
</p>
</div>


<div id="orgbf3df07" class="figure">
<p><img src="https://r2.guolongji.xyz/allinaent/2024/10/e5f2501801322ddd3fc1459298b2a227.png" alt="e5f2501801322ddd3fc1459298b2a227.png" />
</p>
</div>

<p>
开会讨论使用的算法。最后决定使用 XOR 算法。
</p>

<p>
之前预留的是 char * 类型的 key ，现在其实用 uint16_t 就行，结构体是要改的，可以
把之前的 char *public_key; 保留下来，新增一个 uint16_t *xor_key; 这就行了，首先
写一个测试用例。
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdio.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdint.h</span><span style="color: #51afef;">&gt;</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">xor_encrypt_decrypt</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">uint16_t</span> *<span style="color: #dcaeea;">data</span>, <span style="color: #ECBE7B;">uint16_t</span> <span style="color: #dcaeea;">key</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
    *data ^= key;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23545;&#25968;&#25454;&#36827;&#34892; XOR &#25805;&#20316;</span>
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
    <span style="color: #ECBE7B;">uint16_t</span> <span style="color: #dcaeea;">data</span> = 0xABCD;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35201;&#21152;&#23494;&#30340;&#25968;&#25454;</span>
    <span style="color: #ECBE7B;">uint16_t</span> <span style="color: #dcaeea;">key</span> = 0x1234;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23494;&#38053;</span>

    printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"Original data: 0x%04X\n"</span>, data<span style="color: #c678dd;">)</span>;

    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21152;&#23494;</span>
    xor_encrypt_decrypt<span style="color: #c678dd;">(</span>&amp;data, key<span style="color: #c678dd;">)</span>;
    printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"Encrypted data: 0x%04X\n"</span>, data<span style="color: #c678dd;">)</span>;

    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35299;&#23494;</span>
    xor_encrypt_decrypt<span style="color: #c678dd;">(</span>&amp;data, key<span style="color: #c678dd;">)</span>;
    printf<span style="color: #c678dd;">(</span><span style="color: #98be65;">"Decrypted data: 0x%04X\n"</span>, data<span style="color: #c678dd;">)</span>;

    <span style="color: #51afef;">return</span> 0;
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
demo 运行无误。
</p>

<p>
加密部分有一点点小思考，鼠标的左中右三个键是不变的，和之前一样，是的无需加密。解密的时候也
要先判断是不是那三个键，同样，是的话，也不需要解密。
</p>
</div>

<div id="outline-container-org9cf0396" class="outline-3">
<h3 id="org9cf0396"><span class="section-number-3">2.1.</span> 内核修改</h3>
<div class="outline-text-3" id="text-2-1">
<p>
v25 的代码提交在：kernel-v25 的 proj-d-localization-gpu-dev 分支，还没有提交
</p>

<p>
补丁是：cat 0001-feat-feat-add-input-enhance-module.patch
</p>

<div class="org-src-container">
<pre class="src src-diff"><span style="color: #a4aab6;">From 30d0cdde9ef598d32157f216f7270c2eac4252d3 Mon Sep 17 00:00:00 2001</span>
<span style="color: #a4aab6;">From: Longji Guo <a href="mailto:guolongji%40uniontech.com">&lt;guolongji@uniontech.com&gt;</a></span>
<span style="color: #a4aab6;">Date: Fri, 1 Nov 2024 15:13:32 +0800</span>
<span style="color: #a4aab6;">Subject: [PATCH] feat: feat: add input enhance module</span>

<span style="color: #a4aab6;">Change-Id: Ie255fdeae0093ede6a343498326d6315875f1a3e</span>
<span style="color: #a9a1e1;">---</span>
<span style="color: #a4aab6;"> drivers/input/Kconfig         |   8 +++</span>
<span style="color: #a4aab6;"> drivers/input/Makefile        |   2 +-</span>
<span style="color: #a4aab6;"> drivers/input/input-enhance.c | 112 ++++++++++++++++++++++++++++++++++</span>
<span style="color: #a4aab6;"> drivers/input/input-enhance.h |  21 +++++++</span>
<span style="color: #a4aab6;"> drivers/input/input.c         |  12 ++++</span>
<span style="color: #a4aab6;"> 5 files changed, 154 insertions(+), 1 deletion(-)</span>
<span style="color: #a4aab6;"> create mode 100644 drivers/input/input-enhance.c</span>
<span style="color: #a4aab6;"> create mode 100644 drivers/input/input-enhance.h</span>

<span style="color: #46D9FF;">diff --git a/drivers/input/Kconfig b/drivers/input/Kconfig</span>
<span style="color: #46D9FF;">index 3bdbd34314b3..f8bb4619485f 100644</span>
<span style="color: #46D9FF;">--- </span><span style="color: #51afef;">a/drivers/input/Kconfig</span>
<span style="color: #46D9FF;">+++ </span><span style="color: #51afef;">b/drivers/input/Kconfig</span>
<span style="color: #a9a1e1;">@@ -176,6 +176,14 @@</span><span style="color: #46D9FF;"> config INPUT_KUNIT_TEST</span>

<span style="color: #a4aab6;">         If in doubt, say "N".</span>

<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">config INPUT_ENHANCE</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       bool "Input Enhance"</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       default y</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       help</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        Say y herel if you want enhance input.</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        To compile this driver as a module,choose M here: the module</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        will be called input_enhance.</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #a4aab6;"> config INPUT_APMPOWER</span>
<span style="color: #a4aab6;">        tristate "Input Power Event -&gt; APM Bridge" if EXPERT</span>
<span style="color: #a4aab6;">        depends on INPUT &amp;&amp; APM_EMULATION</span>
<span style="color: #46D9FF;">diff --git a/drivers/input/Makefile b/drivers/input/Makefile</span>
<span style="color: #46D9FF;">index c78753274921..30e80a453f37 100644</span>
<span style="color: #46D9FF;">--- </span><span style="color: #51afef;">a/drivers/input/Makefile</span>
<span style="color: #46D9FF;">+++ </span><span style="color: #51afef;">b/drivers/input/Makefile</span>
<span style="color: #a9a1e1;">@@ -6,7 +6,7 @@</span>
<span style="color: #a4aab6;"> # Each configuration option enables a list of files.</span>

<span style="color: #a4aab6;"> obj-$(CONFIG_INPUT)            += input-core.o</span>
<span style="color: #aa2222; background-color: #23272e;">-</span><span style="color: #ff6c6b; background-color: #23272e;">input-core-y := input.o input-compat.o input-mt.o input-poller.o ff-core.o</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">input-core-y := input.o input-compat.o input-mt.o input-poller.o ff-core.o </span><span style="color: #98be65; background-color: #21242b;">input-enhance.o</span>
<span style="color: #a4aab6;"> input-core-y += touchscreen.o</span>

<span style="color: #a4aab6;"> obj-$(CONFIG_INPUT_FF_MEMLESS) += ff-memless.o</span>
<span style="color: #46D9FF;">diff --git a/drivers/input/input-enhance.c b/drivers/input/input-enhance.c</span>
<span style="color: #46D9FF;">new file mode 100644</span>
<span style="color: #46D9FF;">index 000000000000..a01010ae7ee6</span>
<span style="color: #46D9FF;">--- </span><span style="color: #51afef;">/dev/null</span>
<span style="color: #46D9FF;">+++ </span><span style="color: #51afef;">b/drivers/input/input-enhance.c</span>
<span style="color: #a9a1e1;">@@ -0,0 +1,112 @@</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include &lt;linux/module.h&gt;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include &lt;linux/kernel.h&gt;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include &lt;linux/init.h&gt;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include &lt;linux/scpi_protocol.h&gt;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include &lt;asm/io.h&gt;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include &lt;linux/slab.h&gt;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include &lt;linux/fs.h&gt;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include &lt;linux/device.h&gt;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include &lt;linux/uaccess.h&gt;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include "input-enhance.h"</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">MODULE_LICENSE("GPL");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">MODULE_AUTHOR("guolongij@uniontech.com");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">MODULE_DESCRIPTION("Driver to enhance input");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">static int      majorNumber;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">static struct   class*  enhance_module_class = NULL;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">static struct   device* enhance_module_device = NULL;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#define DEVICE_NAME "input_enhance"</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#define CLASS_NAME  "enhance_module"</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">struct enhance_param enhance_param_data = {</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       0,</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       0,</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       0x123, // max value &gt;= 0x2fe</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">};</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">EXPORT_SYMBOL(enhance_param_data);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">static long enhance_module_ioctl(struct file *, unsigned int, unsigned long);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">static int __init enhance_init(void);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">static void __exit enhance_exit(void);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">static const struct file_operations enhance_module_fo = {</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        .owner = THIS_MODULE,</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        .unlocked_ioctl = enhance_module_ioctl,</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">};</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">static long enhance_module_ioctl(struct file *file,</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                 unsigned int cmd,</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                 unsigned long arg)</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">{</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        switch(cmd){</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        case CMD_IOC_0:</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        {</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                printk(KERN_INFO "[EnhanceModule:] Inner function (CMD_IOC_0) finished.\n");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">               if (copy_to_user((void __user *)arg, &amp;enhance_param_data, sizeof(struct enhance_param)))</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                       return -EFAULT;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                break;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        }</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       case CMD_IOC_1:</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        {</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                printk(KERN_INFO "[EnhanceModule:] Inner function (CMD_IOC_1) finished.\n");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">               if (copy_from_user(&amp;enhance_param_data, (void __user *)arg, sizeof(struct enhance_param)))</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                       return -EFAULT;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                break;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        }</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        default:</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                printk(KERN_INFO "[EnhanceModule:] Unknown ioctl cmd!\n");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                return -EINVAL;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        }</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        return 0;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">}</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">static int __init enhance_init(void) {</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        printk(KERN_INFO "[EnhanceModule:] Entering test module. \n");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        majorNumber = register_chrdev(0, DEVICE_NAME, &amp;enhance_module_fo);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        if(majorNumber &lt; 0){</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                printk(KERN_INFO "[EnhanceModule:] Failed to register a major number. \n");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                return majorNumber;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        }</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        printk(KERN_INFO "[EnhanceModule:] Successful to register a major number %d. \n", majorNumber);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        enhance_module_class = class_create(CLASS_NAME);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        if(IS_ERR(enhance_module_class)) {</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                unregister_chrdev(majorNumber, DEVICE_NAME);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                printk(KERN_INFO "[EnhanceModule:] Class device register failed!\n");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                return PTR_ERR(enhance_module_class);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        }</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        printk(KERN_INFO "[EnhanceModule:] Class device register success!\n");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        enhance_module_device = device_create(enhance_module_class, NULL, MKDEV(majorNumber, 0), NULL, DEVICE_NAME);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        if (IS_ERR(enhance_module_device)) {</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                class_destroy(enhance_module_class);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                unregister_chrdev(majorNumber, DEVICE_NAME);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                printk(KERN_ALERT "Failed to create the device\n");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">                return PTR_ERR(enhance_module_device);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        }</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        printk(KERN_INFO "[EnhanceModule:] Test module register successful. \n");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        return 0;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">}</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">static void __exit enhance_exit(void)</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">{</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        printk(KERN_INFO "[EnhanceModule:] Start to clean up module.\n");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        device_destroy(enhance_module_class, MKDEV(majorNumber, 0));</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        class_destroy(enhance_module_class);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        unregister_chrdev(majorNumber, DEVICE_NAME);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">        printk(KERN_INFO "[EnhanceModule:] Clean up successful. Bye.\n");</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">}</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">module_init(enhance_init);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">module_exit(enhance_exit);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #46D9FF;">diff --git a/drivers/input/input-enhance.h b/drivers/input/input-enhance.h</span>
<span style="color: #46D9FF;">new file mode 100644</span>
<span style="color: #46D9FF;">index 000000000000..abe09f46c07a</span>
<span style="color: #46D9FF;">--- </span><span style="color: #51afef;">/dev/null</span>
<span style="color: #46D9FF;">+++ </span><span style="color: #51afef;">b/drivers/input/input-enhance.h</span>
<span style="color: #a9a1e1;">@@ -0,0 +1,21 @@</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">/* SPDX-License-Identifier: GPL-2.0-only */</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#ifndef _INPUT_ENHANCE_H</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#define _INPUT_ENHANCE_H</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include &lt;linux/ioctl.h&gt;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">// long enhance_state = 0; // 0 close; 1 open</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">struct enhance_param {</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       int enhance_state;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       int encrypt_type;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       uint8_t xor_key;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       char *public_key;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">};</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#define CMD_IOC_MAGIC 'a'</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#define CMD_IOC_0 _IOR(CMD_IOC_MAGIC, 0, struct enhance_param)</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#define CMD_IOC_1 _IOW(CMD_IOC_MAGIC, 1, struct enhance_param)</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#define CMD_IOC_2 _IOW(CMD_IOC_MAGIC, 2, struct enhance_param)</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#endif /* _INPUT_ENHANCE_H */</span>
<span style="color: #46D9FF;">diff --git a/drivers/input/input.c b/drivers/input/input.c</span>
<span style="color: #46D9FF;">index 6173218a3f1a..f6a8762c7ca9 100644</span>
<span style="color: #46D9FF;">--- </span><span style="color: #51afef;">a/drivers/input/input.c</span>
<span style="color: #46D9FF;">+++ </span><span style="color: #51afef;">b/drivers/input/input.c</span>
<span style="color: #a9a1e1;">@@ -28,6 +28,9 @@</span>
<span style="color: #a4aab6;"> #include "input-compat.h"</span>
<span style="color: #a4aab6;"> #include "input-core-private.h"</span>
<span style="color: #a4aab6;"> #include "input-poller.h"</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">#include "input-enhance.h"</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">extern struct enhance_param enhance_param_data;</span>

<span style="color: #a4aab6;"> MODULE_AUTHOR("Vojtech Pavlik <a href="mailto:vojtech%40suse.cz">&lt;vojtech@suse.cz&gt;</a>");</span>
<span style="color: #a4aab6;"> MODULE_DESCRIPTION("Input core");</span>
<span style="color: #a9a1e1;">@@ -407,6 +410,10 @@</span><span style="color: #46D9FF;"> void input_handle_event(struct input_dev *dev,</span>
<span style="color: #a4aab6;">        }</span>
<span style="color: #a4aab6;"> }</span>

<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">void xor_encrypt_decrypt(uint16_t *data, uint16_t key) {</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       *data = (*data ^ key) % 0x2ff;</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">}</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #a4aab6;"> /**</span>
<span style="color: #a4aab6;">  * input_event() - report new input event</span>
<span style="color: #a4aab6;">  * @dev: device that generated the event</span>
<span style="color: #a9a1e1;">@@ -429,6 +436,11 @@</span><span style="color: #46D9FF;"> void input_event(struct input_dev *dev,</span>
<span style="color: #a4aab6;"> {</span>
<span style="color: #a4aab6;">        unsigned long flags;</span>

<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       if (enhance_param_data.enhance_state == 1 &amp;&amp; type == 0x01</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">               &amp;&amp; code != 272 &amp;&amp; code != 273 &amp;&amp; code != 274) {</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">               xor_encrypt_decrypt((uint16_t *)&amp;code, enhance_param_data.xor_key);</span>
<span style="color: #22aa22; background-color: #21242b;">+</span><span style="color: #98be65; background-color: #21242b;">       }</span>
<span style="color: #22aa22; background-color: #21242b;">+</span>
<span style="color: #a4aab6;">        if (is_event_supported(type, dev-&gt;evbit, EV_MAX) </span>
<span style="color: #a4aab6;"> #ifdef CONFIG_UOS_TOUCHPAD_SWITCH</span>
<span style="color: #a4aab6;">                 &amp;&amp; !test_bit(INPUT_PROP_TOUCHPAD_SWITCH, dev-&gt;propbit)</span>
<span style="color: #aa2222; background-color: #23272e;">-</span><span style="color: #ff6c6b; background-color: #23272e;">- </span>
2.20.1
</pre>
</div>
</div>
</div>

<div id="outline-container-org00f94f0" class="outline-3">
<h3 id="org00f94f0"><span class="section-number-3">2.2.</span> 用户态库的修改</h3>
<div class="outline-text-3" id="text-2-2">
<p>
用户态的库项目在：<a href="https://gitlabwh.uniontech.com/ut000683/libinput-enhance">https://gitlabwh.uniontech.com/ut000683/libinput-enhance</a>
</p>

<p>
使用最新的V25 镜像。
</p>
</div>
</div>


<div id="outline-container-orgd6bfcd0" class="outline-3">
<h3 id="orgd6bfcd0"><span class="section-number-3">2.3.</span> 对接人</h3>
<div class="outline-text-3" id="text-2-3">
<p>
treeland 的对接人是：郭垚
</p>

<p>
内核还有库的功能基本上完成，不知道会不会有细节上的问题。后面就是配合郭垚调通 treeland 。
目标是达到用 evtest 看到的键是加密的，treeland 管理的窗口获得的键是正常的。
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2024-10-28 一 10:56</p>
<p class="date">Created: 2024-11-01 五 15:30</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
