<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on Allinaent</title>
        <link>https://guolongji.xyz/post/</link>
        <description>Recent content in Posts on Allinaent</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <lastBuildDate>Thu, 11 Jan 2024 10:00:00 +0800</lastBuildDate><atom:link href="https://guolongji.xyz/post/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>置顶：博客计划与完成</title>
        <link>https://guolongji.xyz/post/next_todo/</link>
        <pubDate>Thu, 12 Oct 2023 11:04:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/next_todo/</guid>
        <description>&lt;h2 id=&#34;计划的任务&#34;&gt;计划的任务&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;emacs 使用 mu4e&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这个我本地用来读写 QQ 和 exmail 邮件，功能已经很好了，但是没总结。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;trace-bpfcc 和 mesa 的调试方法&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这个问了洪奥大佬，还没有自己实践过&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;小工具的网站&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;去水印，ai 问答&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;git 常用命令&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;运维常用命令&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;网卡的一些问题解决方法&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;龙芯的交叉编译&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;有价值的之前的文档&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;etc&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ai，math 和内核&lt;/p&gt;
&lt;h2 id=&#34;完成的任务&#34;&gt;完成的任务&lt;/h2&gt;
</description>
        </item>
        <item>
        <title>mesa 中的概念和代码介绍</title>
        <link>https://guolongji.xyz/post/mesa-introduction/</link>
        <pubDate>Thu, 11 Jan 2024 10:00:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/mesa-introduction/</guid>
        <description>&lt;h2 id=&#34;mesa-中的一些基本概念&#34;&gt;mesa 中的一些基本概念&lt;/h2&gt;
&lt;p&gt;mesa 这个项目是图形系统中的重要的一层。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mesa 的 3d 库有哪些？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Mesa 提供了多个 3D 图形库，用于实现不同的图形 API。以下是 Mesa 中一些常见的 3D 图形库：&lt;/p&gt;
&lt;p&gt;OpenGL: Mesa 提供了 OpenGL 的实现，包括 OpenGL 2.1、OpenGL 3.x 和 OpenGL 4.x 等版本。这些实现包括了 OpenGL 渲染器、顶点/像素处理器、纹理映射器、帧缓冲等功能。&lt;/p&gt;
&lt;p&gt;Vulkan: Mesa 提供了 Vulkan 的实现，用于支持 Vulkan API。Vulkan 是一个底层的、跨平台的图形 API
，能够提供更好的性能和更细粒度的控制。&lt;/p&gt;
&lt;p&gt;OpenCL: Mesa 提供了 OpenCL 的实现，用于支持 OpenCL API。OpenCL 是一个用于并行计算的开放标准，可以在不同的硬件上执行通用计算任务。&lt;/p&gt;
&lt;p&gt;EGL: Mesa 提供了 EGL（Embedded System Graphics Library）的实现，它是一个用于在嵌入式系统中管理图形资源的库。EGL 提供了与窗口系统的交互、创建和管理 OpenGL ES 上下文等功能。&lt;/p&gt;
&lt;p&gt;除了以上列举的 3D 图形库，Mesa 还有其他一些辅助库，用于支持特定的功能或硬件，比如 GBM
（Generic Buffer Manager）用于管理基于硬件的缓冲区对象，以及 Gallium3D 驱动架构用于简化图形驱动程序的开发等。&lt;/p&gt;
&lt;p&gt;请注意，Mesa 的具体库和功能取决于编译时的配置和选项，可能会有一些变化。你可以根据自己的需求选择合适的库进行编译和使用。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;为什么起名为 gallium3d，镓这个名字是从何而来？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Gallium3D 的名字来源于元素周期表中的镓（Gallium），这是一个化学元素符号为 Ga 的金属元素。
Gallium3D 项目最初由 Brian Paul 发起，他选择以镓作为项目的命名灵感来自于镓这个元素的特性和应用。&lt;/p&gt;
&lt;p&gt;镓是一种具有特殊性质和广泛应用的金属元素。它的特点之一是与其他元素形成合金时，可以改变合金的性能。同样，Gallium3D 项目的目标是提供一个可扩展的图形驱动架构，使开发人员能够根据需要针对不同的图形硬件进行优化和定制。&lt;/p&gt;
&lt;p&gt;另外，镓还具有低熔点、低毒性等特性，这使得它在电子设备和半导体行业中有广泛的应用。类似地，Gallium3D
项目旨在提供一个灵活易用的图形驱动框架，可以用于各种嵌入式系统和图形应用。&lt;/p&gt;
&lt;p&gt;因此，Gallium3D 名称的选取是一种象征，代表了该项目的灵活性、适应性和广泛的应用范围，类似于镓在化学和工业领域的特性和应用。&lt;/p&gt;
&lt;p&gt;关于取名，国内国外都讲究什么信达雅之类的东西。我只是觉得拗口无趣，名字取的怪好的，心思都花在这个上面，对于是否适合理解这种基本的需求反而弱化了。语言的本质还是为了交流的，对于我这种缺少耐心的人，根本就是讨厌这种乱七八糟起名字的行为。略略略。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;chromium 流览器的名字也是这么来的吗？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;不，Chromium 浏览器的名字并不是来源于镓元素。Chromium 是谷歌公司开发的开源浏览器项目，它的名字来自于铬（Chromium）这个化学元素。&lt;/p&gt;
&lt;p&gt;铬是一个化学元素，其符号为 Cr。它与铁类似，具有良好的耐腐蚀性能和高温稳定性。因此，谷歌选择了铬作为项目名称，以体现 Chromium 浏览器的稳定性和安全性。&lt;/p&gt;
&lt;p&gt;Chromium 浏览器是基于开源项目开发的，其代码库也称为 Chromium。谷歌将其作为 Google Chrome 浏览器的基础，并与全球开发者社区合作进行开发和改进。Chromium 浏览器的开源性质使得其他浏览器如 Opera、Brave
等也可以基于 Chromium 项目进行开发。&lt;/p&gt;
&lt;p&gt;总而言之，Chromium 浏览器的名字来自于铬元素，强调了该浏览器的稳定性和安全性。而 Gallium3D 项目的命名则是基于镓元素，代表了该项目的灵活性和广泛应用的特点。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;uos@guolongji:~/gg/mesa$ tree -A -d -L &lt;span style=&#34;color:#bd93f9&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── build-support
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── debian
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── patches
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;source&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── upstream
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── docs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── relnotes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── specs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── OLD
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── doxygen
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── include
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── c11
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── CL
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── D3D9
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── d3dadapter
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── drm-uapi
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── EGL
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── GL
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │   └── internal
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── GLES
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── GLES2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── GLES3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── HaikuGL
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── KHR
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── pci_ids
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── vulkan
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── m4
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── scons
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;└── src
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── amd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── addrlib
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── common
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── vulkan
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── broadcom
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── cle
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── clif
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── common
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── compiler
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── qpu
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── compiler
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── glsl
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── nir
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── spirv
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── egl
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── drivers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── generate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── wayland
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── gallium
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── auxiliary
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── docs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── drivers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── include
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── state_trackers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── targets
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── tests
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── tools
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── winsys
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── gbm
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── backends
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── getopt
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── glx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── apple
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── tests
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── windows
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── gtest
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── include
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── src
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── hgl
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── intel
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── blorp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── common
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── compiler
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── dev
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── genxml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── isl
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── tools
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── vulkan
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── loader
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── mapi
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── es1api
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── es2api
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── glapi
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── shared-glapi
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── mesa
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── drivers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── main
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── math
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── program
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── sparc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── state_tracker
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── swrast
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── swrast_setup
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── tnl
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── tnl_dd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── vbo
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── x86
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── x86-64
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ├── util
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── sha1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   ├── tests
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    │   └── xmlpool
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    └── vulkan
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ├── registry
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ├── util
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        └── wsi
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;gpt 是一个聪明的机器，他知道很多事情，就是不能像人一样做实验，否则我应该就被淘汰了。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mesa 最外层的 include 目录是干什么用的？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Mesa 是一个开源的图形库，用于实现图形渲染和加速功能。最外层的 include 目录在 Mesa 中扮演着重要的角色。&lt;/p&gt;
&lt;p&gt;include 目录包含了 Mesa 图形库的公共头文件。这些头文件定义了 Mesa 库提供的函数、数据结构和常量等，以及与图形渲染相关的其他信息。通过包含这些头文件，开发人员可以在自己的项目中使用 Mesa 库提供的功能，并进行图形渲染的操作。&lt;/p&gt;
&lt;p&gt;最外层的 include 目录通常是作为 Mesa 库的公共接口，供外部应用程序或其他库使用。开发人员可以直接引用这些头文件，以访问 Mesa 库的功能，并在自己的代码中进行图形渲染和加速的操作。&lt;/p&gt;
&lt;p&gt;总结来说，Mesa 最外层的 include 目录中的头文件提供了 Mesa 库的公共接口，允许开发人员在自己的项目中使用 Mesa 库的功能和特性，从而实现图形渲染和加速的需求。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;这个 include 目录为什么不写在 src 目录里面呢？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;将 include 目录放在 Mesa 的最外层而不是 src 目录中，是为了将公共头文件与实现代码分开，以提高代码的可维护性和可重用性。&lt;/p&gt;
&lt;p&gt;这种组织方式有几个好处：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;清晰的分离&lt;/strong&gt;: 将公共头文件放在 include 目录中可以使开发人员清晰地区分哪些文件是用于公共接口的声明，哪些是用于内部实现的代码。这种分离有助于提高代码结构的清晰度，并使项目更易于理解和维护。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;可重用性&lt;/strong&gt;: 通过将公共头文件放在 include 目录中，其他开发人员可以轻松地包含这些头文件并使用 Mesa 库的功能。这提供了一种重用代码的机制，允许其他项目或库依赖于 Mesa 的功能，而无需访问实现细节。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;编译隔离&lt;/strong&gt;: 将公共头文件放在 include 目录中，可以确保只有需要访问 Mesa 公共接口的代码才能引用这些头文件。这样，可以避免将实现细节暴露给外部代码，同时保护代码的安全性和稳定性。&lt;/p&gt;
&lt;p&gt;总之，将 include 目录放在 Mesa 的最外层而不是 src 目录中，是一种常见的组织代码的方式，有助于提高代码的可维护性、可重用性和安全性。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mesa 中的 src/compiler 目录是什么？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在 Mesa 图形库中，src/compiler 目录包含了与编译器相关的代码和实现。这个目录中的文件主要用于处理 OpenGL 和 Vulkan 等图形 API 的着色器代码的编译和优化。&lt;/p&gt;
&lt;p&gt;具体来说，src/compiler 目录包含以下内容：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;GLSL 编译器&lt;/strong&gt;: 这个目录下包含了用于编译 OpenGL 着色器语言（GLSL）代码的相关功能和算法。GLSL 编译器负责将 GLSL 代码转换成低级的图形硬件能够理解的形式，并进行一些优化操作。&lt;/p&gt;
&lt;p&gt;*SPIR-V 编译器*：SPIR-V 是一种用于表示着色器代码的中间语言，它可以在不同的图形 API 之间进行转换和交流。src/compiler 目录中的文件包含了与 SPIR-V 编译器相关的功能和算法，负责将 GLSL 代码或其他输入转换为 SPIR-V 形式。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;优化器和分析器&lt;/strong&gt;: src/compiler 目录还包含了一些优化器和分析器的实现，用于对着色器代码进行性能优化和分析。这些组件可以帮助提高着色器的执行效率，并生成更高质量的图形渲染结果。&lt;/p&gt;
&lt;p&gt;总之，src/compiler 目录是 Mesa 图形库中用于处理 OpenGL 和 Vulkan 着色器代码编译和优化的部分。它包含了 GLSL 编译器、SPIR-V 编译器以及一些优化器和分析器的实现。这些功能和算法的存在可以帮助开发人员更好地管理和优化图形渲染过程。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mesa 中的 src/egl 目录是什么？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在 Mesa 图形库中，src/egl 目录包含了与 EGL（Embedded System Graphics Library）相关的代码和实现。EGL 是一个用于管理图形渲染上下文、表面和设备之间交互的 API。&lt;/p&gt;
&lt;p&gt;具体来说，src/egl 目录包含以下内容：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;EGL 实现&lt;/strong&gt;: 这个目录下包含了 EGL API 的实现，包括函数调用的处理和与底层图形系统的交互。这些代码负责创建和管理 EGL 上下文，并提供与 OpenGL 和其他图形 API 之间的交互。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;平台特定的 EGL 驱动&lt;/strong&gt;: src/egl 目录还包含了一些特定平台的 EGL 驱动程序，用于与不同的操作系统和硬件平台进行交互。这些驱动程序负责与底层图形系统进行通信，并提供相应的功能和接口。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;扩展支持&lt;/strong&gt;: Mesa 的 EGL 实现还支持一些扩展，用于提供额外的功能或与特定平台进行交互。这些扩展的实现也可以在 src/egl 目录中找到。&lt;/p&gt;
&lt;p&gt;总之，src/egl 目录是 Mesa 图形库中用于实现 EGL API 和与底层图形系统交互的部分。它包含了 EGL 的实现、平台特定的 EGL 驱动程序以及一些扩展支持。这些功能和接口的存在可以帮助开发人员在嵌入式系统中更方便地管理图形渲染上下文、表面和设备之间的交互。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GLSL 语言是什么？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GLSL（OpenGL Shading Language）是一种用于编写着色器程序的高级编程语言。它是 OpenGL 图形 API 的一部分，用于控制图形渲染管线中的顶点和像素处理阶段。&lt;/p&gt;
&lt;p&gt;GLSL 提供了一种编写可在 GPU 上执行的着色器程序的方式。着色器程序是一组特殊的函数，用于对图形数据进行处理和计算。在 OpenGL 中，顶点着色器（Vertex Shader）用于处理输入顶点数据，而片段着色器（Fragment Shader）用于处理每个像素的颜色。&lt;/p&gt;
&lt;p&gt;GLSL 具有类 C 语言的语法结构，但它专门设计用于图形渲染任务，并包含了一些与图形处理相关的特性。
GLSL 语言支持向量和矩阵操作、条件语句、循环控制等常见的编程语言特性，并提供了丰富的内置函数和变量来方便编写着色器程序。&lt;/p&gt;
&lt;p&gt;通过编写 GLSL 代码，开发人员可以自定义图形渲染管线中的顶点和像素处理过程，实现各种图形效果和计算任务。GLSL 着色器程序可以在 GPU 上并行执行，充分利用 GPU 的计算能力，从而实现高性能的图形渲染和计算任务。&lt;/p&gt;
&lt;p&gt;总之，GLSL 是 OpenGL Shading Language 的缩写，它是一种用于编写着色器程序的高级编程语言。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mesa 中的 src/gbm 目录是什么？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在 Mesa 图形库中，src/gbm 目录是一个与 GBM（Generic Buffer Manager）相关的代码和实现。GBM 是一个用于管理显存缓冲区的 API，它可以帮助开发人员在不同的图形系统之间共享显存缓冲区。&lt;/p&gt;
&lt;p&gt;具体来说，src/gbm 目录包含以下内容：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;GBM 实现&lt;/strong&gt;: 这个目录下包含了 GBM API 的实现，包括函数调用的处理和与底层图形系统的交互。这些代码负责创建和管理 GBM 缓冲区对象，并提供与 EGL 和其他图形 API 之间的交互。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;平台特定的 GBM 驱动&lt;/strong&gt;: src/gbm 目录还包含了一些特定平台的 GBM 驱动程序，用于与不同的操作系统和硬件平台进行交互。这些驱动程序负责与底层图形系统进行通信，并提供相应的功能和接口。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;扩展支持&lt;/strong&gt;: Mesa 的 GBM 实现还支持一些扩展，用于提供额外的功能或与特定平台进行交互。这些扩展的实现也可以在 src/gbm 目录中找到。&lt;/p&gt;
&lt;p&gt;总之，src/gbm 目录是 Mesa 图形库中用于实现 GBM API 和与底层图形系统交互的部分。它包含了 GBM 的实现、平台特定的 GBM 驱动程序以及一些扩展支持。这些功能和接口的存在可以帮助开发人员在不同的图形系统之间共享显存缓冲区，从而提高图形渲染的效率。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mesa 中的 src/glx 目录是什么？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在 Mesa 图形库中，src/glx 目录包含与 GLX（OpenGL Extension to the X Window System）相关的代码和实现。GLX 是在 X Window System 上使用 OpenGL 的扩展，它提供了 OpenGL 渲染上下文的创建、管理和交互的功能。&lt;/p&gt;
&lt;p&gt;具体来说，src/glx 目录包含以下内容：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;GLX 实现&lt;/strong&gt;: 这个目录下包含了 GLX API 的实现，包括函数调用的处理和与底层 X Window System 的交互。这些代码负责创建和管理 GLX 渲染上下文，并提供与 X Window System 和 OpenGL 之间的交互。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;GLX 扩展支持&lt;/strong&gt;: Mesa 的 GLX 实现还支持一些扩展，用于提供额外的功能或与特定平台进行交互。这些扩展的实现也可以在 src/glx 目录中找到。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;平台特定的 GLX 驱动&lt;/strong&gt;: src/glx 目录还包含了一些特定平台的 GLX 驱动程序，用于与不同的操作系统和硬件平台进行交互。这些驱动程序负责与底层 X Window System 进行通信，并提供相应的功能和接口。&lt;/p&gt;
&lt;p&gt;总之，src/glx 目录是 Mesa 图形库中用于实现 GLX API 和与底层 X Window System 交互的部分。它包含了 GLX 的实现、扩展支持以及平台特定的 GLX 驱动程序。这些功能和接口的存在可以帮助开发人员在 X Window System 上使用 OpenGL 进行图形渲染，并提供与 X Window System 和其他图形 API
之间的交互。&lt;/p&gt;
&lt;p&gt;简单来说就是 opengl 对 X11 实现的支持部分。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;src/hgl 目录是干什么的？haiku 这个操作系统是干什么的？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Haiku 是一个开源的操作系统，旨在提供简单、高效和现代化的计算环境。它最初是为了取代 BeOS 而开发的，因此继承了 BeOS 的一些设计理念和特性。&lt;/p&gt;
&lt;p&gt;Haiku 的目标是提供用户友好的界面和稳定的系统性能。它专注于桌面计算，并致力于提供一种简洁而富有创意的用户体验。Haiku 的设计理念强调响应速度、可靠性和一致性。&lt;/p&gt;
&lt;p&gt;Haiku 具有以下特点：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;轻量级&lt;/strong&gt;: Haiku 采用精简的设计和优化的代码，使其在资源消耗上非常高效。这使得它适合在较低配置的硬件上运行。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;响应速度&lt;/strong&gt;: Haiku 旨在提供快速且即时的用户体验。它使用了一个基于消息传递的体系结构，以确保系统对用户输入的响应迅速而及时。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;多任务处理&lt;/strong&gt;: Haiku 支持多任务处理，允许用户同时运行多个应用程序，并通过窗口管理器进行管理。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;多媒体功能&lt;/strong&gt;: Haiku 内置了各种多媒体功能，包括音频和视频播放、图像处理和其他多媒体工具。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;开放源代码&lt;/strong&gt;: Haiku 是一个开源项目，这意味着任何人都可以访问、使用和贡献代码。&lt;/p&gt;
&lt;p&gt;总之，Haiku 是一个专注于桌面计算的开源操作系统，旨在提供简洁、高效和稳定的用户体验。它具有轻量级、响应速度快以及多媒体功能丰富等特点。&lt;/p&gt;
&lt;p&gt;所以这个是为了技术派支持添加的一个操作系统。他们很厉害，BeOS 在当时也是很先进的。商业不成功但是技术成功。真是一件悲哀的事。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mesa 演进的一个说明&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/HaoBBNuanMM/article/details/109054106&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/HaoBBNuanMM/article/details/109054106&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Gallium3D 对比非 Gallium3D 架构，Vendor 和平台相关的实现移到了 HW Vendor Driver 和 WinSys 模块的具体实现中，libmesa_dri_drivers 面向 Gallium3D 提供的接口实现 EGL 和 GLES 的调用，实现了 API OS HW 的三层分离。&lt;/p&gt;
&lt;p&gt;也就是说，做了一个软件架构的重构和抽取。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;src/mapi 和 src/mesa 这两个文件夹的区别是什么？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;src/mapi 文件夹是 Mesa 图形库中的一个子目录，它包含了与图形 API 接口相关的代码。这些代码主要负责处理与图形 API 的交互，将 API 调用转发给底层的图形驱动程序或其他模块。src/mapi 中的代码提供了对图形功能的抽象和封装。&lt;/p&gt;
&lt;p&gt;而 src/mesa 文件夹是 Mesa 图形库的另一个子目录，它包含了 Mesa 图形库的核心实现，主要集中在图形渲染管线的各个阶段。这些阶段包括顶点处理、图元装配、光栅化、片段处理等。src/mesa 中的代码实现了渲染管线的功能，以及相关的状态管理和优化算法。&lt;/p&gt;
&lt;p&gt;简单来说，src/mapi 中的代码处理与图形 API 的交互，而 src/mesa 中的代码实现了渲染管线的各个阶段。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;src/mapi 的 api 包含哪些功能？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;src/mapi 目录中的 API 主要包含了与 OpenGL 和其他图形 API 相关的功能。下面是一些常见的功能：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;OpenGL 函数调用&lt;/strong&gt;: Mesa 实现了 OpenGL 标准规范中的核心函数和扩展函数。这些函数可以在应用程序中调用，以执行各种图形操作，例如顶点处理、着色器程序设置、纹理操作、帧缓冲操作等。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Gallium3D 接口&lt;/strong&gt;: Gallium3D 是 Mesa 中的一个模块化图形驱动架构，它提供了一套通用的 API 接口，用于处理图形硬件功能。src/mapi 目录中的代码实现了与 Gallium3D 接口的交互，以便各个驱动程序能够利用 Gallium3D 提供的功能。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;其他图形 API 支持&lt;/strong&gt;: 除了 OpenGL，Mesa 还支持其他图形 API，如 OpenCL、Vulkan 等。src/mapi 目录中的代码也包括这些 API 的实现和相关功能。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;状态管理&lt;/strong&gt;: Mesa 中有许多图形状态需要进行管理和跟踪，例如着色器程序、纹理对象、帧缓冲等。src/mapi 目录中的代码负责维护和管理这些状态，并提供对它们的访问和操作接口。&lt;/p&gt;
&lt;p&gt;总的来说，src/mapi 目录中的 API 提供了与 OpenGL 和其他图形 API 的交互功能，包括函数调用、状态管理以及对特定图形 API 的支持。这些 API 使得应用程序能够通过 Mesa 库与底层的图形硬件进行交互和操作。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;src/mesa 的目录的作用是什么？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在 Mesa 图形库中，src/mesa 目录包含了与图形渲染管线和图形处理相关的代码。这个目录下的代码实现了 Mesa 图形库的核心功能，包括：&lt;/p&gt;
&lt;p&gt;图形渲染管线: Mesa 实现了图形渲染管线的各个阶段，包括顶点处理、图元装配、光栅化、片段处理等。src/mesa 目录中的代码实现了这些阶段的功能，并提供了对 OpenGL API 的支持。&lt;/p&gt;
&lt;p&gt;状态管理: Mesa 中有许多图形状态需要进行管理和跟踪，例如着色器程序、纹理对象、帧缓冲等。src/mesa 目录中的代码负责维护和管理这些状态，并提供对它们的访问和操作接口。&lt;/p&gt;
&lt;p&gt;图形算法和优化: Mesa 中的一些图形算法和优化技术也是在 src/mesa 目录下实现的。例如，三角形剔除、深度测试、多重采样等功能都在这个目录的代码中。&lt;/p&gt;
&lt;p&gt;总的来说，src/mesa 目录包含了 Mesa 图形库的核心功能实现，包括图形渲染管线的各个阶段、状态管理以及一些图形算法和优化。与之相对应，src/mapi 目录则包含了与 API 接口相关的代码，实现了与 OpenGL 和其他图形 API 的交互。这样的划分可以使得 Mesa 的代码结构更加清晰和模块化。&lt;/p&gt;
&lt;p&gt;总的来说 mapi 是和底层打交道比较多的部分；而 mesa 目录是渲染流程的处理。&lt;/p&gt;
&lt;p&gt;小知识，儒释道的产生几乎算是同时期出现的，但是道教是从西汉的黄老之说到从东汉时期正式产生。&lt;/p&gt;
&lt;p&gt;1、相当于中国的春秋末期或者说是东周或者说是诸侯争霸（春秋五霸）的时代；&lt;/p&gt;
&lt;p&gt;2、历史上的佛陀，也就是乔达摩悉达多，生于公元前 563 圆寂于公元前 483 年另有释迦牟尼生于公元前 565 年，灭于公元前 486 年说。但是年代大致不会差很多，一定在中国东周时期这个范围内；&lt;/p&gt;
&lt;p&gt;3、和孔子（前 551——479）生活在几乎同一个时代；&lt;/p&gt;
&lt;p&gt;4、公元前 770 到公元前 476 年左右（田氏代齐、三家分晋）等相当于中国历史上的春秋时期，司马光的《资治通鉴》就是以三家分晋开始写战国历史的，所以佛陀是春秋时代的人，和中国诸子百家齐争鸣同在一个时代。&lt;/p&gt;
&lt;p&gt;所以春秋时期才是思想刚刚出现的朴素时期。那个时代人类的想像力和社会实践有了空前的发展。后面二千年的封建王朝时间，好像社会发展了，但是真的发展的比较慢。只到 1650 年左右，又过了将近 1700 年，人类才走向了自然科学发展的黄金时期，或许，人类的发展就是这样。时快时慢的，大的突破需要很多代人，才能产生一个天之骄子，带领人类走向文明新的阶段。&lt;/p&gt;
&lt;p&gt;壮哉，我的大人类。“一群小土豆也妄想窥视宇宙的真理”，是啊，人类的妄想。这个世界真是神奇的过了头了。&lt;/p&gt;
&lt;h2 id=&#34;如何看-mesa-代码&#34;&gt;如何看 mesa 代码&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;看 mesa 的代码要从顺着哪条线来看呢？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;要理解 Mesa 的代码，可以按照以下线索来进行阅读：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;入口点&lt;/strong&gt; ：从 src/loader，这是程序的入口点，提供了 Mesa 库的初始化和主要功能。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;平台相关代码&lt;/strong&gt; ：在 src/mesa/main 和 src/mesa/drivers 中，可以找到与特定图形 API 和平台相关的代码。例如，src/mesa/main/context.c 包含了与 OpenGL 上下文相关的功能，而 src/mesa/drivers/dri/common 则包含了与 Direct Rendering Infrastructure (DRI) 相关的代码。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;核心实现&lt;/strong&gt; ：进入 src/mesa 目录，从 main 子目录开始，逐步深入各个子目录，如 arrayobj、shader、texobj 等。这些子目录包含了实现 Mesa 图形库核心功能的代码，涵盖了渲染管线中的各个阶段。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;驱动程序&lt;/strong&gt; ：如果对特定的图形硬件感兴趣，可以查看 src/mesa/drivers 目录中的子目录。不同的子目录代表了不同的图形驱动程序，例如 gallium 子目录包含了 Gallium3D 驱动程序。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;可选模块&lt;/strong&gt; ：在 src/mesa/program 目录中，可以找到与 GPU 程序编译和链接相关的代码。这些代码用于处理和优化 GPU 程序，并将其与其他 Mesa 组件集成。&lt;/p&gt;
&lt;p&gt;阅读 Mesa 的代码可以根据个人的兴趣和需求来选择特定的模块和功能进行深入研究。同时，了解 OpenGL、Vulkan 和其他相关图形 API 的基本原理也会有助于更好地理解 Mesa 的实现。&lt;/p&gt;
&lt;h2 id=&#34;mesa-完整流程的顺序是什么样子的&#34;&gt;mesa 完整流程的顺序是什么样子的？&lt;/h2&gt;
&lt;p&gt;Mesa 的完整流程可以大致分为以下几个步骤：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;初始化&lt;/strong&gt; ：在程序的入口点（如 src/main 或 src/gallium/main）进行 Mesa 库的初始化，包括创建上下文、加载图形驱动程序等。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;上下文管理&lt;/strong&gt; ：在 src/mesa/main/context.c 中，处理与 OpenGL 上下文相关的操作，包括上下文的创建、切换和销毁等。它还负责上下文属性的设置，如渲染器类型、版本号、纹理单元数量等。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;顶点数据处理&lt;/strong&gt; ：在 src/mesa/main/vertexarray.c 和 src/mesa/main/varray.c 中，对顶点数据进行处理。这包括对顶点属性的解析、组装和格式转换，以及对顶点缓冲区的管理。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;顶点着色器&lt;/strong&gt; ：在 src/mesa/main/program/* 目录中，进行顶点着色器的编译、链接和优化。这些代码负责将顶点着色器源代码转换为可执行的 GPU 程序。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;图元装配和剪裁&lt;/strong&gt; ：在 src/mesa/main/imports.c 和 src/mesa/main/clip.c 中，根据绘制命令将顶点数据装配成图元，并进行视锥体剪裁来确定可见图元。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;几何着色器（可选）&lt;/strong&gt; ：如果使用了几何着色器，相关的代码位于 src/mesa/main/program/geometry.c 中。几何着色器对输入图元进行变换和生成新的图元。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;图元装订&lt;/strong&gt; ：在 src/mesa/main/vbo/vbo_exec_draw.c 中，对图元进行装订操作，包括应用变换矩阵、执行光栅化等。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;片段着色器&lt;/strong&gt; ：在 src/mesa/main/program/* 目录中，进行片段着色器的编译、链接和优化。这些代码将片段着色器源代码转换为可执行的 GPU 程序。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;光栅化和片段处理&lt;/strong&gt; ：在 src/mesa/main/rastpos.c 和 src/mesa/main/drawpix.c 中，进行图元的光栅化和片段处理。这包括插值、纹理采样、深度测试、颜色混合等操作。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;帧缓冲操作&lt;/strong&gt; ：在 src/mesa/main/fbobject.c 中，对帧缓冲对象进行管理和操作。包括渲染目标的绑定、解绑，以及帧缓冲的读写操作。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;输出到显示设备&lt;/strong&gt; ：在 src/mesa/drivers/*/context.c 中，将渲染结果输出到显示设备上。这涉及到与硬件和平台相关的操作，如通过 DRI 进行 Direct Rendering。&lt;/p&gt;
&lt;p&gt;以上是 Mesa 的大致流程，不同的功能和模块可能有一些细微的差异。此外，Mesa 还涉及到其他方面的功能，如纹理处理、着色器编译和链接、缓存管理等。具体实现的细节会因各个子模块的不同而有所变化。&lt;/p&gt;
&lt;h2 id=&#34;现在看代码&#34;&gt;现在看代码&lt;/h2&gt;
&lt;p&gt;之前明哥分享过 mesa 的库的调用，我看了之前的 ppt ，温故知新（实际上之前根本没记住，都没有什么印象了）。&lt;/p&gt;
&lt;h3 id=&#34;mesa-的初始化&#34;&gt;mesa 的初始化&lt;/h3&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/mesa-init.png&#34;
         alt=&#34;Caption not used as alt text&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 1: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;mesa 3d 的初始化&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

</description>
        </item>
        <item>
        <title>如何用emacs mu4e 和 org-mime收发邮件</title>
        <link>https://guolongji.xyz/post/mu4e-and-org-mime/</link>
        <pubDate>Tue, 09 Jan 2024 15:36:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/mu4e-and-org-mime/</guid>
        <description>&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;用 mu4e 有一段时间了，之前一直认为用 emacs 发 html 的工作邮件不好用。后来突然突破了一些小问题，现在用起来简直是真香了。&lt;/p&gt;
&lt;h2 id=&#34;一些参考的博客&#34;&gt;一些参考的博客&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.cesarolea.com/posts/html-signatures-with-mu4e/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://www.cesarolea.com/posts/html-signatures-with-mu4e/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.reddit.com/r/emacs/comments/he885y/is_it_possible_to_add_an_image_to_orgmsg_signature/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.reddit.com/r/emacs/comments/he885y/is_it_possible_to_add_an_image_to_orgmsg_signature/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://dataswamp.org/~solene/2016-06-07-13.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://dataswamp.org/~solene/2016-06-07-13.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://emacs.stackexchange.com/questions/25045/how-can-i-easily-download-save-an-attachment-in-mu4e&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://emacs.stackexchange.com/questions/25045/how-can-i-easily-download-save-an-attachment-in-mu4e&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.djcbsoftware.nl/code/mu/mu4e/Sending-mail.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.djcbsoftware.nl/code/mu/mu4e/Sending-mail.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/org-mime/org-mime&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/org-mime/org-mime&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;实现&#34;&gt;实现&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;痛点一&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;不能加签名，实际上从 exmail 的已往的邮件中找到签名的部分，html 直接复制下来。&lt;/p&gt;
&lt;p&gt;另外，设置一下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-lisp&#34; data-lang=&#34;lisp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;setq&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;mu4e-compose-signature&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&amp;lt;#part type=text/html&amp;gt;&amp;lt;html&amp;gt;&amp;lt;body&amp;gt;&amp;lt;div ksdocclipboard=\&amp;#34;ksDocClipboardId:&amp;#39;{6ca6dd41-c38a-1a9b-73d3-e616e9e420bf-qya_1697662800_7463885520560027880_14897365800822071641}&amp;#39;;from:&amp;#39;wps&amp;#39;;priorityFormat:&amp;#39;Kingsoft WPS 9.0 Format,Kingsoft Image Data,text/html,text/plain,Kingsoft Data Descriptor&amp;#39;;mimetypes:&amp;#39;Kingsoft WPS 9.0 Format;Kingsoft Image Data;text/html;text/plain;Kingsoft Data Descriptor&amp;#39;\&amp;#34; style=\&amp;#34;font-size: medium;\&amp;#34;&amp;gt;&amp;lt;p class=\&amp;#34;MsoNormal\&amp;#34; style=\&amp;#34;margin: 0pt 0pt 0.0001pt; font-family: Calibri; font-size: 10.5pt;\&amp;#34;&amp;gt;&amp;lt;b style=\&amp;#34;font-size: 10.5pt;\&amp;#34;&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; font-size: 14pt;\&amp;#34;&amp;gt;郭隆基 Longji&amp;lt;font face=\&amp;#34;CESI黑体-GB18030\&amp;#34;&amp;gt;.Guo&amp;lt;/font&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p class=\&amp;#34;MsoNormal\&amp;#34; style=\&amp;#34;margin: 0pt 0pt 0.0001pt; font-family: Calibri; font-size: 10.5pt;\&amp;#34;&amp;gt;&amp;lt;b&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; font-size: 14pt;\&amp;#34;&amp;gt;&amp;lt;font face=\&amp;#34;CESI黑体-GB18030\&amp;#34;&amp;gt;内核研发部&amp;lt;/font&amp;gt;&amp;lt;font face=\&amp;#34;CESI黑体-GB18030\&amp;#34;&amp;gt;&amp;amp;nbsp; 内核研发&amp;lt;/font&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;b&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; font-size: 14pt;\&amp;#34;&amp;gt;工程师&amp;lt;/span&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;b&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; font-size: 14pt;\&amp;#34;&amp;gt;&amp;lt;o:p&amp;gt;&amp;lt;/o:p&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p class=\&amp;#34;MsoNormal\&amp;#34; style=\&amp;#34;margin: 0pt 0pt 0.0001pt; font-family: Calibri; font-size: 10.5pt;\&amp;#34;&amp;gt;&amp;lt;b&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; font-size: 14pt;\&amp;#34;&amp;gt;统信软件&amp;lt;/span&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;b&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; font-size: 14pt;\&amp;#34;&amp;gt;&amp;lt;o:p&amp;gt;&amp;lt;/o:p&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p class=\&amp;#34;MsoNormal\&amp;#34; style=\&amp;#34;margin: 0pt 0pt 0.0001pt; font-family: Calibri; font-size: 10.5pt;\&amp;#34;&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; color: rgb(120, 120, 120); font-size: 14pt;\&amp;#34;&amp;gt;企业&amp;lt;/span&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; color: rgb(120, 120, 120); font-size: 14pt;\&amp;#34;&amp;gt;官网：&amp;lt;/span&amp;gt;&amp;lt;a href=\&amp;#34;https://www.uniontech.com\&amp;#34;&amp;gt;&amp;lt;u&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; color: rgb(0, 0, 255); font-size: 14pt;\&amp;#34;&amp;gt;&amp;lt;font face=\&amp;#34;CESI黑体-GB18030\&amp;#34;&amp;gt;www.uniontech.com&amp;lt;/font&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/u&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; font-size: 14pt;\&amp;#34;&amp;gt;&amp;lt;o:p&amp;gt;&amp;lt;/o:p&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p class=\&amp;#34;MsoNormal\&amp;#34; style=\&amp;#34;margin: 0pt 0pt 0.0001pt; font-family: Calibri; font-size: 10.5pt;\&amp;#34;&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; color: rgb(120, 120, 120); font-size: 14pt;\&amp;#34;&amp;gt;&amp;lt;font face=\&amp;#34;CESI黑体-GB18030\&amp;#34;&amp;gt;服务热线：&amp;lt;/font&amp;gt;&amp;lt;font face=\&amp;#34;CESI黑体-GB18030\&amp;#34;&amp;gt;400-8588-488&amp;lt;/font&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; color: rgb(120, 120, 120); font-size: 14pt;\&amp;#34;&amp;gt;&amp;lt;o:p&amp;gt;&amp;lt;/o:p&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p class=\&amp;#34;MsoNormal\&amp;#34; style=\&amp;#34;margin: 0pt 0pt 0.0001pt; font-family: Calibri; font-size: 10.5pt;\&amp;#34;&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; color: rgb(120, 120, 120); font-size: 14pt;\&amp;#34;&amp;gt;办公地址：&amp;lt;/span&amp;gt;&amp;lt;span style=\&amp;#34;font-family: CESI黑体-GB18030; color: rgb(120, 120, 120); font-size: 14pt;\&amp;#34;&amp;gt;&amp;lt;font face=\&amp;#34;CESI黑体-GB18030\&amp;#34;&amp;gt;北京经济技术开发区科谷一街&amp;lt;/font&amp;gt;&amp;lt;font face=\&amp;#34;CESI黑体-GB18030\&amp;#34;&amp;gt;10号院12号楼&amp;lt;/font&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;p class=\&amp;#34;MsoNormal\&amp;#34; style=\&amp;#34;margin: 0pt 0pt 0.0001pt; font-family: Calibri; font-size: 10.5pt;\&amp;#34;&amp;gt;&amp;lt;img src=\&amp;#34;http://exmail.qq.com/cgi-bin/viewfile?type=signature&amp;amp;amp;picid=ZX0619-gvCHZ7VhAmlZQG0IRjQhddm&amp;amp;amp;uin=762040946\&amp;#34; style=\&amp;#34;font-size: medium; font-family: &amp;amp;quot;lucida Grande&amp;amp;quot;, Verdana, &amp;amp;quot;Microsoft YaHei&amp;amp;quot;;\&amp;#34; onerror=\&amp;#34;\&amp;#34;&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;lt;#/part&amp;gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;现在每次发邮件可以加上签名了。加签名的是 html 邮件，这种邮件只接加文本的内容是不会在邮件当中显示出来的，所以只能用 org-mime 来用 orgmode 写邮件。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;org-mime 的配置&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-lisp&#34; data-lang=&#34;lisp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#50fa7b&#34;&gt;require&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;org-mime&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;setq&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;org-mime-library&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;mml&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;setq&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;org-mime-export-options&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;#39;&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;:with-latex&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;dvipng&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#f1fa8c&#34;&gt;:section-numbers&lt;/span&gt; nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#f1fa8c&#34;&gt;:with-author&lt;/span&gt; nil
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#f1fa8c&#34;&gt;:with-toc&lt;/span&gt; nil))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;核心就是上面的三个配置。&lt;/p&gt;
&lt;p&gt;使用的步聚是这样的。C-c u 打开 mu4e 的主页面，按 C 写一个新邮件。&lt;/p&gt;
&lt;p&gt;使用 org-mime-edit-mail-in-org-mode ，用 orgmode 编辑一个 orgmode 的邮件。按 C-c C-c 来
org-mime-edit-src-exit ，再用 org-mime-htmlize 将 orgmode 的内容转换成 html 。代码，图片，还有其它的 orgmode 的标题之类的都显示的比较好看。&lt;/p&gt;
&lt;p&gt;这样就可以非常方便的使用 emacs 来发送和接收邮件了。&lt;/p&gt;
&lt;p&gt;emacs 强无敌。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240109_155503.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;可以在-orgmode-文件当中直接发邮件&#34;&gt;可以在 orgmode 文件当中直接发邮件&lt;/h2&gt;
&lt;p&gt;在 orgmode 下开起 org-mime-src-mode ，打开这个 mode 之后，就能将 orgmode 文件直接发成邮件出来。不过这个对我来说不是很重要。将发邮件同 emacs 的工作流程联系起来，以后再也不用打开一个网页的客户端了，效率可以得到一丝的提升。幸福感直接提升非常多，最重要的是能绐小白装 X 了。&lt;/p&gt;
&lt;h2 id=&#34;todo-之前的-exmail-和-qq-邮箱的配置&#34;&gt;todo ，之前的 exmail 和 QQ 邮箱的配置&lt;/h2&gt;
&lt;p&gt;这部分是自己之前琢磨出来的，以后补充一下配置的方法。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>显卡测试的一些命令记录</title>
        <link>https://guolongji.xyz/post/grapic-test/</link>
        <pubDate>Wed, 03 Jan 2024 15:28:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/grapic-test/</guid>
        <description>&lt;p&gt;很多东西，每用一次都要查一遍，非常的麻烦。需要把常用的东西记录下来。&lt;/p&gt;
&lt;p&gt;sudo apt install libegl1 libgl1 libgles2 libglvnd0 libglx0&lt;/p&gt;
&lt;p&gt;sudo apt install libdrm-amdgpu1 libdrm-common libdrm-nouveau2 libdrm-radeon1  libdrm2&lt;/p&gt;
&lt;p&gt;sudo apt install libegl-mesa0 libgbm1 libgl1-mesa-dri libglapi-mesa libglx-mesa0 mesa-va-drivers
mesa-vdpau-drivers&lt;/p&gt;
&lt;h2 id=&#34;安装-glmark2&#34;&gt;安装 glmark2&lt;/h2&gt;
&lt;p&gt;sudo apt install g++ libpng-dev libjpeg-dev libx11-dev&lt;/p&gt;
&lt;p&gt;unzip glmark2.zip&lt;/p&gt;
&lt;p&gt;cd glmark2/&lt;/p&gt;
&lt;p&gt;./waf configure &amp;ndash;with-flavors=x11-gl&lt;/p&gt;
&lt;p&gt;./waf build -j4&lt;/p&gt;
&lt;p&gt;sudo ./waf install&lt;/p&gt;
&lt;p&gt;sudo strip -s /usr/local/bin/glmark2&lt;/p&gt;
&lt;h2 id=&#34;测试命令&#34;&gt;测试命令&lt;/h2&gt;
&lt;p&gt;x11perf -all&lt;/p&gt;
&lt;p&gt;glmark2 &amp;ndash;run-forever&lt;/p&gt;
&lt;p&gt;glxgears&lt;/p&gt;
&lt;p&gt;三个同时跑，glxgears 可以显示帧率。&lt;/p&gt;
&lt;h2 id=&#34;deb-下载-mesa-的依赖&#34;&gt;deb 下载 mesa 的依赖&lt;/h2&gt;
&lt;p&gt;sudo apt build-dep mesa #下载 mesa 编译依赖包&lt;/p&gt;
&lt;h2 id=&#34;下载所有依赖包&#34;&gt;下载所有依赖包&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget -c -r -np -k -L -p http://path/to/debs &lt;span style=&#34;color:#6272a4&#34;&gt;#递归下载网页内容，但是每个目录下会多一个index.thml文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rm&lt;span style=&#34;color:#f1fa8c&#34;&gt;`&lt;/span&gt;find ./ -name index.html&lt;span style=&#34;color:#f1fa8c&#34;&gt;`&lt;/span&gt; &lt;span style=&#34;color:#6272a4&#34;&gt;#删除目录及子目录下所有index.html文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        <item>
        <title>AppArmor</title>
        <link>https://guolongji.xyz/post/apparmor-introduction/</link>
        <pubDate>Wed, 03 Jan 2024 14:03:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/apparmor-introduction/</guid>
        <description>&lt;h2 id=&#34;是什么&#34;&gt;是什么？&lt;/h2&gt;
&lt;p&gt;管控应用对资源的访问。对文件，网络，linux Capability ，D-Bus ，signal ，rlimit&lt;/p&gt;
&lt;p&gt;通过配置文件。&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240103_140715.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 1: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;启用&#34;&gt;启用&lt;/h2&gt;
&lt;p&gt;sudo apt install apparmor apparmor-utils  apparmor-profiles apparmor-easyprof&lt;/p&gt;
&lt;h2 id=&#34;查看状态&#34;&gt;查看状态&lt;/h2&gt;
&lt;p&gt;sudo aa-status&lt;/p&gt;
&lt;p&gt;这个是基于路径的。&lt;/p&gt;
&lt;h2 id=&#34;写策略&#34;&gt;写策略&lt;/h2&gt;
&lt;p&gt;写一个 /tmp/ls 来举个例子。&lt;/p&gt;
&lt;p&gt;sudo vim /etc/apparmor.d/tmp.ls&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;/tmp/ls { # (complain) 去掉是强制模式。
        # rules 目录需要以 / 结尾
        /etc/ld.so.cache r,
        /usr/lib/x86_64-linux-gnu/libc-2.28.so rm,
        /usr/lib/x86_64-linux-gnu/* rm,
        /home/uos/ r,
        /proc/filesystems r,
        /usr/lib/locale/locale-archive r,
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;sudo apparmor_parser -r /etc/apparmor.d/tmp.ls 把规则加载到内核当中。&lt;/p&gt;
&lt;p&gt;sudo systemctl start auditd&lt;/p&gt;
&lt;p&gt;sudo tail -f 查看审计日志。&lt;/p&gt;
&lt;p&gt;也可以自动生成规则：&lt;/p&gt;
&lt;p&gt;sudo aa-gen&lt;/p&gt;
&lt;h2 id=&#34;使用的技术&#34;&gt;使用的技术&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240103_142639.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 2: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;flex 举例， sudo apt install flex&lt;/p&gt;
&lt;p&gt;vim test.flex&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;{%
        #include &amp;lt;stdio.h&amp;gt;
%}

[0-9]+ {printf(&amp;#34;NUMBER\n&amp;#34;);
[a-zA-Z] {printf(&amp;#34;WORLD\n&amp;#34;);}
exit (yy_terminate();)


int yy_wrap(){
        return 1;
}
int main() {
        yy_lex();
        return 1;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;flex test.flex ，词法解析的结果会喂绐语法解析的程序。&lt;/p&gt;
&lt;p&gt;vim parse.yacc&lt;/p&gt;
&lt;p&gt;vim scan.lex&lt;/p&gt;
&lt;p&gt;就会得到一个配置文件解析的工具。&lt;/p&gt;
&lt;h2 id=&#34;apparmor-使用的另外的技术&#34;&gt;apparmor 使用的另外的技术&lt;/h2&gt;
&lt;p&gt;状态机。&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240103_144517.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 3: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;状态机的性能非常好，可以对状态机生成的表格做一下压缩。&lt;/p&gt;
&lt;p&gt;缺点：每个应用都需要配置，无法防止重命名，grub 中可以禁用 apparmor 。&lt;/p&gt;
&lt;p&gt;apparmor 是设置应用的资源权限。UOS 做了简化，做了一个 filearmor ，对文件的权限做管控。&lt;/p&gt;
&lt;p&gt;还可以对摄像头做管控。对 /dev/video0 做管控即可。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240103_145700.jpg&#34;/&gt;
&lt;/figure&gt;

</description>
        </item>
        <item>
        <title>使用 qemu 和 gdb 来学习内核流程</title>
        <link>https://guolongji.xyz/post/qume-gdb-kernel/</link>
        <pubDate>Tue, 02 Jan 2024 16:02:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/qume-gdb-kernel/</guid>
        <description>&lt;h2 id=&#34;先把韬哥的分享帖出来&#34;&gt;先把韬哥的分享帖出来&lt;/h2&gt;
&lt;p&gt;useradd -m glj -s /bin/bash -d /home/glj&lt;/p&gt;
&lt;h3 id=&#34;前言&#34;&gt;前言&lt;/h3&gt;
&lt;p&gt;这一篇作为开场，主要是介绍最基本的使用方式：基于一个已经完成编译的内核目录，用新生成的内核 image 启动内核，看看是否一切正常。&lt;/p&gt;
&lt;p&gt;建议大家可以一边看一边动手跟着把流程走一走，工具嘛，熟悉了就亲切方便了。&lt;/p&gt;
&lt;p&gt;关于体验环境，大家可以直接使用自己的机器，安装 qemu 就可以；也可以考虑使用我们的 x86 公共虚拟机环境，我在里面已经布置好了编译目录，以及下文会提到的一些简单的小脚本，让想体验的同事可以直接一键启动。&lt;/p&gt;
&lt;p&gt;公共虚拟机环境：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ssh uos@10.20.53.172
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; /virt-space
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注意：不同架构的某些命令会有差别，比如 console 在 x86 是 ttyS0,在 arm 可能是 ttyAMA0 之类的。&lt;/p&gt;
&lt;h3 id=&#34;qemu-加-kernel-启动&#34;&gt;qemu 加 kernel 启动&lt;/h3&gt;
&lt;p&gt;为了方便调整参数，避免每次都要手敲，我把命令放到了 virt-space 的脚本 1-qemu.sh 里，其实就是启动 exec qemu
的单行命令。（大家在 virt-space 里可以直接./1-qemu.sh 启动；如果是在自己的环境里，调整一下 KERNEL 路径即可；）&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;QEMU&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;qemu-system-x86_64
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;KERNEL&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;4.19-x86/4.19-x86-build/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$QEMU&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -enable-kvm &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -m 2048M &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -smp &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -nographic &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -kernel &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$KERNEL&lt;/span&gt;/arch/x86/boot/bzImage &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -append &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;console=ttyS0 nokaslr&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$@&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exit&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ok，这样我们就完成了基于 image 的虚拟机启动！&lt;/p&gt;
&lt;p&gt;在上面的参数里：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;前面几个是基本的 cpu/memory 配置，我一般习惯 2 个 cpu+2G 内存，日常使用足够。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kernel 指定 image 路径，append 指定 cmdline，还可以有 initrd。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果在本机操作的话我一般不加-nogprahic，但如果是 ssh 到 virt-space，因为在 ssh 里没法起图形，&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;那必须使用 nographic，否则会报错 gtk 初始化失败。&lt;/p&gt;
&lt;p&gt;在 qemu 的窗口（图形化，或者 console）里，我们可以看到内核的启动日志输出，最后会因为找不到 initrd 而走到 panic，但整个内核已经正常启动完成了。——如果我们的问题是修改内核后完全起不来（比如修改了 sched/mm 等内核核心模块），那也许这种最基本的方式就足够我们调试排查问题了。&lt;/p&gt;
&lt;h3 id=&#34;gdb-调试&#34;&gt;gdb 调试&lt;/h3&gt;
&lt;p&gt;我们调整一下启动参数，并且启动 qemu，它会卡住等待：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;QEMU&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;qemu-system-x86_64
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;KERNEL&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;4.19-x86/4.19-x86-build/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$QEMU&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -enable-kvm &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -m 2048M &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -smp &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -nographic &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -kernel &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$KERNEL&lt;/span&gt;/arch/x86/boot/bzImage &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -append &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;console=ttyS0 nokaslr&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -s &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -S &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$@&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exit&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在另一个窗口，我们执行 gdb：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; /virt-space/4.19-x86/4.19-x86-build/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gdb vmlinux
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;(&lt;/span&gt;gdb&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt; target remote:1234
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;(&lt;/span&gt;gdb&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt; hb start_kernel
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;(&lt;/span&gt;gdb&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt; c
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...         -&amp;gt; hit the breakpoint &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;start_kernel&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;(&lt;/span&gt;gdb&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt; bt
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;(&lt;/span&gt;gdb&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt; b rest_init
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;(&lt;/span&gt;gdb&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt; b acpi_init
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;(&lt;/span&gt;gdb&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt; c
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...         -&amp;gt; will hit the next breakpoint
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这样，我们就成功地开始用 gdb 调试我们新编译的内核了。&lt;/p&gt;
&lt;p&gt;说明：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;-s：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;更正式的方式是：-gdb tcp::1234。——“-s”就是一个语法糖。（注意，tcp 后面是两个冒号！）
qemu 会在该端口起一个服务作为 gdb server；gdb 可以用 target remote 命令连接这个端口。多个虚拟机都用“-s”时会有冲突，所以如果在 virt-space 里，大家还是手动指定自己的 port 吧。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;-S:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这个参数会告诉 qemu，让虚拟机停留在上电的第一条指令等待。所以可以和 gdb 配合：虚拟机在第一条指令等待，gdb 连接上后用“c”继续执行。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;hb：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;大家注意，在很多架构里，第一个 start_kernel 断点，必须用硬断点，hardware-breakpoint。等到执行到 start_kernel，被断住时，之后就可以随便用普通的 breakpoint 了。其原因是：
b 可以认为是基于指令替换+int3+ptrace 的，所以只有在代码已经被加载到内存里了才能有效替换；当在 S 处停住时，正准备跑 bios，kernel 还没 load，所以 b 可能会无效；而硬件断点呢？它的底下不是指令替换，而是由硬件提供的对某个地址的强制 watch，所以无论在什么时候 hb 都可以有效，也不管这个地址是 bios 还是 grub 还是 kernel 跑到了，都会被断住。——当然它的代价就是需要硬件支持，而且不像普通断点一样可以无限多，一般有硬件数量限制。我们可以搭配使用：S时使用 hb，监控 start_kernel 地址；等撞到了这个，那 kernel 肯定已经被 load 到内存了，就可以放心使用普通断点了。如果大家在实践中发现没有断到，可以如何排查呢？万变不离其宗的还是 gdb 的基本原理：
gdb 所认为的目标符号的地址虚拟机中目标符号的实际地址只要这两者能对应上，就没有理由断不到。那如何确认这两者呢？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;gdb： info address do_page_fault&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;guest: cat /proc/kallsyms | grep do_page_fault&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;比对这两个地址，如果不一样，找出原因来，比如：&lt;/p&gt;
&lt;p&gt;没有正确地开启 nokaslr。——很容易手输成 nokalsr 之类的。
vmlinux 与 guest 内核不匹配。……&lt;/p&gt;
&lt;h3 id=&#34;加入-initrd&#34;&gt;加入 initrd&lt;/h3&gt;
&lt;p&gt;有时候我们必须要有用户态环境来测试新编译的内核：比如跑一个 poc 或者测试程序，比如挂载磁盘、做文件系统的操作等等。&lt;/p&gt;
&lt;p&gt;这一节，我们引入一个最简单的 initrd，来帮助启动一个基本的用户态操作环境。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;init 创建脚本：&lt;/strong&gt;
大家可以直接使用下面的脚本来创建 initrd：（脚本看起来长，其实内容很少，只是我写的比较罗嗦。）&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;set&lt;/span&gt; -e
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;INITRD_ROOT&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;./initrd-rootfs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt; -e &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$INITRD_ROOT&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt;;&lt;span style=&#34;color:#ff79c6&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    rm -rf &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$INITRD_ROOT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$INITRD_ROOT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$INITRD_ROOT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;install_simple&lt;span style=&#34;color:#ff79c6&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    mkdir -p etc proc sys lib bin usr
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cp /bin/busybox bin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s busybox bin/cat
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s busybox bin/cp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s busybox bin/insmod
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s busybox bin/mkdir
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s busybox bin/mknod
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s busybox bin/mount
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s busybox bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s busybox bin/sleep
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s busybox bin/switch_root
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s busybox bin/umount
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s bin sbin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;install_auto&lt;span style=&#34;color:#ff79c6&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    mkdir -p etc proc sys lib usr/bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cp /usr/bin/busybox usr/bin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    busybox --install -s usr/bin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s bin usr/sbin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s usr/bin bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ln -s usr/bin sbin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;install_xxx&lt;span style=&#34;color:#ff79c6&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;# Add any file you want to the INITRD_ROOT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# change the comment to select the mod&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;#install_simple&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;install_auto
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;install_xxx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;lt;&amp;lt; EOF &amp;gt; init
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;mount -t proc none /proc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;mount -t sysfs none /sys
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;echo
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;echo &amp;#34;Hello, world!&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;exec /bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;chmod +x init
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# Note: must exec cpio in INTIRD_ROOT!&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;find . -print0 | cpio --null -ov --format&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;newc | gzip -9 &amp;gt; ../myinitrd.cpio.gz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;init 脚本有四个基本步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;创建一个文件夹 initrd-rootfs，我们就是步骤这个目录里的内容，然后打包为 initrd 的。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在里面布置我们需要的文件，主要是一些基本的命令。——我们基于 busybox 来实现。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;需要安装 busybox-static deb 包；另外一个可选项是 klibc，功能没有 busybox 多。我在脚本里展示了两种方式：A 手动添加链接；B 使用 busybox 的 install 选项。建议用 auto，这样会有完整的 busybox 命令。如果大家要自己手写脚本的话，要特别注意软链接之间的关系，很容易犯错。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;布置/init:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;内核发现/init 存在时，会自动执行它，作为用户态的入口程序，pid 为 1。脚本的例子里非常简单，就是 mount proc 和 sysfs，然后执行 bash。可以在 init 里做各种事情，比如加载模块，起 udev 挂磁盘，或者挂载 9p/nfs 之类的作为 root，等等。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;cpio 打包：&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;建议大家照抄命令。尤其是要注意：进入 INITRD_ROOT 文件夹后跑命令，不会可能文件路径对不上，最后内核找不到/init。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;启动：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;最后，大家可以用 initrd 来启动：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;QEMU&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;qemu-system-x86_64
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;KERNEL&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;4.19-x86/4.19-x86-build/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$QEMU&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -enable-kvm &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -m 2048M &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -smp &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -nographic &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -kernel &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$KERNEL&lt;/span&gt;/arch/x86/boot/bzImage &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -initrd myintird.cpio.gz &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -append &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;console=ttyS0 nokaslr&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$@&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exit&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;会看到如下显示：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;[    0.469630] Run /init as init process
Hello, world!


BusyBox v1.36.1 (Debian 1:1.36.1-6) built-in shell (ash)
Enter &amp;#39;help&amp;#39; for a list of built-in commands.

/bin/sh: can&amp;#39;t access tty; job control turned off
~ #
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;大家可以在自己的环境里测试，也可以直接到 virt-space 里体验，有一个 2-initrd.sh，就是上面的脚本。——实际上已经生成好了 myinitrd.cpio.gz，大家调整一下 1-qemu.sh 里的启动命令，就可以直接跑了，或者直接用：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./1-qemu.sh -initrd myinitrd.cpio.gz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ok，到这里，我们就可以使用基本的用户环境了。&lt;/p&gt;
&lt;h3 id=&#34;扩展-initrd&#34;&gt;扩展 initrd&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;busybox：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;busybox 提供的命令很多，基本命令都涵盖了：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;Currently defined functions:
        [, [[, acpid, adjtimex, ar, arch, arp, arping, ascii, ash, awk, base64, basename, bc,
        blkdiscard, blockdev, brctl, bunzip2, busybox, bzcat, bzip2, cal, cat, chgrp, chmod,
        chown, chroot, chvt, clear, cmp, cp, cpio, crc32, crond, crontab, cttyhack, cut, date,
        dc, dd, deallocvt, depmod, devmem, df, diff, dirname, dmesg, dnsdomainname, dos2unix,
        dpkg, dpkg-deb, du, dumpkmap, dumpleases, echo, ed, egrep, env, expand, expr, factor,
        fallocate, false, fatattr, fdisk, fgrep, find, findfs, fold, free, freeramdisk,
        fsfreeze, fstrim, ftpget, ftpput, getopt, getty, grep, groups, gunzip, gzip, halt,
        head, hexdump, hostid, hostname, httpd, hwclock, i2cdetect, i2cdump, i2cget, i2cset,
        i2ctransfer, id, ifconfig, ifdown, ifup, init, insmod, ionice, ip, ipcalc, kill,
        killall, klogd, last, less, link, linux32, linux64, linuxrc, ln, loadfont, loadkmap,
        logger, login, logname, logread, losetup, ls, lsmod, lsscsi, lzcat, lzma, lzop,
        md5sum, mdev, microcom, mim, mkdir, mkdosfs, mke2fs, mkfifo, mknod, mkpasswd, mkswap,
        mktemp, modinfo, modprobe, more, mount, mt, mv, nameif, nbd-client, nc, netstat, nl,
        nologin, nproc, nsenter, nslookup, nuke, od, openvt, partprobe, passwd, paste, patch,
        pidof, ping, ping6, pivot_root, poweroff, printf, ps, pwd, rdate, readlink, realpath,
        reboot, renice, reset, resume, rev, rm, rmdir, rmmod, route, rpm, rpm2cpio, run-init,
        run-parts, sed, seq, setkeycodes, setpriv, setsid, sh, sha1sum, sha256sum, sha3sum,
        sha512sum, shred, shuf, sleep, sort, ssl_client, start-stop-daemon, stat, strings,
        stty, su, sulogin, svc, svok, swapoff, swapon, switch_root, sync, sysctl, syslogd,
        tac, tail, tar, taskset, tc, tee, telnet, telnetd, test, tftp, time, timeout, top,
        touch, tr, traceroute, traceroute6, true, truncate, ts, tty, tunctl, ubirename,
        udhcpc, udhcpc6, udhcpd, uevent, umount, uname, uncompress, unexpand, uniq, unix2dos,
        unlink, unlzma, unshare, unxz, unzip, uptime, usleep, uudecode, uuencode, vconfig, vi,
        w, watch, watchdog, wc, wget, which, who, whoami, xargs, xxd, xz, xzcat, yes, zcat
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;但是，有可能对于我们测试内核而言还是不够，比如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;测试需要内核模块&lt;/li&gt;
&lt;li&gt;测试需要挂载磁盘里的文件系统&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;……&lt;/p&gt;
&lt;p&gt;这篇文章里我暂时不准备做详细的说明，但是可以提供一些参考给大家：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;大家感兴趣的话，可以看一下本机的/init：/usr/share/initramfs-tools/init，看它怎么完成各种 kernfs 的挂载，解析 cmdline，实现 break，挂载 root，最后 switch_root。&lt;/li&gt;
&lt;li&gt;另外一个值得参考的则是 liveboot 的 init，它会找到 readonly 的 squashfs image，将它挂起来后再用 tmpfs 来做一层 overlay，实现 rw 的根文件系统。&lt;/li&gt;
&lt;li&gt;之后还会介绍到另外一种裸启动内核 image 的 virtme-ng 项目，也是在 init 里做了很多工作，比如将 host 导出的 9p 目录，挂载为 guest 里的 read-only 根。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;对于内核模块：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可以简单的复制到 INITRD_ROOT，然后在 initramfs 的 shell 里，手动 insmod。——自己注意一下依赖关系就好。&lt;/li&gt;
&lt;li&gt;之后会介绍的 virtme-ng 项目能帮我们处理好模块依赖关系，以及复杂的用户态测试环境。——这也是它最核心的部分。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;对于磁盘：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;规范流程是起 systemd-udevd，然后用 udevadm trigger + settle，再手动 mount；&lt;/li&gt;
&lt;li&gt;也可以简单一点，把相关的 ko（比如对应 fs）打包到 initrd 里，然后手动走 mount 流程。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;qemu-plus-disk-启动&#34;&gt;qemu+disk 启动&lt;/h3&gt;
&lt;p&gt;如果我们编译的内核需要长时间的调试，或者调试它所需要的用户态环境比较复杂，手动构建的 initrd 不能满足要求，那我们可以考虑用一个稳定的磁盘来启动，安装内核 deb 包并测试，就和物理机器一样。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;安装&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;虚拟机的安装：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;推荐用 virt-manager 的图形化界面来安装。&lt;/li&gt;
&lt;li&gt;也可以用 qemu 命令：&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;qemu-img create -f qcow2 uos.img 256G
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;qemu-system-x86_64 -enable-kvm -m 2048M -smp &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt; -hda uos.img -cdrom uos.iso
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注意，如果用 qemu 安装的话，是要图形界面支持的，所以在 ssh 里会启动不了（之前已经提到了，在 ssh 里要用 nographic）；如果在本地的话那都没问题。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;启动&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;安装完成后（不管是用 qemu 还是 virt-manager 安装的），就可以直接基于 disk 启动了，比如：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;qemu-system-x86_64 -enable-kvm -m 2048M -smp &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt; -hda uos.img
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;需要更新内核时，就编译好内核之后，想办法将 deb 包传到 guest 里并安装。——这样，guest 里自始至终都是一个完整、自洽的系统环境，可以跑 bpftrace、trace-cmd、crash 等各种工具。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;hda/vda&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;hda 会虚拟一个 hard-disk 设备，在虚拟机里会被导出为 sda，其实和“-s”一样，也只是一个语法糖，等同于：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;-drive file=uos.img,index=0,media=disk
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果想使用 virtio-blk 的话（导出为 vda），可以：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;-drive file=uos.img,if=none,id=myvda \
 -device virtio-blk-pci,drive=myvda \
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在我们的示例里，简单起见，就直接用-hda 了。&lt;/p&gt;
&lt;h3 id=&#34;文件系统直通&#34;&gt;文件系统直通&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;disk-boot + 9p&lt;/strong&gt;
这里只介绍 disk 启动时的 9p 直通，因为用 kernel/initrd 启动时，需要手动布置 initrd 里的 9p 相关模块，并且更改 init 脚本，我们暂时不想搞这么复杂（以后应该会补充）。&lt;/p&gt;
&lt;p&gt;启动脚本如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;QEMU&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;qemu-system-x86_64
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;KERNEL&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;4.19-x86/4.19-x86-build/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$QEMU&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -enable-kvm &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -m 2048M &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -smp &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -nographic &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -hda disk-imgs/uos-base-hda.img &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt; -fsdev local,security_model&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;passthrough,id&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;fsdev0,path&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;./hostshare &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt; -device virtio-9p-pci,id&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;fs0,fsdev&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;fsdev0,mount_tag&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;hostshare &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$@&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exit&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;qemu 参数说明：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;-fsdev：&lt;/li&gt;
&lt;li&gt;-path：指定了要在 host 里要传递给 guest 的目录，这里是/virt-space/hostshare&lt;/li&gt;
&lt;li&gt;-id：qemu 内部使用，这里在-fsdev 里导出，在-device 被使用&lt;/li&gt;
&lt;li&gt;-security_model：9p 的 credits 管理，本地就用 passthrough 吧。&lt;/li&gt;
&lt;li&gt;-device：&lt;/li&gt;
&lt;li&gt;virtio-9p-pci，完全的写法应该是-driver=virito-9p-pci&lt;/li&gt;
&lt;li&gt;mount_tag：guest 里需要用这个 tag 来完成 mount&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;guest 里挂载：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;挂载命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mount -t 9p -o &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;trans&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;virtio,version&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;9p2000.L hostshare /hostshare
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;version 可以不指定，但是用 9p2000.L 效率更更高。&lt;/p&gt;
&lt;p&gt;也可以写入 fstab：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;hostshrae /hostshare 9p nofail,auto,trans&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;virtio,version&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;9p2000.L &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;之后就可以直接执行：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mount /hostshare
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;注意，如果在 host 里是用 uos 账户（id1000）启动内核的，那在 passthrough 模式下，guest 里同样只能用 id1000 来访问，可能 root 会没有访问权限……&lt;/p&gt;
&lt;h3 id=&#34;kernel-plus-disk-启动&#34;&gt;kernel+disk 启动&lt;/h3&gt;
&lt;p&gt;可以基于 disk，同时指定 kernel 启动，比如：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;QEMU&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;qemu-system-x86_64
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;KERNEL&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;4.19-x86/4.19-x86-build/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$QEMU&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -enable-kvm &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -m 2048M &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -smp &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -nographic &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -kernel &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$KERNEL&lt;/span&gt;/arch/x86/boot/bzImage &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -initrd myinitrd.cpio.gz &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -append &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;console=ttyS0 nokaslr&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    -hda uos.img &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$@&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exit&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;但是我们的 initrd 环境里，缺乏必要的 ko，而且 init 脚本也没做必要的初始化工作，所以 disk 不可用。那如何用这种方式启动呢？某些时候我们想临时测试一个 kernel，但是又需要随便挂个盘，可以持久化一些数据。&lt;/p&gt;
&lt;p&gt;我们暂时不准备用手动方式的实现，而是引入一个上游的专门用于内核启动测试的项目：virtme-ng。&lt;/p&gt;
&lt;h2 id=&#34;一些我的疑问&#34;&gt;一些我的疑问&lt;/h2&gt;
&lt;p&gt;做为刚开始了解 qemu 和文件系统的人，补充一些基本问题的解答是有必要的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;什么是 9p&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;怎么制做 qemu 的镜像呢？&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这个韬哥可能以后会讲，如果不讲的话，自己做一些实践吧。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;内核当中的 bzimage 是什么？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/hanxuefan/article/details/7454352&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/hanxuefan/article/details/7454352&lt;/a&gt; ，就是内核镜像。一般使用压缩后的 bzimage
知道这一点就足够了。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;initrd 和 initramfs 这两个是什么？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;为了增强内核启动的灵活性而产生的机制，就是这个。尤其是文件系统之类的模块，先有蛋还是先有鸡呢？为了减少循环引用吧。反正这套流程才是目前的正统流程，是符和这个现实世界发展而形成的一套机制。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;退出 qemu 的命令行界面&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;C-a x ，用这个快捷键就能把这个关闭了。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;什么是 busybox ？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/448313296&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/448313296&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;busybox 为什么这么小？显然它也是经过了压缩和删减的，所以只能说是精心设计的丐版软件，恰巧嵌入式的机器喜欢丐版的软件。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;上面的 ln -s bin usr/sbin 这个命令一度不理解&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其实，如果 ln -s 的第一个参数文件名或目录名不存在的话，那就会找第二个参数相同目录下的这个文件名或者目录名，看着挺绕的，可以写的更清楚一点。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mount -t&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;mount -t proc none /proc 是一条命令，用于将 proc 文件系统挂载到指定的目录（/proc）。&lt;/p&gt;
&lt;p&gt;在 Linux 系统中，/proc 是一个特殊的虚拟文件系统，提供了对内核运行时状态的访问。它不是从硬盘上的文件系统中读取数据，而是通过内核动态生成的，可以获取有关系统当前状态和进程信息的各种数据。通过挂载/proc 文件系统，可以将这些状态信息暴露给用户空间的应用程序或工具。&lt;/p&gt;
&lt;p&gt;mount -t proc none /proc 命令的含义是将 proc 文件系统以&amp;quot;none&amp;quot;的方式挂载到/proc 目录下。&amp;ldquo;none&amp;quot;表示该挂载点没有来源设备，而是虚拟的。这样，当你通过/proc 目录访问系统信息时，实际上是通过读取/proc 文件系统中的虚拟文件来获取相应的信息。&lt;/p&gt;
&lt;p&gt;需要注意的是，这是一个常见的操作，通常在系统启动时自动执行，以便让用户和系统工具能够方便地访问/proc 中的信息。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;适合做什么？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;qemu 的部分肯定是适合看一些公共部分的代码的。方便调式和学习。尤其是文件系统和网络的学习用 qemu 是比较好的。虚拟机和 docker 不一样。各有所长。可能最好的调试方法是 kgdb 的方式。kgdb
的方式通过网络是最好的。但是目前来看在 UOS 上还是不好做，需要一个不知道什么原理打上的一个
patch 。多了这么一个步骤，不感觉有一些难度还愿意更深入的了解一下了。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cpio 压缩命令&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://liubigbin.github.io/2016/02/28/cpio%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://liubigbin.github.io/2016/02/28/cpio%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;-H 或者是 &amp;ndash;format ，newc ，是一种 SVR4 兼容的模式。&lt;/p&gt;
&lt;p&gt;gzip -9 对应的是最大压缩率，可以用 emacs helm-man 查看中文的文档，可以很清楚的理解每一个参数的作用。然后 C-x 4 0 关闭窗口，emacs 真的是很好用的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;virtme-ng&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这是一个针对内核的测试项目。这些内容都是通过网络社区中的内容学习到的开源知识。要想真的熟练掌握调试的话一定要多看多练。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;什么是 qemu 的 live boot ？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;QEMU（Quick EMUlator）是一款用于模拟 CPU 的开源虚拟化软件。使用 QEMU，用户可以在一个物理机器上运行多个虚拟机，每个虚拟机都可以运行不同的操作系统。&lt;/p&gt;
&lt;p&gt;Live boot 是指直接从可移动媒介（如 USB 驱动器或 CD/DVD 光盘）启动计算机，并在不安装到硬盘的情况下运行操作系统的过程。&lt;/p&gt;
&lt;p&gt;因此，QEMU live boot 就是使用 QEMU 工具，从可移动媒介中引导操作系统并在虚拟机中运行该操作系统的过程。&lt;/p&gt;
&lt;p&gt;使用 QEMU live boot，用户可以在单一计算机上同时运行多个操作系统，而无需将它们安装到本地硬盘。这对于测试、教学或者研究等场景非常有用。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;什么是云镜像？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://cloudinit.readthedocs.io/en/latest/tutorial/qemu.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://cloudinit.readthedocs.io/en/latest/tutorial/qemu.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这个云镜像适合快速构建虚拟机，但是没有找到 UOS 版本的，那就暂时不找了。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/453495129&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/453495129&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;可以用云镜像来做 qemu 虚拟机，但是这个对于调式而言并不方便。没有学习的必要。这种东西，是搞
kvm 云服务器的人才需要关注的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;调试模块和显卡驱动等要后续继续看&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;用 qemu 看启动部分的代码是完完全全够用的了，&lt;/p&gt;
&lt;h2 id=&#34;gdb-高阶用法&#34;&gt;gdb 高阶用法&lt;/h2&gt;
&lt;p&gt;C-x 2 打开调试窗口，看起来还挺炫酷的。关闭这个 tui 窗口用的是 C-x a ；和 qemu 的退出快捷键不一样。qemu 的退出用的是 C-a x 很相似。&lt;/p&gt;
&lt;p&gt;如果是一个公共的问题，mm 或者是 fs 的问题，学习用的话，那么 qemu 真的是不二之选。&lt;/p&gt;
&lt;p&gt;info variables&lt;/p&gt;
&lt;p&gt;info locals&lt;/p&gt;
&lt;p&gt;info args&lt;/p&gt;
&lt;p&gt;这样做的话就能看到足够多的变量了，发现内核当中的变量都被优化掉了，那么也就不能进行调式了。&lt;/p&gt;
&lt;p&gt;内核 gdb 被优化掉了的解决方法。&lt;/p&gt;
&lt;p&gt;解决方法下面的链接有，以后有时间研究一下，或者问问其他人看是不是有人清楚是怎么回事呢？&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://stdio.io/1086&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://stdio.io/1086&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>UOS 安全启动</title>
        <link>https://guolongji.xyz/post/security_boot/</link>
        <pubDate>Tue, 02 Jan 2024 14:07:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/security_boot/</guid>
        <description>&lt;h2 id=&#34;bios-启动&#34;&gt;bios 启动&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_140844.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 1: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;uefi-启动&#34;&gt;uefi 启动&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_141054.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 2: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;efibootmanager 这个工具可以修改启动项。&lt;/p&gt;
&lt;h2 id=&#34;系统启动&#34;&gt;系统启动&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_141647.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 3: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;开源固件&#34;&gt;开源固件&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_141928.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 4: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_142015.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 5: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_142203.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 6: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_142742.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 7: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_142852.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 8: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;把 shim 提交绐微软，微软绐其它厂商提供签名。&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_143521.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 9: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_143921.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 10: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_144328.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 11: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_144520.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 12: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;昆仑，百敖，华为。&lt;/p&gt;
&lt;p&gt;都封装成 PE 结构的列表，只要有一个验证通过就是可信的。这是一种保护安全性的手段。&lt;/p&gt;
&lt;p&gt;shim-signed 这个包有一个我们自己的签名。&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20240102_145150.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 13: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;TPM 是可信安全模块的意思，这个是芯片。变化太快，越来越多的系统服务，使得很难做到这个可信启动。做了 grub 的摘要值，TPM 做了。磁盘加密相关的。还有一个 TCM ，和 TPM 类似。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>在我的博客和emacs中使用tikz 画图</title>
        <link>https://guolongji.xyz/post/tikz-config/</link>
        <pubDate>Mon, 11 Dec 2023 15:43:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/tikz-config/</guid>
        <description>&lt;p&gt;之前有一段时间一直使用 latex 记笔记。latex 有很多的优点，写理科内容必会的东西。但是对于发布博客和高亮代码方面对程序员不太友好。latex 的包虽然很多，但是 orgmode 用 emacs 打开直接是高亮的，这一点 latex-mode 不可以做的很好，因为 latex 的格式太复杂了。&lt;/p&gt;
&lt;p&gt;我写博客是在 emacs 下面写 org 文档，用 ox-hugo 转成 md 发布到远程服务器。但是 org-mode
画图很可方便的使用 tikz 吗？这个东西是可是文档狂魔，无敌大佬 Till Tantau 伴随 latex 一起打造的神器，他也能靠此留名青史。我真的觉得 20 世纪初德国能成为世界的数学和物理之都是因为德国人做事比较严谨。而且热衷于自然科学。&lt;/p&gt;
&lt;p&gt;我爱德国人的古板。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.luogu.com.cn/blog/over-knee-socks/TikZ-guide-1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.luogu.com.cn/blog/over-knee-socks/TikZ-guide-1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在 latex 中是这个宏包：pgf&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.ctan.org/pkg/pgf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.ctan.org/pkg/pgf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这是 tikz 宏包使用说明：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/127155579&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/127155579&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;vikz 虽然写起来看着可怕（代码多），但是他能带绐人一种独特的确定性的美感。用代码画各种图。这是属于程序员的一点小情趣。比起 graphviz ， ditaa 这类的图。vikz 各加无所不能，门槛就是要么使用 latex 的编辑软件，要么像 emacsers  一样能在 orgmode 中方便的使用 vikz 。这部分的内容网上几乎找不到，让我来分享一波使用方法。&lt;/p&gt;
&lt;h2 id=&#34;安装-latex-和-pgf-宏包&#34;&gt;安装 latex 和 pgf 宏包&lt;/h2&gt;
&lt;p&gt;这部分应该很容易，就不说了。&lt;/p&gt;
&lt;h2 id=&#34;emacs-的-xenops-mode-配置&#34;&gt;emacs 的 xenops-mode 配置&lt;/h2&gt;
&lt;p&gt;这个配置为了在本地写代码所见即可得，修改起来方便。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-lisp&#34; data-lang=&#34;lisp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;;; xenops-mode&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#50fa7b&#34;&gt;use-package&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xenops&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f1fa8c&#34;&gt;:config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  (&lt;span style=&#34;color:#ff79c6&#34;&gt;setq&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xenops-math-image-scale-factor&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1.6&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;add-hook&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;latex-mode-hook&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;#&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xenops-mode&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;add-hook&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;LaTeX-mode-hook&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;#&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xenops-mode&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;add-hook&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;org-mode-hook&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;#&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xenops-mode&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;setq&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xenops-math-latex-process-alist&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;#39;&lt;/span&gt;((&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;dvipng&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;:programs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;latex&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;dvipng&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:description&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;dvi &amp;gt; png&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;:message&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;you need to install the programs: latex and dvipng.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-input-type&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;dvi&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-output-type&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;png&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-size-adjust&lt;/span&gt; (&lt;span style=&#34;color:#bd93f9&#34;&gt;1.0&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:latex-compiler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;latex -interaction nonstopmode -shell-escape -output-format dvi -output-directory %o %f&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-converter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;dvipng -D %D -T tight -o %O %f&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        (&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;dvisvgm&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;:programs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;latex&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;dvisvgm&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:description&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xdv &amp;gt; svg&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:message&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;you need to install the programs: latex and dvisvgm.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-input-type&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xdv&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-output-type&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;svg&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-size-adjust&lt;/span&gt; (&lt;span style=&#34;color:#bd93f9&#34;&gt;1.2&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1.2&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:latex-compiler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xelatex -no-pdf -interaction nonstopmode -shell-escape -output-directory %o %f&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-converter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;dvisvgm %f -n -b min -c %S -o %O&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        (&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;imagemagick&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;:programs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;latex&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;convert&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:description&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;pdf &amp;gt; png&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;:message&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;you need to install the programs: latex and imagemagick.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-input-type&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;pdf&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-output-type&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;png&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-size-adjust&lt;/span&gt; (&lt;span style=&#34;color:#bd93f9&#34;&gt;1.0&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:latex-compiler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;pdflatex -interaction nonstopmode -shell-escape -output-directory %o %f&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-converter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;convert -density %D -trim -antialias %f -quality 100 %O&amp;#34;&lt;/span&gt;))))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;setq&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xenops-reveal-on-entry&lt;/span&gt; t
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xenops-image-directory&lt;/span&gt; (&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;expand-file-name&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xenops/image&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;user-emacs-directory&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xenops-math-latex-process&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;imagemagick&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xenops-math-image-scale-factor&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;;; xenops-mode 太好用了，作者真的是为人民服务啊。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;add-hook&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;find-file-hook&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;#&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;my-xenops-function&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;defun&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;my-xenops-function&lt;/span&gt; ()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  (&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;when&lt;/span&gt; (&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;and&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;stringp&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;buffer-file-name&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             (&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;string-match&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;\\.org\\&amp;#39;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;buffer-file-name&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    (&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xenops-render&lt;/span&gt;)))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;;; org-mode预览公式&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;;; https://q3yi.me/post/4_use_xelatex_instead_of_latex_in_org_preview_latex_process/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;add-to-list&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;org-preview-latex-process-alist&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;#39;&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;xdvsvgm&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;:progams&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xelatex&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;dvisvgm&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               &lt;span style=&#34;color:#f1fa8c&#34;&gt;:discription&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xdv &amp;gt; svg&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               &lt;span style=&#34;color:#f1fa8c&#34;&gt;:message&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;you need install the programs: xelatex and dvisvgm.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-input-type&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xdv&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-output-type&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;svg&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-size-adjust&lt;/span&gt; (&lt;span style=&#34;color:#bd93f9&#34;&gt;1.7&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1.5&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               &lt;span style=&#34;color:#f1fa8c&#34;&gt;:latex-compiler&lt;/span&gt; (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xelatex -interaction nonstopmode -no-pdf -output-directory %o %f&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               &lt;span style=&#34;color:#f1fa8c&#34;&gt;:image-converter&lt;/span&gt; (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;dvisvgm %f -n -b min -c %S -o %O&amp;#34;&lt;/span&gt;)))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;setq&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;org-preview-latex-default-process&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;xdvsvgm&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;setq&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;org-latex-create-formula-image-program&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#39;imagemagick&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;xenops-mode 可以用 dvisvgm 来将 latex 编译成 svg 图像，svg 图像要比 png 图像的显示效果好，但是在 emacs 中
babel-src 的 latex 代码确不能用 dvisvgm 来显示生成的 tikz 图片，所以上面的 xenops-math-latex-process 要设置成
&amp;lsquo;imagemagick 。&lt;/p&gt;
&lt;h2 id=&#34;emacs-增加-hugo-导出的-snippet&#34;&gt;emacs 增加 hugo 导出的 snippet&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-snippet&#34; data-lang=&#34;snippet&#34;&gt;# -*- mode: snippet -*-
# name: ljtikz
# key: ljtikz
# --
#+OPTIONS: html-postamble:nil
#+HEADER: :fit yes :imagemagick yes :iminoptions -density 300
#+HEADER: :packages &amp;#39;(&amp;#34;\\\\usepackage{tikz} \\\\usepackage{pgfplots} \\\\pgfplotsset{compat=newest}&amp;#34;)
#+begin_src latex :file ltximg/${1:name} :results raw file :exports results
${2:content}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这个配置让我在本地可以用 snippet 直接写出模板，然后在 content 中进行画图。上面的配置如果只想将图片导出到博客，那上面的 export 处写 results 。如果想将 tikz 的源码也导出的话，不改成 both 。&lt;/p&gt;
&lt;p&gt;如果缺哪个设置就加 tikzpicture 的代码中，例如：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;\begin{tikzpicture}
   \usetikzlibrary{patterns}
...
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;tikz&#34;&gt;tikz&lt;/h2&gt;
&lt;p&gt;我新的分享可以用 tikz 画一些流程图和代码逻辑的图片，tikz 的英文文档有将近 1100 页。难度应该是不大的，关键是系统的学习，成本比较高。尤其是对于理解能力和学习能力比较弱的同学来说（没错，说的就是我），用哪里学哪里。哪里不会点哪里。so hard &amp;hellip;&lt;/p&gt;
&lt;p&gt;tikz 画图的缺点是画图效率低，优点是效果好。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://destinyenvoy.github.io/2019/11/20/draw-pretty-fig/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://destinyenvoy.github.io/2019/11/20/draw-pretty-fig/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tex.stackexchange.com/questions/450250/draw-layered-software-architecture-with-tikz&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://tex.stackexchange.com/questions/450250/draw-layered-software-architecture-with-tikz&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;tikz 的优美例子：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://texample.net/tikz/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://texample.net/tikz/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;tikz 的在线使用教程：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tikz.dev/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://tikz.dev/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;举一些例子&#34;&gt;举一些例子&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-latex&#34; data-lang=&#34;latex&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\begin&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\begin&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;axis&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;[
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    xmin=-3,   xmax=3,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ymin=-3,   ymax=3,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    extra x ticks=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;-1,1&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    extra y ticks=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;-2,2&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    extra tick style=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;grid=major&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[red]&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfextra&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathellipse&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfplotspointaxisxy&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;0&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;0&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfplotspointaxisdirectionxy&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;1&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;0&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfplotspointaxisdirectionxy&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;0&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;2&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#6272a4&#34;&gt;% see also the documentation of
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#6272a4&#34;&gt;% &amp;#39;axis direction cs&amp;#39; which
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#6272a4&#34;&gt;% allows a simpler way to draw this ellipse
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[blue]&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfextra&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathellipse&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfplotspointaxisxy&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;0&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;0&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfplotspointaxisdirectionxy&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;1&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;1&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfplotspointaxisdirectionxy&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;0&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;2&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\addplot&lt;/span&gt; [only marks,mark=*] coordinates &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt; (0,0) &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\end&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;axis&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\end&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/example_0.png&#34;/&gt;
&lt;/figure&gt;

&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-latex&#34; data-lang=&#34;latex&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\begin&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;%\draw (0,0) -- (1,0) -- (1,1) -- cycle;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\tikz&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[thick,rounded corners=8pt]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;(0,0) -- (0,2) -- (1,3.25) -- (2,2) -- (2,0) -- (0,2) -- (2,2) -- (0,0) -- (2,0);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\end&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/demo0.png&#34;/&gt;
&lt;/figure&gt;

&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-latex&#34; data-lang=&#34;latex&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\begin&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#ff79c6&#34;&gt;\usetikzlibrary&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;patterns&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#6272a4&#34;&gt;%\draw[-&amp;gt;] (-3,0) -- (-2,0) arc[radius=0.5cm,start angle=-180,end angle=0] (-1,0) -- (1,0) arc[radius=0.5cm,start angle=180,end angle=0] (2,0) -- (3,0);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;   &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[black,thin, pattern=north east lines, pattern color=gray]&lt;/span&gt; (0,0) ellipse (1.7cm and 1.1cm);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[-latex, thick]&lt;/span&gt; (0.5,0.4).. controls (1,1)  .. (0.8,1.5);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[-latex, thick]&lt;/span&gt; (-0.5,1.5).. controls (-1,1)  .. (-0.8,0.5);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[text=blue]&lt;/span&gt; at (0,0.2) &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;System&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\end&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/demo1.png&#34;/&gt;
&lt;/figure&gt;

&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-latex&#34; data-lang=&#34;latex&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;%\begin{tikzpicture}[background rectangle/.style={fill=white}, show background rectangle, scale=0.4]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\begin&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;[scale=0.4]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\usetikzlibrary&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;shapes.geometric,shapes.symbols,fit,positioning,shadows&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\usetikzlibrary&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;backgrounds&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;% https://tex.stackexchange.com/a/12039/121799
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\makeatletter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfkeys&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;/pgf/.cd,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    parallelepiped offset x/.initial=2mm,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    parallelepiped offset y/.initial=2mm
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfdeclareshape&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;parallelepiped&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritsavedanchors&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt; &lt;span style=&#34;color:#6272a4&#34;&gt;% this is nearly a rectangle
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchorborder&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;north&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;north west&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;north east&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;center&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;west&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;east&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;mid&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;mid west&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;mid east&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;base&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;base west&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;base east&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;south&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;south west&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;south east&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\backgroundpath&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#6272a4&#34;&gt;% store lower right in xa/ya and upper right in xb/yb
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\southwest&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xa=&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@x &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@ya=&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\northeast&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb=&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@x &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yb=&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfmathsetlength\pgfutil&lt;/span&gt;@tempdima&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfkeysvalueof&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;/pgf/parallelepiped offset x&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfmathsetlength\pgfutil&lt;/span&gt;@tempdimb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfkeysvalueof&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;/pgf/parallelepiped offset y&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\def\ppd&lt;/span&gt;@offset&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfutil&lt;/span&gt;@tempdima&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfutil&lt;/span&gt;@tempdimb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathmoveto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfqpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xa&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@ya&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfqpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@ya&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfqpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfqpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xa&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathclose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathmoveto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfqpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@ya&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpointadd&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@ya&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\ppd&lt;/span&gt;@offset&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpointadd&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\ppd&lt;/span&gt;@offset&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpointadd&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xa&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\ppd&lt;/span&gt;@offset&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfqpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xa&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathmoveto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfqpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpointadd&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\ppd&lt;/span&gt;@offset&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;% https://tex.stackexchange.com/a/103691/121799
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfdeclareshape&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;document&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritsavedanchors&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt; &lt;span style=&#34;color:#6272a4&#34;&gt;% this is nearly a rectangle
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchorborder&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;center&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;north&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;north east&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;north west&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;south&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;south east&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;south west&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;west&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\inheritanchor&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[from=rectangle]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;east&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\backgroundpath&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;%
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\southwest&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xa=&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@x &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@ya=&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\northeast&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb=&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@x &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yb=&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xc=&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb &lt;span style=&#34;color:#ff79c6&#34;&gt;\advance\pgf&lt;/span&gt;@xc by-5pt &lt;span style=&#34;color:#6272a4&#34;&gt;% this should be a parameter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yc=&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@ya &lt;span style=&#34;color:#ff79c6&#34;&gt;\advance\pgf&lt;/span&gt;@yc by5pt
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathmoveto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xa&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@ya&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xa&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yc&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xc&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@ya&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathclose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#6272a4&#34;&gt;% add little corner
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathmoveto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xc&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@ya&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xc&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yc&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathlineto&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpoint&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@xb&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\pgf&lt;/span&gt;@yc&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#ff79c6&#34;&gt;\pgfpathclose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\makeatother&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\tikzset&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;doc/.style=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;document,fill=blue!10,draw,thin,minimum
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      height=1.2cm,align=center&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pics/.cd,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    pack/.style=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;code=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;%
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[fill=blue!50,opacity=0.2]&lt;/span&gt; (0,0) -- (0.5,-0.25) -- (0.5,0.25) -- (0,0.5) -- cycle;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[fill=blue!50,opacity=0.2]&lt;/span&gt; (0,0) -- (-0.5,-0.25) -- (-0.5,0.25) -- (0,0.5) -- cycle;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[fill=blue!60,opacity=0.2]&lt;/span&gt; (0,0) -- (-0.5,-0.25) -- (0,-0.5) -- (0.5,-0.25) -- cycle;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[fill=blue!60]&lt;/span&gt; (0,0) -- (0.25,0.125) -- (0,0.25) -- (-0.25,0.125) -- cycle;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[fill=blue!50]&lt;/span&gt; (0,0) -- (0.25,0.125) -- (0.25,-0.125) -- (0,-0.25) -- cycle;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[fill=blue!50]&lt;/span&gt; (0,0) -- (-0.25,0.125) -- (-0.25,-0.125) -- (0,-0.25) -- cycle;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[fill=blue!50,opacity=0.2]&lt;/span&gt; (0,-0.5) -- (0.5,-0.25) -- (0.5,0.25) -- (0,0) -- cycle;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[fill=blue!50,opacity=0.2]&lt;/span&gt; (0,-0.5) -- (-0.5,-0.25) -- (-0.5,0.25) -- (0,0) -- cycle;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[fill=blue!60,opacity=0.2]&lt;/span&gt; (0,0.5) -- (-0.5,0.25) -- (0,0) -- (0.5,0.25) -- cycle;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\resizebox&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\textwidth&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;!&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    [font=&lt;span style=&#34;color:#ff79c6&#34;&gt;\sffamily&lt;/span&gt;,every label/.append
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    style=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;font=&lt;span style=&#34;color:#ff79c6&#34;&gt;\small\sffamily&lt;/span&gt;,align=center&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;[cylinder, cylinder uses custom fill, cylinder end fill=blue!25,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cylinder body fill=blue!50,shape border rotate=90,text=white,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    aspect=0.4,minimum width=1cm,minimum height=1.4cm](Store)&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Store&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;[right=1cm of Store,regular polygon,regular polygon sides=6,fill=orange,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    xscale=1.2,text=white] (Router) &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Router&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[fit=(Store) (Router)]&lt;/span&gt;(fit1)&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;[below=1cm of fit1,tape, draw,thin, tape bend top=none,fill=purple,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    text=white,minimum width=2.2cm,double copy shadow,minimum height=1.5cm]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    (Components) &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Components&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;[draw,dashed,rounded corners,fit=(Store) (Router) (Components),inner
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sep=10pt,label=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;above:&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Universal&lt;span style=&#34;color:#ff79c6&#34;&gt;\\&lt;/span&gt; Application Code&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;](fit2)&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[right=1cm of fit2,doc]&lt;/span&gt; (js) &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;app.js&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[above right=1cm of js,doc]&lt;/span&gt; (Server) &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Server&lt;span style=&#34;color:#ff79c6&#34;&gt;\\&lt;/span&gt; entity&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[below right=1cm of js,doc]&lt;/span&gt; (Client) &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Client&lt;span style=&#34;color:#ff79c6&#34;&gt;\\&lt;/span&gt; entry&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;(fit2.east) -- (js);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[-latex]&lt;/span&gt; (js) |- (Server);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[-latex]&lt;/span&gt; (js) |- (Client);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[-]&lt;/span&gt; (Client) -- ++ (1,0) |- (Server) coordinate[pos=0.25] (aux1);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;[draw,dashed,rounded corners,fit=(fit2) (aux1),inner
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    xsep=10pt,inner ysep=30pt,label=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;above:&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Source&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;](fit3)&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\pic&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[right=2cm of aux1,local bounding box=Webpack,scale=2]&lt;/span&gt; (Webpack) &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;pack&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[below=1mm of Webpack,font=\small\sffamily,align=center]&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Webpack&lt;span style=&#34;color:#ff79c6&#34;&gt;\\&lt;/span&gt; build&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[above right=1cm and 2cm of Webpack.east,doc,fill=red!10]&lt;/span&gt; (ServerBundle)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Server&lt;span style=&#34;color:#ff79c6&#34;&gt;\\&lt;/span&gt; bundle&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[below right=1cm and 2cm of Webpack.east,doc,fill=red!10]&lt;/span&gt; (ClientBundle) &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Client&lt;span style=&#34;color:#ff79c6&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      bundle&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;[right=2cm of ServerBundle,parallelepiped,draw=yellow,fill=red!80,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    minimum width=2cm,minimum height=1.5cm,align=center,text=white]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    (BundleRenderer)   &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Bundle&lt;span style=&#34;color:#ff79c6&#34;&gt;\\&lt;/span&gt; Renderer&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[right=2cm of ClientBundle,doc,fill=yellow,minimum width=2cm,minimum height=1.5cm]&lt;/span&gt; (HTML) &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;HTML&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[-latex]&lt;/span&gt; (aux1) -- (Webpack);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[-latex]&lt;/span&gt; (Webpack) -- ++ (2,0) coordinate(aux2) |- (ServerBundle);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[-latex]&lt;/span&gt; (aux2) |- (ClientBundle);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[-latex]&lt;/span&gt; (ClientBundle) -- (HTML) node[midway,below,font=&lt;span style=&#34;color:#ff79c6&#34;&gt;\small\sffamily&lt;/span&gt;]&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Hydrate&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt; (ServerBundle) -- (BundleRenderer);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[-latex]&lt;/span&gt; (BundleRenderer) -- (HTML) node[midway,right,font=&lt;span style=&#34;color:#ff79c6&#34;&gt;\small\sffamily&lt;/span&gt;]&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Render&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;[draw,dashed,rounded corners,fit=(ServerBundle) (BundleRenderer),inner
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sep=10pt,label=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;above:&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Node server&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;](fit4)&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;[draw,dashed,rounded corners,fit=(ClientBundle) (HTML),inner
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    sep=10pt,label=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;below:&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;Browser&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}}&lt;/span&gt;](fit5)&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\end&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/demo2.png&#34;/&gt;
&lt;/figure&gt;

&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-latex&#34; data-lang=&#34;latex&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\begin&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt; (0,0) to (3,2);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt; (0,0) to[out=90,in=180] (3,2);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt; (0,0) to[bend right] (3,2);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\end&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/example1.png&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;下面是一个中文的示例，这个例子之所以可以导出中文是因为 HEADER 的设置增加了 \usepackage{fontspec} ，并在代码中设置了 font ，并且 HEADER 中指定使用 imagemagick 进行导出，代码中也设置了中文字体：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-latex&#34; data-lang=&#34;latex&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\begin&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;[
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  rec/.style=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;rectangle, thick,minimum width=1.5cm,minimum height=0.5cm,text centered,draw=#1,fill=#1!15,UTF8&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  arrow/.style=&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt; -&amp;gt;,&amp;gt;=stealth,very thick,red!80!black&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\setmainfont&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;FandolSong-Regular.otf&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;(rec1)     [rec=blue]                          &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;现实问题&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;(rec2)     [rec=purple,right = of rec1]        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;数学模型&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;(rec3)     [rec=green,right = of rec2]         &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;数学结论&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\node&lt;/span&gt;(rec4)     [rec=orange,right = of rec3]        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;解释 &lt;span style=&#34;color:#ff79c6&#34;&gt;\&amp;amp;&lt;/span&gt; 预测&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[arrow]&lt;/span&gt;   (rec1)  --node[above]&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;建模&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;    (rec2);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[arrow]&lt;/span&gt;   (rec2)  --node[above]&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;求解&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;    (rec3);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[arrow]&lt;/span&gt;   (rec3)  --node[above]&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;解释&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;    (rec4);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;\draw&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;[arrow]&lt;/span&gt;   (rec4.south)--(&lt;span style=&#34;color:#f1fa8c&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;rec&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;.south&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;)+(&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;$&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  --node[above]&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;检验&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;  (&lt;span style=&#34;color:#f1fa8c&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;rec&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;.south&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;)+(&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cm&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;$&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  -- (rec1.south);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;\end&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;{&lt;/span&gt;tikzpicture&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/process1.png&#34;/&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;总结&#34;&gt;总结&lt;/h2&gt;
&lt;p&gt;用 orgmode 来画 tikz 有很多的 hack trick 。画画时序图还比较简单。想用好确实有陡峭的学习曲线。但是做为最高级的解决方案，tikz 还是值得学习的，因为学会了这个某种程度上就学会了用代码对图片的精准操控。&lt;/p&gt;
&lt;p&gt;orgmode 和 latex 就像是搭积木，上面的图形并没有达到在网页中展示的比较完美的效果，在
&lt;a class=&#34;link&#34; href=&#34;https://tex.stackexchange.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://tex.stackexchange.com/&lt;/a&gt; 里面有很多人问问题，从零开始写一个东西还是比较难的，有比较闲的时间才能弄。到此为止。烦。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>什么是张量？</title>
        <link>https://guolongji.xyz/post/tensor/</link>
        <pubDate>Wed, 22 Nov 2023 14:03:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/tensor/</guid>
        <description>&lt;h2 id=&#34;什么是张量&#34;&gt;什么是张量？&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1tr4y117Ja/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.bilibili.com/video/BV1tr4y117Ja/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;常数 a 是 0 阶张量向量 \(\vec{a}\) 是 1 阶张量用 \(\widetilde{A}\) 表示 2 阶以上的张量&lt;/p&gt;
&lt;p&gt;张量是一种不依赖于坐标系来反应物质的物理量。&lt;/p&gt;
&lt;p&gt;向量 \(\overrightarrow{MN}=\overrightarrow{ON}-\overrightarrow{OM}\) 不会因为坐标系的变化而变化。&lt;/p&gt;
&lt;p&gt;那么一个二阶矩阵是张量吗？&lt;/p&gt;
&lt;p&gt;\[
\left [ \begin{matrix}
a_{11} &amp;amp; a_{12} \\
a_{21} &amp;amp; a_{22}
\end{matrix} \right ]
\]&lt;/p&gt;
&lt;p&gt;二阶的一个矩阵不是一个张量。&lt;/p&gt;
&lt;p&gt;\(\widetilde{A}=A_{ij}\vec{e_{i}}\vec{e_{j}}\) ，其中 \(A_{ij}\) 是数，称之为张量的分量。而后面的 \(\vec{e_{i}}\vec{e_{j}}\) 表示基矢量并矢。&lt;/p&gt;
&lt;p&gt;比如 \(\vec{a}=5\vec{i}+6\vec{i}+7\vec{z}\) 其中的 \(\vec{i}\) ， \(\vec{j}\) ， \(\vec{k}\) 表示基矢量。这三个会张满整个空间。&lt;/p&gt;
&lt;p&gt;什么是并矢呢？&lt;/p&gt;
&lt;p&gt;把两个张量并排的写在一起。 \(\tilde{A}\tilde{B}\) 这就是并矢。如是 \(\tilde{A}\) 是 m 阶的张量， \(\tilde{B}\) 是 n
阶的张量。则两个的并矢是 \(m+n\) 阶的张量。用三维坐标系来表示的话就是 \(\vec{x}\) ， \(\vec{y}\) 合起来表示成一个平面，也就是升阶了。&lt;/p&gt;
&lt;p&gt;矩阵可以看成是一个 0 阶的张量。因为矩阵没有基矢量的定矢。现在关注一下 \(A_{ij}\) ，这个数可以有很多种的表示的形式，它是可以用矩阵来表示的。张量分量是一个数，矩阵形式的张量分量也是一个数。可以这么写：&lt;/p&gt;
&lt;p&gt;\[
\left [ \begin{matrix}
A_{11} &amp;amp; A_{12} \\
A_{21} &amp;amp; A_{22}
\end{matrix} \right ]
\]&lt;/p&gt;
&lt;p&gt;有时候只写一个矩阵的话，是省略了基矢量并矢的。一个矩阵的本质是一个函数，比如 \(i=1,j=2\) 的话就是表示
\(A_{12}\) 。这里面的两个亚标都是 i 和 j ，张量表示是一个遍历的全部过程。两次求和。&lt;/p&gt;
&lt;p&gt;什么是 \(\delta_{ij}\) ，这个函数是什么？&lt;/p&gt;
&lt;p&gt;\[\delta_{ij}=\begin{cases}
1, &amp;amp; i=j \\
0, &amp;amp; i\neq j
\end{cases}
\]&lt;/p&gt;
&lt;p&gt;什么是 \(\epsilon_{ijk}\) ，这个函数又是什么？&lt;/p&gt;
&lt;p&gt;\[
\epsilon_{ijk}=\begin{cases}
1, &amp;amp;  odd\\
0, &amp;amp;  equal\\
-1, &amp;amp; even
\end{cases}
\]&lt;/p&gt;
&lt;p&gt;因为是数，所以可以移动位置。张量分量的矩阵形式就是用矩阵来表示，但是如果要用张量形式的话，就不能用矩阵来表示。&lt;/p&gt;
&lt;p&gt;张量的简写： \(\tilde{P}=P_{ij}\vec{e_{i}}\vec{e_{j}}=\{P_{ij}\}=P_{ij}\)  这是在直角坐标系下的一种简写形式。所以 \(\delta_{ij}\) 有时候是一个数，有时候是一个张量，是不一样的。&lt;/p&gt;
&lt;p&gt;几个特殊的张量：delta 函数，epsilon 函数，爱因斯坦求和约定，nabla 算子，Detla 算子。&lt;/p&gt;
&lt;p&gt;(1) 第一个就是 \(\delta_{ij}\) 张量。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231122_141222.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;(2) 第二个是 \(\epsilon_{ijk}\) 张量。为什么那么设计呢，是因为要符和右手定则，函数的构造都是为了方便计算的。叉乘或叫乘积。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231122_141232.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231122_141240.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;矢量，张量的运算，本质上是基矢量并矢的计算，与张量分量无关。下标这里称之为亚标。亚标数和维数是两个不同的概念。比如下面二阶的张量在三维的坐标下的运算。张量的计算也是求和。&lt;/p&gt;
&lt;p&gt;\(a_{i}b_{i}=a_{1}b_{1}+a_{2}b_{2}+a_{3}b_{3}\)&lt;/p&gt;
&lt;p&gt;\(\vec{a} \times \vec{b} = \epsilon_{ijk}a_{i}b_{j}\vec{e_{k}}\) 第一部分是数，也能表征右手定则，表示正负；第二部分也是数，以模的形式表示在前面；最后一部分表示方向。这个就是爱因斯坦求和约定，很漂亮的形式。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231122_141253.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;矩阵的形式不如张量的形式，张量的形式能表示出右手定则，更直观一点。&lt;/p&gt;
&lt;h2 id=&#34;机器学习当中的张量&#34;&gt;机器学习当中的张量&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/wohu1104/article/details/105603829&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/wohu1104/article/details/105603829&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;机器学习当中的张量就是高维数组这种数据结构做的，和张量分析当中的张量有所不同。高阶的矩阵表示高维当中的一种线性变换。那做了多次的线性变换就是多重线性变换了，也就是张量描述的东西。&lt;/p&gt;
&lt;p&gt;说万物可矩阵，万物可张量，都是对的。这是用到了抽象的符号。抽象的符号组织的很好了之后，可以方便人们发现更多的规律，就是这们回事。矩阵是变换也是一个数，是 0 阶张量，但也是张量，这样看
tensorflow 当中称为 tensor 也没有什么奇怪的了。&lt;/p&gt;
&lt;p&gt;可就是对数据的多次变换就是 tensor flow 了。数学专业的定义和机器学习的定义也不完全一样。机器学习对数学概念的使用比较随意，不用很在意这些名词。要在意的是一些函数的由来。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>矩阵分析（六）函数矩阵的导数</title>
        <link>https://guolongji.xyz/post/matrix-analysis-6/</link>
        <pubDate>Tue, 21 Nov 2023 14:29:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/matrix-analysis-6/</guid>
        <description>&lt;h2 id=&#34;矩阵的导数&#34;&gt;矩阵的导数&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_143153.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_143931.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;之前的目的是看明白反向传播算法的推导过程。现在怎么觉得这个不像呢？&lt;/p&gt;
&lt;h2 id=&#34;矩阵的幂级数&#34;&gt;矩阵的幂级数&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_144226.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;上面的 2 当中的 \(\rho(A)\) 是谱半径，也就是所有的特征值当中最大的那个。3 当中的 \(\rho\) 是曲率半径。&lt;/p&gt;
&lt;p&gt;毛主席当年也是叛逆少年。但是他的叛逆是一种正确的方式，而不是盲目发泄或全盘否定。性格的影响是极为重要的。犯浑的人往往是头脑不清晰。有一个清晰的头脑之后，自然而然会走正确的道路。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_150255.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_150642.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;重点-矩阵函数&#34;&gt;重点：矩阵函数&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_150923.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;什么是矩阵函数？这里看不太明白。什么是最小多项式？之前学过。&lt;/p&gt;
&lt;p&gt;我现在工作生活的与躺平无异。你躺你的孩也学你躺平。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_153524.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_154129.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		data-action=&#34;zoom&#34;
	
&gt;


&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_153702.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		data-action=&#34;zoom&#34;
	
&gt;

&lt;/p&gt;
&lt;p&gt;为什么题目让求 \(e^{At}\) 因为它好算，也可以是 \(\sin At\) 或者 \(\cos At\) 。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_154134.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_154559.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;计算量大。高级的要求是熟练度。因为熟练度高意味着一件事一个人努力了，去尝试做到极限了。熟练度真的是对一个人的最高要求了。算的准之后才是快。做到了又准又快，那么一个人也就成为了这个领域的牛人了。&lt;/p&gt;
&lt;p&gt;技能都是一项一项学的。把关键的练到最快。比如五笔能做到击键九次，那就是一个普通人的极限了。看不懂公式搞人工智能就是空中楼阁。看不懂时候不要想着快，快是懂了之后才练的。&lt;/p&gt;
&lt;h2 id=&#34;矩阵在微分方程组中的应用&#34;&gt;矩阵在微分方程组中的应用&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_160737.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;我对这个世界的复杂性没有足够的认识。想让别人认可，要拿出来大家统一标准的评价体系下的成果。这才能让人信服。在多数情况下公共评价体系是相对科学与公平的。一个人总是觉得自己与众不同是没有意义的。在大的领域有出类拔萃的成果才是人才。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_161332.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_161444.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_161732.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_161852.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;上面的的 \(\tau\) 是变量，手写的 \(\tau\) 看着很像是 &amp;ldquo;2&amp;rdquo; 。做研究写论文，这些公式要学会，是必不可少的。&lt;/p&gt;
&lt;h2 id=&#34;矩阵函数的性质&#34;&gt;矩阵函数的性质&lt;/h2&gt;
&lt;p&gt;由 \(A\) 求 \(e^{At}\) 很麻烦，但是由 \(e^{At}\) 求 \(A\) 比较简单。
&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_163013.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		data-action=&#34;zoom&#34;
	
&gt;

&lt;/p&gt;
&lt;p&gt;数学符号的背后是逻辑。上面的公式是可以证明的， up 主没有证明，这个证明我反正是想不到的。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_164349.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;此处就是矩阵函数求导的方法。&lt;/p&gt;
&lt;p&gt;后续还有张量分析这门课。张量的本质就是“多重线性映射”，入门张量分析，再反过头看之前一个博客中讲机器学习的本质。还是不懂，继续学。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>矩阵分析（五）矩阵的分解</title>
        <link>https://guolongji.xyz/post/matrix-analysis-5/</link>
        <pubDate>Mon, 20 Nov 2023 16:23:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/matrix-analysis-5/</guid>
        <description>&lt;h2 id=&#34;矩阵的三角分解&#34;&gt;矩阵的三角分解&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_162858.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;单位下三角矩阵。普通上三角矩阵。矩阵的分解有什么用呢？L 是左， R 是右。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_163241.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;上面黄色的部分是直接抄下来的。 \(a_{21}\) 是第二行乘以第一列这么算的。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_164159.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;暂时感觉 Crout 分解法和 Cholesky 分解法没有什么用处。先不看了，以后有兴趣了再看一下。&lt;/p&gt;
&lt;h2 id=&#34;矩阵的-qr-分解&#34;&gt;矩阵的 QR 分解&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_164447.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;计算题都是套路，或者说是算法。Q 是酉矩阵。用施密特正交化法。我感觉矩阵分析就是线性代数多了一些内容。&lt;/p&gt;
&lt;p&gt;数学专业和非数学专业学习数学的区别，学数学专业的课能增加自信。但是想在考研数学中取得好成绩，熟练度是更为重要的。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_170726.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_171021.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_171107.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_171255.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_171403.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.zhihu.com/question/322658703&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.zhihu.com/question/322658703&lt;/a&gt; ，数学系和考研数学的差距。看完之后知道自己是底子是非常差的。但不要恢心，我还可以抢救一下。&lt;/p&gt;
&lt;h2 id=&#34;矩阵的满秩分解&#34;&gt;矩阵的满秩分解&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_091045.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;我们学的这些东西是很多数学家一辈子的研究成果。看不懂学不会是正常的。多学几篇就明白了。就懂了。&lt;/p&gt;
&lt;p&gt;什么是满秩矩阵？&lt;/p&gt;
&lt;p&gt;若矩阵秩等于列数，称为列满秩。既是行满秩又是列满秩则为 n 阶矩阵即 n 阶方阵。行满秩矩阵就是行向量线性无关，列满秩矩阵就是列向量线性无关；&lt;/p&gt;
&lt;p&gt;设 A 是 n 阶矩阵， 若 r（A） = n ， 则称 A 为满秩矩阵。 满秩矩阵是一个很重要的概念，它是判断一个矩阵是否可逆的充分必要条件。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_092448.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_092543.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;先化成阶梯型。再化成行最简，什么是行最简？&lt;/p&gt;
&lt;p&gt;在阶梯形矩阵中，若非零行的第一个非零元素全是 1，且非零行的第一个元素 1 所在列的其余元素全为零，就称该矩阵为行最简形矩阵。&lt;/p&gt;
&lt;p&gt;矩阵提取系数的方法：&lt;/p&gt;
&lt;p&gt;格局要打开，否则经常会意难平。&lt;/p&gt;
&lt;p&gt;一旦一个问题可以用矩阵来描述，那么，这个问题用矩阵的法则来求解求可以了。而你还在纠结矩阵各种规律是怎么推导的时候，物理学家已经开始熟练的使用他们来描述理论了。同时 AI 的科学家们也没有去探讨最为深刻的数学规律。做人，做学问，做工程，某一时刻总有最该注意的问题，总有最有价值的问题，总有最重要的问题。&lt;/p&gt;
&lt;p&gt;穷人的觉悟就是努力成为一个富人；底层的觉悟就是努力学习提升认知的水平。穷则变，变则通。躺平有罪，苟活无益。多要求自己，就算你的父母子女优秀也不如你自己优秀更令自己愉快，人的本质都是追求个人的奋斗。别人的成功与你无太大关系，就算是你绐予下一代足够的关心令之成长也无法弥补自己这一代的平庸的痛惜。人生的路，退无可退，唯有向前。&lt;/p&gt;
&lt;p&gt;让实力配上你天生的阿斯伯格。走向成熟，要是再不成熟的话，一辈子都要过去了。另外成熟不是没有梦想，而是用现实的方法追求梦想。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_101613.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;我怀疑上面的 P 写错了， \(\frac13\) 那块化简的好像有问题，以后再看。这是计算部分。没有写错，这是矩阵的标量乘法。&lt;/p&gt;
&lt;p&gt;上面的内容没有问题。你要分清楚矩阵和行列式。行列式记作 \(\overline{A}\) 或 \(\det(A)\) ，而 \(A\) 代表矩阵：矩阵的标量乘法遵循分配律和结合律，是所有元素都乘以标量的乘数。而行列式的的标量乘法则不同，是这个公式：&lt;/p&gt;
&lt;p&gt;\(|kA|=k^{n}|A|\)&lt;/p&gt;
&lt;p&gt;上面的行化简完后 r=2 ，则：&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_103917.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231121_104025.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;满秩分解有什么用处？&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/guoziqing506/article/details/80540323&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/guoziqing506/article/details/80540323&lt;/a&gt;
在机器学习里面很有用。所以矩阵分析是很重要的。&lt;/p&gt;
&lt;p&gt;奇异值分解，十年没有考。但是这个在科研上非常的重要。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/marsggbo/p/10155801.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.cnblogs.com/marsggbo/p/10155801.html&lt;/a&gt; 这篇文章讲了一下奇异值分解，要想理解清楚，肯定要自己做题多演算的。这些东西肯定比较复杂，但是一定要搞清楚。人工智能用到的数学主要是各种矩阵，起码我现在看到的是这样的。&lt;/p&gt;
&lt;p&gt;发现一个博客，他在 2017 年就开始了我最感兴趣的方向。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/marsggbo&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.cnblogs.com/marsggbo&lt;/a&gt; ，他的微信公众号是 AutoML 机器学习。&lt;/p&gt;
&lt;p&gt;别人的知识结构和你的不一样，可以参考，但是要自己重新走一遍。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>矩阵分析（四）向量和矩阵的范数</title>
        <link>https://guolongji.xyz/post/matrix-analysis-4/</link>
        <pubDate>Mon, 20 Nov 2023 13:36:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/matrix-analysis-4/</guid>
        <description>&lt;h2 id=&#34;证明向量的范数&#34;&gt;证明向量的范数&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_133924.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;注意这里是向量的范数。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_134506.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;证明矩阵的范数&#34;&gt;证明矩阵的范数&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_134651.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;迹就是对角线元素之和。范数的“范”字的来源：&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/107384905&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/107384905&lt;/a&gt; ，还有比率和等比级数的两个被译错的词。范的意思是某种长度的度量。这些词的来源搞明白比较好。有的词不达意，影响理解。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_140545.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;数学不做题是不行的。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_141923.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;比起向量只是多了一个相容性这么一个性质。&lt;/p&gt;
&lt;h2 id=&#34;范数与正规矩阵的证明题&#34;&gt;范数与正规矩阵的证明题&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_142953.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;正交（英语：Orthogonality）是线性代数的概念，是垂直这一直观概念的推广。 作为一个形容词，只有在一个确定的内积空间中才有意义。 若内积空间中两向量的内积为 0，则称它们是正交的。&lt;/p&gt;
&lt;p&gt;矩阵是运动的描述，正交矩阵是保持两点欧式距离不变的线性变换。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231120_150601.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;化简的步骤中： \((Q\Lambda Q^{H})^{H}=Q\Lambda^{H}Q^{H}\) ，这块不理解。共轭转置的运算法则不是很清楚。&lt;/p&gt;
&lt;p&gt;共轭的意思是，矩阵中的每一个数字都变成它的共轭复数。共轭是按照一定规律相配的一对。&lt;/p&gt;
&lt;p&gt;对于复矩阵而言共轭转置确实比单纯的转置更为常用, 其原因主要来自于对内积的需求先看  \(C^n\) 空间， \(x^Ty\) 是一个双线性形式, 不构成内积, 而 \(x^Hy\) 才构成内积. 进一步, 看线性算子的伴随， \(&amp;lt;y,Ax&amp;gt;=&amp;lt;A^*y,x&amp;gt;\) , 容易验证伴随算子的矩阵表示恰好是一个转置共轭. 这些都是由内积空间的公理自然决定的. 所以与几何相关的概念经常会采用共轭转置(比如酉阵， Hermite 阵， Hermite 型，
QR 分解, 奇异值分解, 极分解, &amp;hellip;)&lt;/p&gt;
&lt;p&gt;在讨论纯粹的线性的代数性质而不是几何性质的时候单纯的转置就有用了，比如说研究映射 \(X \rightarrow AXB\) 的时候, 可以把 \(X\) 拉成向量, 然后这个线性映射就可以表示成 \(vec(X) -&amp;gt; vec(AXB) = T vec(X)\) 表示矩阵 \(T\) 可以写成  \(T = B^T o A\) ， 这里 \(o\) 表示矩阵的 Kronecker 乘积. 这种情况下取共轭转置就不成立了, 因为破坏了线性性质。&lt;/p&gt;
&lt;p&gt;计算的时候会用到的这几个公式：&lt;/p&gt;
&lt;p&gt;\(A^{H}=\overline{(A^{H})}\)&lt;/p&gt;
&lt;p&gt;\((A+B)^{H} = A^{H} + B^{H}\)&lt;/p&gt;
&lt;p&gt;\((kA)^{H} = \overline{k}A^{H}\)&lt;/p&gt;
&lt;p&gt;\((AB)^{H}=B^{H}A^{H}\)&lt;/p&gt;
&lt;p&gt;\((A^{H})^{H}=A\)&lt;/p&gt;
&lt;p&gt;如果 \(A\) 可逆，则 \((A^{H})^{-1}=(A^{-1})^{H}\)&lt;/p&gt;
&lt;p&gt;我是我，我又不是我，我的身上有许多的基因没有表达，我是一个信息的阶段性载体。命运的齿轮不断向前转动，我的价值有一点奇怪。到底是什么呢？&lt;/p&gt;
&lt;p&gt;一切的怕都是不自信，是他信力大于自信力的表现。人应该做到“他强任他强，清风拂山岗。他横任他横，明月照大江。”自信之人就应该有有阿斯伯格综合症。以自我为中心并没有什么错误，不要为了他人改变自己的特质和性格。&lt;/p&gt;
&lt;p&gt;世上有很多强人，难道就因为他们强，你就不能追求自己喜欢的东西了吗？数学，物理，都挺难的。难道作为一个爱好来学习都不敢了吗？怕什么来什么，不怕什么，什么困难都将过去，失败也没什么大不了的。况且什么是失败呢？有的人一生下来就夭折了，你说你还不够强吗？&lt;/p&gt;
</description>
        </item>
        <item>
        <title>emacs kitty ranger rime 等的一些优化</title>
        <link>https://guolongji.xyz/post/emacs-optimize/</link>
        <pubDate>Fri, 17 Nov 2023 11:43:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/emacs-optimize/</guid>
        <description>&lt;h2 id=&#34;emacs-rime-的-探针-中英文切换方法&#34;&gt;emacs-rime 的“探针”中英文切换方法&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://emacs-china.org/t/emacs-rime/12048/838?page=42&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://emacs-china.org/t/emacs-rime/12048/838?page=42&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://emacs-china.org/t/emacs-rime/18305&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://emacs-china.org/t/emacs-rime/18305&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;设置了一下能用了，但是不是很好用。&lt;/p&gt;
&lt;p&gt;但是我想输入 \(a^{2}+b^{2}=c^{2}\) 这样的式子。不能频繁的切换输入法了。但是输入这种：测试 input test 还是不行。挺奇怪的。用 capslock 映射成 f1 键，用 f1 键绑定到 rime-inline-ascii ，可以解决这个痛点。emacs 内部的输入法和外部的一样好用。&lt;/p&gt;
&lt;h2 id=&#34;rime-和-kitty-的配合使用&#34;&gt;rime 和 kitty 的配合使用&lt;/h2&gt;
&lt;h3 id=&#34;kitty-只有加入了下面-ibus-的环境变量才能用-fcitx5-输入中文&#34;&gt;kitty 只有加入了下面 ibus 的环境变量才能用 fcitx5 输入中文&lt;/h3&gt;
&lt;p&gt;因为 kitty 好用，这个小毛病就尝试解决一下，还真是可以用。&lt;/p&gt;
&lt;p&gt;cat /etc/environment&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;OSFONTDIR&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;/usr/share/fonts/:/usr/local/share/fonts/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;GTK_IM_MODULE&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;fcitx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;QT_IM_MODULE&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;fcitx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;XMODIFIERS&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;@im&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;fcitx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# SDL_IM_MODULE DEFAULT=fcitx&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;GLFW_IM_MODULE&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;ibus
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;安装 fcitx5 的输入法。&lt;/p&gt;
&lt;p&gt;nix-env -iA nixpkgs.fcitx5-rime
nix-env -iA nixpkgs.fcitx5&lt;/p&gt;
&lt;p&gt;为什么使用 kitty ，因为 kitty 好用：&lt;a class=&#34;link&#34; href=&#34;https://askubuntu.com/questions/90214/how-do-i-set-the-default-program&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://askubuntu.com/questions/90214/how-do-i-set-the-default-program&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;kitty 可以使用 fcitx5 这个工具，在这里面找到：&lt;a class=&#34;link&#34; href=&#34;https://github.com/kovidgoyal/kitty/releases&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/kovidgoyal/kitty/releases&lt;/a&gt; 0.28.0 这个版本。这个版本的 opengl 不要求 3.3 ，是 3.1 就足够了。&lt;/p&gt;
&lt;p&gt;sudo ln -s /usr/local/bin/kitty-0.28.0-x86_64/bin/kitty /usr/bin/kitty&lt;/p&gt;
&lt;p&gt;设置默认的 terminal app ，这些东西在 &lt;code&gt;/usr/share/applications/&lt;/code&gt; 当中，也在编译好的两进制的同名目录当中，找到即可。&lt;/p&gt;
&lt;p&gt;系统可以选择这个 .desktop 文件来设置 kitty 为默认的终端程序。&lt;/p&gt;
&lt;p&gt;linux 下 emacs 和系统输入法的完美配合。现在我的 emacs 有点好的不像话了。&lt;/p&gt;
&lt;p&gt;设置 ranger 显示图片： &lt;a class=&#34;link&#34; href=&#34;https://blog.51cto.com/u_15072778/4547963&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.51cto.com/u_15072778/4547963&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;gzip -d rc.conf.gz&lt;/p&gt;
&lt;p&gt;修改一下配置即可，把 rc.local 当中的 set preview_images 设置为 true 。这样问题就解决了。&lt;/p&gt;
&lt;p&gt;另外 kitty 也是有配置的，按下 Ctrl-Alt-F2 即可打开配置，我的配置无非是想弄一个透明色。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://sw.kovidgoyal.net/kitty/conf/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://sw.kovidgoyal.net/kitty/conf/&lt;/a&gt; ，这个里面有大量的配置可以选择，这个比之前的页面配置要好看多了。&lt;/p&gt;
&lt;p&gt;修改 background_opacity 为 0.8 即可，经过实验 0.8 的效果是最好的。&lt;/p&gt;
&lt;p&gt;现在我的 onlyconfig 配置又要多几个了。 kitty 的 rc.conf ， ranger 的配置。还有 fcitx5 的配置。这些配置组合在一起，让我的开发环境看起来很好看。当然最关键的还是好用。&lt;/p&gt;
&lt;h3 id=&#34;设置-fcitx5-的主题&#34;&gt;设置 fcitx5 的主题&lt;/h3&gt;
&lt;p&gt;现在万事大吉了。需要把 fcitx5 的主题再配置一下才好看。&lt;/p&gt;
&lt;p&gt;按照这个来设置办输入法： &lt;a class=&#34;link&#34; href=&#34;https://github.com/thep0y/fcitx5-themes&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/thep0y/fcitx5-themes&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;涉及到所有的配置文件有：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;~/.config/ranger/rc.conf
~/.config/kitty/kitty.conf
~/.local/share/fcitx5/themes/transparent-green/
~/.config/fcitx5/conf/classicui.conf
~/.config/fcitx5/conf/rime.conf
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这五个配置文件。好了，&lt;/p&gt;
&lt;p&gt;还涉及到一个输入法的优化这个还是 popup 更加的好用，frame 会挡住文字，看起来很烦人。&lt;/p&gt;
&lt;p&gt;还涉及到一个配置文件：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;~/.local/share/fcitx5/rime/default.custom.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;linux 的 rime 切换输入法不上屏英文而是上屏中文，很不爽，可以改源码解决。但是我就不拆腾了。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/rime/squirrel/issues/146&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/rime/squirrel/issues/146&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上屏直接按 enter 键，关键还是提高自己的速度和准确率，不能完全信赖工具，工具只是一时的。而知识才是无价的。工具只是一时的，而重要的知识才是无价的。所以现在这种程度就够了。&lt;/p&gt;
&lt;h3 id=&#34;终端里有户名和机器名的配色问题&#34;&gt;终端里有户名和机器名的配色问题&lt;/h3&gt;
&lt;p&gt;将 .bashrc 当中的 force_color_prompt=yes 就可以了。这也是一个小 bug 的修复&lt;/p&gt;
&lt;h3 id=&#34;emacs-中禁用系统-fcitx5-的-rime-输入法&#34;&gt;emacs 中禁用系统 fcitx5 的 rime 输入法。&lt;/h3&gt;
&lt;p&gt;还有一个问题：在 emacs 内部不使用系统的输入法。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt;Desktop Entry&lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;Name&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;Emacs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;GenericName&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;Text Editor
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;Comment&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;Edit text
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;MimeType&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;text/english;text/plain;text/x-makefile;text/x-c++hdr;text/x-c++src;text/x-chdr;text/x-csrc;text/x-java;text/x-moc;text/x-pascal;text/x-tcl;text/x-tex;application/x-shellscript;text/x-c;text/x-c++;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;Exec&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;env &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;GTK_IM_MODULE&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;emacs &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;XMODIFIERS&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;@im&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;emacs emacs %F
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;Icon&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;emacs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;Type&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;Application
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;Terminal&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;Categories&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;Development;TextEditor;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;StartupNotify&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;StartupWMClass&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;Emacs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;emacs 启动时增加两个环境变量就可以了：GTK_IM_MODULE=emacs XMODIFIERS=@im=emacs emacs &amp;amp;&lt;/p&gt;
&lt;p&gt;参见：&lt;a class=&#34;link&#34; href=&#34;https://emacs-china.org/t/emacs/15948&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://emacs-china.org/t/emacs/15948&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这个优化很好，强制使用 emacs 内部的输入法。这个输入法没有一点的 bug ，这就使输入非常的流畅。&lt;/p&gt;
&lt;h2 id=&#34;rime-inline-ascii-trigger-切换-emacs-rime-的中英文&#34;&gt;rime-inline-ascii-trigger 切换 emacs-rime 的中英文&lt;/h2&gt;
&lt;p&gt;设置 rime-inline-ascii 的快捷键是 M-j ，使用这个快捷键可以切换中英文，但是一个痛点始终无法解决：用一个键比如左右 shift 键直接上屏英文，并且切换输入法。 enter 键可以上屏，但是无法切换输入法。C-\ 可以上屏中文并且切换输入法。&lt;/p&gt;
&lt;p&gt;系统的改键，需要启动后手动执行一下，xmodmap ~/.Xmodmap ，有一点奇怪。后续再看。&lt;/p&gt;
&lt;p&gt;困难输入的情况现在已经几乎没有了，现在已经非常好好用了，目前到此为止。&lt;/p&gt;
&lt;h2 id=&#34;最终的优化&#34;&gt;最终的优化&lt;/h2&gt;
&lt;p&gt;借助开源键盘或客制化键盘改键，可以把常用的快捷键做成一个键，这是最终的优化手段。关键还是要自己练习打字，打的多了。很长的一句话多一个或者两个键的输入根本不会影响打字的效率。你能做到
10 分钟打 3000 字吗？很多人是可以做到的。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>线性代数的本质</title>
        <link>https://guolongji.xyz/post/line-algebra-nature/</link>
        <pubDate>Mon, 13 Nov 2023 09:37:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/line-algebra-nature/</guid>
        <description>&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/av6731067&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.bilibili.com/video/av6731067&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;使用 katex 来规范公式的书写，比起 mathjax 和 latex 功能略少，要求公式的语法更为严格，但是渲染速度更快：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://katex.org/docs/supported.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://katex.org/docs/supported.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;以后写数学公式要多多参考这个网页，谢谢人类世界，提供了这么多免费的东西。&lt;/p&gt;
&lt;h2 id=&#34;向量是什么&#34;&gt;向量是什么？&lt;/h2&gt;
&lt;p&gt;物理空间中的向量；ai 中的数组（可以是任何东西，可以说 ai 中的向量是最抽像的东西）；数学中的向量，起始点是原点。数学上为了把向量和点分开，用中括号竖着写，这只是一种惯用写法而已。惯用写法也很重要，因为惯用写法就是历史，数学中的历史同样重要。同意我的观点吗？&lt;/p&gt;
&lt;p&gt;向量相加用物理来看很直观，就是各个方向直接相加。数乘向量的本质是缩放。&lt;/p&gt;
&lt;h2 id=&#34;线性组合-张成的空间与基&#34;&gt;线性组合，张成的空间与基&lt;/h2&gt;
&lt;p&gt;这一章很好理解，没必要很深入的去看这个问题。用终点来代表向量。张成的空间就是全部的缩放形成的空间。线性无关。&lt;/p&gt;
&lt;p&gt;那么根据视频的内容得到了基的严格定义：向量空间的一组基是张成该空间的一个线性无关的向量集。&lt;/p&gt;
&lt;h2 id=&#34;矩阵与线性变换&#34;&gt;矩阵与线性变换&lt;/h2&gt;
&lt;p&gt;matrix 和线性变换（liner transformation）是什么关系？&lt;/p&gt;
&lt;p&gt;变换是函数的一种花哨的说法。线性变换就是对一个向量变换得到另一个向量。 \(L\) 就是一个线性变换了。变换暗示用运动来思考。什么是线性变换，就是变换之后直线必须是直线，不能够弯曲，二是原点保持固定。&lt;/p&gt;
&lt;p&gt;把空间压弯了的变换不是线性变换。我喜欢用美国人的方法来学习数学。原点移动了，线还是直的那么不叫性线变换，叫仿射变换。&lt;/p&gt;
&lt;p&gt;网络线保持平行且等矩分布，这种就叫做线性变换。&lt;/p&gt;
&lt;p&gt;什么是矩阵呢，就是竖着看两个向量写在一起，分别表示 i-hat 和 y-hat 两个做过了线性变换之后的两个向量。称之为 transformed i-hat 和 tranformed y-hat。&lt;/p&gt;
&lt;p&gt;那么就得到了矩阵和向量乘法的公式了。矩阵可以理解成对标准空间的一种变换。将矩阵看成是空间的变换之后，后面的内容都更好理解。&lt;/p&gt;
&lt;h2 id=&#34;矩阵乘法和线性变换组合&#34;&gt;矩阵乘法和线性变换组合&lt;/h2&gt;
&lt;p&gt;据我的经验，如果丢掉矩阵的话，那些涉及矩阵的证明可以缩短一半。 ——埃米尔·阿廷&lt;/p&gt;
&lt;p&gt;shear，剪切，用推移来翻译更为贴切。就是这个意思。&lt;/p&gt;
&lt;p&gt;\[
\left[\begin{matrix}
1 &amp;amp; 1 \\
0 &amp;amp; 1
\end{matrix}\right](\left[\begin{matrix}
0 &amp;amp; -1 \\
1 &amp;amp; 0
\end{matrix}\right]\left[\begin{matrix}
x \\
y
\end{matrix}\right])=\left[\begin{matrix}
1 &amp;amp; -1 \\
1 &amp;amp; 0
\end{matrix}\right]\left[\begin{matrix}
x \\
y
\end{matrix}\right]
\]&lt;/p&gt;
&lt;p&gt;分别称为 Shear（推移），Rotation（旋转），Composition（复合矩阵）。函数从右往左来读。矩阵乘法也是如此，就是说，没有一丝，希伯来语矩阵乘法不具有交互律。矩阵乘法具有结合律。为啥呢？因为三个变换是同样的顺序，完全没有一丝的改变。这就是理解其几何意义的精妙所在。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.conf-aris.com/%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%E4%B9%A0%E6%8B%89%E4%B8%81%E6%96%87%E3%80%81%E5%8F%A4%E5%B8%8C%E8%85%8A%E6%96%87%E4%B8%8E%E5%8F%A4%E5%85%B8%E5%B8%8C%E4%BC%AF%E6%9D%A5/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.conf-aris.com/%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%E4%B9%A0%E6%8B%89%E4%B8%81%E6%96%87%E3%80%81%E5%8F%A4%E5%B8%8C%E8%85%8A%E6%96%87%E4%B8%8E%E5%8F%A4%E5%85%B8%E5%B8%8C%E4%BC%AF%E6%9D%A5/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;为什么要学，拉丁文、古希腊文与古典希伯来文。这是一套开源代码，古人的知慧记录在这里。人生的智慧是有限的，古人的智慧可以对一个人来说是无限的，那么。多看看，多学一学。人的一辈子，可以有很多的收获。&lt;/p&gt;
&lt;p&gt;矩阵的乘法是数乘的推广，不是看这个本质的课程的话还真是理解不了为什么这样做。这样做的目的是将一个不会的东西转换成会的东西，而用会的东西做普适性的推广让自己可以利用新的工具更简单的做好。&lt;/p&gt;
&lt;h2 id=&#34;三维空间中的线性变换&#34;&gt;三维空间中的线性变换&lt;/h2&gt;
&lt;p&gt;一句话就是与两维的类似。&lt;/p&gt;
&lt;h2 id=&#34;行列式&#34;&gt;行列式&lt;/h2&gt;
&lt;p&gt;计算的目的不在于数字本身，而在于洞察其背后的意义。 ——理查德·哈明&lt;/p&gt;
&lt;p&gt;刷新了我的认知，下面的意思是一个变换会让行列式的面积变大为原来的多少倍。行列式是面积的系数，很好的理解。&lt;/p&gt;
&lt;p&gt;\[
\det\Big(\left[\begin{matrix}
3 &amp;amp; 2 \\
0 &amp;amp; 2
\end{matrix}\right]\Big)=6
\]&lt;/p&gt;
&lt;p&gt;如果一个行列式的值为 0，意味着他将整个平面压缩到了一条线上，甚至是一个点上。空间定向改变的话，行列式的值会变为负值。&lt;/p&gt;
&lt;p&gt;用一句话解释： \(det(M_{1}M_{2})=det(M_{1})det(M_{2})\) ，从面积变化的角度来讲，此式显然成立。这就是数学几何解释的意义所在。&lt;/p&gt;
&lt;h2 id=&#34;逆矩阵-列空间与堆零向量&#34;&gt;逆矩阵，列空间与堆零向量&lt;/h2&gt;
&lt;p&gt;提出正确的问题比回答它更难。 ——格奥尔格·康托尔&lt;/p&gt;
&lt;p&gt;以线性变换的眼光来看：逆矩阵，列空间，秩和零空间这四个概念。&lt;/p&gt;
&lt;p&gt;\(A^{-1}A\) ，\(A^{-1}\) 是逆变换，inverse transformation。就是说结果是\[ \left[\begin{matrix}
1 &amp;amp; 0 \\
0 &amp;amp; 1
\end{matrix}\right] \] ，现在的理解就很清楚了。&lt;/p&gt;
&lt;p&gt;只要 \(det(A) \neq 0\) ，则 \(A^{-1}\) exists。如果 \(det(A)=0\)，那么就会压缩成一条线，你不能将一条线解压缩成一个平面。&lt;/p&gt;
&lt;p&gt;当变换的结果是一条线的时候，就说秩为一；如果变为的结果落在某个平面，则称秩为 2。&lt;/p&gt;
&lt;p&gt;所有可能的变换结果的集合称之为列空间。&lt;/p&gt;
&lt;p&gt;秩的定义：列空间的维数。秩达到最大值时，意味着秩与列数相等。称之为满秩。&lt;/p&gt;
&lt;p&gt;变换后的一些向量落在零向量上，“零空间”正是这些向量所构成的空间。Null Space 和 kernel。就是说  \(T(v)=0\) 的向量 \(v\) 的集合。零空间和核是一个概念。&lt;/p&gt;
&lt;h2 id=&#34;非方阵&#34;&gt;非方阵&lt;/h2&gt;
&lt;p&gt;什么是非方阵，比如将一个二维的向量映射为一个三维的向量。那么这个变换对应的就是一个非方阵。&lt;/p&gt;
&lt;h2 id=&#34;点积与对偶性&#34;&gt;点积与对偶性&lt;/h2&gt;
&lt;p&gt;点积就是对应相乘并相加。点积几何上是投影的面积，且点积满足交换率。&lt;/p&gt;
&lt;p&gt;下面来讲一下“对偶性”（duality）。什么是所谓的对偶性呢？两个向量点乘就是将其中一个向量转换为线性变换。选择这两个中的任何一个都是可以的，这就是对偶性。&lt;/p&gt;
&lt;p&gt;&amp;ldquo;对偶&amp;quot;这个词的含义取决于具体的上下文，常常用于描述两个相关但又相对的概念、结构或者关系。&lt;/p&gt;
&lt;h2 id=&#34;叉积的标准介绍&#34;&gt;叉积的标准介绍&lt;/h2&gt;
&lt;p&gt;“每一个维度都很特别。” ——杰佛里·拉加里亚斯&lt;/p&gt;
&lt;p&gt;叉积是两个向量围成的面积。逆时针的相乘为正，叉积有顺序的区别。叉积的值也正是 det 将两个向量合为一个矩阵的值。叉积的结果扔然是一个向量，这个向量的长度是平行四边形的面积。方向由右手法则来表示。 \({\hat{v}} \times {\hat{w}} = \hat{p}\)   右手食指指向 \(\hat{v}\) ，中指指向 \(\hat{w}\) ，大拇指的方向就是结果的向。&lt;/p&gt;
&lt;p&gt;\[
\left[\begin{matrix}
v_{1} \\
v_{2} \\
v_{3}
\end{matrix}\right] \times
\left[\begin{matrix}
w_{1} \\
w_{2} \\
w_{3}
\end{matrix}\right]=det(\left[\begin{matrix}
\hat{i} &amp;amp; v_{1} &amp;amp; w_{1} \\
\hat{j} &amp;amp; v_{2} &amp;amp; w_{2} \\
\hat{k} &amp;amp; v_{3} &amp;amp; w_{3}
\end{matrix}\right])
\]&lt;/p&gt;
&lt;p&gt;也就是下面的：&lt;/p&gt;
&lt;p&gt;\[
{\hat{i}}(v_{2}w_{3}-v_{3}w_{2})+{\hat{j}}(v_{3}w_{1}-v_{1}w_{3})+{\hat{k}}(v_{1}w_{2}-v_{2}w_{1})
\]&lt;/p&gt;
&lt;p&gt;那么叉积的意义到底是什么呢？其实看完这里还是想的不是很明白。&lt;/p&gt;
&lt;h2 id=&#34;以线性变换的眼光看叉积&#34;&gt;以线性变换的眼光看叉积&lt;/h2&gt;
&lt;p&gt;从他（格罗滕迪克）和他的作为中，我还学到一点：不以高难度的证明为傲，因为难度高意味着我们还不理解。理想的情况是能绘出一符美景，而其中的证明显然易见。 ——皮埃尔·德里涅&lt;/p&gt;
&lt;p&gt;没有真正理解问题的我最好的做法就是反复抄一下&lt;/p&gt;
&lt;p&gt;Dual vector，对偶向量，（从空间）到数轴的线性变换。dot product and cross product。&lt;/p&gt;
&lt;p&gt;这一节的内空就看不懂了。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/nbl97/article/details/80582027&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/nbl97/article/details/80582027&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如果实在看不懂就反复看。&lt;/p&gt;
&lt;h2 id=&#34;一点历史的小故事&#34;&gt;一点历史的小故事&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_092635.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;牛顿是炼金术士，而不是一个基督徒。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_092903.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;约翰伯努力是德国人，当然支持莱布尼茨，这一点毫无疑惑。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_093022.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;他的哥哥，雅各布·伯努力，爱提问题。儿孙均是数学研究者。约翰伯努力的另一个学生是洛必达，是那个买论文的大富豪。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_095137.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_093228.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;是瑞士人。瑞士被法国，德国，意大利三面围着，是个科学文化非常繁荣的地方。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_093306.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;瑞士人都以欧拉为荣。要想得到无上荣光，必付出无上代价。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zh.wikipedia.org/zh-hans/%E5%8F%98%E5%88%86%E6%B3%95&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zh.wikipedia.org/zh-hans/%E5%8F%98%E5%88%86%E6%B3%95&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;欧拉的变分法，我真的是看不懂啊。历史上任何一个关键的问题，被一个没有深入研究的人很快理解都是不可能的。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_093525.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_093604.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;法国贵族。有的人一出生便什么都有。他还有一个徒弟是傅立叶。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_093740.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		data-action=&#34;zoom&#34;
	
&gt;


法国人。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_093817.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;柯西被称为最不可爱的数学家。间接导致了阿贝尔的死亡，埋没数学家伽罗瓦。剽窃弗拉德米尔·斯图普尼斯基长达四卷的著作。&lt;/p&gt;
&lt;p&gt;牛顿的徒子徒孙名声不显：&lt;a class=&#34;link&#34; href=&#34;https://www.zhihu.com/question/45437802/answer/102310081&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.zhihu.com/question/45437802/answer/102310081&lt;/a&gt; ，但是是有的，没有消失。&lt;/p&gt;
&lt;p&gt;高斯是约翰·马丁·巴特尔斯的徒弟。高斯属于自己聪明，自学成才的人。高斯的徒弟是狄立克雷，狄立克雷的徒弟是黎曼。高斯的这一个分支也很厉害。这几个都是德国人。另外希尔伯特也是德国人，那么&lt;/p&gt;
&lt;p&gt;当你学习数学到达一定的时间，顺着数学历史的长河慢慢前进，走过古希腊启智时期，走过古代中国辉煌时期，经过欧洲中世纪黑暗的峡谷，暗河，继续往前走，我们乘坐的小舟来到公园 16、17 世纪，你会发现水面忽然开阔起来，无数支流汇聚到一处，融成了一条浩荡的大河。沿岸雄伟的山峰一座接一座，数不胜数，这便到了天才的时代。可能最高的几个山峰你认得，这座郁郁葱葱，高耸入云，叫做牛顿；另一座景秀清奇，峰峦雄伟，是高斯，第三座高山流水白练腾空，唤作欧拉。另外一些同样雄伟层峦叠嶂高山深涧在一起的，他们是韦达、梅森、笛卡尔、费马、帕斯卡、达朗贝尔、拉格朗日、泊松、傅里叶、拉普拉斯，柯西…巴黎是世界上数学家最集中的地方，而在历史上也有很多著名的法国数学家。在微积分领域，长长的数学家表上法国人的名字占了几乎 1/3。法国人对于数学界的贡献由此可见一斑，从初中数学的韦达定理，到高数代表人物拉格朗日，甚至近代大师庞加莱等，几百年，在法兰西这片浪漫的土地上，数学一直保持着旺盛的生命力。&lt;/p&gt;
&lt;p&gt;法国美国是最强的。德国英国稍逊，中国擅长计算，不重视基础和理论。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.zhihu.com/question/23992127&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.zhihu.com/question/23992127&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.zhihu.com/question/26465826/answer/255724890&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.zhihu.com/question/26465826/answer/255724890&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;1、一个小故事，一次小学数学竞赛里，问 4*20+10+9=？法国小盆友最先抢答：等于 4*20+10+9。法语中没有 99 这个单词，基本计数 20 进制，99 日常这么表示（学法语的同学真是辛苦），另外去法国撩妹千万不要问电话号码，法国人念电话号码不像我们习惯一个数一个数地念。比如 61718098，法国人不是念成 6-1-7-1-8-0-9-8，而是两位两位地念 61-71-80-98。听好了： 60+1，60+11，4x20，4x20+10+8。听法国人说电话号码，你刚记了一个 4，后面突然冒出来个 20，所以得赶紧把 4 涂了，改成 80，精神始终处于准亢奋状态。”这个是根植在基础文化日常生活中的（开个玩笑，这个应该不是法国数学厉害的原因）。&lt;/p&gt;
&lt;p&gt;2、你听说法国人数学很好，去问一个幼儿园的法国小盆友：小帅哥，2+3 等于多少呀？小盆友奶声奶气的回答，这个我不知道，但是我知道 2+3=3+2，因为加法构成一个阿尔贝群（阿贝尔群也称为交换群或可交换群，它满足其元素的运算不依赖于它们的次序(交换律公理)的群。阿贝尔群推广了整数集合的加法运算。黑人问号脸哈哈，故事夸张，但在基础教育阶段，法国确实喜欢讲一些很理论的东西，小学就应该学一些零散数学的基本知识嘛）。&lt;/p&gt;
&lt;p&gt;数学是高深的东西，但也从来不是什么不可理解的东西。也许学习数学需要天赋，但是，陪养数学的兴趣一定能让人受益终生。&lt;/p&gt;
&lt;p&gt;法国的数学一直很强。中国为啥一直就不行呢？&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.zhihu.com/question/538822296&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.zhihu.com/question/538822296&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;也许终于有一天，中国的数学成就会达到世界的先进水平。世界上的数学史不过才 300 年而已。但是 300 年的时间会产生很多非常的天分的人。要了解他们的思想，学会他们的思维的精华是很难的。&lt;/p&gt;
&lt;p&gt;数无形时少直觉，形少数时难入微，数形结合百般好。要理解自己的难处，我是没有时间和天赋来做数学的。一方面是培养下一代。一方面是做好本职工作。本职工作是需要一点数学的，学不完所有的数学知识，我甚至连基础部分都不能学的完，理解的很深刻。&lt;/p&gt;
&lt;p&gt;我能做的事就是把尽量多的时间花在有意义的事上，减少娱乐和躺平的时间。做出成果的人在兴趣和专业上一定是勤奋的。勤奋的人才有资格抱怨命运的不公。我没资格，首先入场券“勤奋”要拿到手。珍惜命运，珍惜时间。&lt;/p&gt;
&lt;h2 id=&#34;基变换&#34;&gt;基变换&lt;/h2&gt;
&lt;p&gt;数学是一门赋于不同事物相同名称的艺术。 ——昂利·庞加莱&lt;/p&gt;
&lt;p&gt;对空间网格的定义可以是不同的。&lt;/p&gt;
&lt;p&gt;不同的定义之间如何转化？&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_114344.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;只需要左乘一下就可以把别人的向量坐标转化成我们的向量坐标了。或者两边同时左乘 \(A^{-1}\) 就可以用我们的坐标计算出别人的坐标了。&lt;/p&gt;
&lt;p&gt;90 度的 rotation，逆时针的。  坐标的转换有了，还需要理解矩阵的转换。 用 \(A^{-1}MA\) 来描述就可以了。&lt;/p&gt;
&lt;h2 id=&#34;特征向量与特征值&#34;&gt;特征向量与特征值&lt;/h2&gt;
&lt;p&gt;\(det(A-I)=0\) ，特征向量与对角化。这里也是理解的不够清楚。&lt;/p&gt;
&lt;h2 id=&#34;抽象向量空间&#34;&gt;抽象向量空间&lt;/h2&gt;
&lt;p&gt;这些公理，同其他动机不明的定义一起，让门外汉难以掌握数学。它们主要通过这样的方式协助数学家，从而提升数学的权威性。 ——弗拉基米尔·阿诺尔德&lt;/p&gt;
&lt;p&gt;一个函数的变换是线性的是什么意思？同样是可加性和成比例。保持向量的加法运算和乘法运算。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_135113.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;向量可以是任何东西，是什么根本不重要，只要遵守可加性和成比例性即可。普适的代价是抽象。&lt;/p&gt;
&lt;h2 id=&#34;克来姆法则&#34;&gt;克来姆法则&lt;/h2&gt;
&lt;p&gt;这个法则就是求解方程组。&lt;/p&gt;
&lt;p&gt;问了一下 chat GPT 3.5，他告诉我这个答案：&lt;/p&gt;
&lt;p&gt;学习数学重要的公式到底用不用学会证明的方法？&lt;/p&gt;
&lt;p&gt;学习数学时，了解和记忆重要的公式是非常重要的，因为这些公式往往是解决问题的关键。然而，是否需要学会证明这些公式则取决于你所处的学习阶段和学习目标。&lt;/p&gt;
&lt;p&gt;初级阶段：在学习数学的初级阶段，重点应该放在理解和掌握基本的公式和定理上，而不是花费大量时间去学习证明。这个阶段的学习重点是建立数学基础，培养数学思维。&lt;/p&gt;
&lt;p&gt;高级阶段：随着学习的深入，特别是在进入大学或者深入研究数学的阶段，学会证明数学公式和定理变得更加重要。这有助于深入理解数学原理，提高逻辑推理能力，并且为进一步的学术研究和应用打下坚实的基础。&lt;/p&gt;
&lt;p&gt;个人兴趣：如果你对数学本身很感兴趣，学会证明数学公式可能会成为一种乐趣和挑战。这可以帮助你更深入地理解数学，享受证明的乐趣，并培养逻辑思维能力。&lt;/p&gt;
&lt;p&gt;总的来说，学会证明数学公式的重要性取决于你的学习目标和个人兴趣。在初级阶段，重点应该放在理解和应用公式上；而在更高级的阶段，学会证明数学公式可以帮助你建立更深刻的数学理解。&lt;/p&gt;
&lt;p&gt;兴趣上我是想理解清楚一些本质的问题的，但是熟练度上，我不理解一些问题，没有做过足够的训练。&lt;/p&gt;
&lt;p&gt;对这个世界，我只是模模糊糊的知道一点东西，想要了解的清晰，你是要花时间的。没花很多时间之间，请别报怨为啥这些问题这么难，这么绕。绕可能仅仅是因为你的功课没做到位，实际它就是那个东西。从来不是你之前认为的那样。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>软考考前突击</title>
        <link>https://guolongji.xyz/post/software-architect-example/</link>
        <pubDate>Wed, 01 Nov 2023 19:04:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/software-architect-example/</guid>
        <description>&lt;h2 id=&#34;准备&#34;&gt;准备&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git pull
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./install-eaf.py -i mindmap
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./install-eaf.py --install-core-deps
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;sudo vim ~/.pip/pip.conf&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
[install]
trusted-host = https://pypi.tuna.tsinghua.edu.cn  # trusted-host 此参数是为了避免麻烦，否则使用的时候可能会提示不受信任
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;题目类型：&lt;/p&gt;
&lt;p&gt;上午选择题:75 道，共 75 空，每空是 1 分;满分:75 分;时间:150 分钟；选择题 2min 一道题。&lt;/p&gt;
&lt;p&gt;下午案例题:考核时间:90 分钟满分:75 分，5道大题(第 1 题必做，后 4 题选做 2 题)，一个半小时，半小时一道题。&lt;/p&gt;
&lt;p&gt;论文:系统架构设计论文，考试时间为 120 分钟，笔试，论文题。从给出的 4 道试题(试题一至试题四)中任选 1 道题解答。满分 75 分。论文要写 2000 到 3000 字，3篇 800 字作文的字数。&lt;/p&gt;
&lt;p&gt;45 x 3 = 135 分。也就是说。9/25 的成绩，也就是 100 分满分，只需要考 36 分吗？做对一半的题基本上就能过了。&lt;/p&gt;
&lt;p&gt;总共 32 小时，第一个小时没有什么考点。&lt;/p&gt;
&lt;h2 id=&#34;一-计算机系统&#34;&gt;一、计算机系统&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/1.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 1: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.存储器按照与存储器的矩离可分为：片上缓存，片外缓存，主存，外存&lt;/p&gt;
&lt;p&gt;2.并行总线：多条双向总线；串行总线：一条双向数据线或者两条单向数据线&lt;/p&gt;
&lt;p&gt;3.操作系统分类：批处理操作系统，分时操作系统，实时操作系统，网络操作系统，分布式操作系统，嵌入式操作系统。&lt;/p&gt;
&lt;p&gt;4.网络协议包含：局域网协议，广域网协议，无线网协议，移动网协议&lt;/p&gt;
&lt;p&gt;5.中间件包含：消息中间件，通信中间件，数据存取管理中间件，Web 服务中间件，安全中间件，跨平台和架构的中间件，专用平台中间件，网络中间件。&lt;/p&gt;
&lt;p&gt;6.DSP 处理器采用哈佛结构。&lt;/p&gt;
&lt;h2 id=&#34;二-嵌入式&#34;&gt;二、嵌入式&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/2.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 2: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.嵌入式系统的分类：嵌入式实时系统，嵌入式非实时系统&lt;/p&gt;
&lt;p&gt;2.实时系统：强实时系统，指能够在规定时间内完成系统功能和做出响应的系统。&lt;/p&gt;
&lt;p&gt;3.安全攸关系统：指其不正确的功能或者失效会导致人员伤亡、财产损失等严重后果的计算机系统。&lt;/p&gt;
&lt;p&gt;4.嵌入式系统分为：硬件层，抽象层，操作系统层，中间件层，应用层&lt;/p&gt;
&lt;p&gt;5.嵌入式软件的特点：可裁减性，可配置性，强实时性，安全性，可靠性，高确定性。&lt;/p&gt;
&lt;p&gt;6.嵌入式系统的组成结构：嵌入式微处理器，存储器，总线逻辑，定时器，看门狗电路，I/O 接口，外部设备&lt;/p&gt;
&lt;p&gt;7.嵌入式微处理器分类：微处理器，微控制器，数字信号处理器，图形处理器，片上系统。&lt;/p&gt;
&lt;p&gt;8.存储器分类：随机存储器（不受存储位置的影响），只读存储器。EEPROM 的读取速度快，擦除速度慢。flash，擦写次数多，擦的速度快，但是读的速度慢。&lt;/p&gt;
&lt;p&gt;9.总线分类：数据总线（用于传输数据），地址总线（用于指定 RAM 之中存储数据的地址），控制总线（将微处理器控制单元信号传送到周边设备）；又可分为片内总线，系统总线，局部总线，通信总线；又可分为单工总线，双工总线；又可分为串行总线，并行总线。&lt;/p&gt;
&lt;p&gt;10.看门狗电路：是嵌入式系统必须具备的一种系统恢复能力，可防止程序出错或者死锁。&lt;/p&gt;
&lt;p&gt;11.易错点：嵌入式系统不需要支持多任务，错，选择题考认知细节。&lt;/p&gt;
&lt;h2 id=&#34;三-网络&#34;&gt;三、网络&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/3.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 3: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.性能指标：速率，带宽，吞吐率，时延来度量&lt;/p&gt;
&lt;p&gt;2.非性能指标：从费用，质量，标准化，可靠性，可扩展性，可升级性，易管理性，可维护性来度量。&lt;/p&gt;
&lt;p&gt;3.通信技术分为：数据与信道，复用技术，多址技术，5G 通信技术。&lt;/p&gt;
&lt;p&gt;4.网络分为：局域网，以太网，无线局域网，广域网，城域网，移动通信网。&lt;/p&gt;
&lt;p&gt;5.5G 的主要特征：服务化架构，网络切片技术（可在单个物理网络中切分出多个分离的的逻辑网络）&lt;/p&gt;
&lt;p&gt;6.网络设备：集线器，中继器于物理层；网桥和交换机于数据链路层；路由器和防火墙于网络层&lt;/p&gt;
&lt;p&gt;7.网络协议：应用层，表示层，会话层，传输层，网络层，数据链路层，物理层。&lt;/p&gt;
&lt;p&gt;8.应用层协议：FTP，TFTP，HTTP，HTTPS，DHCP，DNS&lt;/p&gt;
&lt;p&gt;9.传输层协议：TCP，UDP，&lt;/p&gt;
&lt;p&gt;10.网络层协议：IPv4，IPv6&lt;/p&gt;
&lt;p&gt;11.IPv4 to IPv6 的过渡技术：双协议栈技术，隧道技术，NAT-PT 技术。&lt;/p&gt;
&lt;p&gt;12.交换机的功能：集线功能，中继功能，桥接功能，隔离冲突域功能。&lt;/p&gt;
&lt;p&gt;13.交换机的协议有：生成树协议（STP，解决链路回环问题），链路骤合协议（提升与邻接交换设备之间的端口带宽和提高链路可靠性）。&lt;/p&gt;
&lt;p&gt;14.路由器功能：异种网络互连，子网协议转换，数据路由，速率适配，隔离网络，报文分片和重组，备份和流量控制&lt;/p&gt;
&lt;p&gt;15.路由器的协议：内部网关协议（IGP），外部网关协议（EGP），边界网关协议（BGP）&lt;/p&gt;
&lt;p&gt;16.网络建设工程：分为网络设计，网络规划和网络实施 3 个环节。&lt;/p&gt;
&lt;p&gt;17.网络分层设计：接入层，汇骤层，核心层&lt;/p&gt;
&lt;p&gt;18.网络中的最小帧长是由网络检测冲突中的最长时间来定的。&lt;/p&gt;
&lt;p&gt;19.覆盖范围：bluetooth &amp;lt; ZigBee &amp;lt; 802.11n &amp;lt; 802.16m&lt;/p&gt;
&lt;h2 id=&#34;四-信息系统&#34;&gt;四、信息系统&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/4.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 4: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.TPS：（transaction processing system）业务处理系统&lt;/p&gt;
&lt;p&gt;2.EDPS：（electronic data processing system）电子数据处理系统&lt;/p&gt;
&lt;p&gt;3.IPO：（input processing output）；BP：批处理；OLTP：联机事务处理。&lt;/p&gt;
&lt;p&gt;4.MIS：管理信息系统&lt;/p&gt;
&lt;p&gt;5.DSS：（decision support system）&lt;/p&gt;
&lt;p&gt;6.ES：专家系统&lt;/p&gt;
&lt;h2 id=&#34;五-信息安全技术基础知识&#34;&gt;五、信息安全技术基础知识&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/5.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 5: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;对称加密：&lt;/p&gt;
&lt;p&gt;1.DES：（Data Encryption Standard），明文切分为 64 位的块，由 56 位的密钥加密成 64 位的密文&lt;/p&gt;
&lt;p&gt;2.三重 DES：（Triple-DES），使用两把 56 的密钥对明文做三次 DES。&lt;/p&gt;
&lt;p&gt;3.IDEA：国际密钥加密算法（International Data Encryption Algorithm），分组长度为 64 位，密钥长度为 128 位&lt;/p&gt;
&lt;p&gt;4.AES：高级加密标准（Advanced Encryption Standard），分组长度 128 位，支持密钥长度 128，192，256 三种&lt;/p&gt;
&lt;p&gt;5.SM4：分组长度和密钥长都是 128 位。&lt;/p&gt;
&lt;p&gt;非对称加密：&lt;/p&gt;
&lt;p&gt;6.RSA：（三个人名），密钥长度可选&lt;/p&gt;
&lt;p&gt;7.SM2：椭园曲线离散对数问题。相同安全程度下，密钥长度和安全规模比 RSA 小。&lt;/p&gt;
&lt;p&gt;8.控制密钥的安全性：密钥标签，控制矢量&lt;/p&gt;
&lt;p&gt;9.KDC：密钥分配中心&lt;/p&gt;
&lt;p&gt;10.数字签名：可信，不可伪造，不可重用，不可改变，不可抵赖。&lt;/p&gt;
&lt;p&gt;11.访问控制的实现技术：访问控制矩阵，访问控制表（ACL），能力表（Capabilities），授权关系表（Authorization
Relation）&lt;/p&gt;
&lt;p&gt;12.密钥分为：数据加密密钥（DK），密钥加密密钥（KK）&lt;/p&gt;
&lt;p&gt;13.DoS：（Denial of Service），防御手段有特征识别，防火墙，通信数据量统计，修正问题和漏洞四种方法&lt;/p&gt;
&lt;p&gt;14.欺骗攻击：ARP，DNS，IP 欺骗&lt;/p&gt;
&lt;p&gt;15.端口扫描：是入侵者搜集信息的几种常用手法&lt;/p&gt;
&lt;p&gt;16.针对 TCP/IP 堆栈的攻击方式：同步包风暴（SYN Flooding），ICMP 攻击，SNMP 攻击。&lt;/p&gt;
&lt;p&gt;17.系统漏洞扫描：基于网络，基于主机两种&lt;/p&gt;
&lt;p&gt;18.常见的安全协议：SSL，PGP（一种加密软件），IPSec，SET 协议（信用卡支付），HTTPS&lt;/p&gt;
&lt;p&gt;19.风险评估：基于脆弱性，资产，威胁，风险，安全措施&lt;/p&gt;
&lt;h2 id=&#34;六-系统工程&#34;&gt;六、系统工程&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/6.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 6: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.系统工程分类：霍尔的三维结构，切克兰德方法，并行工程，综合集成法，WSR 方法（物理-事理-人理方法）&lt;/p&gt;
&lt;p&gt;2.生命周期的阶段：探索研究，概念阶段，开发阶段，生产阶段，使用阶段&lt;/p&gt;
&lt;p&gt;3.生命周期的方法：计划驱动，渐进式迭代开发，精益开发，敏捷开发&lt;/p&gt;
&lt;p&gt;4.基于模型的系统工程：（MBSE）&lt;/p&gt;
&lt;p&gt;5.MIPS：第秒百万次指令数&lt;/p&gt;
&lt;p&gt;6.性能评估：Web 服务器的性能评测方法有基准性能测试，压力测试，可靠性测试。&lt;/p&gt;
&lt;h2 id=&#34;七-软件工程&#34;&gt;七、软件工程&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/7.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 7: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.软件过程模型包括：瀑布模型，原型模型，螺旋模型，敏捷模型，软件统一过程模型（Rational Unified Process，RUP）也可以称之为合理统一过程。&lt;/p&gt;
&lt;p&gt;2.系统分析与设计包括：结构化方法，面向对象方法，其他方法，逆向工程&lt;/p&gt;
&lt;p&gt;3.净室软件工程：（Cleanroom Software Engineering），CSE，主要是用函数理论和抽样理论，太理论化。&lt;/p&gt;
&lt;p&gt;4.CBSE：基于构建的软件工程&lt;/p&gt;
&lt;h2 id=&#34;八-数据库设计&#34;&gt;八、数据库设计&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/8.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 8: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.关系数据库基本概念：属性，域（取值范围），目或度（属性的个数），候选码，主码，主属性，外码，全码。&lt;/p&gt;
&lt;p&gt;2.关系代数运算&lt;/p&gt;
&lt;p&gt;3.范式：1NF 是属性不可再分；2NF，消除对主码的完全依赖；3NF，消除对主码的传递依赖；4NF，消除对候选码的传递依赖&lt;/p&gt;
&lt;p&gt;4.传递依赖：定义复杂&lt;/p&gt;
&lt;p&gt;5.数据库：实体用矩形，属性用椭园，关系用菱形&lt;/p&gt;
&lt;p&gt;6.OLAP：联机分析处理&lt;/p&gt;
&lt;p&gt;7.OLTP：联机事务处理&lt;/p&gt;
&lt;p&gt;8.通用数据接口标准：（Open DataBase Connectivity，ODBC），解决异构数据库的数据共享。能用统一的方式处理所有的关系数据库。不依赖 DBMS（数据库管理系统）。&lt;/p&gt;
&lt;p&gt;9.数据库接口：DAO，RDO（Remote Data Object），ADO（Active Data Ojbect），
JDBC（java DataBase Connection）&lt;/p&gt;
&lt;p&gt;10.ORM 访问接口分为：Hibernate，Mybatis，JPA&lt;/p&gt;
&lt;p&gt;11.NoSQL：列式存储数据库，键值数据库，文档数据库，图数据库&lt;/p&gt;
&lt;p&gt;12.分布式数据库的特点：共享性，自治性，可用性，分布性。&lt;/p&gt;
&lt;p&gt;13.数据库优化技术：增加冗余列（减少连接操作），增加派生列（减小计算量），重新组表，水平分割表，垂直分割表。反规范化设计的优点是提高性能，缺点是会造成数据的重复存储。&lt;/p&gt;
&lt;p&gt;14.分布式数据库的优化技术：主从复制，读写分离，分表，分库&lt;/p&gt;
&lt;p&gt;15.redis string 类型：用于缓存层或计数器&lt;/p&gt;
&lt;p&gt;16.redis hash：节省空间，用于用户信息&lt;/p&gt;
&lt;p&gt;17.redis set：无序集合，用于去重，抽奖，初始化用户池。&lt;/p&gt;
&lt;p&gt;18.redis list：用于回复评论、点赞&lt;/p&gt;
&lt;p&gt;19.redis 出现的问题：缓存穿透（访问没有缓存的 key），缓存雪崩（大量同时过期），缓存击穿（少量热点过期）&lt;/p&gt;
&lt;p&gt;20.redis 集群分为：主从复制，哨兵集群，Cluster 集群&lt;/p&gt;
&lt;p&gt;21.redis 集群的分片方式主要分为：客户端分片，代理分片，服务端分片&lt;/p&gt;
&lt;h2 id=&#34;九-系统架构设计&#34;&gt;九、系统架构设计&lt;/h2&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;p&gt;2.软件架构设计的生命周期：需求分析阶段，设计阶段，构件组装阶段，部署阶段，后开发阶段。&lt;/p&gt;
&lt;p&gt;3.软件架构的重要性：满足系统的品质，与受益人达成一致的目标，支持计划编制，对系统开发有指导性，有效地管理复杂性，为复用奠定基础，降低维护费用，支持冲突分析&lt;/p&gt;
&lt;p&gt;4.C2 风格：通过连接件连接构件或某个构件组。&lt;/p&gt;
&lt;p&gt;5.特定领域软件架构 DSSA 的建立过程：定义领域范围，定义领域特定元素，定义领域特定的设计和实现。DSSA 的建立过程是并发的，递归的，反复的螺旋模型。&lt;/p&gt;
&lt;p&gt;6.三层 CS 模式：瘦客户端模式。分为表示层（用户接口与应用逻辑层交互），功能层（业务逻辑）和数据层。&lt;/p&gt;
&lt;h2 id=&#34;十-系统质量属性与架构评估&#34;&gt;十、系统质量属性与架构评估&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/10.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 10: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.SAAM（Software Architecture Analysis method）：软件架构分析方法&lt;/p&gt;
&lt;p&gt;2.ATAM（Architecture Tradeoff Analysis method）：架构权衡分析法&lt;/p&gt;
&lt;p&gt;3.ATAM 分为：演示和调查阶段，调查和分析阶段，测试阶段，报告阶段&lt;/p&gt;
&lt;p&gt;4.SAAM 和 ATAM 的对比各有所长。&lt;/p&gt;
&lt;p&gt;5.CBAM：（Cost Benefit Analysis Method）：成本效益分析法&lt;/p&gt;
&lt;p&gt;6.其它评估方法：SEAM，SAABNet，SACMM，SASAM，ALRRA，AHP，COSMIC+UML 方法&lt;/p&gt;
&lt;h2 id=&#34;十一-软件可靠性基础知识&#34;&gt;十一、软件可靠性基础知识&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/11.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 11: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;十二-软件架构的演化和维护&#34;&gt;十二、软件架构的演化和维护&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/12.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 12: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;十三-未来信息综合技术&#34;&gt;十三、未来信息综合技术&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/13.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 13: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.边缘计算：将数据的处理，应用程序的运行以及一些功能服务的实现，由网络中心下放到网络边缘结点上。&lt;/p&gt;
&lt;p&gt;2.云计算的服务方式有：SaaS，PaaS，IaaS&lt;/p&gt;
&lt;h2 id=&#34;十四-系统规划-不重要&#34;&gt;十四、系统规划（不重要）&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/14.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 14: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;十五-信息系统架构设计理论与实践&#34;&gt;十五、信息系统架构设计理论与实践&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/15.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 15: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.TOGAF：（The Open Group 组织）架构框架&lt;/p&gt;
&lt;p&gt;2.ISA：信息系统架构&lt;/p&gt;
&lt;p&gt;3.信息化工程总体归化方法主要有：CSF（关键成功因素法 Critical Success Factors），战略目标集转化法（Strategy Set
Transformation，SST），企业系统规划法（Business System Planning，BSP，自上而下的识别系统目标）&lt;/p&gt;
&lt;h2 id=&#34;十六-层次式架构设计理论与实践&#34;&gt;十六、层次式架构设计理论与实践&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/16.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 16: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.表现层的框架设计：MVC，MVP，MVVM&lt;/p&gt;
&lt;p&gt;2.中间层的框架设计：&lt;/p&gt;
&lt;p&gt;3.数据访问层设计：在线访问，DAO，DTO（Data Transfer Object），离线数据模式，对象/关系映射方式&lt;/p&gt;
&lt;p&gt;4.数据架构均由规划与设计：与类的设计融合，与 XML 的设计融合&lt;/p&gt;
&lt;p&gt;5.物联网层次架构设计：感知层，网络层，应用层&lt;/p&gt;
&lt;p&gt;6.事务处理设计：ACID 原则，即 Atomicity，Consistency，Isolution，Durability&lt;/p&gt;
&lt;h2 id=&#34;十七-云原生架构设计理论与实践&#34;&gt;十七、云原生架构设计理论与实践&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/17.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 17: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.云原生的原则：服务化，弹性，可观测，韧性，所有过程自动化，零信任，架构持续演进&lt;/p&gt;
&lt;p&gt;2.主要架构模式：服务化架构，Mesh 化架构，Serverless 模式，存储计算分离模式，分布式事务模式，可观测架构模式，事件驱动架构模式（EDA，Event Driven Architecture）&lt;/p&gt;
&lt;p&gt;3.反例：庞大的单体应用，“硬拆”为微服务，缺乏自动能力。&lt;/p&gt;
&lt;p&gt;4.无服备的技术特点：全拖管的计算服务，通用性，自动弹性伸缩，按量计费&lt;/p&gt;
&lt;p&gt;5.Service Mesh：服务网格，将微服务之间的连接，安全，流量控制和可观测等通用功能下沉为平台基础设施。&lt;/p&gt;
&lt;h2 id=&#34;十八-面向服务架构设计理论&#34;&gt;十八、面向服务架构设计理论&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/18.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 18: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.SOA 与微服务的区别：微服务相比于 SOA 更加精细；微服务提供的接口更加通用化；微服务更加倾向于分布式去中心化的部署方式。&lt;/p&gt;
&lt;p&gt;2.SOA 的参考架构：Websphere 架构包含业务逻辑服务，控制服务，连接服务，业务创新和优化服务，开发服务，IT 服务。&lt;/p&gt;
&lt;p&gt;3.SOA 主要协议和规范：UDDI（Universal Description，Discovery and Integration） 协议，WSDL（Web Service
Description Language），SOAP（Simple Object Access Protocol），REST 规范。&lt;/p&gt;
&lt;p&gt;4.REST：Representional State Transfer（代表性的状态转换），它强调使用标准的 HTTP 方法进行资源的操作和交互。&lt;/p&gt;
&lt;p&gt;5.SOA 设计的标准要求：文档化标准，通信协议标准，应用程序统一登记与集成，服务质量。&lt;/p&gt;
&lt;p&gt;6.SOA 的设计模式：服务注册表模式，企业服务总线模式，微服务模式，微服务架构模式方案&lt;/p&gt;
&lt;p&gt;7.微服务架构面临的问题与挑点战：服务发现与服务调用的跟踪变得困难；很难实现与传统数据库的强一致性，转而追求最终的一致性。&lt;/p&gt;
&lt;p&gt;8.SOA 的原则：无状态，单一实例，明确定义的接口，自包含和模块化，粗粒度，服务之间松耦合，重用能力，互操作性、兼容和策略声明。&lt;/p&gt;
&lt;h2 id=&#34;十九-嵌入式系统软件&#34;&gt;十九、嵌入式系统软件&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/19.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 19: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.单调速率：（Rate Monotonic Scheduling，RMS），就是按照执行速度的快慢来排序，这种方法被认为是最优的。&lt;/p&gt;
&lt;p&gt;2.DARTS：（Design Approach for Real-Time System），实时系统设计方法。&lt;/p&gt;
&lt;p&gt;3.GEMESYS：（Generic Embedded System），面向安装攸关系统的跨领域系统架构。&lt;/p&gt;
&lt;h2 id=&#34;二十-通信系统架构设计理论与实践&#34;&gt;二十、通信系统架构设计理论与实践&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/20.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 20: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.局域网网络架构类型：单核心架构，双核心架构，环型架构，层次型架构。&lt;/p&gt;
&lt;p&gt;2.广域网网络架构：单核心架构，双核心架构，半/全冗余架构，对等子域架构，层次子域架构&lt;/p&gt;
&lt;p&gt;3.存储网络架构：DAS（Direct Attached Storage），NAS（Network Attached Storage），SAN（Storage Area Storage）&lt;/p&gt;
&lt;p&gt;4.IPv4 和 IPv6 两种共存的技术：双协议栈，隧道技术（ISATAP，6to4，over6，6over4），地址翻译技术。&lt;/p&gt;
&lt;h2 id=&#34;二十一-安全架构设计理论与实践&#34;&gt;二十一、安全架构设计理论与实践&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/21.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 21: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.WPDRRC 信息安全模型：预警，保护，检测，响应，恢复，反击（Counterattack）。三个要素是：人员，策略，技术。&lt;/p&gt;
&lt;p&gt;2.典型安全模型：状态机模型，BLP（人名，机密性） 模型，Biba （完整性）模型，CWM（人名）模型，Chinese Wall 模型&lt;/p&gt;
&lt;p&gt;3.CWM：包含主体，程序，客体；权限分离原则；具有审计能力。用于银行和金融机构。&lt;/p&gt;
&lt;p&gt;4.OSI/RM 信息安全架构：多点防御技术，分层防御技术，支撑性基础设施&lt;/p&gt;
&lt;p&gt;5.信息安全的架构还有：认证框架，访问控制框架，机密性框架，完整性框架，抗抵赖框架。&lt;/p&gt;
&lt;p&gt;6.数据库完整性设计原则：依据完整性约束类型设计其实现的系统层次和方式并考虑性能，尽可能应用实体完整性约束和引用完整性约束，慎用触发器，制定并使用完整性约束命名规范，测试数据库完整性，设置数据库团队，使用 CASE 工具&lt;/p&gt;
&lt;h2 id=&#34;二十二-大数据架构设计理论与实践&#34;&gt;二十二、大数据架构设计理论与实践&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/22.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 22: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.传统数据库数据量增大的处理方法：增加异步处理队列，建立数据库水平分区，建立数据库分片或重新分片，引入读写分离技术，引入分库分表技术&lt;/p&gt;
&lt;p&gt;2.现代大数据处理技术：基于分布式文件系统的 Hadoop；使用 Map/Reduce 或 Spark 数据处理技术；使用 Kafka 数据传输消息队列及 Avro 二进制格式。&lt;/p&gt;
&lt;p&gt;3.典型的大数据架构有：Lambda 架构，Kappa 架构&lt;/p&gt;
&lt;p&gt;4.Lambda 架构：同时处理离线和实时数据的，可容错的，可扩展的分布式系统。&lt;/p&gt;
&lt;p&gt;5.Lambda 分层：批处理层，加速层，服务层。&lt;/p&gt;
&lt;p&gt;6.Kappa 架构：去掉了 Lambda 架构的 Batch Layer。包含实时层和服务层。&lt;/p&gt;
&lt;p&gt;7.Lambda 依赖 Hadoop、Spark、Storm 技术。&lt;/p&gt;
&lt;p&gt;8.Kappa 偏流式计算，依赖 Flink 计算引擎。&lt;/p&gt;
&lt;p&gt;9.Impala 和 Hive 是分布式 Sql 的前端&lt;/p&gt;
&lt;p&gt;10.Flume 是通用的数据收集和传输系统。&lt;/p&gt;
&lt;h2 id=&#34;二十三-知识产权-略&#34;&gt;二十三、知识产权（略）&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/23.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 23: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;二十四-应用数学&#34;&gt;二十四、应用数学&lt;/h2&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/24.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 24: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;1.最小生成树：克鲁斯卡尔算法&lt;/p&gt;
</description>
        </item>
        <item>
        <title>使用perf和flamegraph来分析bug</title>
        <link>https://guolongji.xyz/post/use-perf-and-flame-graph/</link>
        <pubDate>Tue, 24 Oct 2023 15:32:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/use-perf-and-flame-graph/</guid>
        <description>&lt;p&gt;感谢晓哥原创，此处记录，并做一个 bug 的分析记录。&lt;/p&gt;
&lt;h2 id=&#34;什么是-perf&#34;&gt;什么是 perf？&lt;/h2&gt;
&lt;p&gt;perf 工具可以用于分析内核和用户态进程的性能，它提供了一种强大的性能分析工具，可以帮助开发人员诊断和优化系统性能问题。&lt;/p&gt;
&lt;p&gt;在 Linux 系统中，perf 工具使用了 Linux 内核中的性能计数器和跟踪事件机制，可以对内核和用户态进程进行性能分析。具体来说，perf 工具可以用于以下方面的性能分析：&lt;/p&gt;
&lt;p&gt;1.内核性能分析：perf 工具可以使用内核性能计数器和跟踪事件机制，对内核进行性能分析。例如，可以使用 perf 工具分析内核函数的执行时间、中断处理程序的响应时间、系统调用的执行时间等。此外，perf 工具还可以对内核事件进行跟踪和分析，如 CPU 使用率、内存使用情况、磁盘 I/O、网络流量等。&lt;/p&gt;
&lt;p&gt;2.用户态进程性能分析：perf 工具也可以用于对用户态进程进行性能分析。例如，可以使用 perf 工具分析进程的 CPU 使用率、内存使用情况、磁盘 I/O、网络流量等。此外，perf 工具还可以对进程的函数调用进行跟踪和分析，以便查找性能瓶颈和优化代码。&lt;/p&gt;
&lt;p&gt;总之，perf 工具可以用于分析内核和用户态进程的性能，它提供了一种强大的性能分析工具，可以帮助开发人员诊断和优化系统性能问题。&lt;/p&gt;
&lt;p&gt;系统级性能优化通常包括两个阶段：性能剖析( performance profiling )和代码优化。性能剖析的目标是寻找性能瓶颈，查找引发性能问题的原因及热点代码。代码优化的目标是针对具体性能问题而优化代码或编译选项，以改善软件性能。本篇主要讲性能分析中常用的工具 ——perf 。&lt;/p&gt;
&lt;p&gt;Perf 全名是 Performance Event ，是在 Linux 2.6.31 以后内建的系统效能分析工具，依靠 perf ，应用程式可以利用
PMU (Performance Monitoring Unit)， tracepoint 和核心内部的特殊计数器 (counter) 来进行统计，另外还能同时分析运行中的核心程式码，从而更全面了解应用程式中的效能瓶颈。&lt;/p&gt;
&lt;p&gt;Perf 可以解决高级性能和故障排除，它可以分析 :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;为什么内核消耗 CPU 高 ， 代码的位置在哪里？&lt;/li&gt;
&lt;li&gt;什么代码引起了 CPU 2 级 cache 未命中？&lt;/li&gt;
&lt;li&gt;CPU 是否消耗在内存 I/O 上？&lt;/li&gt;
&lt;li&gt;哪些代码分配内存，分配了多少？&lt;/li&gt;
&lt;li&gt;什么触发了 TCP 重传？&lt;/li&gt;
&lt;li&gt;某个内核函数是否正在被调用，调用频率多少？&lt;/li&gt;
&lt;li&gt;线程释放 CPU 的原因？&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;perf-的原理&#34;&gt;perf 的原理&lt;/h2&gt;
&lt;p&gt;性能计数器是现代 CPU 中一些特殊的硬件寄存器。这些寄存器对特定的硬件事件进行计数：比如指令的执行， cache miss 或者是分支预测错误等，同时不会对内核或应用的性能产生影响。这些寄存器中的内容可以被定期收集，同时这些寄存器也可以在特定的事件数量超过一定数值时触发中断。而在这些中断中，特定的事件数量被记录，并在应用层需要时返回这些数据。这样，使得开发者能够收集代码执行过程中某些事件比如 cache miss ，内存引用以及 CPU clock 或 cycle 等的相关信息，并使得开发者能够根据它们来判断代码的运行情况及其原因。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;详⻅ CPU PMU 文档&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;perf-event&#34;&gt;perf event&lt;/h2&gt;
&lt;p&gt;利用 CPU performance counters( 性能计数器 ) ， tracepoints， kprobes 和 uprobes 来进行应用程序的性能分析。 perf 使用这些 linux 内核提供的 tracing 特性进行事件的采集和分析， perf 使用的 event 主要有以下几种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hardware Events： CPU 中的寄存器含有 performance counters( 性能计数器 ) ,用来统计&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Hardware event ,例如 cpu-cycles 、 instructions executed 、 cache-misses 、 branch
mispredicted 等。这些 event 构成了应用程序 profiling 的基础。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Software Events： 基于内核计数器的低优先级 events , 例如 , CPU migrations( 处理器迁移次数 ),&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;minor faults(soft page faults), major faults(hard page faults).&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tracepoints：是散落在内核源代码中的一些 hook ,用来调用 probe 函数,开启后,它们便可以在&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;特定的代码被运行到时被触发,这一特性可以被各种 trace/debug 工具所使用。 Perf 就是该特性的用戶之一。假如您想知道在应用程序运行期间,内核内存管理模块的行为,便可以利用潜伏在
slab 分配器中的 tracepoint 。当内核运行到这些 tracepoint 时,便会通知 perf 。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Dynamic Tracing : probe 函数 ( 探针 or 探测函数 ) , kprobe(kernel probe) 内核态探针,用来创建&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;和管理内核代码中的探测点。 Uprobes , user-probe ,用戶态探针,用来对用戶态应用程序进行探测点的创建和管理。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231024_155057.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;perf-的使用&#34;&gt;perf 的使用&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;安装&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;sudo apt install linux-perf&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;查看版本&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;perf &amp;ndash;version&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;perf 是一个包含 23 个工具&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;序号&lt;/th&gt;
&lt;th&gt;命令&lt;/th&gt;
&lt;th&gt;作用&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;annotate&lt;/td&gt;
&lt;td&gt;解析 perf record 生成的 perf.data 文件，显示被注释的代码。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;archive&lt;/td&gt;
&lt;td&gt;根据数据文件记录的 build-id ，将所有被采样到的 elf 文件打包。利用此压缩包,可以再任何机器上分析数据文件中记录的采样数据。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;bench&lt;/td&gt;
&lt;td&gt;perf 中内置的 benchmark，目前包括两套针对调度器和内存管理子系统的 benchmark。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;build-id-cache&lt;/td&gt;
&lt;td&gt;管理 perf 的 buildid 缓存，每个 elf 文件都有一个独一无二的 buildid 。 buildid 被 perf 用来关联性能数据与 elf 文件。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;build-id-list&lt;/td&gt;
&lt;td&gt;列出数据文件中记录的所有 buildid 。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;diff&lt;/td&gt;
&lt;td&gt;对比两个数据文件的差异。能够给出每个符号(函数)在热点分析上的具体差异。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;evlist&lt;/td&gt;
&lt;td&gt;列出数据文件 perf.data 中所有性能事件。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;inject&lt;/td&gt;
&lt;td&gt;该工具读取 perf record 工具记录的事件流,并将其定向到标准输出。在被分析代码中的任何一点,都可以向事件流中注入其它事件。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;kmem&lt;/td&gt;
&lt;td&gt;针对内核内存( slab )子系统进行追踪测量的工具&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;kvm&lt;/td&gt;
&lt;td&gt;用来追踪测试运行在 KVM 虚拟机上的 Guest OS 。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;list&lt;/td&gt;
&lt;td&gt;列出当前系统支持的所有性能事件。包括硬件性能事件、软件性能事件以及检查点。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;lock&lt;/td&gt;
&lt;td&gt;分析内核中的锁信息,包括锁的争用情况,等待延迟等。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;13&lt;/td&gt;
&lt;td&gt;mem&lt;/td&gt;
&lt;td&gt;内存存取情况&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;record&lt;/td&gt;
&lt;td&gt;收集采样信息,并将其记录在数据文件中。随后可通过其它工具对数据文件进行分析。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;report&lt;/td&gt;
&lt;td&gt;读取 perf record 创建的数据文件,并给出热点分析结果。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;sched&lt;/td&gt;
&lt;td&gt;针对调度器子系统的分析工具。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;17&lt;/td&gt;
&lt;td&gt;script&lt;/td&gt;
&lt;td&gt;执行 perl 或 python 写的功能扩展脚本、生成脚本框架、读取数据文件中的数据信息等。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;stat&lt;/td&gt;
&lt;td&gt;执行某个命令,收集特定进程的性能概况,包括 CPI 、 Cache 丢失率等。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;td&gt;test&lt;/td&gt;
&lt;td&gt;perf 对当前软硬件平台进行健全性测试,可用此工具测试当前的软硬件平台是否能支持 perf 的所有功能。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;timechart&lt;/td&gt;
&lt;td&gt;针对测试期间系统行为进行可视化的工具&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;top&lt;/td&gt;
&lt;td&gt;类似于 linux 的 top 命令,对系统性能进行实时分析。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;22&lt;/td&gt;
&lt;td&gt;trace&lt;/td&gt;
&lt;td&gt;关于 syscall 的工具。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;td&gt;probe&lt;/td&gt;
&lt;td&gt;用于定义动态检查点。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;ul&gt;
&lt;li&gt;perf 的全局命令&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;perf list：查看当前系统支持的性能事件;&lt;/p&gt;
&lt;p&gt;perf bench：对系统性能进行摸底;&lt;/p&gt;
&lt;p&gt;perf test：对系统进行健全性测试;&lt;/p&gt;
&lt;p&gt;perf stat：对全局性能进行统计;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;perf list&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;选项列出了所有的符号事件类型,包括硬件、软件和内核事件。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231024_172717.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;可以看到事件分为三类: Hardware event 硬件事件、 Software event 软件事件和 Hardware cache event 事件。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;hw/hardware 显示支持的硬件事件相关&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;uos@guolongji:~$ perf list hw
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;List of pre-defined events (to be used in -e):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  branch-instructions OR branches                    [Hardware event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  branch-misses                                      [Hardware event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  bus-cycles                                         [Hardware event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cache-misses                                       [Hardware event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cache-references                                   [Hardware event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cpu-cycles OR cycles                               [Hardware event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  instructions                                       [Hardware event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ref-cycles                                         [Hardware event]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;sw/software 显示支持的软件事件列表&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;uos@guolongji:~$ perf list sw
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;List of pre-defined events (to be used in -e):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  alignment-faults                                   [Software event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  bpf-output                                         [Software event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  context-switches OR cs                             [Software event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cpu-clock                                          [Software event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  cpu-migrations OR migrations                       [Software event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  dummy                                              [Software event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  emulation-faults                                   [Software event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  major-faults                                       [Software event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  minor-faults                                       [Software event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  page-faults OR faults                              [Software event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  task-clock                                         [Software event]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;cache/hwcache 显示硬件 cache 相关事件列表&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;uos@guolongji:~$ perf list cache
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;List of pre-defined events (to be used in -e):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  L1-dcache-load-misses                              [Hardware cache event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  L1-dcache-loads                                    [Hardware cache event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  L1-dcache-prefetch-misses                          [Hardware cache event]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  L1-dcache-prefetches                               [Hardware cache event]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;perf-stat&#34;&gt;perf stat&lt;/h2&gt;
&lt;p&gt;执行命令期间执行指定命令并计算发生的事件,并在三列中显示这些计数的统计信息:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;给定事件的出现次数&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;所计算的事件的名称&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;当相关指标可用时,最右侧列中的 hash 符号 ( # ) 后会显示一个比率或百分比。例如,当以默认模式运行时, perf stat
计算周期和指令,因此在最右侧列中计算并显示每个周期的说明。您可以看到与分支缺少相关的类似行为,因为默认情况下这&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;两个事件都被计算为两个分支的百分比。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;root@uos-PC:/home/uos# perf stat ls
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;0001-feat-add-loongarch64-gsgpu-support.diff                  deepin-sw64-0001.patch                    libdrm         Pictures
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;0001-feat-add-loongarch64-gsgpu-support.patch                 deepin-sw64-porting-cmake.patch           libglvnd       series
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;0002-feat-build-libdrm-etnaviv1-package-on-loongarch64.patch  Desktop                                   mesa           source
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;add-loongarch-support-cmake.patch                             Documents                                 mesa23_backup  src
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;changelog                                                     Downloads                                 mesa-utils     updir
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cl.diff                                                       innogpu_2.2.b4.rev3-UOS_amd64.deb         Music          Videos
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;commit-msg                                                    innogpu-kernel-2.2.b4.rev3-UOS_amd64.deb  patches
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; Performance counter stats for &amp;#39;ls&amp;#39;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              0.49 msec task-clock                #    0.750 CPUs utilized
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 0      context-switches          #    0.000 K/sec
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                 0      cpu-migrations            #    0.000 K/sec
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;               103      page-faults               #    0.000 K/sec
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         1,959,599      cycles
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         1,764,610      instructions              #    0.90  insn per cycle
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;           372,897      branches                  #    0.000 K/sec
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            14,576      branch-misses             #    3.91% of all branches
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       0.000647272 seconds time elapsed
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       0.000686000 seconds user
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       0.000000000 seconds sys
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;perf-top&#34;&gt;perf top&lt;/h3&gt;
&lt;p&gt;实时查看当前系统进程函数占用率情况。&lt;/p&gt;
&lt;p&gt;线程使用的 CPU 时间, perf top 显示每个特定功能使用的 CPU 时间。在默认状态下, perf top
告知用戶空间和内核空间的所有 CPU 中使用的功能。&lt;/p&gt;
&lt;p&gt;perf top 可以用于观察系统和软件内性能开销最大的函数列表。通过观察不同事件的函数列表可以分析出不同函数的性能开销情况和特点,判断其优化方向。例如如果某个函数在 perf top -e instructions
中排名靠后,却在 perf top -e cache-misses 和 perf top -e cycles 中排名靠前,说明函数中存在大量
cache-miss 造成 CPU 资源占用较多,就可以考虑优化该函数中的内存访问次数和策略,来减少内存访问和 cache-miss 次数,从而降低 CPU 开销。&lt;/p&gt;
&lt;p&gt;在较新的内核版本中, perf top 还可以深入到函数对应的汇编指令中,明确指出是哪些指令占用了计算资源,可以非常明确的指明软件性能热点。&lt;/p&gt;
&lt;p&gt;执行 perf top 显示如下：&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231025_134420.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;监控界面在几个列中显示数据:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;ldquo;Overhead&amp;rdquo; 列&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;显示给定功能正在使用的 CPU 百分比。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;quot; 共享对象 &amp;quot; 列&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;显示使用 函数的程序或库的名称。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;ldquo;Symbol&amp;rdquo; 列&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;显示函数名称或符号。内核空间中执行的功能由 [k] 标识,用戶空间执行的功能由 [.] 标识。&lt;/p&gt;
&lt;p&gt;查看具体进程用： perf top -p 16279&lt;/p&gt;
&lt;h3 id=&#34;perf-probe&#34;&gt;perf probe&lt;/h3&gt;
&lt;p&gt;自定义动态事件&lt;/p&gt;
&lt;h3 id=&#34;perf-特定功能分析&#34;&gt;perf 特定功能分析&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;perf kmem 针对 slab 子系统性能分析&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;perf kvm 针对 kvm 虚拟化分析&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;perf lock 分析锁性能&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;perf mem 分析内存 slab 性能&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;perf sched 分析内核调度器性能&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;perf trace 记录系统调用轨迹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;perf-record&#34;&gt;perf record&lt;/h2&gt;
&lt;p&gt;The perf tool can be used to collect profiles on per-thread, per-process and per-cpu
basis.There are several commands associated with sampling: record , report , annotate . You
must first collect the samples using perf record . This generates an output file called
perf.data . That file can then be analyzed, possibly on another machine, using the perf report
and perf annotate commands.&lt;/p&gt;
&lt;p&gt;perf 工具可用于收集每个线程、每个进程和每个 CPU 上的基础轮廓。有几个与采样相关的命令：record、report、annotate。你必须首先使用 perf record 收集样本。这将生成一个名为性能数据 .然后可以使用 perf report 分析该文件，可能在另一台计算机上进行分析和性能注释命令。&lt;/p&gt;
&lt;p&gt;perf record 参数说明：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;-a: 全局的 CPU 栈函数跟踪;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在被监控 CPU 上的所有线程中同时使用 perf record 在每个 CPU 模式中对用戶空间和内核空间的性能数据进行抽样和记录。默认情况下,按 CPU 模式监控所有在线 CPU 。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;-o: 指定输出文件;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;-F: 事件采样的频率 , 单位 HZ, 更高的频率会获得更细的统计,但会带来更多的开销;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;-g: 进行堆栈追踪,生成调用关系图,等价于 –call-graph , 默认情况下, -g 等同于 –call-graph fp ,&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;即通过 frame pointer 来进行堆栈追踪。 如果 frame pointer 被优化掉的话,可以通过 dwarf, lbr 进行堆栈追踪;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;ndash; sleep: 采样的时间&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;perf record -F &lt;span style=&#34;color:#bd93f9&#34;&gt;99&lt;/span&gt; -p &lt;span style=&#34;color:#bd93f9&#34;&gt;2338&lt;/span&gt; -g -- sleep &lt;span style=&#34;color:#bd93f9&#34;&gt;30&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;表示每秒 99 次, -p 2338 是进程号,即对哪个进程进行分析, -g 表示记录调用栈, sleep 30 则是持续 30 秒。&lt;/p&gt;
&lt;h2 id=&#34;perf-report&#34;&gt;perf report&lt;/h2&gt;
&lt;p&gt;perf report -i perf.data&lt;/p&gt;
&lt;h2 id=&#34;可视化工具&#34;&gt;可视化工具&lt;/h2&gt;
&lt;p&gt;参考：&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/oujiangping/article/details/78454881&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/oujiangping/article/details/78454881&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;thread&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;test&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; i &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;while&lt;/span&gt;(i &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;5000000000&lt;/span&gt;) i&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    std&lt;span style=&#34;color:#ff79c6&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;thread&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;th[&lt;span style=&#34;color:#bd93f9&#34;&gt;12&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; i &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;12&lt;/span&gt;; i&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        th[i] &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;new&lt;/span&gt; std&lt;span style=&#34;color:#ff79c6&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;thread&lt;/span&gt;(test);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; i &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;12&lt;/span&gt;; i&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        th[i]&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;join();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;delete&lt;/span&gt; th[i];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;./thread&lt;/p&gt;
&lt;p&gt;新的终端下运行：&lt;/p&gt;
&lt;p&gt;sudo perf timechart record&lt;/p&gt;
&lt;p&gt;几秒后 ctl+c 中断&lt;/p&gt;
&lt;p&gt;sudo perf timechart&lt;/p&gt;
&lt;p&gt;结果输出在 output.svg 当中。&lt;/p&gt;
&lt;h2 id=&#34;linux-内核中的-perf-event-子系统&#34;&gt;linux 内核中的 perf event 子系统&lt;/h2&gt;
&lt;p&gt;PMU (Performance Monitoring Unit) 是一种硬件组件，通常集成在现代处理器中，用于监测和记录处理器的性能指标和事件。&lt;/p&gt;
&lt;p&gt;PMU 可以提供大量的性能计数器，用于度量处理器的各种指标，如指令执行数、缓存命中率、分支预测错误次数等。通过配置和读取这些计数器，开发人员可以获取有关程序执行的详细性能数据，以便进行性能分析和优化。&lt;/p&gt;
&lt;p&gt;PMU 还可以监测处理器的事件，如缓存失效、分支预测错误、TLB (Translation Lookaside Buffer) 错误等。这些事件可以帮助开发人员了解程序执行期间发生的异常情况，并进行故障诊断和性能调优。&lt;/p&gt;
&lt;p&gt;PMU 的功能和特性因处理器而异，不同的处理器可能提供不同数量和类型的性能计数器，支持不同的事件监测。为了使用
PMU，开发人员通常需要使用特定的性能分析工具，如 perf、PAPI (Performance Application Programming Interface)
等，这些工具提供了对 PMU 的抽象接口和高级功能，使开发人员能够方便地进行性能分析和优化。&lt;/p&gt;
&lt;p&gt;总结来说，PMU 是一种硬件组件，用于监测和记录处理器的性能指标和事件。它提供性能计数器和事件监测功能，可以帮助开发人员获取有关程序执行的详细性能数据，并进行性能分析和优化。&lt;/p&gt;
&lt;p&gt;网上有很多 perf 架构的博客，等我有时间了有兴趣了再详细看代码，大多数时候会用就可以了：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/pwl999/article/details/81200439&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/pwl999/article/details/81200439&lt;/a&gt;&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231025_143049.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231025_143339.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;1000&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 1: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;perf 子系统架构图&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;火焰图&#34;&gt;火焰图&lt;/h2&gt;
&lt;p&gt;火焰图( Flame Graph )是由 Linux 性能优化大师 Brendan Gregg 发明的,和所有其他的 profiling
方法不同的是,火焰图以一个全局的视野来看待时间分布,它从底部往顶部,列出所有可能导致性能瓶颈的调用栈。&lt;/p&gt;
&lt;p&gt;火焰图是基于 perf 结果产生的 SVG 图片,用来展示 CPU 的调用栈。&lt;/p&gt;
&lt;p&gt;命令行：sudo perf report -n &amp;ndash;stdio&lt;/p&gt;
&lt;p&gt;也能看到比较直观的内容。更直观的只能是火焰图。&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231025_145008.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;1000&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 2: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;火焰图示例&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;一列 box 代表一个 stack trace ,每个 box 代表一个 stack frame 。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;x 轴表示抽样数,如果一个函数在 x 轴占据的宽度越宽,就表示它被抽到的次数多,即执行的时间&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;⻓。注意, x 轴不代表时间,而是所有的调用栈合并后,按字母顺序排列的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;y 轴表示调用栈,每一层都是一个函数。调用栈越深,火焰就越高,顶部就是正在执行的函数,下&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;方都是它的父函数。&lt;/p&gt;
&lt;p&gt;火焰的每一层都会标注函数名,鼠标悬浮时会显示完整的函数名、抽样抽中的次数、占据总抽样次数的百分比。火焰图就是看顶层的哪个函数占据的宽度最大。只要有 &amp;quot; 平顶 &amp;quot; ( plateaus ),就表示该函数可能存在性能问题。&lt;/p&gt;
&lt;p&gt;常⻅的火焰图类型有 On-CPU , Off-CPU ,还有 Memory , Hot/Cold , Differential 等等。&lt;/p&gt;
&lt;p&gt;比较长的延时我认为一定是能通过 perf 这个工具来分析的。那么怎么分析呢？&lt;/p&gt;
&lt;p&gt;操作：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;点击放大&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在某一层点击,火焰图会水平放大,该层会占据所有宽度,显示详细信息。左上⻆会同时显示 &amp;ldquo;Reset Zoom&amp;rdquo; ,点击该链接,图片就会恢复原样。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;搜索&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;按下 Ctrl + F 会显示一个搜索框,用戶可以输入关键词或正则表达式,所有符合条件的函数名会高亮显示。&lt;/p&gt;
&lt;h3 id=&#34;使用过程&#34;&gt;使用过程&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;可视化生成器&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;git clone &lt;a class=&#34;link&#34; href=&#34;https://github.com/brendangregg/FlameGraph.git&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/brendangregg/FlameGraph.git&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;采集数据&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;perf record -p pid -g &amp;ndash; sleep 30&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;读取数据&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;perf report -n --stdio &lt;span style=&#34;color:#6272a4&#34;&gt;# 读取 perf.data 并显示百分比等&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;perf script --header   &lt;span style=&#34;color:#6272a4&#34;&gt;# 显示 perf.data 的所有事件的数据头&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;生成火焰图&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;perf script -i perf.data &amp;amp;&amp;gt; perf.unfold
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./FlameGraph/stackcollapse-perf.pl perf.unfold &amp;amp;&amp;gt; perf.folded
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./FlameGraph/flamegraph.pl perf.folded &amp;gt; perf.svg
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;通过 chrome 或者看图软件打开 perf.svg 。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用脚本从写一下：&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;DIR&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;/your-path/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo perf record -F &lt;span style=&#34;color:#bd93f9&#34;&gt;99&lt;/span&gt; -p &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$1&lt;/span&gt; -g -- sleep &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo perf script -i perf.data &amp;gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DIR&lt;/span&gt;/cpu.perf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./FlameGraph/stackcollapse-perf.pl &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DIR&lt;/span&gt;/cpu.perf &amp;gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DIR&lt;/span&gt;/cpu.folded
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./FlameGraph/flamegraph.pl &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DIR&lt;/span&gt;/cpu.folded &amp;gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DIR&lt;/span&gt;/cpu1.svg
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;linux-用户切换过程偶发的黑屏切换缓慢问题&#34;&gt;linux 用户切换过程偶发的黑屏切换缓慢问题&lt;/h2&gt;
&lt;p&gt;这个问题是在 A 卡的 oland 系列的显卡上出现的一个小问题。因为涉及到 DE，lightdm，dbus，kernel，显卡驱动多方面的因素。所以分析起来没什么头绪。&lt;/p&gt;
&lt;p&gt;一个想法是用 perf 记录所有的调用过程，这样是不是能找到最耗时的地方。&lt;/p&gt;
&lt;p&gt;perf record -a -F 99 -o perf.data&lt;/p&gt;
&lt;p&gt;使用 -a 参数会报 VDSO 还有其它很多的包没有 symbols。perf report -s 可以增加 symbol。直接用-a 参数是无法分析的。&lt;/p&gt;
&lt;p&gt;切换这个过程涉及到哪些程序呢？&lt;/p&gt;
&lt;h2 id=&#34;参考博客&#34;&gt;参考博客&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://queue.acm.org/detail.cfm?id=2927301&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://queue.acm.org/detail.cfm?id=2927301&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://perf.wiki.kernel.org/index.php/Main_Page&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://perf.wiki.kernel.org/index.php/Main_Page&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://perf.wiki.kernel.org/index.php/Tutorial&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://perf.wiki.kernel.org/index.php/Tutorial&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/arnoldlu/p/6241297.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.cnblogs.com/arnoldlu/p/6241297.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://walkerdu.com/2018/09/13/perf-event/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://walkerdu.com/2018/09/13/perf-event/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://pingcap.com/zh/blog/flame-graph&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://pingcap.com/zh/blog/flame-graph&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.brendangregg.com/perf.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.brendangregg.com/perf.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://github.tiankonguse.com/blog/2016/03/29/perf-record.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://github.tiankonguse.com/blog/2016/03/29/perf-record.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.ruanyifeng.com/blog/2017/09/flame-graph.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.ruanyifeng.com/blog/2017/09/flame-graph.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://jasonblog.github.io/note/linux_tools/xi_tong_ji_xing_neng_fen_xi_gong_ju__perf.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://jasonblog.github.io/note/linux_tools/xi_tong_ji_xing_neng_fen_xi_gong_ju__perf.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.collabora.com/news-and-blog/blog/2017/03/21/performance-analysis-in-linux/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.collabora.com/news-and-blog/blog/2017/03/21/performance-analysis-in-linux/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://liujunming.top/2018/05/10/perf%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://liujunming.top/2018/05/10/perf%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>王勇绐我的一些启示</title>
        <link>https://guolongji.xyz/post/wangyong-prose/</link>
        <pubDate>Thu, 19 Oct 2023 16:07:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/wangyong-prose/</guid>
        <description>&lt;p&gt;王勇的经历绐我的一点启示：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/58e5af6149f6&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.jianshu.com/p/58e5af6149f6&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;王勇只比我大四岁，早年父母离婚，高中毕业参加工作。一年多的时间通过 emacs 学习到了很多的开源技术。在 emacs 的 IRC  freenode 和 Libera Chat 频道学习到了很多的开源技术。一起写了 auto complete 这种插件。早期从各类杂志和 emacs 中学习到开源技术。这个能力大部分人都是不具备的。&lt;/p&gt;
&lt;p&gt;他作为 deepin 的前辈为 deepin 做出了很大的贡献，看得出之前的 deepin 的开源社区十分活跃。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.youtube.com/watch?v=UCIp2mY5Qyk&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.youtube.com/watch?v=UCIp2mY5Qyk&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;不知道现在这种 IRC 频道里面的人还多不多。但是有时间可能打开看看，看看其他人都在讨论些什么问题。也许能学到很多其他书本上学不到的东西。&lt;/p&gt;
&lt;p&gt;人生真的是很复杂的，一方面我们要和时间赛跑，一方面没有良好的休息也不能持续前进。&lt;/p&gt;
&lt;p&gt;10 年 10 月，王勇提了不少的 haskell 的项目 gtk2hs 的 patch。haskell 像 emacs 一样，也是一们增加内力的无用之学。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/58e5af6149f6&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.jianshu.com/p/58e5af6149f6&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;王勇写的插件很多，但是看过他的 github 主页，写应用用 C++、python 比较多，貌似写的 c 的项目比较少。应该是对内核的工作做的比较少。因为用的是 QT，vala。我个人觉得没有自己的包管理器，没有自己的极低依赖的 UI Kit，没有内核功能追随与保证兼容性的机制，没有自研的应用开发 ide。做一个操作系统还是不够深入。比起 QT，显然 gtk 更容易安装，依赖更少。可以参考 SDL 和 gtk，用 opengl 渲染，定制更精制的桌面环境。&lt;/p&gt;
&lt;p&gt;用 QT 和 kde，是不是有点拿来主义？当然，大家都有点拿来主义。但是用 QT 就是直接省略了渲染到 UI 层次的代码，缺少了从渲染库到 ui 库的开发，用的还是 QT 提供的方式和基础设施，如果这一层出现问题，解决问题还是依赖别人，而没有完整能力的自己的开发者。系统的核心竞争力是底层的优化带来的流畅和易用性。而 QT 恰恰是流于表面。也是因为人少，不能兼顾，国产没有强大目标和强大的内心，想的是有而非更好。优化限于能用，而难更进一步的易用。如果用参考 skia、Cairo、Qt QML、OpenGL 做的各种 UI 框架，做一个真正原生的东西，那是不是可以说：就像 linux 代替了 unix，新生的 UI 代替了 gnome 和 kde 呢？&lt;/p&gt;
&lt;p&gt;更像是寄生者，硬件上支持了国产的设备驱动，但是机制上没有做到非常地独立自主。虽说不能一口吃一个胖子，但是，好的迭代规则和优化路线没有出来。相比而言，华为做的事情更多。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/manateelazycat&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/manateelazycat&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;之前在 emacs-application-framework 项目绐勇哥提过 issue，做过沟通。人的精力都是有限的，我认为 python
和 nodejs 复杂的依赖不适合在系统层面上搞一个真正易用的东西。就像 haskell 的依赖很多，依赖越多，越难用。&lt;/p&gt;
&lt;p&gt;王勇的经历对普通人来说无疑是一个传奇。对我也有很多的激励的作用。&lt;/p&gt;
&lt;p&gt;人的内心应当强大。比如，经常感觉到累，经常感觉到我不行了，坚持不下去了。但是实际上，多数情况下没有真正到放弃的时候。还有，有时候，觉得没有时间，精力有限，拖延症严重，这些的本质是内心不够强大。内心的强大是：&lt;/p&gt;
&lt;p&gt;相信我做任何事都可以做到优秀。如果选择了一条路，那就按照正确的方式去努力。累了就睡，身体弱就煅练，知识少就学。做事不拖延，不停的打起精神来，内外兼修，打铁并且自身硬。不停的告知自己不要懈殆。&lt;/p&gt;
&lt;p&gt;体材上低脂，头脑上反应迅速积累有价值的基础知识。&lt;/p&gt;
&lt;p&gt;如果能做到这样，并且 30 年如一日。那才能保证在这一世，至少能留下一点的价值，而不是浑浑噩噩，在历史中不被记下一笔。&lt;/p&gt;
&lt;p&gt;做为一个内核研发工程师，我没有像王勇那样参与开源社区问题的解决。从这一点来看，我是一个没有影响力的人。内核比较难找切入点吧。可能是没有在 IRC 上找到合适的问题深入研究并解决。&lt;/p&gt;
&lt;p&gt;尝试了一下 libera chat 这个 irc 的站，国内无法注册。难道又要花钱搞个国外的 vps 吗？&lt;/p&gt;
&lt;p&gt;很想吐槽一下，国内想和国外的技术工作者或学术工作者沟通，被 GFW 限制的太多了。强扭的瓜不甜，技术和学术有更多的容易获得知识的路径。如果一定要与外国人沟通提高效率，那最好是在地基夯劳之后。先通过其它的方式了解知识。甚到一辈子也不需要和外国友人切磋呢。&lt;/p&gt;
&lt;p&gt;低垂的果实尚为入袋，高处的果实又够不到。无人不受限制，但在有限的空间里，可以尽量长，放开长。从另一个角度来讲，此处受限，他处必有所获。&lt;/p&gt;
&lt;p&gt;放弃低价值的事，才能有精力做高价值的事。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>矩阵分析（三）</title>
        <link>https://guolongji.xyz/post/matrix-analysis-3/</link>
        <pubDate>Tue, 17 Oct 2023 15:38:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/matrix-analysis-3/</guid>
        <description>&lt;p&gt;第三章是矩阵的标准形&lt;/p&gt;
&lt;h2 id=&#34;哈密顿-卡莱定理&#34;&gt;哈密顿-卡莱定理&lt;/h2&gt;
&lt;p&gt;数学的本质就是逻辑与设定，如果你觉得反常识那是对设定理解的不深刻。如果推导的速度慢，那是逻辑能力差。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231017_164459.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;韩国考上 SKY 三所好学校的概率和中国考上 985 的概率是差不多的。在中国考上顶尖 985 或者靠竞赛上一个 985
或者是北大数学系物理系，那么科研之路就有了可能，最后读个 PHD 上岸。&lt;/p&gt;
&lt;p&gt;上面的定理非常重要。det 是 determinant 的意思，计算出行列式的结果。这个英文单词的意思是决定性因素，决定条件，也有行列式，方阵的意思。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.ldoceonline.com/dictionary/determinant&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.ldoceonline.com/dictionary/determinant&lt;/a&gt; 从网上的朗道英文词典中能够查到，这个词的真实意思，这样就理解这个词的英文内核了。&lt;/p&gt;
&lt;p&gt;什么是特征多项式？&lt;/p&gt;
&lt;p&gt;特征多项式是指将一个方阵的特征值 \(\lambda\) 带入到多项式中所得到的多项式。在线性代数中，特征多项式是一个非常重要的概念。&lt;/p&gt;
&lt;p&gt;对于一个 \(n \times n\) 的方阵 \(A\)，其特征多项式 \(P(\lambda)\) 定义为：&lt;/p&gt;
&lt;p&gt;\(P(\lambda) = det(A - \lambda I)\)&lt;/p&gt;
&lt;p&gt;其中，det(·) 表示矩阵的行列式运算，I 表示单位矩阵。&lt;/p&gt;
&lt;p&gt;特征多项式 \(P(\lambda)\) 是一个关于 \(\lambda\) 的 \(n\) 次多项式。它的每一项的系数都与原方阵 \(A\) 有关。展开特征多项式后，可以得到类似下面的形式：&lt;/p&gt;
&lt;p&gt;\(P(\lambda) = (-1)^n \lambda ^n + c_{n-1} \lambda^{n-1} + c_{n-2} \lambda^{n-2} + &amp;hellip; + c_1 \lambda + c_0\)&lt;/p&gt;
&lt;p&gt;其中 \(c_{n-1}\) 、 \(c_{n-2}\) 、&amp;hellip;、 \(c_1\) 、 \(c_0\) 是与矩阵 \(A\) 相关的常数系数。&lt;/p&gt;
&lt;p&gt;特征多项式的根（即使 \(P(\lambda) = 0\) 成立的 \(\lambda\) 值）就是原方阵 \(A\) 的特征值。&lt;/p&gt;
&lt;p&gt;特征多项式在很多应用中起着重要的作用，例如特征多项式可以用来计算矩阵的特征值和特征向量。通过求解特征多项式的根，我们可以找到方阵的特征值，进而求解对应的特征向量。特征多项式还可以在矩阵的对角化、奇异值分解等问题中发挥关键作用。&lt;/p&gt;
&lt;p&gt;总之，特征多项式是一个与方阵特征值和特征向量紧密相关的多项式，它为我们理解和应用矩阵的特征值提供了基础。&lt;/p&gt;
&lt;p&gt;wiki 上有卡莱-哈密顿定理的证明：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zh.wikipedia.org/zh-hans/%E5%87%B1%E8%90%8A%E2%80%93%E5%93%88%E5%AF%86%E9%A0%93%E5%AE%9A%E7%90%86&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zh.wikipedia.org/zh-hans/%E5%87%B1%E8%90%8A%E2%80%93%E5%93%88%E5%AF%86%E9%A0%93%E5%AE%9A%E7%90%86&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这么重要的一个定理，想自己会证明要思考的问题比较多。可以学，可以模仿。经常要跳出问题本身。这才是解决数学问题比较重要的地方。&lt;/p&gt;
&lt;p&gt;每门学科都是不容易的，因为都涉及到几个核心公式。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231109_193208.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231109_194018.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;上面这道题的求解公式非常的精彩。中国的是记公式，而不是求解公式。&lt;/p&gt;
&lt;h2 id=&#34;考点二-最小多项式&#34;&gt;考点二：最小多项式&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231109_194702.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;最不多项式，重中之重。对矩阵求导有很重要的作用。上面写的是 \((n_{i} \le k_{i})\) ,&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_172116.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;行列式的按行展开是： \((-1)^{i+j}M_{ij}\) ，其中的 \(M_{ij}\) 是原行列式的代数余子式。记一个就行了，如果想按列展开，做一下转置就行了。行列式做完转置的值与原值相等。&lt;/p&gt;
&lt;h2 id=&#34;考点三-约当标准型-jordan-标准型&#34;&gt;考点三：约当标准型（Jordan 标准型）&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_173507.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;这个是法国数学家，所以叫约当（若当）标准型。上图不清楚的地方是 \(D_{k}(\lambda)\) 。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_174150.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		data-action=&#34;zoom&#34;
	
&gt;


约当块，约当标准型。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_174431.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;就算是最聪明的人也不可能将所有的这些东西学会：&lt;/p&gt;
&lt;p&gt;参考下面这个帖子，数学专业和非专业的学生差距有多大：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.zhihu.com/question/31196397&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.zhihu.com/question/31196397&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;数学是什么，数学是符号和逻辑。所以数学的概念是无穷无尽的。只要是世上有的东西，都可以归为研究的对象，甚至这个世界上没有的东西，也可以用抽像的方法去研究。数学的目的还是为了探索和创造，这种东西。若想成功不能够没有边际的学习。人的一生就是有寿命长短的，是有边际的。所以在了解了一定的广度之后，一定要选择一个方向回归。若说之前可以有强人可以对大部分的分支都做出贡献，那是还没有经过 20 和 21 世纪的科技大爆炸。&lt;/p&gt;
&lt;p&gt;希尔伯特，冯·诺依曼，庞加莱。不是大神越来越少了。而是分支太多，没有时间理解那么多的背景问题。&lt;/p&gt;
&lt;p&gt;我对自己的定位是什么？我是一个工程师，要学会别人的理论用于解决问题。不用对理论的认识十分的深刻，但是要把有用的东西用对地方。能做到这一点也不能说是一个失败的人，也许不如自己对自己之前的要求那么高。学一点比不学一点强。任何的爱好都是有价值的，有和没有是不同的。保障生活的前提下，有追求是有好处的。希望你幸运，能从中得到足够满足自己的收获。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_203931.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_204125.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_204213.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_204732.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;出现的次数是含义就是，如果有两个 \((\lambda -1)^{2}\) 的话，对角线上再多写一个“三个 1”的块就行了。\(\lambda\) 剪的那个数就是对角线的数。约定在对角线外的值一般放在下面。&lt;/p&gt;
&lt;p&gt;最关键的，一定要充分理解的是矩阵求导部分的基础知识，这块对 AI 的重要性太大了。&lt;/p&gt;
&lt;p&gt;如果有 \(d_{4}=(\lambda-2)^{2}(\lambda-1)\) 的话，要拆成：\((\lambda-2)^{2}\) 和 \((\lambda-1)\)，一定要拆成两个，否则结果是不对的。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_211643.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;三个块可以任意组合。理论数学家为工程师提供工具。计算机的重大理论突破在数学上没有任何突破，但是有的问题会不会有呢？会的，比如平铺问题，四色问题。&lt;/p&gt;
&lt;p&gt;这个世界是相辅相成的关系。关键是找到有价值的东西，并在真正有价值的地方取得突破。认识到这一点，你就真正的豁然开朗了。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_212053.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;所有的关系都要写出来。&lt;/p&gt;
&lt;h2 id=&#34;史密斯标准型&#34;&gt;史密斯标准型&lt;/h2&gt;
&lt;p&gt;你是天才吗？不是的话，不要想着一遍就学会。无他，唯手熟尔。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_212425.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;重点，smith 标准型。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_213321.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_213653.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_214234.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;用史密斯标准型方法求解约当标准型&#34;&gt;用史密斯标准型方法求解约当标准型&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_214846.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_215120.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231114_215425.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;贪多嚼不烂，慢慢理解，有的时候慢下来总结反而是一种更快的方法。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>矩阵分析（二）</title>
        <link>https://guolongji.xyz/post/martrix-analysis-2/</link>
        <pubDate>Tue, 17 Oct 2023 09:12:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/martrix-analysis-2/</guid>
        <description>&lt;p&gt;数学往往只讲理论，不讲应用。这就很让人摸不着头脑。&lt;/p&gt;
&lt;h2 id=&#34;内积空间&#34;&gt;内积空间&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231017_092612.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;什么是内积空间（也叫准希尔伯特空间）？什么是酉空间？wiki 上的解释也太抽象了。什么是完备化？&lt;/p&gt;
&lt;p&gt;简单来说内积是对点积增加复数域的推广，内积空间就是酉空间。共轭转置是复数的概念：&lt;/p&gt;
&lt;p&gt;共轭转置是一个操作，用于将复数或矩阵中的每个元素取共轭，并进行转置。对于一个复数 a + bi，它的共轭转置为 a - bi。对于一个矩阵而言，共轭转置操作将每个元素取共轭，并将矩阵转置。&lt;/p&gt;
&lt;p&gt;以矩阵为例，设 A 是一个 m×n 复矩阵，其共轭转置记作 A*（读作&amp;quot;A dagger&amp;quot;）。通过共轭转置操作，A* 的第 i 行、第 j 列的元素是 A 的第 j 行、第 i 列元素的共轭。换句话说，如果 A 的第 i 行、第 j 列元素为 a+bi，则 A* 的第 i 行、第 j 列元素为 a-bi。&lt;/p&gt;
&lt;p&gt;共轭转置常用于复向量空间和矩阵运算中，例如定义内积、计算共轭梯度法等。它在许多数学和工程应用中发挥重要作用。&lt;/p&gt;
&lt;p&gt;内积空间（inner product space）是一种代数结构，它在数学中具有广泛的应用。一个实内积空间是一个实向量空间，配合一个称为“内积”的函数来定义向量之间的乘法。内积类似于向量的点积，但它可以定义于更一般的向量空间上，并且具有更一般的性质。&lt;/p&gt;
&lt;p&gt;内积可以看作是两个向量之间的“相似度”或“夹角”。内积空间具有许多重要的性质，包括范德蒙恒等式、柯西-施瓦茨不等式和三角不等式等。内积空间是线性代数研究的重要分支，应用广泛，例如量子力学、信号处理、数值计算、图像处理等领域。&lt;/p&gt;
&lt;p&gt;内积空间又称为准希尔伯特空间。希尔博特空间要学习泛函分析（function analysis）。代数相比于几何更加的抽象。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/ben-ben/articles/3391781.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.cnblogs.com/ben-ben/articles/3391781.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这篇文章讲得真的是特别的好啊，可惜我没有机会再学数学专业了。希尔博特空间的完备性其实就是对无穷级数的研究。这方面的研究让数学上所有函数可以用几何来表示。几何又可以通过矩阵来表示，那么，就像计算机中的函数式语言 lisp 一样。这个世界是对象（静态的），还是函数（动态的）完全取绝于看问题的角度。&lt;/p&gt;
&lt;p&gt;这个世界是啥？&lt;/p&gt;
&lt;p&gt;动与静与时间，时间到底存在吗？静态和动态本质上是一样的，那其实时间这个概念和以太有点像，可能根本就是不存在的。不是一个根本的东西。&lt;/p&gt;
&lt;p&gt;时间可能是一种约束，就像希尔伯特空间要求的无穷维中范数的收敛。在现实生活中，我们不能做的事就是改变过去，但我们可以影响未来。这是一种热力学中熵增类似的概念。有可能对于过去，这个世界是收敛的，而对于未来这个世界是发散的。&lt;/p&gt;
&lt;p&gt;泛函分析已经成为现代数学的重要支柱之一。看完了这些东西，理解上面的 B 站中的概念就十分地简单了。线性代数的理解好像也豁然开朗了。&lt;/p&gt;
&lt;h2 id=&#34;标准正交积&#34;&gt;标准正交积&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231017_111601.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;schmidt，英文的单词也要懂。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231017_112239.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231017_112654.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;正规矩阵&#34;&gt;正规矩阵&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231017_112817.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;上图中的 \(A^{H}\) 为 \(A\) 的共轭矩阵。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;酉矩阵&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;酉：单一的，统一的。unitary，集权的，单一自治的。拉丁字母 U 来表示。所以中文的这个酉字用的还是很好的。音，义两方面都是“达”的。&lt;/p&gt;
&lt;p&gt;在线性代数中，幺正矩阵（又译作幺正矩阵，英语：unitary matrix）指其共轭转置恰为其逆矩阵的复数方阵，数学描述如下：&lt;/p&gt;
&lt;p&gt;（数学定义）:&lt;/p&gt;
&lt;p&gt;\({\displaystyle U^{*}U=UU^{*}=I_{n}}\)&lt;/p&gt;
&lt;p&gt;其中 \(U^{*}\) 是 \(U\) 的共轭转置， \(I_{n}\)  是 \(n\times n\) 单位矩阵。&lt;/p&gt;
&lt;p&gt;幺正矩阵是正交矩阵（元素均为实数）在复数的推广。
&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231017_114335.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		data-action=&#34;zoom&#34;
	
&gt;

&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;对角矩阵（Diagonal Matrix）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;就是只有对角线上有非零元素。&lt;/p&gt;
&lt;p&gt;\[
\notag
\left [ \begin{matrix}
a&amp;amp; 0&amp;amp; 0 \\
0&amp;amp; b&amp;amp; 0 \\
0&amp;amp; 0&amp;amp; c
\end{matrix} \right ]
\]&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;实对称矩阵（Real Symmetric Matrix）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;\[
\notag
\left [ \begin{matrix}
a&amp;amp; b&amp;amp; c \\
b&amp;amp; d&amp;amp; e \\
c&amp;amp; e&amp;amp; f
\end{matrix} \right ]
\]&lt;/p&gt;
&lt;p&gt;是指一个方阵，它满足以下两个条件：&lt;/p&gt;
&lt;p&gt;1.矩阵的元素都是实数。&lt;/p&gt;
&lt;p&gt;2.矩阵的转置等于它自己，即 \(A = A^T\) 。&lt;/p&gt;
&lt;p&gt;即 \(A=A^{T}\) 且在实数域上。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;反实对称矩阵（Skew-Symmetric Matrix）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;英文的原义就是倾斜-称的意思，学数学还要学很多的英文，法文和拉丁文。&lt;/p&gt;
&lt;p&gt;是指一个方阵，它满足以下两个条件：&lt;/p&gt;
&lt;p&gt;1.矩阵的元素都是实数。&lt;/p&gt;
&lt;p&gt;2.矩阵的转置等于它相反数的乘积，即 \(A = -A^T\) 。&lt;/p&gt;
&lt;p&gt;\[
\notag
\left [ \begin{matrix}
0&amp;amp; a&amp;amp; b \\
-a&amp;amp; 0&amp;amp; c \\
-b&amp;amp; -c&amp;amp; 0
\end{matrix} \right ]
\]&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;厄米特矩阵&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;也称自共轭矩阵，也称自伴随矩阵。名字很多，关键是理解其形式。&lt;/p&gt;
&lt;p&gt;厄米特矩阵（Hermitian Matrix）是指一个复数方阵，它满足以下两个条件：&lt;/p&gt;
&lt;p&gt;1.矩阵的元素都是复数。&lt;/p&gt;
&lt;p&gt;2.矩阵的共轭转置等于它自己的转置的复共轭，即 \(A = A^*\) ，其中 \(A^*\) 表示矩阵 \(A\) 的共轭转置。&lt;/p&gt;
&lt;p&gt;换句话说，厄米特矩阵的每个元素关于主对角线对称，并且每个元素与其对应位置的元素的共轭相等。主对角线是从左上角到右下角的一条对角线。&lt;/p&gt;
&lt;p&gt;\[
\notag
\left [ \begin{matrix}
a&amp;amp; b&amp;amp; c \\
b^{*}&amp;amp; d&amp;amp; e \\
c^{*}&amp;amp; e^{*}&amp;amp; f
\end{matrix} \right ]
\]&lt;/p&gt;
&lt;p&gt;其中，a、b、c、d、e、f 都是复数，并且矩阵的共轭转置等于它自己的转置的复共轭 \(A = A^H\) 。&lt;/p&gt;
&lt;p&gt;厄米特矩阵具有一些重要的性质和特点：&lt;/p&gt;
&lt;p&gt;1.厄米特矩阵的主对角线上的元素都是实数。&lt;/p&gt;
&lt;p&gt;2.厄米特矩阵的特征值都是实数，且它的特征向量对应的特征值之间是正交的。&lt;/p&gt;
&lt;p&gt;3.厄米特矩阵可以通过酉相似变换对角化。这意味着可以找到一个酉矩阵，将厄米特矩阵相似变换为一个对角矩阵，即将矩阵的非对角线上的元素全部变为零。&lt;/p&gt;
&lt;p&gt;\(a_{{i,j}}=\overline {a_{{j,i}}}\) ，其中 \(\overline{(\cdot)}\) 为共轭算子。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;反厄米特矩阵&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;反厄米特矩阵（Anti-Hermitian Matrix），也称为伴随矩阵（Adjoint Matrix），是指一个复数方阵，它满足以下两个条件：&lt;/p&gt;
&lt;p&gt;1.矩阵的元素都是复数。&lt;/p&gt;
&lt;p&gt;2.矩阵的共轭转置等于它自己的相反数的转置的复共轭，即 \(A = -A^H\) ，其中 \(A^H\) 表示矩阵 \(A\) 的共轭转置。&lt;/p&gt;
&lt;p&gt;换句话说，反厄米特矩阵的每个元素关于主对角线反对称，并且每个元素与其对应位置的元素的共轭相等但符号相反。主对角线是从左上角到右下角的一条对角线。&lt;/p&gt;
&lt;h3 id=&#34;正规矩阵一定可以对角化&#34;&gt;正规矩阵一定可以对角化&lt;/h3&gt;
&lt;h3 id=&#34;特征值和特征向量&#34;&gt;特征值和特征向量&lt;/h3&gt;
&lt;p&gt;引用《线性代数的几何意义》的描述：“矩阵乘法对应了一个变换，是把任意一个向量变成另一个方向或长度都大多不同的新向量。在这个变换的过程中，原向量主要发生旋转、伸缩的变化。如果矩阵对某一个向量或某些向量只发生伸缩变换，不对这些向量产生旋转的效果，那么这些向量就称为这个矩阵的特征向量，伸缩的比例就是特征值。”&lt;/p&gt;
&lt;p&gt;大多数时候不用找到真正的一个几何例子，数学是这么一个东西。尝试用最简单的方式去理解一个思路，那么数学就会变得简单很多，以后解决问题也就更加直接有效。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>矩阵分析（一）</title>
        <link>https://guolongji.xyz/post/martrix-analysis-1/</link>
        <pubDate>Mon, 16 Oct 2023 15:40:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/martrix-analysis-1/</guid>
        <description>&lt;p&gt;学习一点数学基础，没学过的话也不可能真正理解 ai。&lt;/p&gt;
&lt;h2 id=&#34;线性空间的基于维数&#34;&gt;线性空间的基于维数&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_154351.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_154408.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_154422.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_154441.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;线性空间中的线性变换&#34;&gt;线性空间中的线性变换&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_154528.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_154824.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;线性变换的像-核&#34;&gt;线性变换的像、核&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_155628.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;这个稍微有一点抽像，但是花一点点的时间就理解了，也不是特别地抽象。&lt;/p&gt;
&lt;h2 id=&#34;线性变换的矩阵&#34;&gt;线性变换的矩阵&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_160752.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;万物皆可矩阵化，线性变换 T 就是矩阵，就是这个间思。上图中的 C 过渡矩阵。矩阵和矩阵。学过且懂了。考试要求有步骤分。&lt;/p&gt;
&lt;p&gt;定义是基底在前，变换在后。&lt;/p&gt;
&lt;p&gt;求逆矩阵比较快的方法是用增广矩阵： \((A|E)\rightarrow(E | A^{-1})\) ，用初等变换法，A变成了单位矩阵之后，右面就变成了 \(A^{-1}\) 。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_163149.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;这里面的 \(\eta_{3}=(0, 1, 1)\) 图片显示不清楚。什么是单位矩阵？在矩阵的乘法中，有一种矩阵起着特殊的作用，如同数的乘法中的 1，这种矩阵被称为单位矩阵。它是个方阵，从左上角到右下角的对角线（称为主对角线）上的元素均为 1。除此以外全都为 0。&lt;/p&gt;
&lt;p&gt;性代基础。学数学要超纲学，才能在解基础题目时能做到降维打击。
&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_170923.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		data-action=&#34;zoom&#34;
	
&gt;

&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_171430.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;关键还是把过度矩阵写出来。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231016_172321.jpg&#34;/&gt;
&lt;/figure&gt;

</description>
        </item>
        <item>
        <title>丁至宣小伙伴教我diy键盘</title>
        <link>https://guolongji.xyz/post/diy-keyboard/</link>
        <pubDate>Wed, 11 Oct 2023 11:18:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/diy-keyboard/</guid>
        <description>&lt;h2 id=&#34;材料准备&#34;&gt;材料准备&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;3D 打印的壳子：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231012_095601.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;800&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 1: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;壳子&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;一大堆的芯片、线还有电池&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231012_095307.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;800&#34;/&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 2: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;芯片和线&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;其他&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;还需要电烙铁，钳子，一些额外的杜邦线，键轴键帽&lt;/p&gt;
&lt;p&gt;除了轨迹球和键轴键帽，其它的东西都是丁至宣小伙伴资助的，万分感谢。&lt;/p&gt;
&lt;h2 id=&#34;开始动工&#34;&gt;开始动工&lt;/h2&gt;
&lt;h2 id=&#34;ox-hugo-image-resize&#34;&gt;ox-hugo image resize&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://corra.fi/posts/ox-hugo-friendly-resize/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://corra.fi/posts/ox-hugo-friendly-resize/&lt;/a&gt;&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231011_174251.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231011_175457.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://wiki.archlinux.org/title/Screen_capture&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://wiki.archlinux.org/title/Screen_capture&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;要我自己写一个压缩工具吗？大可不必：
nix-env -iA nixpkgs.shutter&lt;/p&gt;
&lt;p&gt;shutter这个工具完全比任何其它的截图工具好用，超过 Deepin Screenshot。&lt;/p&gt;
&lt;p&gt;arch的wiki上对这个软件也没有重点突出出来。这个软件最好。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231012_094223.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;设置完快捷键。&lt;/p&gt;
&lt;p&gt;但是还是有问题的，需要shutter截图后再手动拖一下。不过已经不太影响使用了。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>tty和x的切换流程</title>
        <link>https://guolongji.xyz/post/tty-x-switch/</link>
        <pubDate>Mon, 25 Sep 2023 10:31:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/tty-x-switch/</guid>
        <description>&lt;p&gt;这篇文档可以在：&lt;a class=&#34;link&#34; href=&#34;https://guolongji.xyz/post/tty-x-switch/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://guolongji.xyz/post/tty-x-switch/&lt;/a&gt; 这里看到更新。&lt;/p&gt;
&lt;h2 id=&#34;概念&#34;&gt;概念&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Console&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Console 意即控制台。Console 出现在操作系统诞生之前，那个时候的老式计算机还只能通过按钮开关等方式控制计算机的运转，而 Console 就是将控制计算机器件集中起来的面板。由于现代计算机不再使用控制台来控制电脑，所以现代操作系统中的 Console 一般指控制台终端。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Terminal&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Terminal 意即终端。顾名思义，是连接到计算机上的终端设备。当操作系统出现之后，不再使用控制台与计算机交互，而是使用命令，为了能够输入这些命令，出现了电传打字机（Teletype），程序输入输出可以通过电传打字机打印到屏幕上。所以 Terminal 其实是指一种监视计算机输入输出的硬件。但是现代操作系统中使用更多的是软件仿真终端。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TTY&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;TTY 即 TeleTYpe，意即电传打字机。TTY 与 Terminal 初期是同一个概念，电传打字机连接到计算机上便是一台终端设备。当时的 TTY 需要使用 UART 驱动来传输数据，而现代计算机中的 TTY 直接将输出数据渲染成视频信号，输出到显示器中，这些操作都运行在内核态。目前只能在连接键盘与显示器的计算机上使用 TTY。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PTY&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;PTY 即 Pseudo TeleTYpe，意即伪 TTY。PTY 是现代计算机中使用终端模拟软件或者 SSH 连接所使用的伪终端，运行在用户态。现代操作系统使用的终端都是伪终端，通过终端软件对终端进行模拟。PTY 为了保证能够与 TTY 兼容，采用了主从结构，分为 PTY slave side 与 PTY master side。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PTY slave side&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;PTY slave side 的通过 TTY 驱动实现。PTY slave side 与 PTY master side 进行连接，将程序输入输出发送给 PTY
master side 并显示出来。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PTY master side&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;PTY master side 会将程序的输入输出显示在终端模拟软件中。例如当时用 SSH 远程连接时，PTY master side 与 SSH 连接，交换数据。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PTMX&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ptmx 是 Linux 操作系统中的一个特殊设备文件，它代表了伪终端（pseudo-terminal）主设备。伪终端是一种虚拟设备，用于提供交互式终端功能，让程序能够与终端进行通信。&lt;/p&gt;
&lt;p&gt;ptmx 的全称是 &amp;ldquo;Pseudo Terminal Master for X&amp;rdquo;，它是伪终端机制的主控端，通过打开 ptmx 设备可以获得一个伪终端从设备文件（例如 /dev/pts/0）。&lt;/p&gt;
&lt;p&gt;在 Linux 中，当一个程序打开 ptmx 设备并请求一个新的伪终端时，内核会创建一对相互连接的伪终端从设备（slave），然后把主设备（master）的文件描述符和从设备的路径返回给程序。程序可以使用这对从设备和主设备进行通信，就像在与真实终端进行交互一样。&lt;/p&gt;
&lt;p&gt;伪终端在很多应用中非常有用，比如远程登录、终端模拟器、串口通信等。它提供了一个可编程的、终端兼容的接口，使得程序可以以交互的方式与其他终端应用或设备进行通信，而无需直接依赖物理终端。&lt;/p&gt;
&lt;p&gt;总结来说，ptmx 是 Linux 中用于创建和管理伪终端的主设备文件，它为程序提供了与终端交互的接口，为终端模拟、远程登录等操作提供了基础支持。&lt;/p&gt;
&lt;p&gt;说人话就是，每打开一个 terminal 的程序 ptmx 就会创建一个新的 &amp;ldquo;/dev/pts&amp;rdquo; 的下的设备。sysctl kernel.pty.max，能查到这个值是 4096。伪终端的数量也是有限制的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dev 下的 ttyX&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以 chvt 进入，即终端，而 pts 目录下的是不能那么进去的。&lt;/p&gt;
&lt;p&gt;VT 不需要显卡驱动的支持。framebuffer 相关的代码在内核的 drivers/video/fbdev/fbcon.c 当中。&lt;/p&gt;
&lt;p&gt;VT 驱动的代码在 drivers/tty/vt/vt.c 当中。其中的 visual_init 函数中调用 con_init 函数。&lt;/p&gt;
&lt;p&gt;流程是内核启动初始化。&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20230926_090023.png&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;700&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 1: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;tty 子系统架构图&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&#34;如何将一个-tty-和一个-xorg-关连起来&#34;&gt;如何将一个 tty 和一个 xorg 关连起来？&lt;/h2&gt;
&lt;p&gt;分配新用户的 TTY 涉及到内核中几个关键的函数。以下是其中的一些函数：&lt;/p&gt;
&lt;p&gt;1.get_unused_tty_index()：用于获取一个未被使用的 TTY 索引。每个 TTY 都有一个唯一的索引号，内核使用这个索引号来标识不同的 TTY 设备。&lt;/p&gt;
&lt;p&gt;2.tty_alloc_driver()：用于为新的 TTY 实例分配一个 TTY 驱动结构体。TTY 驱动结构体保存了与 TTY 设备相关的信息和操作。&lt;/p&gt;
&lt;p&gt;3.tty_init_dev()：用于初始化新的 TTY 设备。这个函数会设置 TTY 的状态、配置串口传输参数以及注册 TTY 设备到系统中。&lt;/p&gt;
&lt;p&gt;4.tty_open()：用于打开 TTY 设备。当一个用户切换到一个新的 TTY 时，内核会调用这个函数来打开对应的 TTY 设备。&lt;/p&gt;
&lt;p&gt;5.vt_do_activate()：用于激活虚拟终端（Virtual Terminal，VT）。在 Linux 中，每个 TTY 都对应一个 VT，用于提供文本终端的功能。这个函数会激活新的 VT，并将其与对应的 TTY 关联起来。&lt;/p&gt;
&lt;p&gt;这些函数位于内核的 TTY 子系统中，负责管理和处理 TTY 设备。通过调用这些函数，内核能够分配和管理多个 TTY 设备，并在用户切换到不同的 TTY 时分配适当的资源和处理相应的操作。&lt;/p&gt;
&lt;p&gt;xorg 通过命令行参数 -vt 1 来绑定。&lt;/p&gt;
&lt;h3 id=&#34;vt-的切换流程&#34;&gt;vt 的切换流程&lt;/h3&gt;
&lt;p&gt;Ctrl-Alt-F2 在只有一个用户时，切换是切到 tty 的界面。但是如果有多个登陆的用户时就会切换到其它用户的图形界面。&lt;/p&gt;
&lt;p&gt;当用户切换到新的 TTY 时，涉及到内核的一些操作来实现切换。下面是内核切换 TTY 的详细流程：&lt;/p&gt;
&lt;p&gt;用户请求切换 TTY：用户可以通过按下 Ctrl+Alt+F1 到 F6（一般情况下，Linux 系统提供了 6 个 TTY 终端）的组合键来请求切换到相应的 TTY。&lt;/p&gt;
&lt;p&gt;用户空间程序处理请求：当用户按下组合键后，一个特殊的信号（如 SIGINT）将发送给前台进程组中的所有进程。在这种情况下，TTY 驱动程序会接收到信号并执行相应的操作。&lt;/p&gt;
&lt;p&gt;TTY 驱动程序检测信号并通知内核：TTY 驱动程序会检测到信号，并将其传递给内核。内核会响应该信号，并开始进行 TTY 切换的操作。&lt;/p&gt;
&lt;p&gt;内核切换控制台：内核会根据信号中指定的 TTY 编号，将当前活动的 TTY 切换到新的 TTY。它会关闭当前 TTY 的输入和输出，并重新配置设备以与新的 TTY 关联。&lt;/p&gt;
&lt;p&gt;内核执行 TTY 切换操作：内核会执行以下操作来完成 TTY 切换：&lt;/p&gt;
&lt;p&gt;关闭当前 TTY 设备：内核将关闭当前 TTY 设备的输入和输出，在切换期间停止与 TTY 设备的通信。加载新 TTY 设备：内核会初始化和配置新的 TTY 设备，包括打开新 TTY 设备的输入和输出通道。切换虚拟终端结构：内核会更新虚拟终端结构，以反映当前活动的 TTY 设备。用户空间程序刷新屏幕：在 TTY 切换完成后，用户空间程序将被激活，并负责更新新 TTY 的屏幕内容。&lt;/p&gt;
&lt;p&gt;总体而言，内核切换 TTY 的过程涉及到信号处理、设备配置和数据传输等操作。内核负责管理和控制 TTY 设备的状态，以确保正确的 TTY 切换和用户体验。这样，用户可以在不同的 TTY 中进行并发的文本模式会话。&lt;/p&gt;
&lt;h2 id=&#34;dbus&#34;&gt;dbus&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;lightdm(org.freedesktop.DisplayManager)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;登录管理：LightDM 提供用户界面，使用户能够输入用户名和密码登录系统。它支持不同的登录方式，如图形界面登录、远程登录和自动登录。&lt;/p&gt;
&lt;p&gt;会话管理：LightDM 管理用户登录后的会话过程。它允许用户选择默认的窗口管理器或桌面环境，并为每个用户保存其首选设置。&lt;/p&gt;
&lt;p&gt;多用户支持：LightDM 支持多个用户账号，并为每个用户提供独立的登录环境。这意味着多个用户可以同时登录到同一台计算机上，而不会相互干扰。&lt;/p&gt;
&lt;p&gt;主题和样式定制：LightDM 允许用户自定义登录界面的外观和样式。用户可以选择不同的主题、背景图像、字体和颜色方案，以创建自己喜欢的登录界面。&lt;/p&gt;
&lt;p&gt;扩展性和集成：LightDM 支持插件和扩展，可以与各种其他软件和服务集成。它可以与不同的窗口管理器、桌面环境和身份验证系统一起使用。&lt;/p&gt;
&lt;p&gt;总的来说，LightDM 是一个灵活、可定制和易于使用的显示管理器，它提供了一个简单而强大的界面来管理用户登录会话。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;greeter(lightdm-deepin-greeter)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;deepin-authenticate(com.deepin.daemon.Authenticate)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;systemd-logind(org.freedesktop.login1)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;dde-lockservice(org.deepin.dde.LockService1)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;dde-system-daemon(org.deepin.dde.Accounts1)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;accounts-daemon(org.freedesktop.Accounts)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以上服务，基本都是 system bus，可以通过 d-feet 去看对应的接口。可以用 dbus-send，gdbus 和 qdus 来发送 dbus
信号，信号的&lt;/p&gt;
&lt;h3 id=&#34;dbus-接口的使用&#34;&gt;dbus 接口的使用&lt;/h3&gt;
&lt;p&gt;我们有一个服务 deepin-authenticate 是用 golang 来实现的。golang 的 dbus 库的文档在这里：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://pkg.go.dev/github.com/godbus/dbus&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://pkg.go.dev/github.com/godbus/dbus&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Kwin 中用的是 qdbus 的库。&lt;/p&gt;
&lt;p&gt;dbus 的核心概念就是总线消息。&lt;/p&gt;
&lt;h2 id=&#34;linux-图形学中的一些概念&#34;&gt;linux 图形学中的一些概念&lt;/h2&gt;
&lt;h3 id=&#34;dm-wm-与-x-display-manager-control-protocol-xdmcp&#34;&gt;DM，WM 与 X Display Manager Control Protocol（XDMCP）&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;显示管理器 DM
又称为“登陆管理器”。有 lightdm，xdm（x display manager），sddm（Simple Desktop Display Manager），
gdm（gnome Display manager）。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以用登陆脚本代替 DM，比如 xinit + startx 的方式。xinit 程序允许用户手动启动 Xorg 显示服务器。startx 脚本是 xinit 的一个前端。&lt;/p&gt;
&lt;p&gt;xorg-xinit 这个包切换用户最终调用的是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;窗口管理器&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;kwin（dde，支持 X11 和 wayland）、sway（支持 wayland）、wayfire（支持 wayland）、hyperland（现在最火的 wayland wm）、awesome、i3wm、mutter（gnome）&amp;hellip;&amp;hellip;&lt;/p&gt;
&lt;p&gt;在 uos 中可以安装 dde-dconfig-editor 可以选择用 kwin 来启动窗口管理器。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.x.org/releases/current/doc/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.x.org/releases/current/doc/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;man X，本地可以看到。关于 X11 的文档都在这个里面了，是英文，内容很多。&lt;/p&gt;
&lt;p&gt;lightdm 的配置文件在： &lt;code&gt;/etc/lightdm/&lt;/code&gt; 里；&lt;/p&gt;
&lt;p&gt;xorg 的配置文件在这里： &lt;code&gt;/etc/X11/&lt;/code&gt; 里；&lt;/p&gt;
&lt;p&gt;通过 pstree 能看到图形的启动流程：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;uos@guolongji:~$ pstree --ascii
systemd-+ ......
        |-lightdm-+-Xorg---3*[{Xorg}]
        |         |-lightdm-+-startdde-+-DeepinAIAssista---9*[{DeepinAIAssista}]
        |         |         |          |-DeepinVoiceWake---{DeepinVoiceWake}
        |         |         |          |-agent---2*[{agent}]
        |         |         |          |-bd-qimpanel.wat---sleep
        |         |         |          |-chrome-+-2*[cat]
        |         |         |          |        |-2*[chrome---7*[{chrome}]]
        |         |         |          |        |-chrome---chrome---24*[{chrome}]
        |         |         |          |        |-chrome-sandbox---chrome-+-chrome-+-19*[chrome---12*[{chrome}]]
        |         |         |          |        |                         |        |-3*[chrome---13*[{chrome}]]
        |         |         |          |        |                         |        |-chrome---14*[{chrome}]
        |         |         |          |        |                         |        |-chrome---4*[{chrome}]
        |         |         |          |        |                         |        |-2*[chrome---7*[{chrome}]]
        |         |         |          |        |                         |        `-chrome---15*[{chrome}]
        |         |         |          |        |                         `-chrome-sandbox---nacl_helper
        |         |         |          |        `-25*[{chrome}]
        |         |         |          |-dde-calendar-se---2*[{dde-calendar-se}]
        |         |         |          |-dde-clipboard---5*[{dde-clipboard}]
        |         |         |          |-dde-desktop---27*[{dde-desktop}]
        |         |         |          |-dde-dock---25*[{dde-dock}]
        |         |         |          |-dde-file-manage---28*[{dde-file-manage}]
        |         |         |          |-dde-launcher---24*[{dde-launcher}]
        |         |         |          |-dde-lock---24*[{dde-lock}]
        |         |         |          |-dde-osd---7*[{dde-osd}]
        |         |         |          |-dde-polkit-agen---5*[{dde-polkit-agen}]
        |         |         |          |-dde-printer-hel---9*[{dde-printer-hel}]
        |         |         |          |-dde-session-dae---50*[{dde-session-dae}]
        |         |         |          |-deepin-deepinid---30*[{deepin-deepinid}]
        |         |         |          |-deepin-defender---5*[{deepin-defender}]
        |         |         |          |-emacs-+-codeium_languag-+-codeium_languag---15*[{codeium_languag}]
        |         |         |          |       |                 `-15*[{codeium_languag}]
        |         |         |          |       |-epdfinfo
        |         |         |          |       |-python3---8*[{python3}]
        |         |         |          |       `-10*[{emacs}]
        |         |         |          |-emacs-+-codeium_languag-+-codeium_languag---17*[{codeium_languag}]
        |         |         |          |       |                 `-19*[{codeium_languag}]
        |         |         |          |       |-epdfinfo
        |         |         |          |       |-mu
        |         |         |          |       |-python3---8*[{python3}]
        |         |         |          |       |-python3
        |         |         |          |       `-5*[{emacs}]
        |         |         |          |-evince---4*[{evince}]
        |         |         |          |-kitty-+-bash---pstree
        |         |         |          |       `-3*[{kitty}]
        |         |         |          |-kwin_no_scale---kwin_x11---10*[{kwin_x11}]
        |         |         |          |-wps---wps---9*[{wps}]
        |         |         |          `-62*[{startdde}]
        |         |         `-2*[{lightdm}]
        |         `-2*[{lightdm}]
        |- ......
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;amd-显卡的架构演进&#34;&gt;AMD 显卡的架构演进&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://medium.com/high-tech-accessible/an-overview-of-amds-gpu-architectures-884432a717a6&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://medium.com/high-tech-accessible/an-overview-of-amds-gpu-architectures-884432a717a6&lt;/a&gt;&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231101_111732.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231101_111814.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231101_111850.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;sudo apt install mesa-utils&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;uos@guolongji:~$ glxinfo -B
name of display: :0
display: :0  screen: 0
direct rendering: Yes
Extended renderer info (GLX_MESA_query_renderer):
    Vendor: X.Org (0x1002)
    Device: AMD CAICOS (DRM 2.50.0 / 4.19.0-amd64-desktop, LLVM 7.0.1) (0x6779)
    Version: 19.2.6
    Accelerated: yes
    Video memory: 2048MB
    Unified memory: no
    Preferred profile: core (0x1)
    Max core profile version: 3.3
    Max compat profile version: 3.1
    Max GLES1 profile version: 1.1
    Max GLES[23] profile version: 3.1
Memory info (GL_ATI_meminfo):
    VBO free memory - total: 2047 MB, largest block: 2047 MB
    VBO free aux. memory - total: 1021 MB, largest block: 1021 MB
    Texture free memory - total: 2047 MB, largest block: 2047 MB
    Texture free aux. memory - total: 1021 MB, largest block: 1021 MB
    Renderbuffer free memory - total: 2047 MB, largest block: 2047 MB
    Renderbuffer free aux. memory - total: 1021 MB, largest block: 1021 MB
Memory info (GL_NVX_gpu_memory_info):
    Dedicated video memory: 2048 MB
    Total available memory: 3069 MB
    Currently available dedicated video memory: 2047 MB
OpenGL vendor string: X.Org
OpenGL renderer string: AMD CAICOS (DRM 2.50.0 / 4.19.0-amd64-desktop, LLVM 7.0.1)
OpenGL core profile version string: 3.3 (Core Profile) Mesa 19.2.6
OpenGL core profile shading language version string: 3.30
OpenGL core profile context flags: (none)
OpenGL core profile profile mask: core profile

OpenGL version string: 3.1 Mesa 19.2.6
OpenGL shading language version string: 1.40
OpenGL context flags: (none)

OpenGL ES profile version string: OpenGL ES 3.1 Mesa 19.2.6
OpenGL ES profile shading language version string: OpenGL ES GLSL ES 3.10
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;Caicos 和 TeraScale 是什么关系？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Caicos 和 TeraScale 是 AMD 显卡架构中的两个不同概念，它们之间存在一定的关系。&lt;/p&gt;
&lt;p&gt;TeraScale 是 AMD 显卡架构中的一个历史阶段，它首次于 2007 年推出，被广泛应用于 Radeon HD 3000、4000、5000 和
6000 系列显卡中。TeraScale 架构采用了传统的 VLIW（Very Long Instruction Word）设计，通过组合多个简单指令来实现复杂的计算任务。TeraScale 架构在当时是非常先进的，但随着计算单元的增多，复杂度也逐渐增加，导致处理器设计难度和功耗成倍提升。&lt;/p&gt;
&lt;p&gt;而 Caicos 则是 TeraScale 2 架构中的一个代表，它是 AMD Radeon HD 6400 和 6500 系列显卡所采用的架构。
TeraScale 2 架构在 TeraScale 架构的基础上进行了一些优化，如引入了更高效的纹理单元和几何单元，并支持
DirectX 11 和 OpenGL 4.1 等新的标准。同时，TeraScale 2 架构还采用了更加先进的 40nm 制程工艺，使得功耗和热量控制得到了更好的平衡。&lt;/p&gt;
&lt;p&gt;因此，可以说 Caicos 是 TeraScale 2 架构中的一个代表，是 AMD 在当时对 TeraScale 架构的改进和升级。虽然 Caicos 和 TeraScale 有所区别，但它们都是 AMD 显卡架构中的重要部分，并共同推动了 AMD 显卡技术的发展。&lt;/p&gt;
&lt;h2 id=&#34;amd-驱动代码的模块划分和代码介绍&#34;&gt;AMD 驱动代码的模块划分和代码介绍&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;DCE&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;AMD 的 DCE（Display Core Engine）模块是 AMD 显卡中的一个重要组件，它主要负责图形处理单元（GPU）和显示输出之间的通信和协调工作。DCE 模块具有以下功能：&lt;/p&gt;
&lt;p&gt;1.显示控制：DCE 模块负责显卡的显示控制功能，包括显示输出的配置、分辨率管理、刷新率控制等。它能够接收来自 GPU
的图像数据，并将其转换为适当的格式并输出到连接的显示设备上。&lt;/p&gt;
&lt;p&gt;2.多显示器支持：DCE 模块支持多显示器配置，可以同时驱动多个显示设备，例如多个显示器、投影仪等。它能够管理和控制多个显示输出，并确保它们按照用户的设置正确运行。&lt;/p&gt;
&lt;p&gt;3.显示连接管理：DCE 模块负责检测和管理显示设备的连接状态。它能够自动检测连接的显示设备，并在需要时进行重新配置和重新协商，以确保正常的显示输出。&lt;/p&gt;
&lt;p&gt;4.显示特性增强：DCE 模块还提供了一些显示特性的增强功能，例如色彩管理、色彩空间转换、多显示器融合等。这些功能可以提供更好的显示效果和用户体验。&lt;/p&gt;
&lt;p&gt;总的来说，DCE 模块在 AMD 显卡中扮演着重要的角色，它是 GPU 与显示输出之间的桥梁，负责管理、控制和增强显示功能，使用户能够获得良好的图形和显示效果。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DCE 模块和 display 模块是什么关系？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;display 模块包含了 DCE 模块的所有功能，同时还集成了其他相关的硬件和软件组件，例如视频解码器、视频编码器、色彩管理等。它提供了一种精简和高效的架构，以便更好地支持多显示器配置和多种显示输出配置。&lt;/p&gt;
&lt;p&gt;除了 DCE 模块的主要功能外，display 模块还提供了其他的增强功能，例如：&lt;/p&gt;
&lt;p&gt;1.包括 HDMI、DisplayPort 和 DVI 等多种显示输出标准的支持。&lt;/p&gt;
&lt;p&gt;2.支持硬件加速的视频解码和编码功能，能够加速高清视频的播放和转码。&lt;/p&gt;
&lt;p&gt;3.能够支持高分辨率和广色域的显示输出，以提供更好的画质和色彩表现效果。&lt;/p&gt;
&lt;p&gt;总之，DCE 模块是 AMD 显卡中的一个核心组件，而 display 模块则是一个集成了 DCE 模块功能的子系统，并提供了其他相关的硬件和软件组件，以实现更好的画质和用户体验。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;UVD&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;UVD（Unified Video Decoder）是一个硬件模块，用于在 AMD 显卡上进行视频解码的加速处理。UVD 模块主要用于解码高清视频和其他常见的视频格式，以减轻 CPU 的负担并提供更流畅的视频播放体验。&lt;/p&gt;
&lt;p&gt;UVD 模块有以下主要功能：&lt;/p&gt;
&lt;p&gt;1.视频解码加速：UVD 模块使用专门的硬件电路和算法来加速视频解码过程。它支持多种视频编码标准，包括
H.264、MPEG-2、VC-1 等，并能够快速解码高分辨率的视频内容。&lt;/p&gt;
&lt;p&gt;2.解码负载分担：通过使用 UVD 模块进行视频解码，可以将解码任务从 CPU 转移至显卡，减轻 CPU 的负担。这样可以释放 CPU 资源用于其他计算任务，提高系统整体性能和响应速度。&lt;/p&gt;
&lt;p&gt;3.节能和热量控制：UVD 模块在进行视频解码时，能够有效地管理功耗和热量产生。由于视频解码是一项相对固定的任务，UVD 模块可以根据需要动态调整功耗和频率，以提供最佳的性能和能效平衡。&lt;/p&gt;
&lt;p&gt;总之，UVD 模块是 AMD 显卡中的一个硬件加速模块，用于视频解码任务。它能够减轻 CPU 负担，提供更流畅的视频播放体验，并具有节能和热量控制的优化功能。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GMC&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GMC（Graphics Memory Controller）是一个重要的硬件模块，它负责显卡中的内存管理和数据传输。GMC 模块可以有效地管理 GPU 内部的显存，从而提高图形渲染性能和效率。&lt;/p&gt;
&lt;p&gt;GMC 模块主要有以下功能：&lt;/p&gt;
&lt;p&gt;1.内存分配和释放：GMC 模块可以管理 GPU 内部的显存，自动分配和释放内存，确保图形处理单元（GPU）能够快速访问并使用可用的显存。&lt;/p&gt;
&lt;p&gt;2.数据传输：GMC 模块负责数据在 GPU 内部和显存之间的传输。它可以在 GPU 内部的不同模块之间进行高速数据传递，以实现更快的图形渲染和数据处理。&lt;/p&gt;
&lt;p&gt;3.内存优化：GMC 模块能够对显存进行优化，以提高数据读写效率，减少延迟和提高响应速度。这些优化包括内存预取、内存压缩、数据压缩和解压等。&lt;/p&gt;
&lt;p&gt;4.带宽管理：GMC 模块可以管理 GPU 和显存之间的数据带宽，确保数据能够快速传输，并根据需要动态调整带宽分配，以提供更好的性能和能效平衡。&lt;/p&gt;
&lt;p&gt;总之，GMC 模块是 AMD 显卡中的一个核心组件，它负责显存管理和数据传输，并能够提供内存优化和带宽管理等功能，以提高图形渲染性能和效率。&lt;/p&gt;
&lt;p&gt;切换用户的时候一定是内核重新获取了 edid 的，内核当中获取 edid 的时间比较长。amdgpu 获取
edid 主要涉及以下几个文件：&lt;/p&gt;
&lt;p&gt;x86-kernel/drivers/gpu/drm/amd/amdgpu/amdgpu_atombios.c&lt;/p&gt;
&lt;p&gt;x86-kernel/drivers/gpu/drm/amd/amdgpu/amdgpu_i2c.c&lt;/p&gt;
&lt;p&gt;x86-kernel/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c&lt;/p&gt;
&lt;p&gt;因为 oland 显卡不用 display 的代码，所以要从前两个文件来分析代码的调用。&lt;/p&gt;
&lt;p&gt;具体的调用过程我下次讲。&lt;/p&gt;
&lt;p&gt;通过 dmesg|grep drm 可以查到：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;[    0.920573] [drm] radeon kernel modesetting enabled.
[    0.965343] [drm] amdgpu kernel modesetting enabled.
[    0.965343] [drm] amdgpu version: 5.11.32.40512
[    0.965344] [drm] OS DRM version: 4.19.0
[    0.967268] [drm] initializing kernel modesetting (OLAND 0x1002:0x6611 0x1462:0x3740 0x87).
[    0.967277] [drm] register mmio base: 0xA0300000
[    0.967278] [drm] register mmio size: 262144
[    0.967283] [drm] add ip block number 0 &amp;lt;si_common&amp;gt;
[    0.967284] [drm] add ip block number 1 &amp;lt;gmc_v6_0&amp;gt;
[    0.967284] [drm] add ip block number 2 &amp;lt;si_ih&amp;gt;
[    0.967284] [drm] add ip block number 3 &amp;lt;gfx_v6_0&amp;gt;
[    0.967285] [drm] add ip block number 4 &amp;lt;si_dma&amp;gt;
[    0.967285] [drm] add ip block number 5 &amp;lt;si_dpm&amp;gt;
[    0.967286] [drm] add ip block number 6 &amp;lt;dce_v6_0&amp;gt;
[    0.967286] [drm] add ip block number 7 &amp;lt;uvd_v3_1&amp;gt;
[    0.975071] [drm] BIOS signature incorrect 5b 7
[    0.975303] [drm] vm size is 64 GB, 2 levels, block size is 10-bit, fragment size is 9-bit
[    0.975335] [drm] Detected VRAM RAM=2048M, BAR=256M
[    0.975335] [drm] RAM width 64bits GDDR5
[    0.975358] [drm] amdgpu: 2048M of VRAM memory ready
[    0.975359] [drm] amdgpu: 7898M of GTT memory ready.
[    0.975361] [drm] GART: num cpu pages 262144, num gpu pages 262144
[    0.975901] [drm] Supports vblank timestamp caching Rev 2 (21.10.2013).
[    0.975902] [drm] Driver supports precise vblank timestamp query.
[    0.976076] [drm] Internal thermal controller with fan control
[    0.976082] [drm] amdgpu: dpm initialized
[    0.976096] [drm] AMDGPU Display Connectors
[    0.976096] [drm] Connector 0:
[    0.976097] [drm]   HDMI-A-1
[    0.976097] [drm]   HPD2
[    0.976098] [drm]   DDC: 0x1950 0x1950 0x1951 0x1951 0x1952 0x1952 0x1953 0x1953
[    0.976098] [drm]   Encoders:
[    0.976098] [drm]     DFP1: INTERNAL_UNIPHY
[    0.976099] [drm] Connector 1:
[    0.976099] [drm]   VGA-1
[    0.976099] [drm]   DDC: 0x194c 0x194c 0x194d 0x194d 0x194e 0x194e 0x194f 0x194f
[    0.976100] [drm]   Encoders:
[    0.976100] [drm]     CRT1: INTERNAL_KLDSCP_DAC1
[    0.976141] [drm] Found UVD firmware Version: 64.0 Family ID: 13
[    0.976809] [drm] PCIE gen 3 link speeds already enabled
[    1.530160] [drm] UVD initialized successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;oland 显卡用的是 dce_v6_0 这个模块：&lt;/p&gt;
&lt;h3 id=&#34;激活-tty-的流程&#34;&gt;激活 tty 的流程&lt;/h3&gt;
&lt;p&gt;分配新用户的 TTY 涉及到内核中几个关键的函数。以下是其中的一些函数：&lt;/p&gt;
&lt;p&gt;1.get_unused_tty_index()：用于获取一个未被使用的 TTY 索引。每个 TTY 都有一个唯一的索引号，内核使用这个索引号来标识不同的 TTY 设备。&lt;/p&gt;
&lt;p&gt;2.tty_alloc_driver()：用于为新的 TTY 实例分配一个 TTY 驱动结构体。TTY 驱动结构体保存了与
TTY 设备相关的信息和操作。&lt;/p&gt;
&lt;p&gt;3.tty_init_dev()：用于初始化新的 TTY 设备。这个函数会设置 TTY 的状态、配置串口传输参数以及注册 TTY 设备到系统中。&lt;/p&gt;
&lt;p&gt;4.tty_open()：用于打开 TTY 设备。当一个用户切换到一个新的 TTY 时，内核会调用这个函数来打开对应的 TTY 设备。&lt;/p&gt;
&lt;p&gt;5.vt_do_activate()：用于激活虚拟终端（Virtual Terminal，VT）。在 Linux 中，每个 TTY 都对应一个
VT，用于提供文本终端的功能。这个函数会激活新的 VT，并将其与对应的 TTY 关联起来。&lt;/p&gt;
&lt;p&gt;这些函数位于内核的 TTY 子系统中，负责管理和处理 TTY 设备。通过调用这些函数，内核能够分配和管理多个 TTY 设备，并在用户切换到不同的 TTY 时分配适当的资源和处理相应的操作。&lt;/p&gt;
&lt;p&gt;ioctl(fd, VT_ACTIVATE, vt)，通过这个调用内核。&lt;/p&gt;
&lt;p&gt;对应的是内核的 drivers/tty/vt/vt_ioctl.c 里面的两个处理函数：&lt;/p&gt;
&lt;p&gt;vt_ioctl 和 vt_compat_ioctl 两个处理函数：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * ioctl(fd, VT_ACTIVATE, num) will cause us to switch to vt # num,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * with num &amp;gt;= 1 (switches to vt 0, our console, are not allowed, just
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * to preserve sanity).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;VT_ACTIVATE&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;perm)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;EPERM;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (arg &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt; arg &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;gt;&lt;/span&gt; MAX_NR_CONSOLES)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;  &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;ENXIO;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                arg&lt;span style=&#34;color:#ff79c6&#34;&gt;--&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;console_lock&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;vc_allocate&lt;/span&gt;(arg);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;console_unlock&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (ret)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;set_console&lt;/span&gt;(arg);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;或者是：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;VT_ACTIVATE&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;VT_WAITACTIVE&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;VT_RELDISP&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;VT_DISALLOCATE&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;VT_RESIZE&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;VT_RESIZEX&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; fallback;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * the rest has a compatible data structure behind arg,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * but we have to convert it to a proper 64 bit pointer.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                arg &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; (&lt;span style=&#34;color:#8be9fd&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;long&lt;/span&gt;)&lt;span style=&#34;color:#50fa7b&#34;&gt;compat_ptr&lt;/span&gt;(arg);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; fallback;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; ret;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;fallback&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;vt_ioctl&lt;/span&gt;(tty, cmd, arg);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;黑屏并不是说这个系统调用导致的，而是切换至新的 xorg，新的 xorg 会从读 edid 导致的黑屏。这个我是花了一段时间才想明白的。上面的代码就不展开了。&lt;/p&gt;
&lt;p&gt;通过 perf 找到的调用堆栈如下：&lt;/p&gt;
&lt;p&gt;drm_ioctl&lt;/p&gt;
&lt;p&gt;drm_ioctl_kernel&lt;/p&gt;
&lt;p&gt;drm_mode_getconnector&lt;/p&gt;
&lt;p&gt;drm_helper_probe_single_connector_modes&lt;/p&gt;
&lt;p&gt;amdgpu_connector_dvi_detect&lt;/p&gt;
&lt;p&gt;amdgpu_connector_get_edid&lt;/p&gt;
&lt;p&gt;drm_get_edid&lt;/p&gt;
&lt;p&gt;drm_do_get_edid&lt;/p&gt;
&lt;p&gt;drm_do_probe_ddc_edid&lt;/p&gt;
&lt;p&gt;bit_xfer&lt;/p&gt;
&lt;p&gt;drivers/gpu/drm/amd/amdgpu/amdgpu_connectors.c&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_connector_get_edid&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_connector &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;connector)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;adev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; dev&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev_private;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_connector &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;amdgpu_connector &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;to_amdgpu_connector&lt;/span&gt;(connector);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;edid)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* on hw with routers, select right port */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;router.ddc_valid)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_i2c_router_select_ddc_port&lt;/span&gt;(amdgpu_connector);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; ((&lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_connector_encoder_get_dp_bridge_encoder_id&lt;/span&gt;(connector) &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;             ENCODER_OBJECT_ID_NONE) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;ddc_bus&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;has_aux) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;edid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_get_edid&lt;/span&gt;(connector,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                      &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;ddc_bus&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;aux.ddc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; ((connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connector_type &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; DRM_MODE_CONNECTOR_DisplayPort) &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   (connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connector_type &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; DRM_MODE_CONNECTOR_eDP)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_connector_atom_dig &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dig &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;con_priv;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; ((dig&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dp_sink_type &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; CONNECTOR_OBJECT_ID_DISPLAYPORT &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     dig&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dp_sink_type &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; CONNECTOR_OBJECT_ID_eDP) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;ddc_bus&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;has_aux)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;edid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_get_edid&lt;/span&gt;(connector,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                              &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;ddc_bus&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;aux.ddc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;ddc_bus)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;edid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_get_edid&lt;/span&gt;(connector,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                              &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;ddc_bus&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;adapter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;ddc_bus) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;edid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_get_edid&lt;/span&gt;(connector,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                      &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;ddc_bus&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;adapter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;edid) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/* some laptops provide a hardcoded edid in rom for LCDs */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (((connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connector_type &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; DRM_MODE_CONNECTOR_LVDS) &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     (connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connector_type &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; DRM_MODE_CONNECTOR_eDP)))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        amdgpu_connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;edid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_connector_get_hardcoded_edid&lt;/span&gt;(adev);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;drivers/gpu/drm/drm_edid.c&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * drm_get_edid - get EDID data, if available
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @connector: connector we&amp;#39;re probing
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @adapter: I2C adapter to use for DDC
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Poke the given I2C channel to grab EDID data if possible.  If found,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * attach it to the connector.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Return: Pointer to valid EDID or NULL if we couldn&amp;#39;t find any.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; edid &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_get_edid&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_connector &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;connector,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; i2c_adapter &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;adapter)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; edid &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;edid;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;force &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; DRM_FORCE_OFF)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;force &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; DRM_FORCE_UNSPECIFIED &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_probe_ddc&lt;/span&gt;(adapter))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        edid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_do_get_edid&lt;/span&gt;(connector, drm_do_probe_ddc_edid, adapter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (edid)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_get_displayid&lt;/span&gt;(connector, edid);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; edid;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;EXPORT_SYMBOL&lt;/span&gt;(drm_get_edid);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;drivers/gpu/drm/drm_edid.c&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * drm_do_get_edid - get EDID data using a custom EDID block read function
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @connector: connector we&amp;#39;re probing
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @get_edid_block: EDID block read function
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @data: private data passed to the block read function
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * When the I2C adapter connected to the DDC bus is hidden behind a device that
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * exposes a different interface to read EDID blocks this function can be used
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * to get EDID data using a custom block read function.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * As in the general case the DDC bus is accessible by the kernel at the I2C
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * level, drivers must make all reasonable efforts to expose it as an I2C
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * adapter and use drm_get_edid() instead of abusing this function.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * The EDID may be overridden using debugfs override_edid or firmare EDID
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * (drm_load_edid_firmware() and drm.edid_firmware parameter), in this priority
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * order. Having either of them bypasses actual EDID reads.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Return: Pointer to valid EDID or NULL if we couldn&amp;#39;t find any.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; edid &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_do_get_edid&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_connector &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;connector,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;get_edid_block)(&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;data, u8 &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;buf, &lt;span style=&#34;color:#8be9fd&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; block,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                              &lt;span style=&#34;color:#8be9fd&#34;&gt;size_t&lt;/span&gt; len),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;data)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; i, j &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;, valid_extensions &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        u8 &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;edid, &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;new;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; edid &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;override;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        override &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_get_override_edid&lt;/span&gt;(connector);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (override)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; override;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; ((edid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;kmalloc&lt;/span&gt;(EDID_LENGTH, GFP_KERNEL)) &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* base block fetch */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;4&lt;/span&gt;; i&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;get_edid_block&lt;/span&gt;(data, edid, &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;, EDID_LENGTH))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; out;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_edid_block_valid&lt;/span&gt;(edid, &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;false&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                         &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;edid_corrupt))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (i &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_edid_is_zero&lt;/span&gt;(edid, EDID_LENGTH)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;null_edid_counter&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; carp;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (i &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;4&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; carp;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* if there&amp;#39;s no extensions, we&amp;#39;re done */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        valid_extensions &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; edid[&lt;span style=&#34;color:#bd93f9&#34;&gt;0x7e&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (valid_extensions &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; edid &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;)edid;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        new &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;krealloc&lt;/span&gt;(edid, (valid_extensions &lt;span style=&#34;color:#ff79c6&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; EDID_LENGTH, GFP_KERNEL);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;new)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; out;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        edid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; new;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; (j &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;; j &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;=&lt;/span&gt; edid[&lt;span style=&#34;color:#bd93f9&#34;&gt;0x7e&lt;/span&gt;]; j&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                u8 &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;block &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; edid &lt;span style=&#34;color:#ff79c6&#34;&gt;+&lt;/span&gt; j &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; EDID_LENGTH;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;4&lt;/span&gt;; i&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;get_edid_block&lt;/span&gt;(data, block, j, EDID_LENGTH))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; out;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_edid_block_valid&lt;/span&gt;(block, j, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;false&lt;/span&gt;, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (i &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;4&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        valid_extensions&lt;span style=&#34;color:#ff79c6&#34;&gt;--&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (valid_extensions &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; edid[&lt;span style=&#34;color:#bd93f9&#34;&gt;0x7e&lt;/span&gt;]) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                u8 &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;base;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;connector_bad_edid&lt;/span&gt;(connector, edid, edid[&lt;span style=&#34;color:#bd93f9&#34;&gt;0x7e&lt;/span&gt;] &lt;span style=&#34;color:#ff79c6&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                edid[EDID_LENGTH&lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#ff79c6&#34;&gt;+=&lt;/span&gt; edid[&lt;span style=&#34;color:#bd93f9&#34;&gt;0x7e&lt;/span&gt;] &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt; valid_extensions;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                edid[&lt;span style=&#34;color:#bd93f9&#34;&gt;0x7e&lt;/span&gt;] &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; valid_extensions;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                new &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;kmalloc_array&lt;/span&gt;(valid_extensions &lt;span style=&#34;color:#ff79c6&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;, EDID_LENGTH,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                    GFP_KERNEL);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;new)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; out;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                base &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; new;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;=&lt;/span&gt; edid[&lt;span style=&#34;color:#bd93f9&#34;&gt;0x7e&lt;/span&gt;]; i&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        u8 &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;block &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; edid &lt;span style=&#34;color:#ff79c6&#34;&gt;+&lt;/span&gt; i &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; EDID_LENGTH;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_edid_block_valid&lt;/span&gt;(block, i, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;false&lt;/span&gt;, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#ff79c6&#34;&gt;continue&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;memcpy&lt;/span&gt;(base, block, EDID_LENGTH);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        base &lt;span style=&#34;color:#ff79c6&#34;&gt;+=&lt;/span&gt; EDID_LENGTH;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;kfree&lt;/span&gt;(edid);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                edid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; new;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; edid &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;)edid;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;carp&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;connector_bad_edid&lt;/span&gt;(connector, edid, &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;out&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;kfree&lt;/span&gt;(edid);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;EXPORT_SYMBOL_GPL&lt;/span&gt;(drm_do_get_edid);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;drivers/gpu/drm/drm_edid.c&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * drm_do_probe_ddc_edid() - get EDID information via I2C
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @data: I2C device adapter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @buf: EDID data buffer to be filled
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @block: 128 byte EDID block to start fetching from
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @len: EDID data buffer length to fetch
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Try to fetch EDID information by calling I2C driver functions.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Return: 0 on success or -1 on failure.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_do_probe_ddc_edid&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;data, u8 &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;buf, &lt;span style=&#34;color:#8be9fd&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; block, &lt;span style=&#34;color:#8be9fd&#34;&gt;size_t&lt;/span&gt; len)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; i2c_adapter &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;adapter &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; data;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;char&lt;/span&gt; start &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; block &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; EDID_LENGTH;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;char&lt;/span&gt; segment &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; block &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;char&lt;/span&gt; xfers &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; segment &lt;span style=&#34;color:#ff79c6&#34;&gt;?&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; ret, retries &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;5&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * The core I2C driver will automatically retry the transfer if the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * adapter reports EAGAIN. However, we find that bit-banging transfers
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * are susceptible to errors under a heavily loaded machine and
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * generate spurious NAKs and timeouts. Retrying the transfer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * of the individual block a few times seems to overcome this.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;do&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; i2c_msg msgs[] &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .addr	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; DDC_SEGMENT_ADDR,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .flags	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .len	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .buf	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;segment,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        }, {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .addr	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; DDC_ADDR,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .flags	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .len	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .buf	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;start,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        }, {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .addr	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; DDC_ADDR,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .flags	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; I2C_M_RD,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .len	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; len,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                .buf	&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; buf,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * Avoid sending the segment addr to not upset non-compliant
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * DDC monitors.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;i2c_transfer&lt;/span&gt;(adapter, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;msgs[&lt;span style=&#34;color:#bd93f9&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt; xfers], xfers);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (ret &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;ENXIO) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;drm: skipping non-existent adapter %s&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                        adapter&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;name);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#ff79c6&#34;&gt;while&lt;/span&gt; (ret &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; xfers &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;--&lt;/span&gt;retries);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; ret &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; xfers &lt;span style=&#34;color:#ff79c6&#34;&gt;?&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;drm/amd/amdgpu/amggpu_i2c.c&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_i2c_post_xfer&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; i2c_adapter &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;i2c_adap)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_i2c_chan &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;i2c &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;i2c_get_adapdata&lt;/span&gt;(i2c_adap);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;adev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; i2c&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev_private;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_i2c_bus_rec &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;rec &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;i2c&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;rec;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;uint32_t&lt;/span&gt; temp;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* unmask the gpio pins for software use */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        temp &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;RREG32&lt;/span&gt;(rec&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mask_clk_reg) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;~&lt;/span&gt;rec&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mask_clk_mask;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;WREG32&lt;/span&gt;(rec&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mask_clk_reg, temp);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        temp &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;RREG32&lt;/span&gt;(rec&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mask_clk_reg);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        temp &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;RREG32&lt;/span&gt;(rec&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mask_data_reg) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;~&lt;/span&gt;rec&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mask_data_mask;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;WREG32&lt;/span&gt;(rec&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mask_data_reg, temp);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        temp &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;RREG32&lt;/span&gt;(rec&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mask_data_reg);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;mutex_unlock&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;i2c&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mutex);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;之前高英杰的分享中 VGA 会隔 10s 循环读一下 edid。&lt;/p&gt;
&lt;p&gt;gpu/drm/drm_probe_helper.c&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;output_poll_execute&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; work_struct &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;work)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_begin&lt;/span&gt;(dev, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_for_each_connector_iter&lt;/span&gt;(connector, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                repoll &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;status &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_helper_probe_detect&lt;/span&gt;(connector, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (old_status &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;status) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;old, &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;new;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;status &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; connector_status_unknown) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;status &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; old_status;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#ff79c6&#34;&gt;continue&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_end&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;mutex_unlock&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;dev&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode_config.mutex);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;out&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (changed)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_kms_helper_hotplug_event&lt;/span&gt;(dev);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (repoll)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;schedule_delayed_work&lt;/span&gt;(delayed_work, DRM_OUTPUT_POLL_PERIOD);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我对 edid 不太了解， &lt;strong&gt;现在怀疑是 VGA 的循环读 edid 和切换用户时读 edid 同时进行的情况下在 i2c 的层面有了干扰&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;用户与系统-xorg-进程对应方法&#34;&gt;用户与系统 xorg 进程对应方法&lt;/h2&gt;
&lt;p&gt;通过 pstree 可以查看系统的服务启动流程。系统的启动流程大体描述一下：&lt;/p&gt;
&lt;p&gt;创建多个用户，有的登陆，有的不登陆。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;uos@uos-PC:~$ loginctl list-sessions
SESSION  UID USER    SEAT  TTY
      1 1000 uos     seat0
     10 1004 test4   seat0
     12 1007 test7   seat0
     16 1006 test6   seat0
     19 1008 test8   seat0
     32 1000 uos           pts/2
      4 1002 test2   seat0
      7 1001 test1   seat0
     c7  116 lightdm seat0

9 sessions listed.

uos@uos-PC:~$ loginctl show-session 1
Id=1
User=1000
Name=uos
Timestamp=Tue 2023-10-24 10:44:15 CST
TimestampMonotonic=4856519
VTNr=1
Seat=seat0
Display=:0
Remote=no
Service=lightdm-autologin
Desktop=deepin
Scope=session-1.scope
Leader=1137
Audit=1
Type=x11
Class=user
Active=no
State=online
IdleHint=no
IdleSinceHint=0
IdleSinceHintMonotonic=0
LockedHint=no

uos@uos-PC:~$ ps -ef|grep xorg|grep -v grep
root       987   839  0 10月24 tty1   00:00:17 /usr/lib/xorg/Xorg -background none :0
root      3108   839  0 10月24 tty2   00:00:10 /usr/lib/xorg/Xorg -background none :1
root      5265   839  0 10月24 tty3   00:00:04 /usr/lib/xorg/Xorg -background none :2
root      6921   839  0 10月24 tty4   00:00:05 /usr/lib/xorg/Xorg -background none :3
root      8327   839  0 10月24 tty5   00:00:04 /usr/lib/xorg/Xorg -background none :4
root      9802   839  0 10月24 tty6   00:00:07 /usr/lib/xorg/Xorg -background none :5
root     25787   839  0 10月24 tty7   00:00:05 /usr/lib/xorg/Xorg -background none :6
root     27291   839  0 10月24 tty8   00:00:05 /usr/lib/xorg/Xorg -background none :7
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;上面的“:0” 是 X Display Server 的名字。&lt;/p&gt;
&lt;h2 id=&#34;使用-perf-来调试&#34;&gt;使用 perf 来调试&lt;/h2&gt;
&lt;p&gt;关于 perf 的使用可以看另一篇博客： &lt;a class=&#34;link&#34; href=&#34;https://guolongji.xyz/post/use-perf-and-flame-graph/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://guolongji.xyz/post/use-perf-and-flame-graph/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;目的是找两个己经登陆的用户的两个不同的 Xorg 进程，对这两个不同的进程用 perf 工具进行统计。这两个进程都是在运行当中的，如果 perf 能够同时对两个 xorg 的进程进行分析，那么就可以打到耗时的地方。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;uos@uos-PC:~$ ps -ef|grep kwin|grep -v grep
uos       1331  1172  0 10月24 ?      00:00:00 /bin/sh /usr/bin/kwin_no_scale
uos       1387  1331  0 10月24 ?      00:00:18 kwin_x11 -platform dde-kwin-xcb:appFilePath=/usr/bin/kwin_no_scale
test2     4171  3977  0 10月24 ?      00:00:00 /bin/sh /usr/bin/kwin_no_scale
test2     4261  4171  0 10月24 ?      00:00:09 kwin_x11 -platform dde-kwin-xcb:appFilePath=/usr/bin/kwin_no_scale
test1     5701  5541  0 10月24 ?      00:00:00 /bin/sh /usr/bin/kwin_no_scale
test1     5809  5701  0 10月24 ?      00:00:01 kwin_x11 -platform dde-kwin-xcb:appFilePath=/usr/bin/kwin_no_scale
test4     7353  7196  0 10月24 ?      00:00:00 /bin/sh /usr/bin/kwin_no_scale
test4     7463  7353  0 10月24 ?      00:00:01 kwin_x11 -platform dde-kwin-xcb:appFilePath=/usr/bin/kwin_no_scale
test7     8726  8572  0 10月24 ?      00:00:00 /bin/sh /usr/bin/kwin_no_scale
test7     8822  8726  0 10月24 ?      00:00:01 kwin_x11 -platform dde-kwin-xcb:appFilePath=/usr/bin/kwin_no_scale
test6    24815 24625  0 10月24 ?      00:00:00 /bin/sh /usr/bin/kwin_no_scale
test6    24891 24815  0 10月24 ?      00:00:00 kwin_x11 -platform dde-kwin-xcb:appFilePath=/usr/bin/kwin_no_scale
test8    26225 26070  0 10月24 ?      00:00:00 /bin/sh /usr/bin/kwin_no_scale
test8    26316 26225  0 10月24 ?      00:00:01 kwin_x11 -platform dde-kwin-xcb:appFilePath=/usr/bin/kwin_no_scale

uos@uos-PC:~$ cat /proc/1387/environ |grep -a --color DISPLAY
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;观察两个变量分别是 :0 和 :6&lt;/p&gt;
&lt;p&gt;那么对应的两个进程号就是 987 和 25787。&lt;/p&gt;
&lt;p&gt;用 perf 来监视的话，分别在两个目录下运行：&lt;/p&gt;
&lt;p&gt;perf record -p 987 -g  &amp;ndash; sleep 30&lt;/p&gt;
&lt;p&gt;perf record -p 25787 -g  &amp;ndash; sleep 30&lt;/p&gt;
&lt;p&gt;测试部步是先两个 ssh 在两个不同的目录运行两个进程的采样任务。手动在被测试的机器上切换 uos 和 test8 两个用户，现象是经过 6 到 7 次，没有黑屏，最后一次黑屏。经过 10s 之后采样结束。&lt;/p&gt;
&lt;p&gt;生成的图如下：&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231026_172216.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;xorg 的时钟占比为 94%，而 drm_get_edid 的时钟占比高达 32%。&lt;/p&gt;
&lt;p&gt;显然被测试的 oland 显卡 drm_do_probe_ddc_edid 这个过程是有时候比较慢的。一直切换会由“经常不黑屏”的状态变为经常黑屏的状态。所以猜测是存在什么循环。&lt;/p&gt;
&lt;h2 id=&#34;为什么-xorg-的数量比登陆的用户数多一个&#34;&gt;为什么 xorg 的数量比登陆的用户数多一个？&lt;/h2&gt;
&lt;p&gt;因为 lightdm-deepin-greeter 也会创建一个 xorg 用于过渡。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;uos@uos-PC:~$ ps -ef|grep greeter|grep -v grep
lightdm  27361 27344  0 10月24 ?      00:00:00 /bin/bash /usr/bin/deepin-greeter
lightdm  27376 27361  0 10月24 ?      00:00:00 /bin/bash /usr/share/dde-session-shell/greeters.d/x/lightdm-deepin-greeter
lightdm  27377 27376  0 10月24 ?      00:00:02 /usr/lib/deepin-daemon/greeter-display-daemon
lightdm  27379 27376  0 10月24 ?      00:00:00 /bin/bash /usr/share/dde-session-shell/greeters.d/launch-binary
lightdm  27407 27379  0 10月24 ?      00:00:33 /usr/bin/lightdm-deepin-greeter
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;能不能写一个切换用户的脚本呢&#34;&gt;能不能写一个切换用户的脚本呢？&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;while&lt;/span&gt; true; &lt;span style=&#34;color:#ff79c6&#34;&gt;do&lt;/span&gt; qdbus --system org.freedesktop.login1 /org/freedesktop/login1/seat/seat0 &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;org.freedesktop.login1.Seat.SwitchToNext; sleep 2; qdbus --system org.freedesktop.login1 &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;/org/freedesktop/login1/seat/seat0 org.freedesktop.login1.Seat.SwitchToPrevious; sleep 2; &lt;span style=&#34;color:#ff79c6&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;用 dbus 信号去切 tty 是没有问题的。与窗管的同事沟通了解到。dde-dock 可能是会刷新 edid 的状态，而用上面的命令不会刷新 edid 的状态，那么也就不会出现黑屏的问题了。那现在这个问题的的原因就基本上清晰了。&lt;/p&gt;
&lt;p&gt;之前廖元用的脚本是这个：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;n&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;((&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$n&lt;/span&gt;&amp;lt;100&lt;span style=&#34;color:#ff79c6&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sh -c &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;gdbus call --system --dest org.freedesktop.login1 --object-path /org/freedesktop/login1 \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;--method org.freedesktop.login1.Manager.ActivateSession 2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$n&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;n&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;$((&lt;/span&gt;n+1&lt;span style=&#34;color:#ff79c6&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sleep &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sh -c &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;gdbus call --system --dest org.freedesktop.login1 --object-path /org/freedesktop/login1 \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;--method org.freedesktop.login1.Manager.ActivateSession c2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        sleep &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;其它的相关-bug&#34;&gt;其它的相关 bug&lt;/h2&gt;
&lt;p&gt;机缘巧合之下，在 4.19 内核里发现了 radeon 驱动一个很神奇的问题，插拔 hdmi 线时候，先拔出一半等 10s 左右再全部拔出。这时候，在 sys 下读到的 hdmi 连接状态还是 connected。这个感觉还是很神奇的。切到 amdgpu 之后，也有这个问题。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.51cto.com/u_15155099/2767298&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.51cto.com/u_15155099/2767298&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;HDMI 拔出正常逻辑应该是：HPD 探测到电压变化触发中断，接下来 DDC 读取显示器 EDID 返回失败，最终到 dvi_detect 函数中，通过 DDC 返回的失败，设置显示器连接状态为 disconnected。&lt;/p&gt;
&lt;p&gt;在这个问题中，HDMI 拔出，HPD 探测到电压变化中断触发，DDC 读取显示器 EDID 返回成功，detect 函数设置显示器连接状态是 connected。那真正出错的位置是 DDC 不应该读取到 EDID。&lt;/p&gt;
&lt;p&gt;oland 显卡读取 edid 的逻辑有大问题。&lt;/p&gt;
&lt;h2 id=&#34;什么是-edid&#34;&gt;什么是 EDID？&lt;/h2&gt;
&lt;p&gt;edid 核心的内容都在这里了：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.graniteriverlabs.com.cn/technical-blog/edid-overview/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.graniteriverlabs.com.cn/technical-blog/edid-overview/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://en.wikipedia.org/wiki/Extended_Display_Identification_Data&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://en.wikipedia.org/wiki/Extended_Display_Identification_Data&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.wpgdadatong.com.cn/blog/detail/72670&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.wpgdadatong.com.cn/blog/detail/72670&lt;/a&gt;&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231027_145247.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;而目前我们所采用的是 EDID1.3 版本，EDID1.0、EDID1.1、EDID1.2 均已在 2001 年 1 月 1 日停止使用。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;cat /sys/class/drm/card0-VGA-1/edid |hexdump -C
# 或者：cat /sys/class/drm/card0-HDMI-A-1/edid | hexdump -C
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;view sonic 的显示器举例：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;下面是 VGA 的 edid：&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;00000000  00 ff ff ff ff ff ff 00  5a 63 22 3a 01 01 01 01  |........Zc&amp;#34;:....|
00000010  29 1e 01 03 08 35 1d 78  2e e0 f5 a5 55 52 a0 27  |)....5.x....UR.&amp;#39;|
00000020  0c 50 54 bf ef 80 b3 00  a9 40 a9 c0 95 00 90 40  |.PT......@.....@|
00000030  81 80 81 40 81 c0 02 3a  80 18 71 38 2d 40 58 2c  |...@...:..q8-@X,|
00000040  45 00 0f 29 21 00 00 1e  00 00 00 ff 00 57 36 38  |E..)!........W68|
00000050  32 30 34 31 32 30 30 39  33 0a 00 00 00 fd 00 32  |204120093......2|
00000060  4b 18 52 11 00 0a 20 20  20 20 20 20 00 00 00 fc  |K.R...      ....|
00000070  00 56 41 32 34 33 31 2d  48 2d 32 0a 20 20 00 74  |.VA2431-H-2.  .t|
00000080
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;下面是 HDMI 的 edid：&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;00000000  00 ff ff ff ff ff ff 00  5a 63 3a c6 01 01 01 01  |........Zc:.....|
00000010  1e 1e 01 03 80 35 1d 78  2e b4 85 a3 56 50 a0 26  |.....5.x....VP.&amp;amp;|
00000020  0f 50 54 bf ef 80 b3 00  a9 40 a9 c0 95 00 90 40  |.PT......@.....@|
00000030  81 80 81 40 81 c0 02 3a  80 18 71 38 2d 40 58 2c  |...@...:..q8-@X,|
00000040  45 00 0f 28 21 00 00 1e  00 00 00 fd 00 32 4b 18  |E..(!........2K.|
00000050  52 11 00 0a 20 20 20 20  20 20 00 00 00 fc 00 56  |R...      .....V|
00000060  41 32 34 36 32 2d 48 0a  20 20 20 20 00 00 00 ff  |A2462-H.    ....|
00000070  00 57 42 31 32 30 33 30  30 35 33 34 34 0a 00 17  |.WB1203005344...|
00000080
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重点看：&lt;/p&gt;
&lt;p&gt;1.12h 和 13h，分别是 01 和 03。这就表明是 edid 1.3 版本，且不包含括展块。&lt;/p&gt;
&lt;p&gt;2.23h 至 25h 为 Established timing，早期的分辨率信息。上面的是 bf ef 80，即：&lt;/p&gt;
&lt;p&gt;1011 1111
1110 1111
1000 0000&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231027_152110.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;通过 xrandr 看能对应上显示器的信息：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;uos@guolongji:~/Desktop$ xrandr
Screen 0: minimum 320 x 200, current 1920 x 1080, maximum 16384 x 16384
HDMI-0 disconnected (normal left inverted right x axis y axis)
DVI-0 disconnected (normal left inverted right x axis y axis)
VGA-0 connected primary 1920x1080+0+0 (normal left inverted right x axis y axis) 527mm x 297mm
   1920x1080     60.00*+
   1600x1200     60.00     1680x1050     59.95
   1400x1050     59.98     1600x900      60.00
   1280x1024     75.02    60.02     1440x900      59.89
   1280x960      60.00     1152x864      75.00
   1280x720      60.00     1024x768      75.03    70.07    60.00
   832x624       74.55
   800x600       72.19    75.00    60.32    56.25
   640x480       75.00    72.81    66.67    59.94
   720x400       70.08
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3.从 26h 到 35h，16 个 bit，每两个 bit 表示一个标准分辨率，即：b3 00 a9 40 a9 c0 95 00 90 40 81 80 81 40 81 c0&lt;/p&gt;
&lt;p&gt;10110011 00000000&lt;/p&gt;
&lt;p&gt;10100110 01000000&lt;/p&gt;
&lt;p&gt;10100110 11010000&lt;/p&gt;
&lt;p&gt;01100101 00000000&lt;/p&gt;
&lt;p&gt;01100000 01000000&lt;/p&gt;
&lt;p&gt;10000001 10000000&lt;/p&gt;
&lt;p&gt;10000001 01000000&lt;/p&gt;
&lt;p&gt;10000001 11010000&lt;/p&gt;
&lt;p&gt;拿 10110011 00000000 来举例：10110011 即 b3， 179，加上 31 即 210，乘以 8，即 1680，这个是 1680 的那个分辨率的信息。&lt;/p&gt;
&lt;p&gt;4.那么 1920 那个分辨率的信息是怎么拿到的呢？&lt;/p&gt;
&lt;p&gt;02 3a  80 18 71 38 2d 40 58 2c 45 00 0f 28 21 00 00 1e&lt;/p&gt;
&lt;p&gt;从 established timing 到 standard timing 到 Detailed timing descriptor，分辨率的解析就很麻烦。&lt;/p&gt;
&lt;p&gt;这个的解析比较麻烦，可以参考：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://winddoing.github.io/post/47714.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://winddoing.github.io/post/47714.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;有一个站可以解析 edid： &lt;a class=&#34;link&#34; href=&#34;http://www.edidreader.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://www.edidreader.com/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;开源的解析工具很多，&lt;a class=&#34;link&#34; href=&#34;https://github.com/dgallegos/edidreader&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/dgallegos/edidreader&lt;/a&gt; ，供参考。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;是不是 e-edid&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;edid 可能是 128 个 bit，也可能是 256 个 bit。分为 block0 和 block1 两部分。block1 叫 Extension block。&lt;/p&gt;
&lt;p&gt;block1 可以没有。Block0 已对显示器的功能进行基本的描述，像是产品信息和支持的分辨率等等，但如果显示器要额外支持一些 HDMI 进阶功能：如色深、音讯格式、3D，此时就需要使用 Extension block 来描述。Extension block 的格式总共有下列几种，但在 HDMI 规范中必须至少使用一个 CEA-EXT。&lt;/p&gt;
&lt;p&gt;倒数第二个字节是 Extension Block(s)  : 0，就不是 e-edid，非 0 就是。&lt;/p&gt;
&lt;h2 id=&#34;fqa&#34;&gt;FQA&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;为什么系统下和芯片中都需要包含固件代码？（显卡 vbios 和系统下的 bin）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在很多硬件设备中，特别是芯片、固件和驱动程序之间的关系非常紧密。固件代码通常被设计用于与硬件交互，并为操作系统或其他软件提供硬件相关的功能和操作。因此，在某些情况下，固件代码需要同时存在于硬件设备中和操作系统文件系统中。&lt;/p&gt;
&lt;p&gt;具体来说，设备固件通常存储在硬件设备的非易失性存储器中，例如闪存、EEPROM 或 ROM 芯片中。这些固件代码包含了设备的基本操作和配置信息，以及一些初始化程序和驱动程序。&lt;/p&gt;
&lt;p&gt;然而，在某些情况下，固件代码需要在操作系统中使用。例如，在 Linux 系统中，设备驱动程序通常需要使用固件代码才能正确地初始化和配置设备，从而使设备在操作系统中正常工作。因此，固件代码必须以某种方式从设备中传输到操作系统中。&lt;/p&gt;
&lt;p&gt;为此，Linux 等操作系统提供了一种机制，允许将固件代码复制到操作系统文件系统中的某个位置，以便设备驱动程序在需要时可以加载并使用它。这就是为什么在系统中也需要包含固件代码。操作系统中的这些固件文件通常放置在/lib/firmware 目录中。&lt;/p&gt;
&lt;p&gt;总之，固件代码需要同时存在于硬件设备中和操作系统文件系统中，因为它们在共同协作以使设备得以正常工作。&lt;/p&gt;
&lt;h2 id=&#34;分析有误-继续&#34;&gt;分析有误，继续&lt;/h2&gt;
&lt;p&gt;不是问题，之前分析有误，加一些打印就能发现，读取 edid 的时间根本就不长。要分析什么时候会调用和产生黑屏。这个黑屏遮罩的方法的调用者都有谁，这个问窗管应该就可以了。不行再问题闫博文。&lt;/p&gt;
&lt;p&gt;找到这些项目，申请代码树权限。后续，分析什么情况下调用黑屏遮罩的方法。&lt;/p&gt;
&lt;h2 id=&#34;继续&#34;&gt;继续&lt;/h2&gt;
&lt;p&gt;lightdm-gtk-greeter（即是包名也是程序名）；dde-session-shell 的 dde-lock。看不懂这些应用是怎么放到一起组合起来的。系统是怎么组合起来的，这个是个相当复杂的问题。&lt;/p&gt;
&lt;p&gt;xset dpms force off，这个命令可以设置黑屏。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat /sys/class/drm/card*/dpms
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo nano /etc/default/grub
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;GRUB_CMDLINE_LINUX&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;quiet splash drm.debug=0x04&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo update-grub
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在 Linux 内核中，drm.debug 参数用于控制 DRM（Direct Rendering Manager）子系统的调试输出。这个参数可以接受不同数值，每个数值代表一种不同的调试级别，通常使用十六进制表示。&lt;/p&gt;
&lt;p&gt;常见的 drm.debug 参数取值包括：&lt;/p&gt;
&lt;p&gt;0x01：启用基本的 DRM 调试信息&lt;/p&gt;
&lt;p&gt;0x04：启用详细的 DRM 调试信息&lt;/p&gt;
&lt;p&gt;0x10：启用扩展的 DRM 调试信息&lt;/p&gt;
&lt;p&gt;0x40：启用更多的 DRM 调试信息&lt;/p&gt;
&lt;p&gt;0x100：启用所有可用的 DRM 调试信息&lt;/p&gt;
&lt;p&gt;你可以根据需要将这些数值进行组合，以启用多个级别的调试信息。例如，如果你想同时启用基本的调试信息和详细的调试信息，可以将数值相加，如 0x01 + 0x04 = 0x05。&lt;/p&gt;
&lt;p&gt;在实际使用中，根据需求选择合适的调试级别，以便获取所需的调试信息，同时避免产生过多无关的日志输出。&lt;/p&gt;
&lt;p&gt;现在要做的事就是打开 drm 的调整试信息，然后做测试，这个还是很简单的。&lt;/p&gt;
&lt;p&gt;打开了调式之后，发现 amdgpu_atombios_encoder_dpms 这个函数调用的次数是有区别的，没问题的时候调用一次，而有问题的时个会调用多次。&lt;/p&gt;
&lt;p&gt;打印的日志是：&lt;/p&gt;
&lt;p&gt;[ 1268.188110] [drm:amdgpu_atombios_encoder_dpms [amdgpu]] encoder dpms 30 to mode 3, devices 00000008,
active_devices 00000008&lt;/p&gt;
&lt;p&gt;为什么打印一次的时候就闪一下屏，而打印多次的时候就会有黑屏的现象？是什么导致了这个日志有时候会打印多次呢？&lt;/p&gt;
&lt;p&gt;现在要分析一下什么情况下会调用 amdgpu_atombios_encoder_dpms ，或者直接加上一个 WARN_ON(1) 来分析这个问题。&lt;/p&gt;
&lt;p&gt;调用的地方并不多，如下：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;drivers/gpu/drm/amd/amdgpu/dce_v6_0.c:3089:	amdgpu_atombios_encoder_dpms(encoder, DRM_MODE_DPMS_OFF);
drivers/gpu/drm/amd/amdgpu/dce_v6_0.c:3147:	amdgpu_atombios_encoder_dpms(encoder, DRM_MODE_DPMS_ON);
drivers/gpu/drm/amd/amdgpu/dce_v6_0.c:3158:	amdgpu_atombios_encoder_dpms(encoder, DRM_MODE_DPMS_OFF);
drivers/gpu/drm/amd/amdgpu/dce_v6_0.c:3217:	.dpms = amdgpu_atombios_encoder_dpms,
drivers/gpu/drm/amd/amdgpu/dce_v6_0.c:3227:	.dpms = amdgpu_atombios_encoder_dpms,
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;下面这个函数是设置 mode set 的：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;dce_v6_0_encoder_mode_set&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;encoder,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_display_mode &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;mode,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                          &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_display_mode &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;adjusted_mode)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;amdgpu_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;to_amdgpu_encoder&lt;/span&gt;(encoder);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; em &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_atombios_encoder_get_encoder_mode&lt;/span&gt;(encoder);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        amdgpu_encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;pixel_clock &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; adjusted_mode&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;clock;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* need to call this here rather than in prepare() since we need some crtc info */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_atombios_encoder_dpms&lt;/span&gt;(encoder, DRM_MODE_DPMS_OFF);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* set scaler clears this on some chips */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;dce_v6_0_set_interleave&lt;/span&gt;(encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc, mode);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (em &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; ATOM_ENCODER_MODE_HDMI &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;ENCODER_MODE_IS_DP&lt;/span&gt;(em)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;dce_v6_0_afmt_enable&lt;/span&gt;(encoder, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;dce_v6_0_afmt_setmode&lt;/span&gt;(encoder, adjusted_mode);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;下面这个函数是提交的，难道设置完成之后需要再提交一下吗？&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;dce_v6_0_encoder_commit&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;encoder)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;adev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; dev&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev_private;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* need to call this here as we need the crtc set up */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_atombios_encoder_dpms&lt;/span&gt;(encoder, DRM_MODE_DPMS_ON);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_atombios_scratch_regs_lock&lt;/span&gt;(adev, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;encoder disable ，这个 encoder 是什么东西？&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;dce_v6_0_encoder_disable&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;encoder)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;amdgpu_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;to_amdgpu_encoder&lt;/span&gt;(encoder);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_encoder_atom_dig &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dig;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; em &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_atombios_encoder_get_encoder_mode&lt;/span&gt;(encoder);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_atombios_encoder_dpms&lt;/span&gt;(encoder, DRM_MODE_DPMS_OFF);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_atombios_encoder_is_digital&lt;/span&gt;(encoder)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (em &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; ATOM_ENCODER_MODE_HDMI &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;ENCODER_MODE_IS_DP&lt;/span&gt;(em))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;dce_v6_0_afmt_enable&lt;/span&gt;(encoder, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;false&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                dig &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; amdgpu_encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;enc_priv;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                dig&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dig_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        amdgpu_encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;active_device &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;dig_helper 这个又是什么东西？&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_encoder_helper_funcs dce_v6_0_dig_helper_funcs &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .dpms &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; amdgpu_atombios_encoder_dpms,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .mode_fixup &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; amdgpu_atombios_encoder_mode_fixup,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .prepare &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; dce_v6_0_encoder_prepare,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .mode_set &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; dce_v6_0_encoder_mode_set,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .commit &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; dce_v6_0_encoder_commit,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .disable &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; dce_v6_0_encoder_disable,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .detect &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; amdgpu_atombios_encoder_dig_detect,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;dac_helper ，这个又是什么东西？&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_encoder_helper_funcs dce_v6_0_dac_helper_funcs &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .dpms &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; amdgpu_atombios_encoder_dpms,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .mode_fixup &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; amdgpu_atombios_encoder_mode_fixup,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .prepare &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; dce_v6_0_encoder_prepare,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .mode_set &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; dce_v6_0_encoder_mode_set,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .commit &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; dce_v6_0_encoder_commit,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .detect &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; amdgpu_atombios_encoder_dac_detect,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;drm_encoder&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;drm_encoder 在 Linux 系统中用于表示显示控制器的硬件模块，负责管理和控制显示信号的生成和传输，以确保图形数据能够正确地显示在相应的显示设备上。&lt;/p&gt;
&lt;p&gt;在这个 amdgpu_atombios_encoder_dpms 的函数里面加上 WARN_ON(1) 查看不同情况下的调用者是否有什么不同。&lt;/p&gt;
&lt;p&gt;使用 WARN_ON(1) 没有显示出来新的调用信息，难道这块不是内核的内容就无法打开吗？记的不对，那换成 dump_stack();
这个重新编译一个内核试试。&lt;/p&gt;
&lt;p&gt;上层用的是这个函数设置的：&lt;/p&gt;
&lt;p&gt;extern Status DPMSForceLevel(Display *, CARD16);&lt;/p&gt;
&lt;p&gt;是 libxext 这个包。下载包，看这个函数的实现：&lt;/p&gt;
&lt;p&gt;在 src/DPMS.c 这个文件下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Status
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;DPMSForceLevel&lt;/span&gt;(Display &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dpy, CARD16 level)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    XExtDisplayInfo &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;info &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;find_display&lt;/span&gt; (dpy);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;register&lt;/span&gt; xDPMSForceLevelReq &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;req;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;DPMSCheckExtension&lt;/span&gt; (dpy, info, &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; ((level &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; DPMSModeOn) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        (level &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; DPMSModeStandby) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        (level &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; DPMSModeSuspend) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        (level &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; DPMSModeOff))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; BadValue;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;LockDisplay&lt;/span&gt;(dpy);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;GetReq&lt;/span&gt;(DPMSForceLevel, req);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    req&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;reqType &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; info&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;codes&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;major_opcode;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    req&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dpmsReqType &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; X_DPMSForceLevel;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    req&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;level &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; level;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;UnlockDisplay&lt;/span&gt;(dpy);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;SyncHandle&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里面的 SyncHandle 在 X11/Xlibint.h 这个头文件当中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#define SyncHandle() \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;        if (dpy-&amp;gt;synchandler) (*dpy-&amp;gt;synchandler)(dpy)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;有 SyncHandle 那么是不是还有 AsyncHandle 呢？确实是有的：&lt;/p&gt;
&lt;p&gt;有两个，一个是 _XDeqAsyncHandler ，另外一个是 DeqAsyncHandler 这两个一看就是出队列的。那谁是入队列的呢？&lt;/p&gt;
&lt;p&gt;我可以把 X11 的代码放到一个地方，用 tag 来查一下。所有的相关的代码包含哪些？&lt;/p&gt;
&lt;p&gt;在 X11 协议中，&amp;ldquo;dpmsReqType&amp;rdquo; 是用于控制显示器电源管理的请求类型。根据协议文档，有以下几种 dpmsReqType 的取值：&lt;/p&gt;
&lt;p&gt;DPMSGetVersion：获取 DPMS 扩展的版本信息。&lt;/p&gt;
&lt;p&gt;DPMSCapable：检查服务器是否支持 DPMS 扩展。&lt;/p&gt;
&lt;p&gt;DPMSGetTimeouts：获取当前的 DPMS 超时设置（激活、关闭和关闭后重新打开的超时时间）。&lt;/p&gt;
&lt;p&gt;DPMSSetTimeouts：设置 DPMS 的超时时间。&lt;/p&gt;
&lt;p&gt;DPMSEnable：启用 DPMS 功能。&lt;/p&gt;
&lt;p&gt;DPMSDisable：禁用 DPMS 功能。&lt;/p&gt;
&lt;p&gt;DPMSForceLevel：强制设置显示器的电源状态。&lt;/p&gt;
&lt;p&gt;DPMSInfo：获取关于显示器电源状态的信息。&lt;/p&gt;
&lt;p&gt;这些请求类型用于控制显示器的电源管理行为，例如启用或禁用 DPMS 功能、查询支持的功能和状态、设置超时时间以及强制改变显示器的电源状态等。&lt;/p&gt;
&lt;p&gt;需要注意的是，具体实现可能会有所不同，不同的 X11 服务器可能支持不同的请求类型或者有其他自定义的扩展类型。因此，对于特定的 X11 服务器或库，最好参考其相关文档以了解支持的 dpmsReqType 类型。&lt;/p&gt;
&lt;p&gt;设置显示器黑屏除了 DPMSForceLevel 外还有别的方法吗？有的。&lt;/p&gt;
&lt;p&gt;除了使用 DPMS 扩展的 DPMSForceLevel 命令外，还可以通过其他方式控制显示器黑屏。下面列出几种可能的方法。&lt;/p&gt;
&lt;p&gt;调用 XResetScreenSaver 函数：这个函数可以重置屏幕保护程序的计时器，防止显示器进入屏幕保护模式。如果需要让显示器立即停止显示内容，可以反复调用该函数并传入一个较小的时间值，例如 1 秒。&lt;/p&gt;
&lt;p&gt;使用 X11 的 RandR 扩展：RandR（Resize and Rotate）是 X11 的一个扩展，它可以让客户端程序在运行时改变显示器的分辨率和方向。RandR 扩展中包含了一些控制显示器电源管理的命令，例如 RROutputSetDPMSMode
和 RROutputSetProperty。通过调用这些命令，可以实现关闭显示器或者使其进入省电模式。&lt;/p&gt;
&lt;p&gt;调用显卡驱动程序提供的 API：显卡驱动程序通常会提供一些 API，用于控制显示器的电源管理行为。例如，NVIDIA
的 Linux 显卡驱动程序提供了 nvidia-settings 命令行工具，可以用于配置和控制 NVIDIA 显卡的各种设置，包括显示器电源管理。&lt;/p&gt;
&lt;p&gt;需要注意的是，这些方法的实现可能会因操作系统、显卡驱动程序和硬件配置等因素而异。在实际开发中，应该根据具体的需求选择最合适的方法，并参考相关文档以确保其在目标平台上的可用性。&lt;/p&gt;
&lt;p&gt;看现象有可能是调用了 XResetScreenSaver 这个函数。但是有的时候不调用，有的时候调用。&lt;/p&gt;
&lt;p&gt;x_all 下搜 XSetScreenSaver 这个函数：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/** Initialize DPMS support.  We save the current settings and turn off
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * DPMS.  The settings are restored in #dmxDPMSTerm. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;dmxDPMSInit&lt;/span&gt;(DMXScreenInfo &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; dmxScreen)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; interval, preferBlanking, allowExposures;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;/* Turn off DPMS */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;_dmxDPMSInit&lt;/span&gt;(dmxScreen))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; FALSE;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;dmxScreen&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;beDisplay)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; FALSE;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;/* Turn off screen saver */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;XGetScreenSaver&lt;/span&gt;(dmxScreen&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;beDisplay, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;dmxScreen&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;savedTimeout, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;interval,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;preferBlanking, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;allowExposures);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;XSetScreenSaver&lt;/span&gt;(dmxScreen&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;beDisplay, &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;, interval,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    preferBlanking, allowExposures);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;XResetScreenSaver&lt;/span&gt;(dmxScreen&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;beDisplay);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;dmxSync&lt;/span&gt;(dmxScreen, FALSE);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; TRUE;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Distributed Multihead X（dmx）服务器是 X Window System 的一个组件，用于将多个物理显示器组合成一个虚拟的大显示器。它允许用户在多个计算机上连接多个显示器，并将它们视为一个逻辑上连续的显示区域。&lt;/p&gt;
&lt;p&gt;我怀疑是这里走到了不同的分支了，所以有时候黑屏，有时候不黑屏。那可以加个日志看看，但是 xorg 我不知道怎么编译和加日志，先尝试一下看看。&lt;/p&gt;
&lt;p&gt;xserver-xorg-core 这个是有 debug 包的，那我能不能安装了 debug 包用 gdb 来调试一下看看是进入了哪个分支呢？理论上应该是可以的。那能不能用 bpf-trace 呢？这个和内核有关，好像没什么关系。&lt;/p&gt;
&lt;p&gt;方向不对，这个 xdmx 这个是个 x11 的插件，并没有安装，方向是错的。&lt;/p&gt;
&lt;p&gt;在从 startdde 看一下：&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231122_175228.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;dde_wldpms 这个东西不是在 X11 下使用的，这个也排除了。&lt;/p&gt;
&lt;p&gt;就省下一个函数要看了：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;setDPMSMode&lt;/span&gt;(on &lt;span style=&#34;color:#8be9fd&#34;&gt;bool&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;var&lt;/span&gt; err &lt;span style=&#34;color:#8be9fd&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; _useWayland {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; !on {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        _, err = exec.&lt;span style=&#34;color:#50fa7b&#34;&gt;Command&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;dde_wldpms&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;-s&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;Off&amp;#34;&lt;/span&gt;).&lt;span style=&#34;color:#50fa7b&#34;&gt;Output&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        _, err = exec.&lt;span style=&#34;color:#50fa7b&#34;&gt;Command&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;dde_wldpms&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;-s&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;On&amp;#34;&lt;/span&gt;).&lt;span style=&#34;color:#50fa7b&#34;&gt;Output&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;var&lt;/span&gt; mode = &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;uint16&lt;/span&gt;(dpms.DPMSModeOn)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; !on {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        mode = &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;uint16&lt;/span&gt;(dpms.DPMSModeOff)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                err = dpms.&lt;span style=&#34;color:#50fa7b&#34;&gt;ForceLevelChecked&lt;/span&gt;(_xConn, mode).&lt;span style=&#34;color:#50fa7b&#34;&gt;Check&lt;/span&gt;(_xConn)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; err &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                logger.&lt;span style=&#34;color:#50fa7b&#34;&gt;Warning&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;Failed to set dpms mode:&amp;#34;&lt;/span&gt;, on, err)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ForceLevelChecked 这个函数。这个函数调用了多次，可以在这个地方加一下打印？&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231122_175958.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;看了 syslog 的日志中有 startdde 的，但是感觉又不像是上层导致的内核出现多次的打印，再继续分析 drm
框架的调用过程吧。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#ifdef CONFIG_LOCKDEP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; lockdep_map connector_list_iter_dep_map &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        .name &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;drm_connector_list_iter&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;// ......
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * drm_connector_list_iter_begin - initialize a connector_list iterator
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @dev: DRM device
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @iter: connector_list iterator
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Sets @iter up to walk the &amp;amp;drm_mode_config.connector_list of @dev. @iter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * must always be cleaned up again by calling drm_connector_list_iter_end().
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Iteration itself happens using drm_connector_list_iter_next() or
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * drm_for_each_connector_iter().
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_begin&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dev,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                   &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_connector_list_iter &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;iter)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        iter&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; dev;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        iter&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;conn &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;lock_acquire_shared_recursive&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;connector_list_iter_dep_map, &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;, _RET_IP_);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;EXPORT_SYMBOL&lt;/span&gt;(drm_connector_list_iter_begin);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * drm_crtc_helper_set_config - set a new config from userspace
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @set: mode set configuration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @ctx: lock acquire context, not used here
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * The drm_crtc_helper_set_config() helper function implements the of
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * &amp;amp;drm_crtc_funcs.set_config callback for drivers using the legacy CRTC
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * helpers.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * It first tries to locate the best encoder for each connector by calling the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * connector @drm_connector_helper_funcs.best_encoder helper operation.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * After locating the appropriate encoders, the helper function will call the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * mode_fixup encoder and CRTC helper operations to adjust the requested mode,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * or reject it completely in which case an error will be returned to the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * application. If the new configuration after mode adjustment is identical to
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * the current configuration the helper function will return without performing
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * any other operation.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * If the adjusted mode is identical to the current mode but changes to the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * frame buffer need to be applied, the drm_crtc_helper_set_config() function
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * will call the CRTC &amp;amp;drm_crtc_helper_funcs.mode_set_base helper operation.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * If the adjusted mode differs from the current mode, or if the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * -&amp;gt;mode_set_base() helper operation is not provided, the helper function
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * performs a full mode set sequence by calling the -&amp;gt;prepare(), -&amp;gt;mode_set()
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * and -&amp;gt;commit() CRTC and encoder helper operations, in that order.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Alternatively it can also use the dpms and disable helper operations. For
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * details see &amp;amp;struct drm_crtc_helper_funcs and struct
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * &amp;amp;drm_encoder_helper_funcs.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * This function is deprecated.  New drivers must implement atomic modeset
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * support, for which this function is unsuitable. Instead drivers should use
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * drm_atomic_helper_set_config().
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Returns:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Returns 0 on success, negative errno numbers on failure.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_crtc_helper_set_config&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_mode_set &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;set,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_modeset_acquire_ctx &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;ctx)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dev;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;**&lt;/span&gt;save_encoder_crtcs, &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;new_crtc;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;**&lt;/span&gt;save_connector_encoders, &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;new_encoder, &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;encoder;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;bool&lt;/span&gt; mode_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;false&lt;/span&gt;; &lt;span style=&#34;color:#6272a4&#34;&gt;/* if true do a full mode set */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;bool&lt;/span&gt; fb_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;false&lt;/span&gt;; &lt;span style=&#34;color:#6272a4&#34;&gt;/* if true and !mode_changed just do a flip */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_connector &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;connector;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_connector_list_iter conn_iter;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; count &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;, ro, fail &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_crtc_helper_funcs &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;crtc_funcs;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_mode_set save_set;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; ret;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; i;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;BUG_ON&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;set);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;BUG_ON&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;BUG_ON&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;helper_private);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* Enforce sane interface api - has been abused by the fb helper. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;BUG_ON&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;BUG_ON&lt;/span&gt;(set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;num_connectors &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        crtc_funcs &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;helper_private;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;[CRTC:%d:%s] [FB:%d] #connectors=%d (x y) (%i %i)&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                              set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;base.id, set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;name,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                              set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;base.id,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                              (&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;)set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;num_connectors, set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;x, set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;y);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;[CRTC:%d:%s] [NOFB]&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                              set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;base.id, set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;name);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_crtc_helper_disable&lt;/span&gt;(set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        dev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_warn_on_modeset_not_all_locked&lt;/span&gt;(dev);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * Allocate space for the backup of all (non-pointer) encoder and
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * connector data.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        save_encoder_crtcs &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;kcalloc&lt;/span&gt;(dev&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode_config.num_encoder,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#ff79c6&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;), GFP_KERNEL);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;save_encoder_crtcs)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;ENOMEM;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        save_connector_encoders &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;kcalloc&lt;/span&gt;(dev&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode_config.num_connector,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#ff79c6&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;), GFP_KERNEL);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;save_connector_encoders) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;kfree&lt;/span&gt;(save_encoder_crtcs);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;ENOMEM;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * Copy data. Note that driver private data is not affected.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * Should anything bad happen only the expected state is
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * restored, not the drivers personal bookkeeping.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        count &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_for_each_encoder&lt;/span&gt;(encoder, dev) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                save_encoder_crtcs[count&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;] &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        count &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_begin&lt;/span&gt;(dev, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_for_each_connector_iter&lt;/span&gt;(connector, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                save_connector_encoders[count&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;] &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_end&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        save_set.crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        save_set.mode &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        save_set.x &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        save_set.y &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        save_set.fb &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;primary&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* We should be able to check here if the fb has the same properties
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * and then just flip_or_move it */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;primary&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/* If we have no fb then treat it as a full mode set */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;primary&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;crtc has no fb, full mode set&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        mode_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;format &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;primary&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;format) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        mode_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        fb_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;x &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;x &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;y &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;y)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                fb_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_mode_equal&lt;/span&gt;(set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;modes are different, full mode set&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_mode_debug_printmodeline&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_mode_debug_printmodeline&lt;/span&gt;(set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                mode_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* take a reference on all unbound connectors in set, reuse the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * already taken reference for bound connectors
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; (ro &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;; ro &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;num_connectors; ro&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connectors[ro]&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;continue&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_get&lt;/span&gt;(set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connectors[ro]);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* a) traverse passed in connector list and get encoders for them */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        count &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_begin&lt;/span&gt;(dev, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_for_each_connector_iter&lt;/span&gt;(connector, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_connector_helper_funcs &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;connector_funcs &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;helper_private;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                new_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; (ro &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;; ro &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;num_connectors; ro&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connectors[ro] &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; connector) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                new_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; connector_funcs&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;best_encoder&lt;/span&gt;(connector);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#6272a4&#34;&gt;/* if we can&amp;#39;t get an encoder for a connector
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                                   we are setting now - then fail */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (new_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                        &lt;span style=&#34;color:#6272a4&#34;&gt;/* don&amp;#39;t break so fail path works correct */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                        fail &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dpms &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; DRM_MODE_DPMS_ON) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                        &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;connector dpms not on, full mode switch&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                        mode_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (new_encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;encoder changed, full mode switch&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        mode_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#6272a4&#34;&gt;/* If the encoder is reused for another connector, then
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                         * the appropriate crtc will be set later.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; new_encoder;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_end&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (fail) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;EINVAL;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; fail;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        count &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_begin&lt;/span&gt;(dev, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_for_each_connector_iter&lt;/span&gt;(connector, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;continue&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        new_crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        new_crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; (ro &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;; ro &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;num_connectors; ro&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connectors[ro] &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; connector)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                new_crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/* Make sure the new CRTC will work with the encoder */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (new_crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_encoder_crtc_ok&lt;/span&gt;(connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder, new_crtc)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;EINVAL;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_end&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; fail;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (new_crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;crtc changed, full mode switch&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        mode_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; new_crtc;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (new_crtc) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;[CONNECTOR:%d:%s] to [CRTC:%d:%s]&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                      connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;base.id, connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;name,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                      new_crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;base.id, new_crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;name);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;[CONNECTOR:%d:%s] to [NOCRTC]&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                      connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;base.id, connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;name);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_end&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* mode_set_base is not a required function */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (fb_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;crtc_funcs&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode_set_base)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                mode_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (mode_changed) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_helper_crtc_in_use&lt;/span&gt;(set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;attempting to set mode from&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                        &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34; userspace&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_mode_debug_printmodeline&lt;/span&gt;(set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;primary&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_crtc_helper_set_mode&lt;/span&gt;(set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc, set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;mode,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                      set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;x, set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;y,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                      save_set.fb)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_ERROR&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;failed to set mode on [CRTC:%d:%s]&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                          set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;base.id, set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;name);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;primary&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; save_set.fb;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;EINVAL;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; fail;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;Setting connector DPMS state to on&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; (i &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;; i &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;num_connectors; i&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_DEBUG_KMS&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\t&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;[CONNECTOR:%d:%s] set DPMS on&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;, set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connectors[i]&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;base.id,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                              set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connectors[i]&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;name);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connectors[i]&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;funcs&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;dpms&lt;/span&gt;(set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connectors[i], DRM_MODE_DPMS_ON);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;__drm_helper_disable_unused_functions&lt;/span&gt;(dev);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (fb_changed) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;x &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;y &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;primary&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; crtc_funcs&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;mode_set_base&lt;/span&gt;(set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;x, set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;y, save_set.fb);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (ret &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;x &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; save_set.x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;y &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; save_set.y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;primary&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; save_set.fb;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;goto&lt;/span&gt; fail;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;kfree&lt;/span&gt;(save_connector_encoders);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;kfree&lt;/span&gt;(save_encoder_crtcs);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;fail&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* Restore all previous data. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        count &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_for_each_encoder&lt;/span&gt;(encoder, dev) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                encoder&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; save_encoder_crtcs[count&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        count &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_begin&lt;/span&gt;(dev, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_for_each_connector_iter&lt;/span&gt;(connector, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                connector&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; save_connector_encoders[count&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_list_iter_end&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;conn_iter);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* after fail drop reference on all unbound connectors in set, let
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * bound connectors keep their reference
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;for&lt;/span&gt; (ro &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;; ro &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;num_connectors; ro&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connectors[ro]&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;encoder)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;continue&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_connector_put&lt;/span&gt;(set&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;connectors[ro]);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* Try to restore the config */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (mode_changed &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_crtc_helper_set_mode&lt;/span&gt;(save_set.crtc, save_set.mode, save_set.x,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                      save_set.y, save_set.fb))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_ERROR&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;failed to restore config after modeset failure&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;kfree&lt;/span&gt;(save_connector_encoders);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;kfree&lt;/span&gt;(save_encoder_crtcs);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; ret;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;EXPORT_SYMBOL&lt;/span&gt;(drm_crtc_helper_set_config);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231123_104321.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;现在就是要找什么时个会调用多次，这个很重要。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;dce_v6_0_crtc_dpms&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;crtc, &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; mode)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;adev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; dev&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev_private;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; amdgpu_crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;amdgpu_crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;to_amdgpu_crtc&lt;/span&gt;(crtc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd&#34;&gt;unsigned&lt;/span&gt; type;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;switch&lt;/span&gt; (mode) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;DRM_MODE_DPMS_ON&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                amdgpu_crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;enabled &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_atombios_crtc_enable&lt;/span&gt;(crtc, ATOM_ENABLE);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_atombios_crtc_blank&lt;/span&gt;(crtc, ATOM_DISABLE);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/* Make sure VBLANK and PFLIP interrupts are still enabled */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                type &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_display_crtc_idx_to_irq_type&lt;/span&gt;(adev,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                amdgpu_crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc_id);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_irq_update&lt;/span&gt;(adev, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;adev&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;crtc_irq, type);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_irq_update&lt;/span&gt;(adev, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;adev&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;pageflip_irq, type);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_crtc_vblank_on&lt;/span&gt;(crtc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;dce_v6_0_crtc_load_lut&lt;/span&gt;(crtc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;DRM_MODE_DPMS_STANDBY&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;DRM_MODE_DPMS_SUSPEND&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;DRM_MODE_DPMS_OFF&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_crtc_vblank_off&lt;/span&gt;(crtc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (amdgpu_crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;enabled)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_atombios_crtc_blank&lt;/span&gt;(crtc, ATOM_ENABLE);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_atombios_crtc_enable&lt;/span&gt;(crtc, ATOM_DISABLE);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                amdgpu_crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;enabled &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* adjust pm to dpms */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;amdgpu_pm_compute_clocks&lt;/span&gt;(adev);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我看的代码是内核的代码，而机器上使用的是 amdgpu_dkms 的代码，在内核当中搜不到，那么从 dkms 的代码当中看看。如果还是没有，那就非常的奇怪了。&lt;/p&gt;
&lt;p&gt;最诡异的是找不到 drm_crtc_helper_set_config 这个函数的调用者是谁。&lt;/p&gt;
&lt;p&gt;使用 bpftrace 来分析一下这个工具。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;uos@uos-PC:~$ sudo stackcount-bpfcc drm_crtc_helper_set_config
请输入密码:
验证成功
Tracing 1 functions for &amp;#34;drm_crtc_helper_set_config&amp;#34;... Hit Ctrl-C to end.
^C
  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_mode_setcrtc
  drm_ioctl_kernel
  drm_ioctl
  amdgpu_drm_ioctl
  do_vfs_ioctl
  ksys_ioctl
  __x64_sys_ioctl
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  ioctl
  [unknown]
    Xorg [3966]
    1

  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_mode_setcrtc
  drm_ioctl_kernel
  drm_ioctl
  amdgpu_drm_ioctl
  do_vfs_ioctl
  ksys_ioctl
  __x64_sys_ioctl
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  ioctl
  [unknown]
    Xorg [972]
    1

  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_mode_setcrtc
  drm_ioctl_kernel
  drm_ioctl
  amdgpu_drm_ioctl
  do_vfs_ioctl
  ksys_ioctl
  __x64_sys_ioctl
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  ioctl
  [unknown]
    Xorg [972]
    1

Detaching...
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;有问题的时候是这样的：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;uos@uos-PC:~$ sudo stackcount-bpfcc drm_crtc_helper_set_config
Tracing 1 functions for &amp;#34;drm_crtc_helper_set_config&amp;#34;... Hit Ctrl-C to end.
^C
  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_mode_setcrtc
  drm_ioctl_kernel
  drm_ioctl
  amdgpu_drm_ioctl
  do_vfs_ioctl
  ksys_ioctl
  __x64_sys_ioctl
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  ioctl
  [unknown]
    Xorg [3966]
    1

  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_crtc_force_disable
  drm_framebuffer_remove
  drm_mode_rmfb_work_fn
  process_one_work
  worker_thread
  kthread
  ret_from_fork
    kworker/7:0 [14323]
    1

  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_mode_setcrtc
  drm_ioctl_kernel
  drm_ioctl
  amdgpu_drm_ioctl
  do_vfs_ioctl
  ksys_ioctl
  __x64_sys_ioctl
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  ioctl
  [unknown]
    Xorg [972]
    1

  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_mode_setcrtc
  drm_ioctl_kernel
  drm_ioctl
  amdgpu_drm_ioctl
  do_vfs_ioctl
  ksys_ioctl
  __x64_sys_ioctl
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  ioctl
  [unknown]
    Xorg [3966]
    1

Detaching...
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;经过多次测试，很明确的是 kworker 导致了多次的调用。drm_mode_rmfb_work_fn ，这个函数在什么情况下会触发？这个函数的调用者是 drm_mode_rmfb 和 drm_fb_release 这两个函数。再往上找应该就是真正的原因了。&lt;/p&gt;
&lt;p&gt;drm_mode_rmfb 的调用栈也可以用 bpftrace 来试一下。也可以 emacs 看代码分析一下。要不还 bpf 试一下吧。&lt;/p&gt;
&lt;p&gt;drm_client_buffer_rmfb&lt;/p&gt;
&lt;p&gt;drm_client_framebuffer_delete&lt;/p&gt;
&lt;p&gt;drm_fbdev_cleanup&lt;/p&gt;
&lt;p&gt;drm_fbdev_release 和 drm_fbdev_client_hotplug ，显然用的是 release 这个。&lt;/p&gt;
&lt;p&gt;drm_fbdev_fb_destroy&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;uos@uos-PC:~$ sudo stackcount-bpfcc drm_fb_release
Tracing 1 functions for &amp;#34;drm_fb_release&amp;#34;... Hit Ctrl-C to end.
^C
  drm_fb_release
  drm_file_free.part.5
  drm_release
  __fput
  task_work_run
  exit_to_usermode_loop
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  __close
    dde-blackwidget [9780]
    1

  drm_fb_release
  drm_file_free.part.5
  drm_release
  __fput
  task_work_run
  exit_to_usermode_loop
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  __close
  [unknown]
  [unknown]
  [unknown]
    dde-blackwidget [9780]
    1

Detaching...
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;现在现象有三种，不闪烁，闪一下，和黑屏一段时间，上面的这种是后两种情况出现的。看起来和 dde-blackwidget 这个有关系。&lt;/p&gt;
&lt;p&gt;通过 gdb 调试，发现多次调用 drmModeRmFB ，这个函数是 libdrm 的函数。调用者往前找是&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231124_164822.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;1500&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 2: &lt;!-- raw HTML omitted --&gt;/ 第一次调用 /&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231124_165440.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;1500&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 3: &lt;!-- raw HTML omitted --&gt;/ 第二次调用 /&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;为什么会多次调用，我的目的始终是找到这个问题的源头。&lt;/p&gt;
&lt;p&gt;看代码，对比。&lt;/p&gt;
&lt;p&gt;问题好像找到了，if (!info-&amp;gt;shadow_fb) 这个判断可能是问题的根因。在没有出错的情况下没有这个调用的话。
AMDGPULeaveVT_KMS 每次离开的时候都会调用一次。这个怀疑的点是很好的，现在就是怎么编译一套代码做替换，这个不仅仅是 xorg ，还有别的包。有人绐了我一个编译的脚本，研究一下。&lt;/p&gt;
&lt;p&gt;编译 xserver-xorg-video-amdgpu 时报了一个奇怪的错误，syntax error near unexpected token `RANDR,&amp;rsquo; ，这个错误居然是没有装 xorg-dev ，参见下面：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/merge/xf86-input-tslib/issues/9&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/merge/xf86-input-tslib/issues/9&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;CPU_PLATFORM&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;x86_64-linux-gnu&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;BIN_DEPLOY_PATH&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;/home/uos/xorg-deploy&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;modules_DEPLOY_PATH&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;/lib/&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$CPU_PLATFORM&lt;/span&gt;/xorg/modules
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;DRIVER_PATH&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$modules_DEPLOY_PATH&lt;/span&gt;/drivers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;INPUT_PATH&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$modules_DEPLOY_PATH&lt;/span&gt;/input
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;SRC_PATH&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;/home/uos/wangxinbo/src/xorg-server&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; modules_DEPLOY_PATH &amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$modules_DEPLOY_PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; DRIVER_PATH &amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DRIVER_PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; INPUT_PATH &amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$INPUT_PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;#  编译xorg&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$SRC_PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;export&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;PKG_CONFIG_PATH&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;/share/pkgconfig:&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;/lib/pkgconfig:&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$PKG_CONFIG_PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;meson build --prefix&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; build
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ninja
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ninja install
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; xorg build finished&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 安装XKB&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt; ! -d &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;/share/X11/&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt;; &lt;span style=&#34;color:#ff79c6&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;/share/X11/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cp -r /usr/share/X11/xkb/ &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;/share/X11/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;/bin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ln -s /usr/bin/xkbcomp  ./xkbcomp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; XKB installing finished&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 安装video driver&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt; ! -d &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DRIVER_PATH&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt;; &lt;span style=&#34;color:#ff79c6&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DRIVER_PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cp /usr/lib/xorg/modules/drivers/* &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DRIVER_PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; video driver installing finished&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 安装input driver&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt; ! -d &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$INPUT_PATH&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt;; &lt;span style=&#34;color:#ff79c6&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$INPUT_PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cp /usr/lib/xorg/modules/input/* &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$INPUT_PATH&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; input driver installing finished&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 创建log日志&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt; ! -f &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt;; &lt;span style=&#34;color:#ff79c6&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;/var/log
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; log path created&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 安装ddx驱动配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt; ! -f &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;/share/X11/xorg.conf.d&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt;; &lt;span style=&#34;color:#ff79c6&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;/share/X11/xorg.conf.d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cp /usr/share/X11/xorg.conf.d/* &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$BIN_DEPLOY_PATH&lt;/span&gt;/share/X11/xorg.conf.d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; ddx config file installing finished&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;用编译完成的 amdgpu_drv.so 替换系统下原有的：&lt;/p&gt;
&lt;p&gt;/usr/lib/xorg/modules/drivers/amdgpu_drv.so ，这样的话应该就能够对应的上代码了吧。&lt;/p&gt;
&lt;p&gt;替换完成后重启。用 gdb 调试，每次的调用是否是一样的呢？只针对 AMDGPULeaveVT_KM 这个函数确实每次都是一样的。&lt;/p&gt;
&lt;p&gt;intel 集显也会偶尔出现黑屏的现象。签于 amd 显卡测试的现象不稳定，可以用 intel 的分析一下。还有一个思路就是换早期版本的 UOS 镜像，下载下来测试一下，看看有没有问题。&lt;/p&gt;
&lt;p&gt;intel 显卡没有测试出来黑屏一段时间。&lt;/p&gt;
&lt;p&gt;回到之间的思路，还是一个问题。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;uos@uos-PC:~$ sudo stackcount-bpfcc drm_crtc_helper_set_config
Tracing 1 functions for &amp;#34;drm_crtc_helper_set_config&amp;#34;... Hit Ctrl-C to end.
^C
  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_crtc_force_disable
  drm_framebuffer_remove
  drm_mode_rmfb_work_fn
  process_one_work
  worker_thread
  kthread
  ret_from_fork
    kworker/4:3 [8160]
    1

  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_mode_setcrtc
  drm_ioctl_kernel
  drm_ioctl
  amdgpu_drm_ioctl
  do_vfs_ioctl
  ksys_ioctl
  __x64_sys_ioctl
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  ioctl
  [unknown]
    Xorg [893]
    11

  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_mode_setcrtc
  drm_ioctl_kernel
  drm_ioctl
  amdgpu_drm_ioctl
  do_vfs_ioctl
  ksys_ioctl
  __x64_sys_ioctl
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  ioctl
  [unknown]
    Xorg [4491]
    11

  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_mode_setcrtc
  drm_ioctl_kernel
  drm_ioctl
  amdgpu_drm_ioctl
  do_vfs_ioctl
  ksys_ioctl
  __x64_sys_ioctl
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  ioctl
  [unknown]
    Xorg [893]
    22

  drm_crtc_helper_set_config
  amdgpu_display_crtc_set_config
  __drm_mode_set_config_internal
  drm_mode_setcrtc
  drm_ioctl_kernel
  drm_ioctl
  amdgpu_drm_ioctl
  do_vfs_ioctl
  ksys_ioctl
  __x64_sys_ioctl
  do_syscall_64
  entry_SYSCALL_64_after_hwframe
  ioctl
  [unknown]
    Xorg [4491]
    22

Detaching...
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;关于-mesa-和-amdgpu-umd-驱动&#34;&gt;关于 mesa 和 amdgpu umd 驱动&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://cloud.tencent.com/developer/article/2206046&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://cloud.tencent.com/developer/article/2206046&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;umd 的驱动在哪里？&lt;/p&gt;
&lt;p&gt;amdgpu 的 umd 驱动有两个包，一个是 libdrm 中的 amdgpu 部分，一个是 xserver-xorg-video-amdgpu 这个部分。切换用户的时候不会从新加载驱动程序，只会只需要进行与 UMD 驱动的交互，以获取 GPU 访问权限并使用已初始化好的 UMD 库进行图形操作。&lt;/p&gt;
&lt;h2 id=&#34;这个函数的-warn-没有显示出来新的调用信息&#34;&gt;这个函数的 WARN 没有显示出来新的调用信息&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_framebuffer_remove&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_framebuffer &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;fb)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dev;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;fb)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        dev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; fb&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;WARN_ON&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;list_empty&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;fb&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;filp_head));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * drm ABI mandates that we remove any deleted framebuffers from active
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * useage. But since most sane clients only remove framebuffers they no
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * longer need, try to optimize this away.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * Since we&amp;#39;re holding a reference ourselves, observing a refcount of 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * means that we&amp;#39;re the last holder and can skip it. Also, the refcount
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * can never increase from 1 again, so we don&amp;#39;t need any barriers or
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * locks.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * Note that userspace could try to race with use and instate a new
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * usage _after_ we&amp;#39;ve cleared all current ones. End result will be an
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * in-use fb with fb-id == 0. Userspace is allowed to shoot its own foot
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * in this manner.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_framebuffer_read_refcount&lt;/span&gt;(fb) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_drv_uses_atomic_modeset&lt;/span&gt;(dev)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;atomic_remove_fb&lt;/span&gt;(fb);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;WARN&lt;/span&gt;(ret, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;atomic remove_fb failed with %i&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;, ret);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;legacy_remove_fb&lt;/span&gt;(fb);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_framebuffer_put&lt;/span&gt;(fb);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;EXPORT_SYMBOL&lt;/span&gt;(drm_framebuffer_remove);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;模拟错误的产生&#34;&gt;模拟错误的产生&lt;/h2&gt;
&lt;p&gt;(1) 看看是不是走到了这个分支里面去，理解代码。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;legacy_remove_fb&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_framebuffer &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;fb)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; fb&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_crtc &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;crtc;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_plane &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;plane;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_modeset_lock_all&lt;/span&gt;(dev);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* remove from any CRTC */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_for_each_crtc&lt;/span&gt;(crtc, dev) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (crtc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;primary&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; fb) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#6272a4&#34;&gt;/* should turn off the crtc */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_crtc_force_disable&lt;/span&gt;(crtc))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_ERROR&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;failed to reset crtc %p when fb was deleted&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;, crtc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_for_each_plane&lt;/span&gt;(plane, dev) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (plane&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; fb)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_plane_force_disable&lt;/span&gt;(plane);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_modeset_unlock_all&lt;/span&gt;(dev);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;(2) 看看是不是走到了分支 legacy_remove_fb(fb) 这里去了，加一下打印。是的。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_framebuffer_remove&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_framebuffer &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;fb)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dev;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;fb)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        dev &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; fb&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;dev;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;WARN_ON&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;list_empty&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;fb&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;filp_head));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * drm ABI mandates that we remove any deleted framebuffers from active
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * useage. But since most sane clients only remove framebuffers they no
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * longer need, try to optimize this away.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * Since we&amp;#39;re holding a reference ourselves, observing a refcount of 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * means that we&amp;#39;re the last holder and can skip it. Also, the refcount
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * can never increase from 1 again, so we don&amp;#39;t need any barriers or
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * locks.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * Note that userspace could try to race with use and instate a new
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * usage _after_ we&amp;#39;ve cleared all current ones. End result will be an
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * in-use fb with fb-id == 0. Userspace is allowed to shoot its own foot
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * in this manner.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_framebuffer_read_refcount&lt;/span&gt;(fb) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_drv_uses_atomic_modeset&lt;/span&gt;(dev)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;atomic_remove_fb&lt;/span&gt;(fb);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;WARN&lt;/span&gt;(ret, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;atomic remove_fb failed with %i&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;, ret);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                } &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;legacy_remove_fb&lt;/span&gt;(fb);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_framebuffer_put&lt;/span&gt;(fb);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;EXPORT_SYMBOL&lt;/span&gt;(drm_framebuffer_remove);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;bpf 查一下 legacy_remove_fb 这个函数的调用。不能查，加打印，发现确实是调用的 legacy 接口。&lt;/p&gt;
&lt;p&gt;问题是解释清楚这个过程出现的原因。这样这个 bug 才能说明清楚。&lt;/p&gt;
&lt;h2 id=&#34;用加延时的方法来测试&#34;&gt;用加延时的方法来测试&lt;/h2&gt;
&lt;p&gt;(1) 加延时的意思是什么？&lt;/p&gt;
&lt;p&gt;(2) 删除所有的 fb 的原因是什么？&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_mode_rmfb_work_fn&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; work_struct &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;w)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_mode_rmfb_work &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;arg &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;container_of&lt;/span&gt;(w, &lt;span style=&#34;color:#50fa7b&#34;&gt;typeof&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;arg), work);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;while&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;list_empty&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;arg&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fbs)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_framebuffer &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;list_first_entry&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;arg&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fbs, &lt;span style=&#34;color:#50fa7b&#34;&gt;typeof&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;fb), filp_head);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;list_del_init&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;fb&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;filp_head);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_framebuffer_remove&lt;/span&gt;(fb);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;正常的情况下只会删除自己的一个 fb 。异常的时候才会删除所有的 fb 。&lt;/p&gt;
&lt;p&gt;把这些 fb 打印出来，找到这些 fb 的上层是谁在持有。&lt;/p&gt;
&lt;p&gt;(3) gdb 调试的时候 xorg 会收到信号，是什么信号呢？&lt;/p&gt;
&lt;p&gt;Thread 1 &amp;ldquo;Xorg&amp;rdquo; received signal SIGUSR1, User defined signal 1.
0x00007f662a834aff in epoll_wait (epfd=3, events=0x7ffdbe20c8b0, maxevents=256, timeout=-1)
at ../sysdeps/unix/sysv/linux/epoll_wait.c:30
30	in ../sysdeps/unix/sysv/linux/epoll_wait.c&lt;/p&gt;
&lt;p&gt;这个信号是 xorg 重新加载配置的信号。这个时候要看 xorg 的代码了。&lt;/p&gt;
&lt;p&gt;(4) 怎么模拟 xorg 处理信号？&lt;/p&gt;
&lt;p&gt;kill -SIGUSR1 915&lt;/p&gt;
&lt;p&gt;用这个命令有的时候可以模拟出来黑屏的效果，可以认为是这个信号调用有时候会引起黑屏。&lt;/p&gt;
&lt;p&gt;用 CRASH 来处理一下。或者用 gdb 跟一下看一下这个信号来怎么处理的，内核态返回用户态的时候会有信号。&lt;/p&gt;
&lt;p&gt;(5) 再往下分析的话要分析，什么情况下会出现“信号”处理不过来的情况。&lt;/p&gt;
&lt;p&gt;是真的信号处理不过来了吗？还是其它的原因？&lt;/p&gt;
&lt;p&gt;在 Linux 内核中，work_struct 结构体是表示工作队列（work queue）中的一个工作项（work item）。工作队列是一种异步执行任务的机制，在后台执行耗时的操作或延迟处理。它是内核中非常常用的一种机制，广泛应用于各种驱动程序和子系统中。&lt;/p&gt;
&lt;p&gt;一直搞不清楚，rm 的 fb 到底是哪里来的。先不管怎么来的，先打印一下，看看有几个 fb ，这之后再分析。也是一个 fb ，并没有多个 fb 需要销毁。所以应该和个数没有什么关系。&lt;/p&gt;
&lt;p&gt;内核进程销毁是通过调用这三行：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_framebuffer &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;list_first_entry&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;arg&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;fbs, &lt;span style=&#34;color:#50fa7b&#34;&gt;typeof&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;fb), filp_head);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;list_del_init&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;fb&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;filp_head);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;drm_framebuffer_remove&lt;/span&gt;(fb);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这个函数： void drm_framebuffer_put(struct drm_framebuffer *fb); 他的作用是将 framebuffer 的引用计数加 1 ，如果引用计数是 0 的话就释放 framebuffer 。&lt;/p&gt;
&lt;p&gt;上面的逻辑看清楚了之后，就明白了。&lt;/p&gt;
&lt;p&gt;如何找到 fb 的引用者？这个信息怎么获取到？&lt;/p&gt;
&lt;p&gt;占老板让看： &lt;code&gt;/sys/kernel/debug/dri/0/clients&lt;/code&gt; 这个文件。&lt;/p&gt;
&lt;p&gt;GPT 让我看： &lt;code&gt;/sys/kernel/debug/fb/&lt;/code&gt; 但是这个文件没有找到。&lt;/p&gt;
&lt;p&gt;又查到可以用 SystemTap 来追踪 fb 的引用者。需要安装内核的 debug 包。&lt;/p&gt;
&lt;p&gt;这个追踪遇到了一点问题。&lt;/p&gt;
&lt;p&gt;用 drgn 或者 gdb 的调试脚本，找一下，可能申请 fb 引用的地方，这些地方还是看代码。&lt;/p&gt;
&lt;p&gt;用 systemtap 调试要写一些调试脚本，不是太好用的样子，尝试 probe 写了几个 drm fb 相关的函数都不能用。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/sys/kernel/debug/dri/0/framebuffer&lt;/code&gt; 这个中的内容看起来很像是有东西。&lt;/p&gt;
&lt;p&gt;sudo apt-get install inotify-tools&lt;/p&gt;
&lt;p&gt;用这个工具来监视文件的变化。inotifywait -m -r &lt;code&gt;/sys/kernel/&lt;/code&gt; ，发现在切换用户的时候这个文件没有变化。&lt;/p&gt;
&lt;p&gt;那要想其它的办法了。&lt;/p&gt;
&lt;p&gt;能通过 gdb 或都 ebpf 找到更多的信息吗？gdb 加脚本。&lt;/p&gt;
&lt;p&gt;sudo strace -p 881 -e trace=signal -e &amp;lsquo;signal=SIGUSR1&amp;rsquo;&lt;/p&gt;
&lt;p&gt;&amp;mdash; SIGUSR1 {si_signo=SIGUSR1, si_code=SI_KERNEL} &amp;mdash;
rt_sigaction(SIGUSR1, {sa_handler=0x49d450, sa_mask=[USR1], sa_flags=SA_RESTORER, sa_restorer=0x7f8e8bc3a730}, {sa_handler=0x49d450, sa_mask=[USR1], sa_flags=SA_RESTORER, sa_restorer=0x7f8e8bc3a730}, 8) = 0
rt_sigreturn({mask=[]})                 = -1 EINTR (被中断的系统调用)&lt;/p&gt;
&lt;p&gt;这个信号是内核发出的，可以看一下内核那里会发这个信号。信号都是内核发送绐用户态进程的。所以这个没什么意义。&lt;/p&gt;
&lt;p&gt;找内核的代码没有找到。不知道怎么找，可以先不纠结，先再 libdrm 当中加 setcrtc 屏蔽 SIGUSR1 信号的东西，设置完成之后再关屏蔽。&lt;/p&gt;
&lt;p&gt;如何编译和替换 libdrm ，ldd /usr/lib/xorg/Xorg ，按照上面的思路先修改一下 libdrm 。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * drm_framebuffer_lookup - look up a drm framebuffer and grab a reference
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @dev: drm device
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @file_priv: drm file to check for lease against.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * @id: id of the fb object
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * If successful, this grabs an additional reference to the framebuffer -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * callers need to make sure to eventually unreference the returned framebuffer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * again, using drm_framebuffer_put().
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_framebuffer &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;drm_framebuffer_lookup&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_device &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;dev,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                               &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_file &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;file_priv,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                               &lt;span style=&#34;color:#8be9fd&#34;&gt;uint32_t&lt;/span&gt; id)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_mode_object &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;obj;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_framebuffer &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;fb &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        obj &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;__drm_mode_object_find&lt;/span&gt;(dev, file_priv, id, DRM_MODE_OBJECT_FB);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (obj)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                fb &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;obj_to_fb&lt;/span&gt;(obj);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; fb;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;EXPORT_SYMBOL&lt;/span&gt;(drm_framebuffer_lookup);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这个函数可以增加引用数。查他的调用的话，值得怀疑的就是这么一个函数：int drm_mode_setcrtc ，这个通过 ioctl 来调用。&lt;/p&gt;
&lt;p&gt;DRM_IOCTL_DEF(DRM_IOCTL_MODE_SETCRTC, drm_mode_setcrtc, DRM_MASTER|DRM_UNLOCKED)&lt;/p&gt;
&lt;p&gt;在 libdrm 当中搜一下这个函数的调用，看看能不能关信号。在内核当中屏蔽信号；或者在用户态当中屏蔽信号。这个信号的作用是什么，内核为什么会发，如果屏蔽的话会不会有问题呢？&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;drm_public &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;drmModeSetCrtc&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; fd, &lt;span style=&#34;color:#8be9fd&#34;&gt;uint32_t&lt;/span&gt; crtcId, &lt;span style=&#34;color:#8be9fd&#34;&gt;uint32_t&lt;/span&gt; bufferId,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   &lt;span style=&#34;color:#8be9fd&#34;&gt;uint32_t&lt;/span&gt; x, &lt;span style=&#34;color:#8be9fd&#34;&gt;uint32_t&lt;/span&gt; y, &lt;span style=&#34;color:#8be9fd&#34;&gt;uint32_t&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;connectors, &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; count,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                   drmModeModeInfoPtr mode)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_mode_crtc crtc;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;memclear&lt;/span&gt;(crtc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        crtc.x             &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; x;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        crtc.y             &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; y;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        crtc.crtc_id       &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; crtcId;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        crtc.fb_id         &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; bufferId;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        crtc.set_connectors_ptr &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;VOID2U64&lt;/span&gt;(connectors);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        crtc.count_connectors &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; count;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (mode) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#50fa7b&#34;&gt;memcpy&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;crtc.mode, mode, &lt;span style=&#34;color:#ff79c6&#34;&gt;sizeof&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; drm_mode_modeinfo));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          crtc.mode_valid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;DRM_IOCTL&lt;/span&gt;(fd, DRM_IOCTL_MODE_SETCRTC, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;crtc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;libdrm 中是上面的样子。&lt;/p&gt;
&lt;p&gt;要修改的话还是要在 xorg 里面，也就是&lt;/p&gt;
&lt;p&gt;查一下这个函数：xf86Sigusr1Handler ，这个是处理刷新的时间配置的一个函数。没找到这个函数。&lt;/p&gt;
&lt;p&gt;用 signal(SIGUSR1, SIG_IGN); 来设置关闭自定义信号；恢复怎么写？找恢复的地方。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;signal.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd&#34;&gt;sigset_t&lt;/span&gt; mask;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd&#34;&gt;sigset_t&lt;/span&gt; prev_mask;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// 定义要屏蔽的信号集
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;sigemptyset&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;mask);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;sigaddset&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;mask, SIGINT); &lt;span style=&#34;color:#6272a4&#34;&gt;// 屏蔽 SIGINT 信号
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// 关闭信号
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;sigprocmask&lt;/span&gt;(SIG_BLOCK, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;mask, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;prev_mask) &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;perror&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;sigprocmask&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// 在这里执行一些需要屏蔽信号的操作
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// 恢复信号
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;sigprocmask&lt;/span&gt;(SIG_SETMASK, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;prev_mask, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;) &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;perror&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;sigprocmask&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;// 在这里执行一些不需要屏蔽信号的操作
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上面是恢复和关闭信号集的例子。&lt;/p&gt;
&lt;p&gt;setcrtc 是不是有一人默认的延时时间。&lt;/p&gt;
&lt;h2 id=&#34;观察例子&#34;&gt;观察例子&lt;/h2&gt;
&lt;p&gt;没有问题的时候是这个样子的：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;2023-12-06 15:09:16 uos-PC kernel: [77256.505105] [drm:drm_mode_addfb2 [drm]] [FB:48]
2023-12-06 15:09:16 uos-PC kernel: [77256.506734] [drm:drm_mode_setcrtc [drm]] [CRTC:37:crtc-0]
2023-12-06 15:09:16 uos-PC kernel: [77256.506758] [drm:drm_mode_setcrtc [drm]] [CONNECTOR:41:HDMI-A-1]
2023-12-06 15:09:16 uos-PC kernel: [77256.506769] [drm:drm_crtc_helper_set_config [drm_kms_helper]]
2023-12-06 15:09:16 uos-PC kernel: [77256.506778] [drm:drm_crtc_helper_set_config [drm_kms_helper]] [CRTC:37:crtc-0] [FB:48] #connectors=1 (x y) (0 0)
2023-12-06 15:09:16 uos-PC kernel: [77256.506788] [drm:drm_crtc_helper_set_config [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1] to [CRTC:37:crtc-0]
2023-12-06 15:09:16 uos-PC kernel: [77256.506955] [drm:dce_v6_0_program_watermarks [amdgpu]] force priority to high
2023-12-06 15:09:16 uos-PC kernel: [77256.509859] [drm:drm_mode_setcrtc [drm]] [CRTC:39:crtc-1]
2023-12-06 15:09:16 uos-PC kernel: [77256.509878] [drm:drm_crtc_helper_set_config [drm_kms_helper]]
2023-12-06 15:09:16 uos-PC kernel: [77256.509886] [drm:drm_crtc_helper_set_config [drm_kms_helper]] [CRTC:39:crtc-1] [NOFB]
2023-12-06 15:09:16 uos-PC kernel: [77256.510069] [drm:amdgpu_atombios_encoder_dpms [amdgpu]] encoder dpms 21 to mode 3, devices 00000001, active_devices 00000000
2023-12-06 15:09:16 uos-PC kernel: [77256.510266] [drm:dce_v6_0_program_watermarks [amdgpu]] force priority to high
2023-12-06 15:09:16 uos-PC kernel: [77256.510563] [drm:drm_mode_addfb2 [drm]] [FB:44]
2023-12-06 15:09:16 uos-PC kernel: [77256.510696] [drm:drm_mode_addfb2 [drm]] [FB:70]
2023-12-06 15:09:16 uos-PC kernel: [77256.513253] [drm:drm_mode_setcrtc [drm]] [CRTC:37:crtc-0]
2023-12-06 15:09:16 uos-PC kernel: [77256.513271] [drm:drm_mode_setcrtc [drm]] [CONNECTOR:41:HDMI-A-1]
2023-12-06 15:09:16 uos-PC kernel: [77256.513280] [drm:drm_crtc_helper_set_config [drm_kms_helper]]
2023-12-06 15:09:16 uos-PC kernel: [77256.513286] [drm:drm_crtc_helper_set_config [drm_kms_helper]] [CRTC:37:crtc-0] [FB:44] #connectors=1 (x y) (0 0)
2023-12-06 15:09:16 uos-PC kernel: [77256.513293] [drm:drm_crtc_helper_set_config [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1] to [CRTC:37:crtc-0]
2023-12-06 15:09:16 uos-PC kernel: [77256.513467] [drm:dce_v6_0_program_watermarks [amdgpu]] force priority to high
2023-12-06 15:09:16 uos-PC kernel: [77256.513647] [drm:dce_v6_0_crtc_load_lut [amdgpu]] 0
2023-12-06 15:09:16 uos-PC kernel: [77256.513725] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1]
2023-12-06 15:09:16 uos-PC kernel: [77256.547971] [drm:amdgpu_atombios_encoder_set_bios_scratch_regs [amdgpu]] DFP1 connected
2023-12-06 15:09:16 uos-PC kernel: [77256.547988] [drm:drm_add_display_info [drm]] non_desktop set to 0
2023-12-06 15:09:16 uos-PC kernel: [77256.547996] [drm:drm_add_edid_modes [drm]] ELD: no CEA Extension found
2023-12-06 15:09:16 uos-PC kernel: [77256.548002] [drm:drm_add_display_info [drm]] non_desktop set to 0
2023-12-06 15:09:16 uos-PC kernel: [77256.548075] [drm:drm_mode_debug_printmodeline [drm]] Modeline 75:&amp;#34;1600x1200&amp;#34; 0 162000 1600 1664 1856 2160 1200 1201 1204 1250 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548080] [drm:drm_mode_prune_invalid [drm]] Not using 1600x1200 mode: BAD_WIDTH
2023-12-06 15:09:16 uos-PC kernel: [77256.548086] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1] probed modes :
2023-12-06 15:09:16 uos-PC kernel: [77256.548092] [drm:drm_mode_debug_printmodeline [drm]] Modeline 45:&amp;#34;1920x1080&amp;#34; 60 148500 1920 2008 2052 2200 1080 1084 1089 1125 0x48 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548098] [drm:drm_mode_debug_printmodeline [drm]] Modeline 46:&amp;#34;1680x1050&amp;#34; 60 119000 1680 1728 1760 1840 1050 1053 1059 1080 0x40 0x9
2023-12-06 15:09:16 uos-PC kernel: [77256.548103] [drm:drm_mode_debug_printmodeline [drm]] Modeline 51:&amp;#34;1400x1050&amp;#34; 60 101000 1400 1448 1480 1560 1050 1053 1057 1080 0x40 0x9
2023-12-06 15:09:16 uos-PC kernel: [77256.548108] [drm:drm_mode_debug_printmodeline [drm]] Modeline 49:&amp;#34;1600x900&amp;#34; 60 108000 1600 1624 1704 1800 900 901 904 1000 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548113] [drm:drm_mode_debug_printmodeline [drm]] Modeline 62:&amp;#34;1280x1024&amp;#34; 75 135000 1280 1296 1440 1688 1024 1025 1028 1066 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548119] [drm:drm_mode_debug_printmodeline [drm]] Modeline 52:&amp;#34;1280x1024&amp;#34; 60 108000 1280 1328 1440 1688 1024 1025 1028 1066 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548124] [drm:drm_mode_debug_printmodeline [drm]] Modeline 50:&amp;#34;1440x900&amp;#34; 60 88750 1440 1488 1520 1600 900 903 909 926 0x40 0x9
2023-12-06 15:09:16 uos-PC kernel: [77256.548129] [drm:drm_mode_debug_printmodeline [drm]] Modeline 53:&amp;#34;1280x960&amp;#34; 60 108000 1280 1376 1488 1800 960 961 964 1000 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548134] [drm:drm_mode_debug_printmodeline [drm]] Modeline 72:&amp;#34;1152x864&amp;#34; 75 108000 1152 1216 1344 1600 864 865 868 900 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548139] [drm:drm_mode_debug_printmodeline [drm]] Modeline 54:&amp;#34;1280x720&amp;#34; 60 74250 1280 1390 1430 1650 720 725 730 750 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548144] [drm:drm_mode_debug_printmodeline [drm]] Modeline 63:&amp;#34;1024x768&amp;#34; 75 78750 1024 1040 1136 1312 768 769 772 800 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548149] [drm:drm_mode_debug_printmodeline [drm]] Modeline 64:&amp;#34;1024x768&amp;#34; 70 75000 1024 1048 1184 1328 768 771 777 806 0x40 0xa
2023-12-06 15:09:16 uos-PC kernel: [77256.548154] [drm:drm_mode_debug_printmodeline [drm]] Modeline 65:&amp;#34;1024x768&amp;#34; 60 65000 1024 1048 1184 1344 768 771 777 806 0x40 0xa
2023-12-06 15:09:16 uos-PC kernel: [77256.548159] [drm:drm_mode_debug_printmodeline [drm]] Modeline 66:&amp;#34;832x624&amp;#34; 75 57284 832 864 928 1152 624 625 628 667 0x40 0xa
2023-12-06 15:09:16 uos-PC kernel: [77256.548164] [drm:drm_mode_debug_printmodeline [drm]] Modeline 67:&amp;#34;800x600&amp;#34; 75 49500 800 816 896 1056 600 601 604 625 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548170] [drm:drm_mode_debug_printmodeline [drm]] Modeline 68:&amp;#34;800x600&amp;#34; 72 50000 800 856 976 1040 600 637 643 666 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548175] [drm:drm_mode_debug_printmodeline [drm]] Modeline 55:&amp;#34;800x600&amp;#34; 60 40000 800 840 968 1056 600 601 605 628 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548180] [drm:drm_mode_debug_printmodeline [drm]] Modeline 56:&amp;#34;800x600&amp;#34; 56 36000 800 824 896 1024 600 601 603 625 0x40 0x5
2023-12-06 15:09:16 uos-PC kernel: [77256.548185] [drm:drm_mode_debug_printmodeline [drm]] Modeline 57:&amp;#34;640x480&amp;#34; 75 31500 640 656 720 840 480 481 484 500 0x40 0xa
2023-12-06 15:09:16 uos-PC kernel: [77256.548190] [drm:drm_mode_debug_printmodeline [drm]] Modeline 58:&amp;#34;640x480&amp;#34; 73 31500 640 664 704 832 480 489 492 520 0x40 0xa
2023-12-06 15:09:16 uos-PC kernel: [77256.548195] [drm:drm_mode_debug_printmodeline [drm]] Modeline 59:&amp;#34;640x480&amp;#34; 67 30240 640 704 768 864 480 483 486 525 0x40 0xa
2023-12-06 15:09:16 uos-PC kernel: [77256.548200] [drm:drm_mode_debug_printmodeline [drm]] Modeline 60:&amp;#34;640x480&amp;#34; 60 25175 640 656 752 800 480 490 492 525 0x40 0xa
2023-12-06 15:09:16 uos-PC kernel: [77256.548205] [drm:drm_mode_debug_printmodeline [drm]] Modeline 61:&amp;#34;720x400&amp;#34; 70 28320 720 738 846 900 400 412 414 449 0x40 0x6
2023-12-06 15:09:16 uos-PC kernel: [77256.548481] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:43:VGA-1]
2023-12-06 15:09:16 uos-PC kernel: [77256.564415] [drm:amdgpu_atombios_encoder_dac_detect [amdgpu]] Bios 0 scratch 10000 00000001
2023-12-06 15:09:16 uos-PC kernel: [77256.564559] [drm:amdgpu_atombios_encoder_set_bios_scratch_regs [amdgpu]] CRT1 disconnected
2023-12-06 15:09:16 uos-PC kernel: [77256.564574] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:43:VGA-1] disconnected
2023-12-06 15:09:16 uos-PC kernel: [77256.564820] [drm:dce_v6_0_crtc_load_lut [amdgpu]] 0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;有问题的时候是这个样子的：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;2023-12-06 15:24:38 uos-PC kernel: [78177.919158] [drm:drm_mode_addfb2 [drm]] [FB:45]
2023-12-06 15:24:38 uos-PC kernel: [78177.920802] [drm:drm_mode_setcrtc [drm]] [CRTC:37:crtc-0]
2023-12-06 15:24:38 uos-PC kernel: [78177.920842] [drm:drm_mode_setcrtc [drm]] [CONNECTOR:41:HDMI-A-1]
2023-12-06 15:24:38 uos-PC kernel: [78177.920858] [drm:drm_crtc_helper_set_config [drm_kms_helper]]
2023-12-06 15:24:38 uos-PC kernel: [78177.920872] [drm:drm_crtc_helper_set_config [drm_kms_helper]] [CRTC:37:crtc-0] [FB:45] #connectors=1 (x y) (0 0)
2023-12-06 15:24:38 uos-PC kernel: [78177.920888] [drm:drm_crtc_helper_set_config [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1] to [CRTC:37:crtc-0]
2023-12-06 15:24:38 uos-PC kernel: [78177.921183] [drm:dce_v6_0_program_watermarks [amdgpu]] force priority to high
2023-12-06 15:24:38 uos-PC kernel: [78177.921473] [drm:drm_mode_rmfb_work_fn [drm]] *ERROR* guolongji drm_mode_rmfb_work_fn
2023-12-06 15:24:38 uos-PC kernel: [78177.921505] [drm:drm_framebuffer_remove [drm]] *ERROR* guolongji before legacy_remove_fb
2023-12-06 15:24:38 uos-PC kernel: [78177.921528] [drm:drm_crtc_helper_set_config [drm_kms_helper]]
2023-12-06 15:24:38 uos-PC kernel: [78177.921539] [drm:drm_crtc_helper_set_config [drm_kms_helper]] [CRTC:37:crtc-0] [NOFB]
2023-12-06 15:24:38 uos-PC kernel: [78177.921748] [drm:amdgpu_atombios_encoder_dpms [amdgpu]] encoder dpms 30 to mode 3, devices 00000008, active_devices 00000008
2023-12-06 15:24:38 uos-PC kernel: [78177.930791] [drm:amdgpu_atombios_encoder_dpms [amdgpu]] encoder dpms 21 to mode 3, devices 00000001, active_devices 00000000
2023-12-06 15:24:38 uos-PC kernel: [78177.957678] [drm:drm_framebuffer_remove [drm]] *ERROR* guolongji after legacy_remove_fb
2023-12-06 15:24:38 uos-PC kernel: [78177.958575] [drm:drm_mode_setcrtc [drm]] [CRTC:39:crtc-1]
2023-12-06 15:24:38 uos-PC kernel: [78177.958581] [drm:drm_crtc_helper_set_config [drm_kms_helper]]
2023-12-06 15:24:38 uos-PC kernel: [78177.958584] [drm:drm_crtc_helper_set_config [drm_kms_helper]] [CRTC:39:crtc-1] [NOFB]
2023-12-06 15:24:38 uos-PC kernel: [78177.958642] [drm:amdgpu_atombios_encoder_dpms [amdgpu]] encoder dpms 30 to mode 3, devices 00000008, active_devices 00000000
2023-12-06 15:24:38 uos-PC kernel: [78177.958688] [drm:amdgpu_atombios_encoder_dpms [amdgpu]] encoder dpms 21 to mode 3, devices 00000001, active_devices 00000000
2023-12-06 15:24:38 uos-PC kernel: [78177.958847] [drm:drm_mode_addfb2 [drm]] [FB:45]
2023-12-06 15:24:38 uos-PC kernel: [78177.958881] [drm:drm_mode_addfb2 [drm]] [FB:70]
2023-12-06 15:24:38 uos-PC kernel: [78177.961160] [drm:drm_mode_setcrtc [drm]] [CRTC:37:crtc-0]
2023-12-06 15:24:38 uos-PC kernel: [78177.961174] [drm:drm_mode_setcrtc [drm]] [CONNECTOR:41:HDMI-A-1]
2023-12-06 15:24:38 uos-PC kernel: [78177.961181] [drm:drm_crtc_helper_set_config [drm_kms_helper]]
2023-12-06 15:24:38 uos-PC kernel: [78177.961185] [drm:drm_crtc_helper_set_config [drm_kms_helper]] [CRTC:37:crtc-0] [FB:45] #connectors=1 (x y) (0 0)
2023-12-06 15:24:38 uos-PC kernel: [78177.961190] [drm:drm_crtc_helper_set_config [drm_kms_helper]] crtc has no fb, full mode set
2023-12-06 15:24:38 uos-PC kernel: [78177.961194] [drm:drm_crtc_helper_set_config [drm_kms_helper]] connector dpms not on, full mode switch
2023-12-06 15:24:38 uos-PC kernel: [78177.961197] [drm:drm_crtc_helper_set_config [drm_kms_helper]] encoder changed, full mode switch
2023-12-06 15:24:38 uos-PC kernel: [78177.961201] [drm:drm_crtc_helper_set_config [drm_kms_helper]] crtc changed, full mode switch
2023-12-06 15:24:38 uos-PC kernel: [78177.961205] [drm:drm_crtc_helper_set_config [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1] to [CRTC:37:crtc-0]
2023-12-06 15:24:38 uos-PC kernel: [78177.961209] [drm:drm_crtc_helper_set_config [drm_kms_helper]] attempting to set mode from userspace
2023-12-06 15:24:38 uos-PC kernel: [78177.961219] [drm:drm_mode_debug_printmodeline [drm]] Modeline 73:&amp;#34;&amp;#34; 0 148500 1920 2008 2052 2200 1080 1084 1089 1125 0x0 0x5
2023-12-06 15:24:38 uos-PC kernel: [78177.961299] [drm:amdgpu_encoder_set_active_device [amdgpu]] setting active device to 00000008 from 00000008 00000008 for encoder 2
2023-12-06 15:24:38 uos-PC kernel: [78177.961309] [drm:drm_crtc_helper_set_mode [drm_kms_helper]] [CRTC:37:crtc-0]
2023-12-06 15:24:38 uos-PC kernel: [78177.961390] [drm:amdgpu_atombios_encoder_dpms [amdgpu]] encoder dpms 21 to mode 3, devices 00000001, active_devices 00000000
2023-12-06 15:24:38 uos-PC kernel: [78177.961507] [drm:dce_v6_0_program_watermarks [amdgpu]] force priority to high
2023-12-06 15:24:38 uos-PC kernel: [78177.961590] [drm:amdgpu_pll_compute [amdgpu]] 148500 - 148500, pll dividers - fb: 88.0 ref: 2, post 8
2023-12-06 15:24:38 uos-PC kernel: [78177.970783] [drm:dce_v6_0_program_watermarks [amdgpu]] force priority to high
2023-12-06 15:24:38 uos-PC kernel: [78177.970806] [drm:drm_crtc_helper_set_mode [drm_kms_helper]] [ENCODER:40:TMDS-40] set [MODE:73:]
2023-12-06 15:24:38 uos-PC kernel: [78177.970866] [drm:amdgpu_atombios_encoder_dpms [amdgpu]] encoder dpms 30 to mode 3, devices 00000008, active_devices 00000008
2023-12-06 15:24:38 uos-PC kernel: [78177.970928] [drm:dce_v6_0_crtc_load_lut [amdgpu]] 0
2023-12-06 15:24:38 uos-PC kernel: [78177.970983] [drm:dce_v6_0_program_watermarks [amdgpu]] force priority to high
2023-12-06 15:24:38 uos-PC kernel: [78177.987659] [drm:amdgpu_atombios_encoder_dpms [amdgpu]] encoder dpms 30 to mode 0, devices 00000008, active_devices 00000008
2023-12-06 15:24:38 uos-PC kernel: [78177.988881] [drm:drm_crtc_helper_set_config [drm_kms_helper]] Setting connector DPMS state to on
2023-12-06 15:24:38 uos-PC kernel: [78177.988883] [drm:drm_crtc_helper_set_config [drm_kms_helper]]     [CONNECTOR:41:HDMI-A-1] set DPMS on
2023-12-06 15:24:38 uos-PC kernel: [78177.988961] [drm:dce_v6_0_crtc_load_lut [amdgpu]] 0
2023-12-06 15:24:38 uos-PC kernel: [78177.989016] [drm:dce_v6_0_program_watermarks [amdgpu]] force priority to high
2023-12-06 15:24:38 uos-PC kernel: [78177.989072] [drm:amdgpu_atombios_encoder_dpms [amdgpu]] encoder dpms 30 to mode 0, devices 00000008, active_devices 00000008
2023-12-06 15:24:38 uos-PC kernel: [78177.989128] [drm:amdgpu_atombios_encoder_dpms [amdgpu]] encoder dpms 21 to mode 3, devices 00000001, active_devices 00000000
2023-12-06 15:24:38 uos-PC kernel: [78177.989179] [drm:dce_v6_0_program_watermarks [amdgpu]] force priority to high
2023-12-06 15:24:38 uos-PC kernel: [78177.989257] [drm:dce_v6_0_crtc_load_lut [amdgpu]] 0
2023-12-06 15:24:38 uos-PC kernel: [78177.989286] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1]
2023-12-06 15:24:38 uos-PC kernel: [78178.023683] [drm:amdgpu_atombios_encoder_set_bios_scratch_regs [amdgpu]] DFP1 connected
2023-12-06 15:24:38 uos-PC kernel: [78178.023694] [drm:drm_add_display_info [drm]] non_desktop set to 0
2023-12-06 15:24:38 uos-PC kernel: [78178.023702] [drm:drm_add_edid_modes [drm]] ELD: no CEA Extension found
2023-12-06 15:24:38 uos-PC kernel: [78178.023708] [drm:drm_add_display_info [drm]] non_desktop set to 0
2023-12-06 15:24:38 uos-PC kernel: [78178.023779] [drm:drm_mode_debug_printmodeline [drm]] Modeline 75:&amp;#34;1600x1200&amp;#34; 0 162000 1600 1664 1856 2160 1200 1201 1204 1250 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023785] [drm:drm_mode_prune_invalid [drm]] Not using 1600x1200 mode: BAD_WIDTH
2023-12-06 15:24:38 uos-PC kernel: [78178.023790] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1] probed modes :
2023-12-06 15:24:38 uos-PC kernel: [78178.023795] [drm:drm_mode_debug_printmodeline [drm]] Modeline 46:&amp;#34;1920x1080&amp;#34; 60 148500 1920 2008 2052 2200 1080 1084 1089 1125 0x48 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023801] [drm:drm_mode_debug_printmodeline [drm]] Modeline 48:&amp;#34;1680x1050&amp;#34; 60 119000 1680 1728 1760 1840 1050 1053 1059 1080 0x40 0x9
2023-12-06 15:24:38 uos-PC kernel: [78178.023806] [drm:drm_mode_debug_printmodeline [drm]] Modeline 52:&amp;#34;1400x1050&amp;#34; 60 101000 1400 1448 1480 1560 1050 1053 1057 1080 0x40 0x9
2023-12-06 15:24:38 uos-PC kernel: [78178.023811] [drm:drm_mode_debug_printmodeline [drm]] Modeline 50:&amp;#34;1600x900&amp;#34; 60 108000 1600 1624 1704 1800 900 901 904 1000 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023817] [drm:drm_mode_debug_printmodeline [drm]] Modeline 63:&amp;#34;1280x1024&amp;#34; 75 135000 1280 1296 1440 1688 1024 1025 1028 1066 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023822] [drm:drm_mode_debug_printmodeline [drm]] Modeline 53:&amp;#34;1280x1024&amp;#34; 60 108000 1280 1328 1440 1688 1024 1025 1028 1066 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023827] [drm:drm_mode_debug_printmodeline [drm]] Modeline 51:&amp;#34;1440x900&amp;#34; 60 88750 1440 1488 1520 1600 900 903 909 926 0x40 0x9
2023-12-06 15:24:38 uos-PC kernel: [78178.023832] [drm:drm_mode_debug_printmodeline [drm]] Modeline 54:&amp;#34;1280x960&amp;#34; 60 108000 1280 1376 1488 1800 960 961 964 1000 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023837] [drm:drm_mode_debug_printmodeline [drm]] Modeline 72:&amp;#34;1152x864&amp;#34; 75 108000 1152 1216 1344 1600 864 865 868 900 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023842] [drm:drm_mode_debug_printmodeline [drm]] Modeline 55:&amp;#34;1280x720&amp;#34; 60 74250 1280 1390 1430 1650 720 725 730 750 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023847] [drm:drm_mode_debug_printmodeline [drm]] Modeline 64:&amp;#34;1024x768&amp;#34; 75 78750 1024 1040 1136 1312 768 769 772 800 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023852] [drm:drm_mode_debug_printmodeline [drm]] Modeline 65:&amp;#34;1024x768&amp;#34; 70 75000 1024 1048 1184 1328 768 771 777 806 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.023857] [drm:drm_mode_debug_printmodeline [drm]] Modeline 66:&amp;#34;1024x768&amp;#34; 60 65000 1024 1048 1184 1344 768 771 777 806 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.023862] [drm:drm_mode_debug_printmodeline [drm]] Modeline 67:&amp;#34;832x624&amp;#34; 75 57284 832 864 928 1152 624 625 628 667 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.023868] [drm:drm_mode_debug_printmodeline [drm]] Modeline 68:&amp;#34;800x600&amp;#34; 75 49500 800 816 896 1056 600 601 604 625 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023873] [drm:drm_mode_debug_printmodeline [drm]] Modeline 71:&amp;#34;800x600&amp;#34; 72 50000 800 856 976 1040 600 637 643 666 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023878] [drm:drm_mode_debug_printmodeline [drm]] Modeline 56:&amp;#34;800x600&amp;#34; 60 40000 800 840 968 1056 600 601 605 628 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023883] [drm:drm_mode_debug_printmodeline [drm]] Modeline 57:&amp;#34;800x600&amp;#34; 56 36000 800 824 896 1024 600 601 603 625 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.023889] [drm:drm_mode_debug_printmodeline [drm]] Modeline 58:&amp;#34;640x480&amp;#34; 75 31500 640 656 720 840 480 481 484 500 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.023894] [drm:drm_mode_debug_printmodeline [drm]] Modeline 59:&amp;#34;640x480&amp;#34; 73 31500 640 664 704 832 480 489 492 520 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.023899] [drm:drm_mode_debug_printmodeline [drm]] Modeline 60:&amp;#34;640x480&amp;#34; 67 30240 640 704 768 864 480 483 486 525 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.023904] [drm:drm_mode_debug_printmodeline [drm]] Modeline 61:&amp;#34;640x480&amp;#34; 60 25175 640 656 752 800 480 490 492 525 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.023909] [drm:drm_mode_debug_printmodeline [drm]] Modeline 62:&amp;#34;720x400&amp;#34; 70 28320 720 738 846 900 400 412 414 449 0x40 0x6
2023-12-06 15:24:38 uos-PC kernel: [78178.024163] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:43:VGA-1]
2023-12-06 15:24:38 uos-PC kernel: [78178.039107] [drm:amdgpu_atombios_encoder_dac_detect [amdgpu]] Bios 0 scratch 10000 00000001
2023-12-06 15:24:38 uos-PC kernel: [78178.039261] [drm:amdgpu_atombios_encoder_set_bios_scratch_regs [amdgpu]] CRT1 disconnected
2023-12-06 15:24:38 uos-PC kernel: [78178.039279] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:43:VGA-1] disconnected
2023-12-06 15:24:38 uos-PC kernel: [78178.039529] [drm:dce_v6_0_crtc_load_lut [amdgpu]] 0
2023-12-06 15:24:38 uos-PC kernel: [78178.051695] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1]
2023-12-06 15:24:38 uos-PC kernel: [78178.085953] [drm:amdgpu_atombios_encoder_set_bios_scratch_regs [amdgpu]] DFP1 connected
2023-12-06 15:24:38 uos-PC kernel: [78178.085964] [drm:drm_add_display_info [drm]] non_desktop set to 0
2023-12-06 15:24:38 uos-PC kernel: [78178.085972] [drm:drm_add_edid_modes [drm]] ELD: no CEA Extension found
2023-12-06 15:24:38 uos-PC kernel: [78178.085978] [drm:drm_add_display_info [drm]] non_desktop set to 0
2023-12-06 15:24:38 uos-PC kernel: [78178.086049] [drm:drm_mode_debug_printmodeline [drm]] Modeline 75:&amp;#34;1600x1200&amp;#34; 0 162000 1600 1664 1856 2160 1200 1201 1204 1250 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086055] [drm:drm_mode_prune_invalid [drm]] Not using 1600x1200 mode: BAD_WIDTH
2023-12-06 15:24:38 uos-PC kernel: [78178.086060] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1] probed modes :
2023-12-06 15:24:38 uos-PC kernel: [78178.086066] [drm:drm_mode_debug_printmodeline [drm]] Modeline 46:&amp;#34;1920x1080&amp;#34; 60 148500 1920 2008 2052 2200 1080 1084 1089 1125 0x48 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086072] [drm:drm_mode_debug_printmodeline [drm]] Modeline 48:&amp;#34;1680x1050&amp;#34; 60 119000 1680 1728 1760 1840 1050 1053 1059 1080 0x40 0x9
2023-12-06 15:24:38 uos-PC kernel: [78178.086077] [drm:drm_mode_debug_printmodeline [drm]] Modeline 52:&amp;#34;1400x1050&amp;#34; 60 101000 1400 1448 1480 1560 1050 1053 1057 1080 0x40 0x9
2023-12-06 15:24:38 uos-PC kernel: [78178.086083] [drm:drm_mode_debug_printmodeline [drm]] Modeline 50:&amp;#34;1600x900&amp;#34; 60 108000 1600 1624 1704 1800 900 901 904 1000 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086088] [drm:drm_mode_debug_printmodeline [drm]] Modeline 63:&amp;#34;1280x1024&amp;#34; 75 135000 1280 1296 1440 1688 1024 1025 1028 1066 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086093] [drm:drm_mode_debug_printmodeline [drm]] Modeline 53:&amp;#34;1280x1024&amp;#34; 60 108000 1280 1328 1440 1688 1024 1025 1028 1066 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086099] [drm:drm_mode_debug_printmodeline [drm]] Modeline 51:&amp;#34;1440x900&amp;#34; 60 88750 1440 1488 1520 1600 900 903 909 926 0x40 0x9
2023-12-06 15:24:38 uos-PC kernel: [78178.086104] [drm:drm_mode_debug_printmodeline [drm]] Modeline 54:&amp;#34;1280x960&amp;#34; 60 108000 1280 1376 1488 1800 960 961 964 1000 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086109] [drm:drm_mode_debug_printmodeline [drm]] Modeline 72:&amp;#34;1152x864&amp;#34; 75 108000 1152 1216 1344 1600 864 865 868 900 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086114] [drm:drm_mode_debug_printmodeline [drm]] Modeline 55:&amp;#34;1280x720&amp;#34; 60 74250 1280 1390 1430 1650 720 725 730 750 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086119] [drm:drm_mode_debug_printmodeline [drm]] Modeline 64:&amp;#34;1024x768&amp;#34; 75 78750 1024 1040 1136 1312 768 769 772 800 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086124] [drm:drm_mode_debug_printmodeline [drm]] Modeline 65:&amp;#34;1024x768&amp;#34; 70 75000 1024 1048 1184 1328 768 771 777 806 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.086129] [drm:drm_mode_debug_printmodeline [drm]] Modeline 66:&amp;#34;1024x768&amp;#34; 60 65000 1024 1048 1184 1344 768 771 777 806 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.086134] [drm:drm_mode_debug_printmodeline [drm]] Modeline 67:&amp;#34;832x624&amp;#34; 75 57284 832 864 928 1152 624 625 628 667 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.086139] [drm:drm_mode_debug_printmodeline [drm]] Modeline 68:&amp;#34;800x600&amp;#34; 75 49500 800 816 896 1056 600 601 604 625 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086144] [drm:drm_mode_debug_printmodeline [drm]] Modeline 71:&amp;#34;800x600&amp;#34; 72 50000 800 856 976 1040 600 637 643 666 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086149] [drm:drm_mode_debug_printmodeline [drm]] Modeline 56:&amp;#34;800x600&amp;#34; 60 40000 800 840 968 1056 600 601 605 628 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086154] [drm:drm_mode_debug_printmodeline [drm]] Modeline 57:&amp;#34;800x600&amp;#34; 56 36000 800 824 896 1024 600 601 603 625 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.086159] [drm:drm_mode_debug_printmodeline [drm]] Modeline 58:&amp;#34;640x480&amp;#34; 75 31500 640 656 720 840 480 481 484 500 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.086164] [drm:drm_mode_debug_printmodeline [drm]] Modeline 59:&amp;#34;640x480&amp;#34; 73 31500 640 664 704 832 480 489 492 520 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.086169] [drm:drm_mode_debug_printmodeline [drm]] Modeline 60:&amp;#34;640x480&amp;#34; 67 30240 640 704 768 864 480 483 486 525 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.086175] [drm:drm_mode_debug_printmodeline [drm]] Modeline 61:&amp;#34;640x480&amp;#34; 60 25175 640 656 752 800 480 490 492 525 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.086180] [drm:drm_mode_debug_printmodeline [drm]] Modeline 62:&amp;#34;720x400&amp;#34; 70 28320 720 738 846 900 400 412 414 449 0x40 0x6
2023-12-06 15:24:38 uos-PC kernel: [78178.086208] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:43:VGA-1]
2023-12-06 15:24:38 uos-PC kernel: [78178.103073] [drm:amdgpu_atombios_encoder_dac_detect [amdgpu]] Bios 0 scratch 10000 00000001
2023-12-06 15:24:38 uos-PC kernel: [78178.103228] [drm:amdgpu_atombios_encoder_set_bios_scratch_regs [amdgpu]] CRT1 disconnected
2023-12-06 15:24:38 uos-PC kernel: [78178.103245] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:43:VGA-1] disconnected
2023-12-06 15:24:38 uos-PC kernel: [78178.103319] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1]
2023-12-06 15:24:38 uos-PC kernel: [78178.138981] [drm:amdgpu_atombios_encoder_set_bios_scratch_regs [amdgpu]] DFP1 connected
2023-12-06 15:24:38 uos-PC kernel: [78178.138993] [drm:drm_add_display_info [drm]] non_desktop set to 0
2023-12-06 15:24:38 uos-PC kernel: [78178.139002] [drm:drm_add_edid_modes [drm]] ELD: no CEA Extension found
2023-12-06 15:24:38 uos-PC kernel: [78178.139009] [drm:drm_add_display_info [drm]] non_desktop set to 0
2023-12-06 15:24:38 uos-PC kernel: [78178.139095] [drm:drm_mode_debug_printmodeline [drm]] Modeline 75:&amp;#34;1600x1200&amp;#34; 0 162000 1600 1664 1856 2160 1200 1201 1204 1250 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139102] [drm:drm_mode_prune_invalid [drm]] Not using 1600x1200 mode: BAD_WIDTH
2023-12-06 15:24:38 uos-PC kernel: [78178.139107] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:41:HDMI-A-1] probed modes :
2023-12-06 15:24:38 uos-PC kernel: [78178.139114] [drm:drm_mode_debug_printmodeline [drm]] Modeline 46:&amp;#34;1920x1080&amp;#34; 60 148500 1920 2008 2052 2200 1080 1084 1089 1125 0x48 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139121] [drm:drm_mode_debug_printmodeline [drm]] Modeline 48:&amp;#34;1680x1050&amp;#34; 60 119000 1680 1728 1760 1840 1050 1053 1059 1080 0x40 0x9
2023-12-06 15:24:38 uos-PC kernel: [78178.139127] [drm:drm_mode_debug_printmodeline [drm]] Modeline 52:&amp;#34;1400x1050&amp;#34; 60 101000 1400 1448 1480 1560 1050 1053 1057 1080 0x40 0x9
2023-12-06 15:24:38 uos-PC kernel: [78178.139134] [drm:drm_mode_debug_printmodeline [drm]] Modeline 50:&amp;#34;1600x900&amp;#34; 60 108000 1600 1624 1704 1800 900 901 904 1000 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139140] [drm:drm_mode_debug_printmodeline [drm]] Modeline 63:&amp;#34;1280x1024&amp;#34; 75 135000 1280 1296 1440 1688 1024 1025 1028 1066 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139147] [drm:drm_mode_debug_printmodeline [drm]] Modeline 53:&amp;#34;1280x1024&amp;#34; 60 108000 1280 1328 1440 1688 1024 1025 1028 1066 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139153] [drm:drm_mode_debug_printmodeline [drm]] Modeline 51:&amp;#34;1440x900&amp;#34; 60 88750 1440 1488 1520 1600 900 903 909 926 0x40 0x9
2023-12-06 15:24:38 uos-PC kernel: [78178.139160] [drm:drm_mode_debug_printmodeline [drm]] Modeline 54:&amp;#34;1280x960&amp;#34; 60 108000 1280 1376 1488 1800 960 961 964 1000 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139166] [drm:drm_mode_debug_printmodeline [drm]] Modeline 72:&amp;#34;1152x864&amp;#34; 75 108000 1152 1216 1344 1600 864 865 868 900 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139172] [drm:drm_mode_debug_printmodeline [drm]] Modeline 55:&amp;#34;1280x720&amp;#34; 60 74250 1280 1390 1430 1650 720 725 730 750 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139179] [drm:drm_mode_debug_printmodeline [drm]] Modeline 64:&amp;#34;1024x768&amp;#34; 75 78750 1024 1040 1136 1312 768 769 772 800 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139185] [drm:drm_mode_debug_printmodeline [drm]] Modeline 65:&amp;#34;1024x768&amp;#34; 70 75000 1024 1048 1184 1328 768 771 777 806 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.139191] [drm:drm_mode_debug_printmodeline [drm]] Modeline 66:&amp;#34;1024x768&amp;#34; 60 65000 1024 1048 1184 1344 768 771 777 806 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.139198] [drm:drm_mode_debug_printmodeline [drm]] Modeline 67:&amp;#34;832x624&amp;#34; 75 57284 832 864 928 1152 624 625 628 667 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.139204] [drm:drm_mode_debug_printmodeline [drm]] Modeline 68:&amp;#34;800x600&amp;#34; 75 49500 800 816 896 1056 600 601 604 625 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139211] [drm:drm_mode_debug_printmodeline [drm]] Modeline 71:&amp;#34;800x600&amp;#34; 72 50000 800 856 976 1040 600 637 643 666 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139217] [drm:drm_mode_debug_printmodeline [drm]] Modeline 56:&amp;#34;800x600&amp;#34; 60 40000 800 840 968 1056 600 601 605 628 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139224] [drm:drm_mode_debug_printmodeline [drm]] Modeline 57:&amp;#34;800x600&amp;#34; 56 36000 800 824 896 1024 600 601 603 625 0x40 0x5
2023-12-06 15:24:38 uos-PC kernel: [78178.139230] [drm:drm_mode_debug_printmodeline [drm]] Modeline 58:&amp;#34;640x480&amp;#34; 75 31500 640 656 720 840 480 481 484 500 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.139237] [drm:drm_mode_debug_printmodeline [drm]] Modeline 59:&amp;#34;640x480&amp;#34; 73 31500 640 664 704 832 480 489 492 520 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.139243] [drm:drm_mode_debug_printmodeline [drm]] Modeline 60:&amp;#34;640x480&amp;#34; 67 30240 640 704 768 864 480 483 486 525 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.139249] [drm:drm_mode_debug_printmodeline [drm]] Modeline 61:&amp;#34;640x480&amp;#34; 60 25175 640 656 752 800 480 490 492 525 0x40 0xa
2023-12-06 15:24:38 uos-PC kernel: [78178.139255] [drm:drm_mode_debug_printmodeline [drm]] Modeline 62:&amp;#34;720x400&amp;#34; 70 28320 720 738 846 900 400 412 414 449 0x40 0x6
2023-12-06 15:24:38 uos-PC kernel: [78178.139558] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:43:VGA-1]
2023-12-06 15:24:38 uos-PC kernel: [78178.155136] [drm:amdgpu_atombios_encoder_dac_detect [amdgpu]] Bios 0 scratch 10000 00000001
2023-12-06 15:24:38 uos-PC kernel: [78178.155305] [drm:amdgpu_atombios_encoder_set_bios_scratch_regs [amdgpu]] CRT1 disconnected
2023-12-06 15:24:38 uos-PC kernel: [78178.155323] [drm:drm_helper_probe_single_connector_modes [drm_kms_helper]] [CONNECTOR:43:VGA-1] disconnected
2023-12-06 15:24:38 uos-PC kernel: [78178.170911] [drm:dce_v6_0_crtc_load_lut [amdgpu]] 0
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;deepin-elf-veri -&amp;gt; 11073-deepin-elf-veri:23
dde-system-daem -&amp;gt; 965-dde-system-daem:23
uos-resource-ma -&amp;gt; 711-uos-resource-ma:23
pidof -&amp;gt; 2427-fcitx-helper:17
deepin-elf-veri -&amp;gt; 2883-deepin-elf-veri:23
uos-resource-ma -&amp;gt; 748-uos-resource-ma:23
deepin-elf-veri -&amp;gt; 2883-deepin-elf-veri:23
pidof -&amp;gt; 2427-fcitx-helper:17
dde-system-daem -&amp;gt; 947-dde-system-daem:23
dde-system-daem -&amp;gt; 958-dde-system-daem:23
deepin-elf-veri -&amp;gt; 11073-deepin-elf-veri:23
uos-resource-ma -&amp;gt; 711-uos-resource-ma:23
dde-session-dae -&amp;gt; 1864-dde-session-dae:23
startdde -&amp;gt; 1809-startdde:23
pidof -&amp;gt; 2427-fcitx-helper:17
dde-lock -&amp;gt; 2418-dde-lock:17
dde-lockservice -&amp;gt; 5604-dde-lockservice:23
dbus-daemon -&amp;gt; 5598-dbus-daemon:9
dbus-daemon -&amp;gt; 714-dbus-daemon:17
kworker/3:0 -&amp;gt; 889-Xorg:10
Xorg -&amp;gt; 3723-Xorg:10
dde-switchtogre -&amp;gt; 1-systemd:17
uos-resource-ma -&amp;gt; 711-uos-resource-ma:23
pidof -&amp;gt; 2427-fcitx-helper:17
deepin-authenti -&amp;gt; 2948-deepin-authenti:23
uos-resource-ma -&amp;gt; 711-uos-resource-ma:23
deepin-elf-veri -&amp;gt; 11073-deepin-elf-veri:23
dde-session-dae -&amp;gt; 1260-dde-session-dae:23
startdde -&amp;gt; 1809-startdde:23
uos-resource-ma -&amp;gt; 766-uos-resource-ma:23
pidof -&amp;gt; 2427-fcitx-helper:17
^Ckworker/u16:0 -&amp;gt; 4240-bpftrace:2
uos-resource-ma -&amp;gt; 711-uos-resource-ma:23
dde-session-dae -&amp;gt; 1260-dde-session-dae:23
^Ckworker/u16:2 -&amp;gt; 4240-bpftrace:2
^Ckworker/u16:0 -&amp;gt; 4240-bpftrace:2
uos-resource-ma -&amp;gt; 748-uos-resource-ma:23
^Ckworker/u16:2 -&amp;gt; 4240-bpftrace:2
uos-resource-ma -&amp;gt; 711-uos-resource-ma:23
pidof -&amp;gt; 2427-fcitx-helper:17
dde-session-dae -&amp;gt; 1694-dde-session-dae:23
uos-resource-ma -&amp;gt; 711-uos-resource-ma:23
dde-session-dae -&amp;gt; 1694-dde-session-dae:23
^Ckworker/u16:0 -&amp;gt; 4240-bpftrace:2
pidof -&amp;gt; 2427-fcitx-helper:17
dde-session-dae -&amp;gt; 1260-dde-session-dae:23
^Ckworker/u16:2 -&amp;gt; 4240-bpftrace:2
startdde -&amp;gt; 2363-startdde:23
uos-resource-ma -&amp;gt; 711-uos-resource-ma:23
uos-resource-ma -&amp;gt; 766-uos-resource-ma:23
pidof -&amp;gt; 2427-fcitx-helper:17
dde-system-daem -&amp;gt; 948-dde-system-daem:23
uos-resource-ma -&amp;gt; 748-uos-resource-ma:23
^Ckworker/u16:0 -&amp;gt; 4240-bpftrace:2
^Ckworker/u16:2 -&amp;gt; 4240-bpftrace:2
^Ckworker/u16:0 -&amp;gt; 4240-bpftrace:2
^Ckworker/u16:2 -&amp;gt; 4240-bpftrace:2
^Ckworker/u16:0 -&amp;gt; 4240-bpftrace:2
^Ckworker/u16:2 -&amp;gt; 4240-bpftrace:2
^Ckworker/u16:0 -&amp;gt; 4240-bpftrace:2
uos-resource-ma -&amp;gt; 766-uos-resource-ma:23
pidof -&amp;gt; 2427-fcitx-helper:17
dde-session-dae -&amp;gt; 1694-dde-session-dae:23
uos-resource-ma -&amp;gt; 766-uos-resource-ma:23
uos-resource-ma -&amp;gt; 711-uos-resource-ma:23
dde-system-daem -&amp;gt; 958-dde-system-daem:23
startdde -&amp;gt; 2397-startdde:23
pidof -&amp;gt; 2427-fcitx-helper:17
deepin-elf-veri -&amp;gt; 2883-deepin-elf-veri:23
dde-session-dae -&amp;gt; 1260-dde-session-dae:23
pidof -&amp;gt; 2427-fcitx-helper:17
uos-resource-ma -&amp;gt; 766-uos-resource-ma:23
uos-resource-ma -&amp;gt; 711-uos-resource-ma:23
dde-session-dae -&amp;gt; 1260-dde-session-dae:23
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;kworker/3:0 -&amp;gt; 889-Xorg:10
Xorg -&amp;gt; 3723-Xorg:10&lt;/p&gt;
&lt;p&gt;看看这两个，信号就是从内核的进程发出来的。那这个信号到底是什么含义呢？如何通过代码找到发送信号的地方呢？&lt;/p&gt;
&lt;h2 id=&#34;韬哥指导&#34;&gt;韬哥指导&lt;/h2&gt;
&lt;p&gt;可以在 trace 里打印一下 kstack，看看 kworker 的路径。&lt;/p&gt;
&lt;p&gt;一般而言，内核是不会主动向用户进程发送 SIGUSR 的，这是留给用户进程自定义的信号，有 SIGUSR1 和 SIGUSR2。&lt;/p&gt;
&lt;p&gt;所以，很有可能是这是 xorg 主动注册的：在某个事件发生时，给我发送这个信号，我会知道怎么处理。典型的就是内核提供的定时器接口 itimer，默认是发送 SIGALARM，但是是可以指定 signal 的。&lt;/p&gt;
&lt;p&gt;所以往下至少有这样一些思路可以找找：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;打印 kstack，看 kworker 路径。——有可能都不是因为 kworker 发的，而是在 irq/softirq 里，比如在 hrtimer 中断里发的。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;看一下 xorg 的这个信号的 handler，可以用 crash 找到 handler 地址，然后用 gdb 找到函数名，或者在 xorg 代&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;码里搜一搜 SIGUSR，或者在它运行时 trace 一下 signal handler 的注册过程，估计都可以找到。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;根据它的注册接口（什么事件会触发）、handler，流程框架可能就大概出来了。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;按照韬哥的思路我来尝试一下。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-bt&#34; data-lang=&#34;bt&#34;&gt;bpftrace -e &amp;#39;tracepoint:signal:signal_generate { printf(&amp;#34;Process %d %s sent SIGNAL %d to process %d %s\n&amp;#34;, pid, comm, args-&amp;gt;sig, args-&amp;gt;pid, args-&amp;gt;comm);printf(&amp;#34;Kstack %s\n&amp;#34;,kstack);}&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;还是用韬哥的脚本做一下修改可以使用：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-bpftrace&#34; data-lang=&#34;bpftrace&#34;&gt;#!/usr/bin/env bpftrace

#ifndef BPFTRACE_HAVE_BTF
#include &amp;lt;linux/sched.h&amp;gt;

// Until BTF is available, we&amp;#39;ll need to declare some of this struct manually,
// since it isn&amp;#39;t available to be #included. This will need maintenance to match
// your kernel version. It is from kernel/sched/sched.h:
struct cfs_rq {
        struct load_weight load;
        unsigned long runnable_weight;
        unsigned int nr_running;
        unsigned int h_nr_running;
};
#endif


k:send_signal
{
        // for 4.19:
        //              $task = (task_struct *)arg2;                    -&amp;gt; OK
        //              $task = (struct task_struct *)arg2;             -&amp;gt; NG
        $task = (task_struct *)arg2;
        printf(&amp;#34;%s -&amp;gt; %d-%s:%d\nkstack: %s,&amp;#34;, comm, $task-&amp;gt;pid,
                $task-&amp;gt;comm, arg0, kstack);
}
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;,kworker/1:1 -&amp;gt; 3723-Xorg:10
kstack:
        send_signal+1
        do_send_sig_info+74
        kill_pid_info+68
        change_console+113
        console_callback+357
        process_one_work+423
        worker_thread+48
        kthread+274
        ret_from_fork+31
,dde-switchtogre -&amp;gt; 1-systemd:17
kstack:
        send_signal+1
        do_notify_parent+538
        do_exit+2950
        do_group_exit+58
        __x64_sys_exit_group+20
        do_syscall_64+90
        entry_SYSCALL_64_after_hwframe+68
,Xorg -&amp;gt; 889-Xorg:10
kstack:
        send_signal+1
        do_send_sig_info+74
        kill_pid_info+68
        complete_change_console+154
        vt_ioctl+4101
        tty_ioctl+540
        do_vfs_ioctl+164
        ksys_ioctl+96
        __x64_sys_ioctl+22
        do_syscall_64+90
        entry_SYSCALL_64_after_hwframe+68
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;gdb 下查看 handler 函数：&lt;/p&gt;
&lt;p&gt;是这个函数，
xf86VTRequest&lt;/p&gt;
&lt;p&gt;搜到的函数如下：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;uos@uos-PC:~/x_all$ grep xf86VTRequest -rIin
xorg-server-1.20.4.71/hw/xfree86/os-support/bsd/bsd_init.c:272:                OsSignal(SIGUSR1, xf86VTRequest);
xorg-server-1.20.4.71/hw/xfree86/os-support/bsd/bsd_VTsw.c:45:xf86VTRequest(int sig)
xorg-server-1.20.4.71/hw/xfree86/os-support/linux/lnx_init.c:241:            OsSignal(SIGUSR1, xf86VTRequest);
xorg-server-1.20.4.71/hw/xfree86/os-support/shared/VTsw_usl.c:44:xf86VTRequest(int sig)
xorg-server-1.20.4.71/hw/xfree86/os-support/shared/VTsw_usl.c:46:    OsSignal(sig, (void (*)(int)) xf86VTRequest);
xorg-server-1.20.4.71/hw/xfree86/os-support/xf86_OSproc.h:181:extern _X_EXPORT void xf86VTRequest(int sig);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在内术当中有这几个函数：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;change_console&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; vc_data &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;new_vc)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; vc_data &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;vc;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;new_vc &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt; new_vc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;vc_num &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; fg_console &lt;span style=&#34;color:#ff79c6&#34;&gt;||&lt;/span&gt; vt_dont_switch)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * If this vt is in process mode, then we need to handshake with
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * that process before switching. Essentially, we store where that
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * vt wants to switch to and wait for it to tell us when it&amp;#39;s done
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * (via VT_RELDISP ioctl).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * We also check to see if the controlling process still exists.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * If it doesn&amp;#39;t, we reset this vt to auto mode and continue.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * This is a cheap way to track process control. The worst thing
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * that can happen is: we send a signal to a process, it dies, and
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * the switch gets &amp;#34;lost&amp;#34; waiting for a response; hopefully, the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * user will try again, we&amp;#39;ll detect the process is gone (unless
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * the user waits just the right amount of time :-) and revert the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * vt to auto control.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        vc &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; vc_cons[fg_console].d;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (vc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;vt_mode.mode &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; VT_PROCESS) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * Send the signal as privileged - kill_pid() will
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * tell us if the process has gone or something else
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * is awry.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * We need to set vt_newvt *before* sending the signal or we
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * have a race.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                vc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;vt_newvt &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; new_vc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;vc_num;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;kill_pid&lt;/span&gt;(vc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;vt_pid, vc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;vt_mode.relsig, &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                         * It worked. Mark the vt to switch to and
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                         * return. The process needs to send us a
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                         * VT_RELDISP ioctl to complete the switch.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * The controlling process has died, so we revert back to
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * normal operation. In this case, we&amp;#39;ll also change back
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * to KD_TEXT mode. I&amp;#39;m not sure if this is strictly correct
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * but it saves the agony when the X server dies and the screen
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * remains blanked due to KD_GRAPHICS! It would be nice to do
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * this outside of VT_PROCESS but there is no single process
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * to account for and tracking tty count may be undesirable.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;reset_vc&lt;/span&gt;(vc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * Fall through to normal (VT_AUTO) handling of the switch...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * Ignore all switches in KD_GRAPHICS+VT_AUTO mode
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (vc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;vc_mode &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; KD_GRAPHICS)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;complete_change_console&lt;/span&gt;(new_vc);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * This is the console switching callback.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Doing console switching in a process context allows
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * us to do the switches asynchronously (needed when we want
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * to switch due to a keyboard interrupt).  Synchronization
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * with other console code and prevention of re-entrancy is
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * ensured with console_lock.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;console_callback&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; work_struct &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;ignored)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;console_lock&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (want_console &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (want_console &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; fg_console &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#50fa7b&#34;&gt;vc_cons_allocated&lt;/span&gt;(want_console)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;hide_cursor&lt;/span&gt;(vc_cons[fg_console].d);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;change_console&lt;/span&gt;(vc_cons[want_console].d);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#6272a4&#34;&gt;/* we only changed when the console had already
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                           been allocated - a new console is not created
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                           in an interrupt routine */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                want_console &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (do_poke_blanked_console) { &lt;span style=&#34;color:#6272a4&#34;&gt;/* do not unblank for a LED change */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                do_poke_blanked_console &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;poke_blanked_console&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (scrollback_delta) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; vc_data &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;vc &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; vc_cons[fg_console].d;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;clear_selection&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (vc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;vc_mode &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; KD_TEXT &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; vc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;vc_sw&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;con_scrolldelta)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        vc&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;vc_sw&lt;span style=&#34;color:#ff79c6&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;con_scrolldelta&lt;/span&gt;(vc, scrollback_delta);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                scrollback_delta &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (blank_timer_expired) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;do_blank_screen&lt;/span&gt;(&lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                blank_timer_expired &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;notify_update&lt;/span&gt;(vc_cons[fg_console].d);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;console_unlock&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;最终找到 xorg ，是 xorg 中的 lnx_init.c 中的 xf86OpenConsole 函数会初始化的时候调用这个函数。再往上是这个：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * InitOutput --
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *	Initialize screenInfo for all actually accessible framebuffers.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *      That includes vt-manager setup, querying all possible devices and
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *      collecting the pixmap formats.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;InitOutput&lt;/span&gt;(ScreenInfo &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; pScreenInfo, &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#8be9fd&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;**&lt;/span&gt;argv)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;再往上是这个：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;dix_main&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; argc, &lt;span style=&#34;color:#8be9fd&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;argv[], &lt;span style=&#34;color:#8be9fd&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;envp[])
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这个是架构和硬件无关的公共部分。&lt;/p&gt;
&lt;p&gt;发现有一堆的函数，还是用 gdb 再看一下吧。&lt;/p&gt;
&lt;p&gt;找到收到信号后 xorg 处理的 handler 是哪个，这个如果能找到的话，那么问题大概能理清楚？&lt;/p&gt;
&lt;p&gt;处理是在这里的 xf86VTRequest ，这个函数会在收到内核的 SYSUSR1 信号后做一些处理，这个函数如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Handle the VT-switching interface for OSs that use USL-style ioctl()s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * (the sysv, sco, and linux subdirs).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * This function is the signal handler for the VT-switching signal.  It
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * is only referenced inside the OS-support layer.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;xf86VTRequest&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; sig)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;OsSignal&lt;/span&gt;(sig, (&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;)(&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;)) xf86VTRequest);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    xf86Info.vtRequestsPending &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; TRUE;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在 lnx_init.c 当中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;xf86OpenConsole&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; i, ret;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; vt_stat vts;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; vt_mode VT;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;vcs[] &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; { &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;/dev/vc/%d&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;/dev/tty%d&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (serverGeneration &lt;span style=&#34;color:#ff79c6&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;linux_parse_vt_settings&lt;/span&gt;(FALSE);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;KeepTty) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#8be9fd&#34;&gt;pid_t&lt;/span&gt; ppid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;getppid&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#8be9fd&#34;&gt;pid_t&lt;/span&gt; ppgid;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ppgid &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;getpgid&lt;/span&gt;(ppid);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;             * change to parent process group that pgid != pid so
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;             * that setsid() doesn&amp;#39;t fail and we become process
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;             * group leader
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;             */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;setpgid&lt;/span&gt;(&lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;, ppgid) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;xf86Msg&lt;/span&gt;(X_WARNING, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole: setpgid failed: %s&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;strerror&lt;/span&gt;(errno));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#6272a4&#34;&gt;/* become process group leader */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; ((&lt;span style=&#34;color:#50fa7b&#34;&gt;setsid&lt;/span&gt;() &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;xf86Msg&lt;/span&gt;(X_WARNING, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole: setsid failed: %s&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                        &lt;span style=&#34;color:#50fa7b&#34;&gt;strerror&lt;/span&gt;(errno));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        i &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;while&lt;/span&gt; (vcs[i] &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;snprintf&lt;/span&gt;(vtname, &lt;span style=&#34;color:#ff79c6&#34;&gt;sizeof&lt;/span&gt;(vtname), vcs[i], xf86Info.vtno);    &lt;span style=&#34;color:#6272a4&#34;&gt;/* /dev/tty1-64 */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; ((xf86Info.consoleFd &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;open&lt;/span&gt;(vtname, O_RDWR &lt;span style=&#34;color:#ff79c6&#34;&gt;|&lt;/span&gt; O_NDELAY, &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            i&lt;span style=&#34;color:#ff79c6&#34;&gt;++&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (xf86Info.consoleFd &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;FatalError&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole: Cannot open virtual console&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34; %d (%s)&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;, xf86Info.vtno, &lt;span style=&#34;color:#50fa7b&#34;&gt;strerror&lt;/span&gt;(errno));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * Linux doesn&amp;#39;t switch to an active vt after the last close of a vt,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         * so we do this ourselves by remembering which is active now.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;         */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;SYSCALL&lt;/span&gt;(ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;ioctl&lt;/span&gt;(xf86Info.consoleFd, VT_GETSTATE, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;vts));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (ret &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;xf86Msg&lt;/span&gt;(X_WARNING, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole: VT_GETSTATE failed: %s&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#50fa7b&#34;&gt;strerror&lt;/span&gt;(errno));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            activeVT &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; vts.v_active;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;xf86Info.ShareVTs) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; termios nTty;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;             * now get the VT.  This _must_ succeed, or else fail completely.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;             */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;switch_to&lt;/span&gt;(xf86Info.vtno, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;FatalError&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole: Switching VT failed&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;SYSCALL&lt;/span&gt;(ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;ioctl&lt;/span&gt;(xf86Info.consoleFd, VT_GETMODE, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;VT));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (ret &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;FatalError&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole: VT_GETMODE failed %s&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           &lt;span style=&#34;color:#50fa7b&#34;&gt;strerror&lt;/span&gt;(errno));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;OsSignal&lt;/span&gt;(SIGUSR1, xf86VTRequest);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            VT.mode &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; VT_PROCESS;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            VT.relsig &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; SIGUSR1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            VT.acqsig &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; SIGUSR1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;SYSCALL&lt;/span&gt;(ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;ioctl&lt;/span&gt;(xf86Info.consoleFd, VT_SETMODE, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;VT));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (ret &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;FatalError&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    (&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole: VT_SETMODE VT_PROCESS failed: %s&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                     &lt;span style=&#34;color:#50fa7b&#34;&gt;strerror&lt;/span&gt;(errno));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;SYSCALL&lt;/span&gt;(ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;ioctl&lt;/span&gt;(xf86Info.consoleFd, KDSETMODE, KD_GRAPHICS));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (ret &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;FatalError&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole: KDSETMODE KD_GRAPHICS failed %s&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           &lt;span style=&#34;color:#50fa7b&#34;&gt;strerror&lt;/span&gt;(errno));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;tcgetattr&lt;/span&gt;(xf86Info.consoleFd, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;tty_attr);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;SYSCALL&lt;/span&gt;(&lt;span style=&#34;color:#50fa7b&#34;&gt;ioctl&lt;/span&gt;(xf86Info.consoleFd, KDGKBMODE, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;tty_mode));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#6272a4&#34;&gt;/* disable kernel special keys and buffering */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;SYSCALL&lt;/span&gt;(ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;ioctl&lt;/span&gt;(xf86Info.consoleFd, KDSKBMODE, K_OFF));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (ret &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/* fine, just disable special keys */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;SYSCALL&lt;/span&gt;(ret &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;ioctl&lt;/span&gt;(xf86Info.consoleFd, KDSKBMODE, K_RAW));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (ret &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#50fa7b&#34;&gt;FatalError&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole: KDSKBMODE K_RAW failed %s&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                               &lt;span style=&#34;color:#50fa7b&#34;&gt;strerror&lt;/span&gt;(errno));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/* ... and drain events, else the kernel gets angry */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;xf86SetConsoleHandler&lt;/span&gt;(drain_console, &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;NULL&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nTty &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; tty_attr;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nTty.c_iflag &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; (IGNPAR &lt;span style=&#34;color:#ff79c6&#34;&gt;|&lt;/span&gt; IGNBRK) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;~&lt;/span&gt;PARMRK) &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;~&lt;/span&gt;ISTRIP);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nTty.c_oflag &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nTty.c_cflag &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; CREAD &lt;span style=&#34;color:#ff79c6&#34;&gt;|&lt;/span&gt; CS8;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nTty.c_lflag &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nTty.c_cc[VTIME] &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nTty.c_cc[VMIN] &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;cfsetispeed&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;nTty, &lt;span style=&#34;color:#bd93f9&#34;&gt;9600&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;cfsetospeed&lt;/span&gt;(&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;nTty, &lt;span style=&#34;color:#bd93f9&#34;&gt;9600&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;tcsetattr&lt;/span&gt;(xf86Info.consoleFd, TCSANOW, &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&lt;/span&gt;nTty);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; {                      &lt;span style=&#34;color:#6272a4&#34;&gt;/* serverGeneration != 1 */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;xf86Info.ShareVTs &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; xf86Info.autoVTSwitch) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#6272a4&#34;&gt;/* now get the VT */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;switch_to&lt;/span&gt;(xf86Info.vtno, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;FatalError&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86OpenConsole: Switching VT failed&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;xf86InfoRec 是 Xorg 服务器中的全局变量，包含了很多的信息，用于初始化等。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * xf86InfoRec contains global parameters which the video drivers never
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * need to access.  Global parameters which the video drivers do need
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * should be individual globals.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;typedef&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; consoleFd;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; vtno;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;/* event handler part */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; lastEventTime;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool vtRequestsPending;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#ifdef __sun
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; vtPendingNum;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;    Bool dontVTSwitch;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool autoVTSwitch;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool ShareVTs;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool dontZap;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool dontZoom;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool notrapSignals;         &lt;span style=&#34;color:#6272a4&#34;&gt;/* don&amp;#39;t exit cleanly - die at fault */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;/* graphics part */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ScreenPtr currentScreen;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#if defined(CSRG_BASED) || defined(__FreeBSD_kernel__)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; consType;               &lt;span style=&#34;color:#6272a4&#34;&gt;/* Which console driver? */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;/* Other things */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool allowMouseOpenFail;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool vidModeEnabled;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* VidMode extension enabled */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool vidModeAllowNonLocal;  &lt;span style=&#34;color:#6272a4&#34;&gt;/* allow non-local VidMode
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                                 * connections */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool miscModInDevEnabled;   &lt;span style=&#34;color:#6272a4&#34;&gt;/* Allow input devices to be
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                                 * changed */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool miscModInDevAllowNonLocal;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool useSIGIO;              &lt;span style=&#34;color:#6272a4&#34;&gt;/* Use SIGIO for handling DRI1 swaps */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool pmFlag;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    MessageType iglxFrom;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    XF86_GlxVisuals glxVisuals;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    MessageType glxVisualsFrom;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool useDefaultFontPath;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool ignoreABI;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool forceInputDevices;     &lt;span style=&#34;color:#6272a4&#34;&gt;/* force xorg.conf or built-in input devices */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool autoAddDevices;        &lt;span style=&#34;color:#6272a4&#34;&gt;/* Whether to succeed NIDR, or ignore. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool autoEnableDevices;     &lt;span style=&#34;color:#6272a4&#34;&gt;/* Whether to enable, or let the client
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                                 * control. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool dri2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    MessageType dri2From;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool autoAddGPU;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;debug;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#ifdef XSERVER_PLATFORM_BUS
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;char&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;primaryBusDrv;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    MessageType primaryBusDrvFrom;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Bool autoBindGPU;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;} xf86InfoRec, &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;xf86InfoPtr;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;切换调用的是这个函数：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * xf86VTSwitch --
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *      Handle requests for switching the vt.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;xf86VTSwitch&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;DebugF&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;xf86VTSwitch()&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#ifdef XFreeXDGA
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;DGAVTSwitch&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;return&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;     * Since all screens are currently all in the same state it is sufficient
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;     * check the first.  This might change in future.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;     *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;     * VTLeave is always handled here (VT_PROCESS guarantees this is safe),
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;     * if we use systemd_logind xf86VTEnter() gets called by systemd-logind.c
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;     * once it has resumed all drm nodes.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;xf86VTOwner&lt;/span&gt;()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#ifdef CONFIG_UDEV_KMS
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;usb_drm_device_handle&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;remove&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;xf86VTLeave&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;systemd_logind_controls_session&lt;/span&gt;()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#ifdef CONFIG_UDEV_KMS
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;usb_drm_device_handle&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;add&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;xf86VTEnter&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;往上一级是这个：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * xf86Wakeup --
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; *      Os wakeup handler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/* ARGSUSED */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;xf86Wakeup&lt;/span&gt;(&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;blockData, &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; err)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#50fa7b&#34;&gt;xf86VTSwitchPending&lt;/span&gt;())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#50fa7b&#34;&gt;xf86VTSwitch&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在 xf86Init.c 中的 InitOutput 函数当中会初始化收到切换信号的的注册过程：
RegisterBlockAndWakeupHandlers((ServerBlockHandlerProcPtr) NoopDDA, xf86Wakeup,
NULL);&lt;/p&gt;
&lt;p&gt;还有一个是接内核事件的：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * Handle keyboard events that cause some kind of &amp;#34;action&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; * (i.e., server termination, video mode changes, VT switches, etc.)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;xf86ProcessActionEvent&lt;/span&gt;(ActionEvent action, &lt;span style=&#34;color:#8be9fd&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;arg)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#50fa7b&#34;&gt;DebugF&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;ProcessActionEvent(%d,%p)&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;, (&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt;) action, arg);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;switch&lt;/span&gt; (action) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;ACTION_TERMINATE&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;xf86Info.dontZap) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;xf86Msg&lt;/span&gt;(X_INFO, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;Server zapped. Shutting down.&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#ifdef XFreeXDGA
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;DGAShutdown&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#endif
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;GiveUp&lt;/span&gt;(&lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;ACTION_NEXT_MODE&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;xf86Info.dontZoom)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;xf86ZoomViewport&lt;/span&gt;(xf86Info.currentScreen, &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;ACTION_PREV_MODE&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;xf86Info.dontZoom)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#50fa7b&#34;&gt;xf86ZoomViewport&lt;/span&gt;(xf86Info.currentScreen, &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;ACTION_SWITCHSCREEN&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;xf86Info.dontVTSwitch &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; arg) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; vtno &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;((&lt;span style=&#34;color:#8be9fd&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt;) arg);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (vtno &lt;span style=&#34;color:#ff79c6&#34;&gt;!=&lt;/span&gt; xf86Info.vtno) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;xf86VTActivate&lt;/span&gt;(vtno)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#50fa7b&#34;&gt;ErrorF&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;Failed to switch from vt%02d to vt%02d: %s&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           xf86Info.vtno, vtno, &lt;span style=&#34;color:#50fa7b&#34;&gt;strerror&lt;/span&gt;(errno));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;ACTION_SWITCHSCREEN_NEXT&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;xf86Info.dontVTSwitch) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;xf86VTActivate&lt;/span&gt;(xf86Info.vtno &lt;span style=&#34;color:#ff79c6&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/* If first try failed, assume this is the last VT and
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 * try wrapping around to the first vt.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;                 */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;xf86VTActivate&lt;/span&gt;(&lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                    &lt;span style=&#34;color:#50fa7b&#34;&gt;ErrorF&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;Failed to switch from vt%02d to next vt: %s&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                           xf86Info.vtno, &lt;span style=&#34;color:#50fa7b&#34;&gt;strerror&lt;/span&gt;(errno));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;ACTION_SWITCHSCREEN_PREV&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;xf86Info.dontVTSwitch &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; xf86Info.vtno &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color:#ff79c6&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color:#50fa7b&#34;&gt;xf86VTActivate&lt;/span&gt;(xf86Info.vtno &lt;span style=&#34;color:#ff79c6&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;1&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#6272a4&#34;&gt;/* Don&amp;#39;t know what the maximum VT is, so can&amp;#39;t wrap around */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                &lt;span style=&#34;color:#50fa7b&#34;&gt;ErrorF&lt;/span&gt;(&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;Failed to switch from vt%02d to previous vt: %s&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                       xf86Info.vtno, &lt;span style=&#34;color:#50fa7b&#34;&gt;strerror&lt;/span&gt;(errno));
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#ff79c6&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#ff79c6&#34;&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;画一下流程图&#34;&gt;画一下流程图&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/process1.png&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;那么 setcrtc 这个系统调用是谁调用的呢？我分析的有，但是为啥有的时候就不闪呢？&lt;/p&gt;
&lt;p&gt;setcrtc 这个系统调用一定是调用多次的。打到多次调用的地方。&lt;/p&gt;
&lt;p&gt;libdrm 下的 drmModeSetCrtc&lt;/p&gt;
&lt;p&gt;（1) void AMDGPULeaveVT_KMS(ScrnInfoPtr pScrn) ，退出的就会有这个调用的。&lt;/p&gt;
&lt;p&gt;还有吗？&lt;/p&gt;
&lt;p&gt;（2) drmmode_crtc_dpms(xf86CrtcPtr crtc, int mode) ，用 gdb 试一下，很容易。&lt;/p&gt;
&lt;p&gt;信号的分析：
./winn-signal.bt&lt;/p&gt;
&lt;p&gt;好吧，用两个 gdb 走一下完整的流程：&lt;/p&gt;
&lt;p&gt;（1）切出的 xorg 收到信号 SIGUSR1&lt;/p&gt;
&lt;p&gt;（2) 触发断点&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;(gdb) bt
#0  0x00007f649eb0e5d0 in drmModeSetCrtc () from /lib/x86_64-linux-gnu/libdrm.so.2
#1  0x00007f649df90508 in drmmode_set_mode (crtc=crtc@entry=0x2601cf0, fb=fb@entry=0x319b6a0, mode=mode@entry=0x2601d08, x=x@entry=0, y=y@entry=0) at ../../src/drmmode_display.c:1353
#2  0x00007f649df8b445 in AMDGPULeaveVT_KMS (pScrn=0x1edc200) at ../../src/amdgpu_kms.c:2202
#3  0x000000000049012c in xf86XVLeaveVT (pScrn=0x1edc200) at ../../../../../../hw/xfree86/common/xf86xv.c:1226
#4  0x00007f649e2df449 in glxDRILeaveVT (scrn=0x1edc200) at ../../../../glx/glxdri2.c:815
#5  0x000000000047bc95 in xf86VTLeave () at ../../../../../../hw/xfree86/common/xf86Events.c:396
#6  0x0000000000443435 in WakeupHandler (result=result@entry=-1) at ../../../../dix/dixutils.c:429
#7  0x0000000000598bb1 in WaitForSomething (are_ready=0) at ../../../../os/WaitFor.c:210
#8  0x000000000043e6cc in Dispatch () at ../../../../include/list.h:220
#9  0x0000000000442906 in dix_main (argc=12, argv=0x7ffc704559c8, envp=&amp;lt;optimized out&amp;gt;) at ../../../../dix/main.c:276
#10 0x00007f649e5f11fb in __libc_start_main (main=0x42b6a0 &amp;lt;main&amp;gt;, argc=12, argv=0x7ffc704559c8, init=&amp;lt;optimized out&amp;gt;, fini=&amp;lt;optimized out&amp;gt;, rtld_fini=&amp;lt;optimized out&amp;gt;, stack_end=0x7ffc704559b8)
    at ../csu/libc-start.c:308
#11 0x000000000042b6da in _start () at ../../../../../../hw/xfree86/common/xf86Events.c:638
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;（3）切入的 xorg 收到信号 SIGUSR1&lt;/p&gt;
&lt;p&gt;（4）触发断点&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;(gdb) bt
#0  0x00007f377dea25d0 in drmModeSetCrtc () from /lib/x86_64-linux-gnu/libdrm.so.2
#1  0x00007f377d3237e3 in drmmode_crtc_dpms (crtc=0x250b0e0, mode=3) at ../../src/drmmode_display.c:405
#2  0x00007f377d327119 in drmmode_set_desired_modes (pScrn=pScrn@entry=0x1de8070, drmmode=drmmode@entry=0x1de94e8, set_hw=set_hw@entry=1) at ../../src/drmmode_display.c:3641
#3  0x00007f377d31f12d in AMDGPUEnterVT_KMS (pScrn=0x1de8070) at ../../src/amdgpu_kms.c:2141
#4  0x000000000048e4e0 in ?? ()
#5  0x00000000004b8f78 in ?? ()
#6  0x00000000004834d9 in ?? ()
#7  0x00007f377d6734af in ?? () from /usr/lib/xorg/modules/extensions/libglx.so
#8  0x000000000047bf29 in xf86VTEnter ()
#9  0x0000000000443435 in WakeupHandler ()
#10 0x0000000000598bb1 in WaitForSomething ()
#11 0x000000000043e6cc in ?? ()
#12 0x0000000000442906 in ?? ()
#13 0x00007f377d9851fb in __libc_start_main (main=0x42b6a0, argc=12, argv=0x7ffd2944c698, init=&amp;lt;optimized out&amp;gt;, fini=&amp;lt;optimized out&amp;gt;, rtld_fini=&amp;lt;optimized out&amp;gt;, stack_end=0x7ffd2944c688)
    at ../csu/libc-start.c:308
#14 0x000000000042b6da in _start ()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;（5) 第二次触发断点&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-nil&#34; data-lang=&#34;nil&#34;&gt;(gdb) bt
#0  0x00007f377dea25d0 in drmModeSetCrtc () from /lib/x86_64-linux-gnu/libdrm.so.2
#1  0x00007f377d324508 in drmmode_set_mode (crtc=crtc@entry=0x250a4e0, fb=fb@entry=0x2a33370, mode=mode@entry=0x250a5c8, x=x@entry=0, y=y@entry=0) at ../../src/drmmode_display.c:1353
#2  0x00007f377d324a6d in drmmode_set_mode_major (crtc=0x250a4e0, mode=0x250a5c8, rotation=&amp;lt;optimized out&amp;gt;, x=&amp;lt;optimized out&amp;gt;, y=&amp;lt;optimized out&amp;gt;) at ../../src/drmmode_display.c:1452
#3  0x00007f377d3271b7 in drmmode_set_desired_modes (pScrn=pScrn@entry=0x1de8070, drmmode=drmmode@entry=0x1de94e8, set_hw=set_hw@entry=1) at ../../src/drmmode_display.c:3688
#4  0x00007f377d31f12d in AMDGPUEnterVT_KMS (pScrn=0x1de8070) at ../../src/amdgpu_kms.c:2141
#5  0x000000000048e4e0 in ?? ()
#6  0x00000000004b8f78 in ?? ()
#7  0x00000000004834d9 in ?? ()
#8  0x00007f377d6734af in ?? () from /usr/lib/xorg/modules/extensions/libglx.so
#9  0x000000000047bf29 in xf86VTEnter ()
#10 0x0000000000443435 in WakeupHandler ()
#11 0x0000000000598bb1 in WaitForSomething ()
#12 0x000000000043e6cc in ?? ()
#13 0x0000000000442906 in ?? ()
#14 0x00007f377d9851fb in __libc_start_main (main=0x42b6a0, argc=12, argv=0x7ffd2944c698, init=&amp;lt;optimized out&amp;gt;, fini=&amp;lt;optimized out&amp;gt;, rtld_fini=&amp;lt;optimized out&amp;gt;, stack_end=0x7ffd2944c688)
    at ../csu/libc-start.c:308
#15 0x000000000042b6da in _start ()
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;什么是-drm-中的-plane&#34;&gt;什么是 drm 中的 plane ？&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/hexiaolong2009/article/details/84934294&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/hexiaolong2009/article/details/84934294&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;plane 就是硬件图层的意思，简单的的合成任务不是交绐 GPU 当中的渲染单元，而是交绐 GPU 当中的 plane 。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://crab2313.github.io/post/drm-legacy-kms/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://crab2313.github.io/post/drm-legacy-kms/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;可以不使用 fb ，把 plane 绑定到 crtc 上做显示，也可以用 fb ，这种形式的兼容性可能好一点。&lt;/p&gt;
&lt;h2 id=&#34;什么是-udev&#34;&gt;什么是 udev ？&lt;/h2&gt;
&lt;p&gt;udev 是一个设备管理工具，udev 以守护进程的形式运行，通过侦听内核发出来的 uevent 来管理/dev 目录下的设备文件。udev 在用户空间运行，而不在内核空间 运行。它能够根据系统中的硬件设备的状态动态更新设备文件，包括设备文件的创建，删除等。设备文件通常放在/dev 目录下。使用 udev 后，在/dev 目录下就只包含系统中真正存在的设备。&lt;/p&gt;
&lt;h2 id=&#34;现代显示器一大堆的-buffer&#34;&gt;现代显示器一大堆的 buffer&lt;/h2&gt;
&lt;p&gt;何小龙此人写了很多的文章，GPU 相关的东西都在他的 CSDN 和微信公众号里面能够找到。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/hexiaolong2009/article/details/105961192&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/hexiaolong2009/article/details/105961192&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;现代显卡：&lt;/p&gt;
&lt;p&gt;显存缓冲区（VRAM）：显存缓冲区是显卡上专门用于存储图形数据的内存。它通常由显卡硬件直接管理，用于存储帧缓冲、纹理、深度缓冲等图形数据。&lt;/p&gt;
&lt;p&gt;帧缓冲区（Framebuffer）：帧缓冲区是用于存储整个屏幕图像的内存区域，包括颜色、深度和模板等信息。它是图形渲染的最终输出目标，用于生成用户可见的图像。&lt;/p&gt;
&lt;p&gt;纹理缓冲区（Texture Buffer）：纹理缓冲区用于存储 2D 或 3D 纹理数据，供图形渲染过程中使用。纹理缓冲区通常用于在物体表面上贴图或进行其他纹理映射操作。&lt;/p&gt;
&lt;p&gt;深度缓冲区（Depth Buffer）：深度缓冲区用于记录每个像素的深度信息，以便进行遮挡和深度测试，确保正确的渲染顺序和透视效果。&lt;/p&gt;
&lt;p&gt;模板缓冲区（Stencil Buffer）：模板缓冲区用于存储模板测试相关的信息，通常用于实现镜像、投影等特殊效果。&lt;/p&gt;
&lt;h2 id=&#34;怎么看-dri-mode&#34;&gt;怎么看 dri mode&lt;/h2&gt;
&lt;p&gt;从 xorg 的日志当中搜一下 dri 没有，glxinfo 没有，xorg 的配置文件，有！&lt;/p&gt;
&lt;p&gt;最终查到我的机器用的模式是 pagefilp 。用的驱动是 modesetting 。&lt;/p&gt;
&lt;p&gt;另外 amdgpu 使用的是 pageflip ：&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/xiaozhi_botton/article/details/111884866&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/xiaozhi_botton/article/details/111884866&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;drm-framebuffer&#34;&gt;drm_framebuffer&lt;/h2&gt;
&lt;p&gt;drm_framebuffer 的 filp_head 是指向正在显示的帧的。&lt;/p&gt;
&lt;h2 id=&#34;filp-head&#34;&gt;filp_head&lt;/h2&gt;
&lt;p&gt;filp_head 指向的是当前正在显示的帧缓冲区。&lt;/p&gt;
&lt;h2 id=&#34;结尾&#34;&gt;结尾&lt;/h2&gt;
&lt;p&gt;新的分析放到 pdf 当中了。想看的下载一下吧：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://guolongji.xyz/ox-hugo/tty-x-switch-beamer.pdf&#34; &gt;file:/tty-x-switch-beamer.pdf&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>深度学习必备核心算法</title>
        <link>https://guolongji.xyz/post/core-algorithms-for-mathine-learning/</link>
        <pubDate>Thu, 21 Sep 2023 16:55:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/core-algorithms-for-mathine-learning/</guid>
        <description>&lt;h2 id=&#34;机器学习流程&#34;&gt;机器学习流程:&lt;/h2&gt;
&lt;p&gt;特征工程建立模型评估与应用数据获取&lt;/p&gt;
&lt;h2 id=&#34;特征工程的作用&#34;&gt;特征工程的作用:&lt;/h2&gt;
&lt;p&gt;数据特征决定了模型的上限预处理和特征提取是最核心的算法与参数选择决定了如何逼近这个上限&lt;/p&gt;
&lt;h2 id=&#34;特征如何提取&#34;&gt;特征如何提取：&lt;/h2&gt;
&lt;p&gt;segway 这个牌子的平衡车，有 handle（把手）和 wheel（轮子）
handle，wheel -&amp;gt; Feature representation -&amp;gt; Leading Algorithm&lt;/p&gt;
&lt;h2 id=&#34;传统的特征提取方法&#34;&gt;传统的特征提取方法：&lt;/h2&gt;
&lt;p&gt;Natural images（自然界的图片）-&amp;gt; Learning bases: &amp;ldquo;Edges&amp;rdquo;&lt;/p&gt;
&lt;h2 id=&#34;为什么需要深度学习&#34;&gt;为什么需要深度学习：&lt;/h2&gt;
&lt;p&gt;32x32 的手写数字“3” -&amp;gt; 5x5 的 convolution（卷积核）处理，Feature Extraction -&amp;gt; fully connection（全连接）进行分类&lt;/p&gt;
&lt;h2 id=&#34;深度学习的应用&#34;&gt;深度学习的应用：&lt;/h2&gt;
&lt;p&gt;车辆检测人脸识别医疗（genomic data -&amp;gt; clinical data -&amp;gt; radiomic data）表情转换黑白图片转彩色图图片多分类 imagenet： &lt;a class=&#34;link&#34; href=&#34;https://www.image-net.org&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.image-net.org&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;深度学习算法优于传统人工智能算法&#34;&gt;深度学习算法优于传统人工智能算法&lt;/h2&gt;
&lt;h2 id=&#34;图像分类任务定义&#34;&gt;图像分类任务定义&lt;/h2&gt;
&lt;p&gt;绐图片加标签&lt;/p&gt;
&lt;h2 id=&#34;计算机眼中的图像&#34;&gt;计算机眼中的图像&lt;/h2&gt;
&lt;p&gt;是一个三维（三个通道）数组。数组的元素是色值（精度可以是 255）。数组的长度是像素数。像素数是 width * height
计算出。&lt;/p&gt;
&lt;h2 id=&#34;cv-的挑战&#34;&gt;CV 的挑战&lt;/h2&gt;
&lt;p&gt;照射角度形状改变部分遮蔽背景混入&lt;/p&gt;
&lt;h2 id=&#34;cv-分类机器学习的常规套路&#34;&gt;CV 分类机器学习的常规套路&lt;/h2&gt;
&lt;p&gt;1.收集数据并给定标签
2.训练一个分类器
3.测试,评估&lt;/p&gt;
&lt;h2 id=&#34;k-邻近-knn-分类方法&#34;&gt;K 邻近（KNN）分类方法&lt;/h2&gt;
&lt;p&gt;1.计算已知类别数据集中的点与当前点的距离
2.按照距离依次排序
3.选取与当前点距离最小的 K 个点
4.确定前 K 个点所在类别的出现概率
5.返回前 K 个点出现频率最高的类别作为当前点预测分类&lt;/p&gt;
&lt;h2 id=&#34;knn-特点&#34;&gt;KNN 特点&lt;/h2&gt;
&lt;p&gt;KNN 算法本身简单有效,它是一种 lazy-learning 算法。分类器不需要使用训练集进行训练,训练时间复杂度为 0。
KNN 分类的计算复杂度和训练集中的文档数目成正比，也就是说,如果训练集中文档总数为 n,那么 KNN 的分类时间复杂度为 O(n)。
K 值的选择,距离度量和分类决策规则是该算法的三个基本要素。&lt;/p&gt;
&lt;h2 id=&#34;图片数据库-cifar-10&#34;&gt;图片数据库 CIFAR-10&lt;/h2&gt;
&lt;p&gt;经典数据集：
10 类标签
10000 个测试数据
50000 个训练数据&lt;/p&gt;
&lt;h2 id=&#34;为什么-k-近邻不能用来图像分类&#34;&gt;为什么 K 近邻不能用来图像分类?&lt;/h2&gt;
&lt;p&gt;背景主导是一个最大的问题,我们关注的却是主体(主要成分)
如何才能让机器学习到哪些是重要的成分呢？&lt;/p&gt;
&lt;p&gt;KNN 中距离的概念：
&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/kl1411/article/details/74079956&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/kl1411/article/details/74079956&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;L1 (Manhattan) distance:&lt;/p&gt;
&lt;p&gt;\( d_{1}(I_{1}, I_{2})=\sum\limits_{p} |I_{1}^{p}-I_{2}^{p}| \)&lt;/p&gt;
&lt;p&gt;L2 (Euclidean) distance:
\( d_{2}(I_{1}, I_{2})=\sqrt{\sum\limits_{p} |I_{1}^{p}-I_{2}^{p}|^{2}} \)
对于 k 邻近的 k 应该如何选择&lt;/p&gt;
&lt;p&gt;背景主导是一个最大的问题，我们关注的却是主体(主要成分)。&lt;/p&gt;
&lt;p&gt;通过网上这篇文章的讲解，我对 knn 的分类有了较为明了的认识：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/gengzhikui1992/article/details/104346235&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/gengzhikui1992/article/details/104346235&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;通过交叉验证的方法来确定 k 值：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/FYZHANG/p/12030460.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.cnblogs.com/FYZHANG/p/12030460.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;通过 numpy 和 sklearn 来实现代码。&lt;/p&gt;
&lt;h2 id=&#34;神经网络基础&#34;&gt;神经网络基础&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;线性函数&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;从输入到输出的映射。&lt;/p&gt;
&lt;p&gt;在数学里对线性有详细的解释：&lt;a class=&#34;link&#34; href=&#34;https://www.zhihu.com/question/20084968&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.zhihu.com/question/20084968&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;数学里，一般说的线性，是说的线性映射,这是一个函数（或称为映射，function or map），而不是方程(equation)。这个映射要同时满足两个条件：&lt;/p&gt;
&lt;p&gt;1:可加性 \( f(x + y) = f(x) + f(y) \)&lt;/p&gt;
&lt;p&gt;2:齐次性（同质性）\( f(\alpha x) = \alpha f(x) \)&lt;/p&gt;
&lt;p&gt;也有用 叠加特性：\( f(ax+by)=af(x)+bf(y) \) 合起来表示的。&lt;/p&gt;
&lt;p&gt;非线性方程，就是因变量与自变量之间的关系不是线性的关系，这类方程很多，例如平方关系、对数关系、指数关系、三角函数关系等等。求解此类方程往往很难得到精确解，经常需要求近似解问题。相应的求近似解的方法也逐渐得到大家的重视。&lt;/p&gt;
&lt;p&gt;广义相对论方程就是一个非线性偏微分方程，无法得到精确解。广义相对论是描述引力的理论，它的方程式非常复杂。虽然这些方程式可以使用数值计算的方法求解，但是由于计算量很大，仍然是个非常困难的问题。不过，在某些特殊情况下，广义相对论的方程式可以被简化，从而得到一些精确解。例如，施瓦茨希尔德黑洞、克尔黑洞和台风模型等等，都是广义相对论的精确解。&lt;/p&gt;
&lt;p&gt;人式智能中的线性函数为：&lt;/p&gt;
&lt;p&gt;\( f(x_{i}, W, b) = Wx_{i}+b \)&lt;/p&gt;
&lt;p&gt;stretch pixels into single column，理解一下。&lt;/p&gt;
&lt;h3 id=&#34;损失函数&#34;&gt;损失函数&lt;/h3&gt;
&lt;p&gt;这个概念是核心：&lt;/p&gt;
&lt;p&gt;目标函数（Objective Function），也称为损失函数（Loss Function）或代价函数（Cost Function），是在机器学习和优化问题中用来衡量模型预测结果与真实值之间差异的函数。&lt;/p&gt;
&lt;p&gt;目标函数的选择取决于具体的任务和模型类型。在监督学习任务中，目标函数通常根据预测结果和真实标签之间的差异来评估模型的性能。对于回归问题，常用的目标函数包括均方误差（Mean Squared Error）和平均绝对误差（Mean Absolute Error）等；对于分类问题，常见的目标函数有交叉熵损失（Cross-Entropy Loss）和对数损失（Log Loss）等。&lt;/p&gt;
&lt;p&gt;目标函数的设计旨在使模型的预测结果尽可能接近真实值，因此在训练过程中，优化算法会通过调整模型的参数，最小化目标函数的值。在机器学习的训练过程中，通常使用梯度下降等优化算法来求解目标函数的最小值。&lt;/p&gt;
&lt;p&gt;需要注意的是，目标函数的选择应该与问题的特点和需求相匹配。不同的目标函数可能会导致不同的模型性能和训练效果。因此，在实际应用中，选择适当的目标函数对于模型的训练和性能优化非常重要。&lt;/p&gt;
&lt;p&gt;损失函数，“预测更准确”即“loss”更小，损失函数的意义就在这里。&lt;/p&gt;
&lt;p&gt;\( L_{i}=\sum_{j\neq{y_{i}}} max(0, s_{j}-S_{y_{i}}+1) \)&lt;/p&gt;
&lt;p&gt;什么是损失函数？&lt;/p&gt;
&lt;p&gt;一言以蔽之，损失函数（loss function）就是用来度量模型的预测值 f(x)与真实值 Y 的差异程度的运算函数，它是一个非负实值函数，通常使用 L(Y, f(x))来表示，损失函数越小，模型的鲁棒性就越好。&lt;/p&gt;
&lt;p&gt;为什么要使用损失函数？&lt;/p&gt;
&lt;p&gt;损失函数使用主要是在模型的训练阶段，每个批次的训练数据送入模型后，通过前向传播输出预测值，然后损失函数会计算出预测值和真实值之间的差异值，也就是损失值。得到损失值之后，模型通过反向传播去更新各个参数，来降低真实值与预测值之间的损失，使得模型生成的预测值往真实值方向靠拢，从而达到学习的目的。&lt;/p&gt;
&lt;p&gt;有哪些损失函数？&lt;/p&gt;
&lt;p&gt;还有就是百度的飞桨平台：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://paddlepedia.readthedocs.io/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://paddlepedia.readthedocs.io/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;像 linux 内核一样的文档，总量也不多。可以从中学习到一些基础知识。自学的路从来打开，在互联网时代，一切知识都能自学。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;L2 范数均方差损失函数（MSE： Mean Square Error），Mean 是平均的意思：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;\( L(Y|f(x))=\frac{1}{n}\sum_{i=1}^{N}{(Y_{i}-f(x_{i}))^{2}} \)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;L1 损失函数（即曼哈顿距离），又叫 MAE（Mean Absolute Error）：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;\(L(Y|f(x))=\sum_{i=1}^{N}{|Y_{i}-f(x_{i})|}\)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;均方根误差损失函数（即欧式距离），又叫 RMSE（Root Mean Square Error）：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;\(L(Y|f(x))=\sqrt{\frac{1}{n}\sum_{i=1}^{N}{(Y_{i}-f(x_{i}))^{2}}}\)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;smooth L1 损失函数：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;\[
\notag
L(Y|f(x)) =  \begin{cases}     \frac{1}{2}(Y-f(x))^{2} &amp;amp; \text{  |Y-f(x)|&amp;lt;1}  \\    |Y-f(x)|-\frac{1}{2}
&amp;amp; \text{ |Y-f(x)|&amp;gt;=1}  \end{cases}
\]&lt;/p&gt;
&lt;p&gt;Smooth L1 损失是由 Girshick R 在 Fast R-CNN 中提出的，主要用在目标检测中防止梯度爆炸。不懂的可以先不了解。后续再折回来看一下这个问题。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;huber 损失函数&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;\[
\notag
{\displaystyle L_{\delta }(y,f(x))=
{\begin{cases}{\frac {1}{2}}(y-f(x))^{2}&amp;amp;{\text{for }}|y-f(x)|\leq \delta ,
\\delta \ \cdot \left(|y-f(x)|-{\frac {1}{2}}\delta \right),&amp;amp;{\text{otherwise.}}\end{cases}}}
\]&lt;/p&gt;
&lt;p&gt;huber 损失是平方损失和绝对损失的综合，它克服了平方损失和绝对损失的缺点，不仅使损失函数具有连续的导数，而且利用 MSE 梯度随误差减小的特性，可取得更精确的最小值。尽管 huber 损失对异常点具有更好的鲁棒性，但是，它不仅引入了额外的参数，而且选择合适的参数比较困难，这也增加了训练和调试的工作量。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;KL 散度（相对熵）损失函数：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;\(L(Y|f(x))=\sum_{i=1}^{n}{Y_{i}\times log(\frac{Y_{i}}{f(x_{i})})}\)&lt;/p&gt;
&lt;p&gt;Y 代表真实值，f(x) 代表预测值。&lt;/p&gt;
&lt;p&gt;相对熵由 Solomon Kullback 和 Richard Leibler 在 Kullback &amp;amp; Leibler (1951)中引入，属于数理统计当中的知识。&lt;/p&gt;
&lt;p&gt;一种统计学度量，表示的是一个概率分布相对于另一个概率分布的差异程度，在信息论中又称为相对熵（Relative entropy）。&lt;/p&gt;
&lt;p&gt;库尔贝勒莱布勒散度。外国人这么喜欢用人名命名公式吗？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;交叉熵损失函数：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;\(L(Y|f(x))=-\sum_{i=1}^{N}{Y_{i}log f(x_{i})}\)&lt;/p&gt;
&lt;p&gt;交叉熵是信息论中的一个概念，最初用于估算平均编码长度，引入机器学习后，用于评估当前训练得到的概率分布与真实分布的差异情况。为了使神经网络的每一层输出从线性组合转为非线性逼近，以提高模型的预测精度，在以交叉熵为损失函数的神经网络模型中一般选用 tanh、sigmoid、softmax 或 ReLU 作为激活函数。&lt;/p&gt;
&lt;p&gt;损失函数 = 数据损失 + 正则化惩罚项&lt;/p&gt;
&lt;p&gt;\(L = \frac{1}{N}\sum_{i=1}^{N}\sum_{j\neq y_{i}}\max (0, f(x_{i};W)_{j} - f(x_{i};W)_{y_{i}}+1) + \lambda R(W)\)&lt;/p&gt;
&lt;p&gt;正则化惩罚项：&lt;/p&gt;
&lt;p&gt;\(R(W) = \sum_k\sum_l W_{k,l}^2\)&lt;/p&gt;
&lt;p&gt;过拟合的模型是没有用的。通过对数据进行训练，得到模型参数。机器学习再认知上提供了一种思路，就是执果猜因。&lt;/p&gt;
&lt;h3 id=&#34;l1-范数&#34;&gt;L1 范数&lt;/h3&gt;
&lt;p&gt;什么是惩罚项呢？L1-norm，L2-norm 等，中文称 L1 正则化，L2 正则化，或者 L1 范数或 L2 范数。&lt;/p&gt;
&lt;p&gt;下面这篇文章把正则化惩罚项讲的比较清楚了。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/LXP-Never/p/10918704.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.cnblogs.com/LXP-Never/p/10918704.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;L1 范数符合拉普拉斯分布，是不完全可微的。表现在图像上会有很多角出现。这些角和目标函数的接触机会远大于其他部分。就会造成最优值出现在坐标轴上，因此就会导致某一维的权重为 0，产生稀疏权重矩阵，进而防止过拟合。&lt;/p&gt;
&lt;p&gt;最小平方损失函数的 L1 正则化：&lt;/p&gt;
&lt;p&gt;\(W^{*} =\mathop{\arg\min\limits_{w}} \ \ \sum\limits_{j}\Big(t(x_{j})-\sum\limits_{i}w_{i}h_{i}(x_{j})\Big)^{2} + \lambda\sum\limits_{i=1}^{k}|w_{i}|\)&lt;/p&gt;
&lt;h3 id=&#34;l2-范数&#34;&gt;L2 范数&lt;/h3&gt;
&lt;p&gt;L2 范数符合高斯分布，是完全可微的。和 L1 相比，图像上的棱角被圆滑了很多。一般最优值不会在坐标轴上出现。在最小化正则项时，可以是参数不断趋向于 0，最后活的很小的参数。&lt;/p&gt;
&lt;p&gt;在机器学习中，正规化是防止过拟合的一种重要技巧。从数学上讲，它会增加一个正则项，防止系数拟合得过好以至于过拟合。L1 与 L2 的区别只在于，L2 是权重的平方和，而 L1 就是权重的和。&lt;/p&gt;
&lt;p&gt;如下，最小平方损失函数的 L2 正则化：&lt;/p&gt;
&lt;p&gt;\(W^{*} =\mathop{\arg\min\limits_{w}} \ \ \sum\limits_{j}\Big(t(x_{j})-\sum\limits_{i}w_{i}h_{i}(x_{j})\Big)^{2} + \lambda\sum\limits_{i=1}^{k}w_{i}^{2}\)&lt;/p&gt;
&lt;p&gt;如何选择损失函数？&lt;/p&gt;
&lt;p&gt;（1） 选择最能表达数据的主要特征来构建基于距离或基于概率分布度量的特征空间。&lt;/p&gt;
&lt;p&gt;（2）选择合理的特征归一化方法，使特征向量转换后仍能保持原来数据的核心内容。&lt;/p&gt;
&lt;p&gt;（3）选取合理的损失函数，在实验的基础上，依据损失不断调整模型的参数，使其尽可能实现类别区分。&lt;/p&gt;
&lt;p&gt;（4）合理组合不同的损失函数，发挥每个损失函数的优点，使它们能更好地度量样本间的相似性。&lt;/p&gt;
&lt;p&gt;（5）将数据的主要特征嵌入损失函数，提升基于特定任务的模型预测精确度。&lt;/p&gt;
&lt;p&gt;转载：&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/261059231&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/261059231&lt;/a&gt; ，另外 python 对这几种损失函数的实现也在这篇知乎的博客当中。&lt;/p&gt;
&lt;p&gt;L1 范数和 L2 范数的区别：&lt;/p&gt;
&lt;p&gt;1、L1 正则化是模型各个参数的绝对值之和。&lt;/p&gt;
&lt;p&gt;L2 正则化是模型各个参数的平方和的开方值。&lt;/p&gt;
&lt;p&gt;2、L1 会趋向于产生少量的特征，而其他的特征都是 0，产生稀疏权重矩阵。&lt;/p&gt;
&lt;p&gt;L2 会选择更多的特征，这些特征都会接近于 0。&lt;/p&gt;
&lt;p&gt;再讨论几个问题：&lt;/p&gt;
&lt;p&gt;1.为什么参数越小代表模型越简单？&lt;/p&gt;
&lt;p&gt;越是复杂的模型，越是尝试对所有样本进行拟合，包括异常点。这就会造成在较小的区间中产生较大的波动，这个较大的波动也会反映在这个区间的导数比较大。&lt;/p&gt;
&lt;p&gt;只有越大的参数才可能产生较大的导数。因此参数越小，模型就越简单。&lt;/p&gt;
&lt;p&gt;2.实现参数的稀疏有什么好处？&lt;/p&gt;
&lt;p&gt;因为参数的稀疏，在一定程度上实现了特征的选择。一般而言，大部分特征对模型是没有贡献的。这些没有用的特征虽然可以减少训练集上的误差，但是对测试集的样本，反而会产生干扰。稀疏参数的引入，可以将那些无用的特征的权重置为 0.&lt;/p&gt;
&lt;p&gt;3.L1 范数和 L2 范数为什么可以避免过拟合？&lt;/p&gt;
&lt;p&gt;加入正则化项就是在原来目标函数的基础上加入了约束。当目标函数的等高线和 L1，L2 范数函数第一次相交时，得到最优解。&lt;/p&gt;
&lt;p&gt;注意：&lt;/p&gt;
&lt;p&gt;1、一般正则化，只是对模型的权重 W 参数进行惩罚，而偏置参数 b 是不进行惩罚的，而 torch.optim 的优化器
weight_decay 参数指定的权值衰减是对网络中的所有参数，包括权值 w 和偏置 b 同时进行惩罚。很多时候如果对 b 进行
L2 正则化将会导致严重的欠拟合，因此这个时候一般只需要对权值 w 进行正则即可。&lt;/p&gt;
&lt;p&gt;2、torch.optim 的优化器固定实现 L2 正则化，不能实现 L1 正则化。&lt;/p&gt;
&lt;p&gt;好了，现在对损失函数有了基本的了解了。&lt;/p&gt;
&lt;h3 id=&#34;softmax-分类器&#34;&gt;softmax 分类器&lt;/h3&gt;
&lt;p&gt;softmax 是一种激活函数。可以把得分值转换成一个 0 到 1 之间的概率值。形式是：&lt;/p&gt;
&lt;p&gt;\(g(z)=\frac{1}{1+e^{-z}}\)&lt;/p&gt;
&lt;p&gt;上面这个是 sigmod 函数。&lt;/p&gt;
&lt;p&gt;有两种 loss function 比较重要：&lt;/p&gt;
&lt;p&gt;Multiclass SVM loss 和 Softmax classifier loss&lt;/p&gt;
&lt;p&gt;归一化的目的就是使得预处理的数据被限定在一定的范围内（比如[0,1]或者[-1,1]），从而消除奇异样本数据导致的不良影响。&lt;/p&gt;
&lt;p&gt;softmax 又被称为归一化指数函数。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.jiqizhixin.com/graph/technologies/0e9e62e2-9958-4146-b0af-f3d049ff2490&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.jiqizhixin.com/graph/technologies/0e9e62e2-9958-4146-b0af-f3d049ff2490&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;可以说 Softmax 函数是对 Sigmoid 函数的推广。&lt;/p&gt;
&lt;p&gt;Sigmoid 函数（也称为逻辑函数或 Logistic 函数）是一种非线性函数，它将输入的实数映射到 0 到 1 之间的概率值。而 Softmax 函数是一种多元分类的激活函数，它将输入的实数向量映射为一组表示离散分类概率的向量。&lt;/p&gt;
&lt;p&gt;在二元分类问题中，Sigmoid 函数常用于将线性组合的结果转化为一个类别的概率。而在多元分类问题中，Softmax 函数可以将线性组合的结果转化为多个类别的概率分布。Softmax 函数的数学形式如下：&lt;/p&gt;
&lt;p&gt;\(softmax(Z_{i}) = \frac{e^{z^{i}}}{\sum_{j=1}^{k}e^{z_{j}}}\)&lt;/p&gt;
&lt;p&gt;其中， \(z_{i}\) 表示线性组合的第 i 个元素的值（即 \(z = f(x_{i}; W)\) ），K 表示类别的数量。&lt;/p&gt;
&lt;p&gt;因此，Softmax 函数可以被视为 Sigmoid 函数在多元分类问题中的推广。Softmax 函数保证了所有类别的输出概率之和为 1，因此可以用于多类别分类模型的输出层激活函数。&lt;/p&gt;
&lt;p&gt;这个函数从形式的设计上来看并不复杂。用脑子简单想想也可以明白这个是怎么设计出来的。学习人工智能并不需要十分高深的数学知识。但是需要看懂公式，理解公式。&lt;/p&gt;
&lt;h3 id=&#34;ce-loss&#34;&gt;CE loss&lt;/h3&gt;
&lt;p&gt;softmax 的 loss 怎么算？&lt;/p&gt;
&lt;p&gt;在多元分类任务中，交叉熵（Cross Entropy）常用于计算 Softmax 的 loss。交叉熵是一种用于衡量两个概率分布之间差异性的度量方法，通过比较模型预测的概率分布与真实标签的概率分布来度量模型的表现。&lt;/p&gt;
&lt;p&gt;假设有 K 个类别， \(y_{i}\) 表示第 i 个样本的真实标签， \(\hat{y}_i\) 表示第 i 个样本对应的模型预测的概率分布，那么交叉熵的数学形式可以表示为：&lt;/p&gt;
&lt;p&gt;\(CE(\hat y_{i}, y_{i})=-\sum\limits_{j=1}^{K}y_{i,j}\log(y_{i,j})\)&lt;/p&gt;
&lt;p&gt;换个写法也可以写成： \(L_{i} = - \log P(Y=y_{i}|X=x_{i})\)&lt;/p&gt;
&lt;p&gt;其中，\(y_{i,j}\) 表示第 i 个样本属于第 j 类的标签；\(\hat{y}_{i,j}\) 表示第 i 个样本属于第 j 类的预测概率。&lt;/p&gt;
&lt;p&gt;而在训练过程中，我们需要将所有样本的交叉熵求和并除以样本数量 N，得到平均交叉熵损失，即：&lt;/p&gt;
&lt;p&gt;\(J(\theta) = -\frac{1}{N}\sum_{i=1}^{N}\sum_{j=1}^{K} y_{i,j} \log(\hat{y}_{i,j})\)&lt;/p&gt;
&lt;p&gt;其中，\(\theta\) 表示模型的参数。&lt;/p&gt;
&lt;p&gt;Softmax 和交叉熵常常一起作为多元分类问题的 loss 函数，在反向传播时可以根据链式法则求出 Softmax 层和损失函数的梯度，并用于参数更新。&lt;/p&gt;
&lt;p&gt;这些公式单列出来没有解释的话是看不懂的。&lt;/p&gt;
&lt;h3 id=&#34;hinge-loss-合页损失&#34;&gt;hinge loss（合页损失）&lt;/h3&gt;
&lt;p&gt;Hinge Loss（合页损失）是一种用于处理分类问题的损失函数，通常用于支持向量机（SVM）等算法中。&lt;/p&gt;
&lt;p&gt;在二元分类问题中，假设我们需要将样本 xx 分为两个类别，1和-1。那么 Hinge Loss 的数学形式如下：&lt;/p&gt;
&lt;p&gt;\(L(y, \hat{y}) = \max(0, 1 - y\cdot\hat{y})\)&lt;/p&gt;
&lt;p&gt;其中，y 表示样本的真实标签，\(\hat{y}\) 表示样本的预测标签。&lt;/p&gt;
&lt;p&gt;Hinge Loss 表明，在正确分类的情况下，该样本的损失为 0；而在错误分类的情况下，损失项被激活，并且与分类误差按线性递增的方式增加，即错误分类越严重，则损失项越大。该函数不仅度量了分类器的准确性，也可以用来鼓励有更大的间隔（Margin）的决策边界，从而提高了分类器对未知数据的泛化能力。&lt;/p&gt;
&lt;p&gt;在多元分类问题中，可以使用 Multi-Class Hinge Loss（多分类合页损失）来计算损失，其数学形式如下：&lt;/p&gt;
&lt;p&gt;\(L(y, \hat{y}) = \sum_{j \neq y} \max(0, \hat{y}_j - \hat{y}_y + \Delta)\)&lt;/p&gt;
&lt;p&gt;其中，y 表示样本的真实标签，\(\hat{y}\) 表示样本的预测分数（Score），\(\Delta\) 是一个超参数，通常设置为 1。&lt;/p&gt;
&lt;p&gt;Hinge Loss 在训练 SVM 等模型中被广泛使用，并被证明在分类问题上表现良好。&lt;/p&gt;
&lt;h3 id=&#34;数据预处理归一化-损失函数正则化&#34;&gt;数据预处理归一化，损失函数正则化&lt;/h3&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/hrbeuwhw/article/details/79147275&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/hrbeuwhw/article/details/79147275&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;正则化：就是平衡训练误差与模型复杂度的一种方式，通过加入正则项来避免过拟合（over-fitting）。&lt;/p&gt;
&lt;p&gt;关于正则化，有一个 Elastic Net，吸收了 L1 和 L2 范式的优点。&lt;/p&gt;
&lt;p&gt;归一化：1）归一化后加快了梯度下降求最优解的速度；2）归一化有可能提高精度。&lt;/p&gt;
&lt;h3 id=&#34;什么是熵-什么是交叉熵&#34;&gt;什么是熵，什么是交叉熵&lt;/h3&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/149186719&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/149186719&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;看完这篇文章，豁然开朗：&lt;/p&gt;
&lt;p&gt;香农提出了熵的定义：无损编码事件信息的最小平均编码长度。&lt;/p&gt;
&lt;p&gt;这个问题，我自己也想过，但是别人都提出理论了。理论的东西经过发展就会变得越来越成熟。&lt;/p&gt;
&lt;p&gt;对于具有 N 种等可能性状态的信息，每种状态的可能性 P = 1/N，编码该信息所需的最小编码长度为（用二进制表示）：&lt;/p&gt;
&lt;p&gt;\(\log_{2}N = -\log_{2}\frac{1}{N}=-\log_{2}P\)&lt;/p&gt;
&lt;p&gt;而熵的公式为：&lt;/p&gt;
&lt;p&gt;\(Entropy = -\sum\limits_{i}P(i)\log_{2}P(i)\)&lt;/p&gt;
&lt;p&gt;信息论中熵的概念和霍夫曼编码息息相关。&lt;/p&gt;
&lt;p&gt;那什么是交叉熵呢？&lt;/p&gt;
&lt;p&gt;“熵是服从某一特定概率分布事件的理论最小平均编码长度”，只要我们知道了任何事件的概率分布，我们就可以计算它的熵；那如果我们不知道事件的概率分布，又想计算熵，该怎么做呢？那我们来对熵做一个估计吧，熵的估计的过程自然而然的引出了交叉熵。&lt;/p&gt;
&lt;p&gt;用公式来描述的话就是：&lt;/p&gt;
&lt;p&gt;\(CrossEntropy=E_{x\sim P}[-\log Q(x)]\)&lt;/p&gt;
&lt;p&gt;\(Entropy=E_{x\sim P}[-\log P(x)]\)&lt;/p&gt;
&lt;p&gt;P 是真实的，经过观测得到的；而 Q 是理论的，也就是我们之前的模型。&lt;/p&gt;
&lt;h3 id=&#34;score-function&#34;&gt;score function&lt;/h3&gt;
&lt;p&gt;得分函数。&lt;/p&gt;
&lt;h3 id=&#34;反向传播与梯度下降&#34;&gt;反向传播与梯度下降&lt;/h3&gt;
&lt;p&gt;梯度下降：&lt;/p&gt;
&lt;p&gt;引入：当我们得到了一个目标函数后，如何进行求解？直接求解？（并不一定可解，线性回归可以当做是一个特例）&lt;/p&gt;
&lt;p&gt;常规套路：机器学习的套路就是我交给机器一堆数据，然后告诉它什么样的学习方式是对的（目标函数），然后让它朝着这个方向去做&lt;/p&gt;
&lt;p&gt;如何优化：一口吃不成个胖子，我们要静悄悄的一步步的完成迭代（每次优化一点点，累积起来就是个大成绩了）&lt;/p&gt;
&lt;p&gt;梯度下降（Gradient Descent）是一种常用的优化算法，用于求解最小化目标函数的问题。它通过迭代方式更新模型参数，使得目标函数逐渐趋向于最小值。&lt;/p&gt;
&lt;p&gt;在梯度下降算法中，我们首先需要定义一个目标函数（也称为损失函数），例如在机器学习中常用的均方误差（Mean Squared Error）。然后，我们从任意初始点开始，根据当前点的位置和梯度信息，以一定的步长（学习率）向梯度的反方向移动，不断迭代更新参数，直至达到局部或全局最小值。&lt;/p&gt;
&lt;p&gt;具体来说，设目标函数为 \(J(\theta)\)，其中 \(\theta\) 表示模型的参数，在梯度下降的过程中，我们按照以下步骤进行更新：&lt;/p&gt;
&lt;p&gt;一、初始化参数：给定初始参数 \(\theta_0\)。二、计算梯度：计算当前参数位置的梯度，即 \(\Delta J(\theta)\)。三、参数更新：根据梯度和学习率 \(\alpha\)，更新参数：&lt;/p&gt;
&lt;p&gt;\(\theta_{t+1} = \theta_{t} - \alpha \nabla J(\theta_t)\)&lt;/p&gt;
&lt;p&gt;四、其中，t 表示迭代的步数。重复步骤 2-3，直到满足停止条件，如达到最大迭代次数、梯度变化很小或损失函数收敛等。&lt;/p&gt;
&lt;p&gt;梯度下降算法的关键在于计算目标函数的梯度，通过梯度信息来指导参数的更新方向。在实际应用中，有多种梯度下降算法的变体，如批量梯度下降（Batch Gradient Descent）、随机梯度下降（Stochastic Gradient Descent）和小批量梯度下降（Mini-batch Gradient Descent）等，以平衡计算效率和收敛速度。&lt;/p&gt;
&lt;p&gt;梯度下降算法是机器学习和深度学习等领域中最基础且重要的优化方法之一，被广泛应用于模型训练和参数优化过程中。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;什么是批量梯度下降？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;批量梯度下降（Batch Gradient Descent）是梯度下降算法的一种形式，也是最原始的梯度下降方法之一。它在每一次迭代中使用全部训练样本的梯度计算来更新模型参数，因此也被称为全批量梯度下降。&lt;/p&gt;
&lt;p&gt;具体来说，假设目标函数为 \(J(\theta)\)，其中 \(\theta\) 表示模型的参数，批量梯度下降的更新公式为：&lt;/p&gt;
&lt;p&gt;\(\theta_{t+1}=\theta_t-\alpha \frac{1}{m}\sum^m_{i=1}\nabla_{\theta} J(\theta_t,x^{(i)},y^{(i)})\)&lt;/p&gt;
&lt;p&gt;其中，m 表示训练样本的数量，\((x^{(i)}, y^{(i)})\) 表示第 i 个样本的特征和标签，\(\alpha\) 表示学习率，
\(\nabla_{\theta}\) 表示对参数 \(\theta\) 求偏导数的算符，\(\nabla_{\theta} J(\theta_t,x^{(i)},y^{(i)})\) 表示目标函数在参数 \(\theta_{t}\) 处关于第 i 个训练样本的梯度。这个式子的意义是，对所有的训练样本求平均值，然后用平均值作为梯度进行参数的更新。&lt;/p&gt;
&lt;p&gt;批量梯度下降算法使用全部训练集的信息来更新参数，因此其估计结果比较准确，但是计算代价也比较高。此外，每次迭代需要遍历所有训练样本，所以在大样本数据集上训练，迭代速度会比较慢。&lt;/p&gt;
&lt;p&gt;总之，批量梯度下降算法是一种基本的优化方法，被广泛应用于机器学习、深度学习等领域中。它的优缺点需要根据具体问题和数据规模来评估，可以通过其他变种的梯度下降算法来弥补其一些不足之处。&lt;/p&gt;
&lt;p&gt;英文 nabla 是微分算符的意思。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;什么是随机梯度下降&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;随机梯度下降（Stochastic Gradient Descent，SGD）是梯度下降算法的一种变体，它在每一次迭代中仅使用一个样本的梯度来更新模型参数。相比于批量梯度下降算法，SGD 的计算代价更低，能够加速模型的训练过程。&lt;/p&gt;
&lt;p&gt;具体来说，在每次迭代中，SGD 从训练集中随机选择一个样本 \((x^{(i)}, y^{(i)})\)，其中 \(x^{(i)}\) 表示该样本的特征，
\(y^{(i)}\) 表示其对应的标签。然后，SGD 使用该样本的梯度来更新模型参数：&lt;/p&gt;
&lt;p&gt;\(\theta_{t+1} = \theta_t - \alpha \nabla_{\theta} J(\theta_t, x^{(i)}, y^{(i)})\)&lt;/p&gt;
&lt;p&gt;其中，\(\theta_t\) 表示第 t 个迭代时的参数值，\(\alpha\) 是学习率，\(\nabla_{\theta} J(\theta_t, x^{(i)},y^{(i)})\) 表示目标函数关于样本 \((x^{(i)}, y^{(i)})\) 在参数 $θ_t$处的梯度。&lt;/p&gt;
&lt;p&gt;由于随机梯度下降每次只使用一个样本进行参数更新，因此其计算速度比批量梯度下降快。此外，SGD 还具有一定的随机性，这使得它在处理大数据集时能够避免陷入局部最优解，并且对于在线学习（Online Learning）等实时场景也具有较好的适应性。&lt;/p&gt;
&lt;p&gt;然而，由于随机梯度下降仅使用一个样本的梯度来更新参数，因此在单个样本上的梯度估计可能存在较大的抖动。为了减小抖动并使训练过程更加稳定，通常会引入一些技巧，例如使用学习率衰减（Learning Rate Decay）、加入动量（Momentum）等。&lt;/p&gt;
&lt;p&gt;总结来说，随机梯度下降是一种高效且常用的优化算法，在大规模数据集和实时学习中有着广泛的应用。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;什么是小批量梯度下降法&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;小批量梯度下降（Mini-Batch Gradient Descent）是梯度下降算法的一种变体，它在每一次迭代中使用部分样本的梯度来更新模型参数。相比于批量梯度下降和随机梯度下降，小批量梯度下降综合了两者的优点，既可以减小计算代价，又能够在一定程度上保持梯度估计的稳定性。&lt;/p&gt;
&lt;p&gt;具体来说，在每次迭代中，小批量梯度下降从训练集中随机选择一个固定大小的样本批次（mini-batch），假设该批次包含
m 个样本 \((x^{(i)}, y^{(i)})\)，其中 \(x^{(i)}\) 表示第 i 个样本的特征，\(y^{(i)}\) 表示其对应的标签。然后，小批量梯度下降使用该批次的梯度的平均值来更新模型参数：&lt;/p&gt;
&lt;p&gt;\(\theta_{t+1} = \theta_t - \alpha \frac{1}{m}\sum_{i=1}^{m} \nabla_{\theta} J(\theta_t, x^{(i)}, y^{(i)})\)&lt;/p&gt;
&lt;p&gt;其中，\(\theta_t\) 表示第 t 个迭代时的参数值，\(\alpha\) 是学习率，
\(\nabla_{\theta} J(\theta_t, x^{(i)},y^{(i)})\) 表示目标函数关于样本 \((x^{(i)}, y^{(i)})\) 在参数 \(\theta_t\) 处的梯度。&lt;/p&gt;
&lt;p&gt;小批量梯度下降相比于批量梯度下降，其计算代价会小很多，因为每次迭代只需要处理一个批次的样本。同时，与随机梯度下降相比，小批量梯度下降能够减小梯度估计的抖动，提供更稳定的参数更新。此外，小批量梯度下降还可以充分利用并行计算的优势，提高训练过程的效率。&lt;/p&gt;
&lt;p&gt;选择合适的小批量大小是一个重要的超参数，通常需要根据具体问题和计算资源进行调整。较小的批量大小可以提供更稳定的梯度估计，但会增加训练过程的噪声；较大的批量大小可以减小噪声影响，但可能会陷入局部最优解。&lt;/p&gt;
&lt;p&gt;总之，小批量梯度下降是一种在实践中广泛应用的梯度下降算法，它在计算代价和稳定性之间取得了一个平衡，并能够有效地训练大规模数据集上的模型。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;总结：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在深度学习和机器学习领域中，应用最广泛的梯度下降算法是小批量梯度下降（Mini-Batch Gradient Descent）算法。小批量梯度下降综合了批量梯度下降和随机梯度下降的优点，被广泛应用于训练神经网络等大规模数据集上的模型。&lt;/p&gt;
&lt;p&gt;相较于批量梯度下降，小批量梯度下降具有更低的计算复杂度，因为每次迭代只处理一小部分样本，这使得它能够更高效地进行参数更新。与此同时，相比于随机梯度下降，小批量梯度下降在参数更新过程中能够提供更稳定的梯度估计，减少了抖动现象，并且能够充分利用并行计算的优势。&lt;/p&gt;
&lt;p&gt;小批量梯度下降可以通过调整小批量的大小来平衡计算效率和模型稳定性，在实践中被广泛采用。通常情况下，小批量大小在几十到几千之间，具体的选择需要根据问题的复杂度、数据集的大小以及计算资源的限制进行权衡。&lt;/p&gt;
&lt;p&gt;尽管小批量梯度下降是最广泛应用的梯度下降算法，但在特定的场景下也会使用其他变种的梯度下降算法。例如，当处理较小规模的数据集时，可以使用批量梯度下降；而在在线学习或者实时训练的场景下，随机梯度下降可能更适用。&lt;/p&gt;
&lt;p&gt;总之，小批量梯度下降是目前应用最广泛的梯度下降算法，它提供了一种有效而稳定的方式来训练深度学习模型和其他机器学习模型。&lt;/p&gt;
&lt;p&gt;学习率（步长）：对结果会产生巨大的影响，一般小一些。&lt;/p&gt;
&lt;p&gt;如何选择：从小的开始选，不行再小。&lt;/p&gt;
&lt;p&gt;批处理数量：32，64，128 都可以，很多时候还得考虑内存和效率。&lt;/p&gt;
&lt;h3 id=&#34;反向传播&#34;&gt;反向传播&lt;/h3&gt;
&lt;p&gt;neurons，神经元。关于反向传播这个概念，早就是一个基础概念了，但是在数学上，理解起来还是比较抽象，要反复看和理解。&lt;/p&gt;
&lt;p&gt;算数和数学是不一样的东西。&lt;/p&gt;
&lt;p&gt;矩阵求导：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/32368246&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/32368246&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/24709748&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/24709748&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/24863977&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/24863977&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;反复看那些理解不了的公式，记住，公式中包含的信息是比较多的。如果不熟悉的领域要慢慢看才能看懂。不能急于求成。&lt;/p&gt;
&lt;p&gt;行列式就是数值。矩阵是表示一种数据结构。&lt;/p&gt;
&lt;p&gt;数学提问对于理解矩阵微分十分地重要，所以，下面这几个问题是我的一些疑惑。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;矩阵于行列式不同吗？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;矩阵和行列式是线性代数中的两个重要概念，它们有些相似但也有一定的区别。&lt;/p&gt;
&lt;p&gt;矩阵（Matrix）是一个按照矩形排列的数表，其中的元素可以是实数或复数。矩阵通常用大写字母表示，例如 A、B 等。矩阵可以有不同的大小，通过行数和列数来描述。一个 \(m \times n\) 的矩阵具有 m 行和 n 列。每个矩阵元素可以通过索引标识，例如第 i 行、第 j 列的元素记作 \(A_{ij}\) 。&lt;/p&gt;
&lt;p&gt;行列式（Determinant）是一个与方阵相关的标量值。方阵是一个行数和列数相等的矩阵。行列式的计算依赖于方阵的元素，通过展开定理或其他方法可以得到行列式的值。行列式的计算结果为一个数值，它包含了方阵多个元素之间的关系信息。行列式通常用竖线符号表示，例如 \(|A|\) 。&lt;/p&gt;
&lt;p&gt;换句话说，矩阵是一种数据结构，用于存储和操作多个数值。而行列式是一个通过对方阵元素进行特定运算而得到的数值。&lt;/p&gt;
&lt;p&gt;总结起来，矩阵是用来表示数据的结构，而行列式是通过矩阵的元素计算而来的特定数值。&lt;/p&gt;
&lt;p&gt;列向量一般用“;”来分割元素。注意约定的写法。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;行向量与列向量的区别？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;行向量和列向量是矩阵中的两种特殊向量形式，它们在表示方式和运算规则上存在一些区别。&lt;/p&gt;
&lt;p&gt;行向量：行向量是一个只有一行的矩阵，由左到右水平排列。行向量通常用小写字母加横线表示。行向量的转置得到的是列向量。&lt;/p&gt;
&lt;p&gt;列向量：列向量是一个只有一列的矩阵，由上到下垂直排列。列向量通常用小写字母加箭头表示。列向量的转置得到的是行向量。&lt;/p&gt;
&lt;p&gt;区别：&lt;/p&gt;
&lt;p&gt;形状：行向量只有一行，而列向量只有一列。表示方式：行向量水平排列，列向量垂直排列。运算规则：行向量和列向量在进行矩阵乘法时需要遵循不同的规则。行向量与行数相同的矩阵相乘，结果为行向量；列向量与列数相同的矩阵相乘，结果为列向量。线性代数中的运用：行向量常用于表示方程组的系数矩阵，而列向量常用于表示方程组的解向量。需要注意的是，在计算机编程中，行向量和列向量有时也可以通过矩阵的转置来互相表示。但在数学中，行向量和列向量是不同的概念，它们在矩阵运算和表示方式上具有明确的区别。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;多元微分学中的梯度怎么理解？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在多元微分学中，梯度是一个常用的概念，用于描述多变量函数在某一点的变化率和方向。&lt;/p&gt;
&lt;p&gt;考虑一个具有多个自变量的函数，例如 f(x, y)，其中 x 和 y 是自变量。梯度是这个函数对自变量的偏导数组成的向量。在二维情况下，梯度可以表示为 \(\nabla f = \left(\frac{\partial f}{\partial x}, \frac{\partial f}{\partial y}\right)\)
，它是一个二维向量。在三维及以上的情况下，梯度是一个更高维度的向量。&lt;/p&gt;
&lt;p&gt;梯度的几何意义可以理解为函数在某一点处最陡峭的上升方向。它指示了函数在该点最快增长的方向和速率。梯度的方向是函数在该点取得最大变化率的方向，而梯度的模（长度）表示了变化率的大小。&lt;/p&gt;
&lt;p&gt;梯度在最优化问题中非常重要。在求解函数的最大值或最小值时，可以通过梯度信息来确定前进的方向。例如，在最小化函数时，可以朝着负梯度的方向进行迭代，从而逐渐接近最小值点。&lt;/p&gt;
&lt;p&gt;总之，梯度在多元微分学中提供了关于函数在某一点的变化率和方向的信息。它在最优化、机器学习等领域中有着广泛的应用。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;标量对向量的导数怎么理解？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;标量对向量的导数，也称为向量的梯度，是一种向量函数，它描述了在某个点上一个标量函数对于相应向量变量在每个方向上的变化率和方向。&lt;/p&gt;
&lt;p&gt;假设有一个标量函数 \(f(x_1,\ldots,x_n)\)，其中 \(x_1,\ldots,x_n\) 是自变量，且同时存在一个向量
\(\mathbf{x}=(x_1,\ldots,x_n)\)。那么，标量 f 对向量 x 的导数就是一个向量，通常记作 \(\nabla f\)，由函数 f 对每个自变量 \(x_i\)
的偏导数组成。即，&lt;/p&gt;
&lt;p&gt;\(\nabla f = \left(\frac{\partial f}{\partial x_1}, \ldots, \frac{\partial f}{\partial x_n}\right)\)&lt;/p&gt;
&lt;p&gt;梯度向量的符号表示通常为 \(\nabla\)，由于它是一个向量，所以可以用一个箭头来表示。梯度向量的方向是变化最快的方向（即函数增加最快的方向），而梯度的大小表示函数在该点上的增长速率的大小。&lt;/p&gt;
&lt;p&gt;例如，假设 \(f(x,y)=2x+y\) ，则 f 对于自变量向量 \(\mathbf{x}=(x,y)\) 的导数就是 \(\nabla f=\left(\frac{\partial f}{\partial x},\frac{\partial f}{\partial y}\right)=(2,1)\) 。这意味着，在点(x,y)处，f 在 x 方向上每增加 1 个单位，f 将增加 2 个单位；而在 y 方向上每增加 1 个单位，f 将增加 1 个单位。&lt;/p&gt;
&lt;p&gt;梯度向量在很多科学和工程领域中都有广泛的应用，包括优化、机器学习、物理学、工程学等。例如，在机器学习中，梯度被用来更新模型参数以最小化损失函数，从而提高模型性能。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;什么是标量函数？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;标量函数是一种以输入为向量或标量，输出为标量的函数。简单来说，它将一个或多个变量映射到一个实数，而不是向量或矩阵。&lt;/p&gt;
&lt;p&gt;具体来说，考虑一个函数 f，它的定义域可以是一个或多个实数变量，例如 f(x)或 \(f(x_1,x_2,\ldots,x_n)\) 。如果该函数的值域为实数，那么它就是一个标量函数。&lt;/p&gt;
&lt;p&gt;标量函数是最常见的函数类型，我们在日常生活中遇到的许多函数都属于这个类别。例如，温度、速度、能量、质量等都是标量的物理量，它们可以由标量函数来描述。&lt;/p&gt;
&lt;p&gt;在数学和工程领域，我们经常需要研究和分析标量函数的性质，包括函数的连续性、可导性、最大值和最小值等。这些性质对于优化问题、最小二乘法、函数逼近等具有重要意义。通过对标量函数的研究，我们可以了解函数的行为、性质和变化规律，从而在实际问题中做出合理的决策和推断。&lt;/p&gt;
&lt;p&gt;这里我看到 pdf 的 &lt;code&gt;= 44 =&lt;/code&gt; 页了，做一个记录。&lt;/p&gt;
&lt;h3 id=&#34;整体架构&#34;&gt;整体架构&lt;/h3&gt;
&lt;p&gt;模拟神经元。&lt;/p&gt;
&lt;p&gt;神经网络的强大之处在于，用更多的参数来拟合复杂的数据。可以用非线性方程做堆叠，类似下面这样：&lt;/p&gt;
&lt;p&gt;\(f=W_{3}\max(0, W_{2}\max(0, W_{1}x))\)&lt;/p&gt;
&lt;h3 id=&#34;正则化的作用&#34;&gt;正则化的作用&lt;/h3&gt;
&lt;p&gt;惩罚力度对结果的影响：惩罚力度越大，拟合度越大，甚至过拟合。&lt;/p&gt;
&lt;p&gt;参数个数对结果的影响：隐藏的神经元个数越多，拟合度越大，甚至过拟合。&lt;/p&gt;
&lt;h3 id=&#34;激活函数&#34;&gt;激活函数&lt;/h3&gt;
&lt;p&gt;非常重要的一部分，常用的激活函数有：Sigmod ， Relu ， Tanh 等。&lt;/p&gt;
&lt;p&gt;前两个函数的图像是从右向左，从高到低的两个滑梯，一个到 0 就滑到底了，另一个 0 的时候才滑到中间。一个光滑一个在 0 处有奇异点。&lt;/p&gt;
&lt;h3 id=&#34;数据预处理&#34;&gt;数据预处理&lt;/h3&gt;
&lt;p&gt;一、数据可以中心化： X -= np.mean(X, axis = 0) ，通过变换坐标系做到以原点为中心。&lt;/p&gt;
&lt;p&gt;二、正则化：我的理解是把数据规范到一个范围内，比如 X /= np.std(X, axis = 0) 。&lt;/p&gt;
&lt;h3 id=&#34;参数的初始化&#34;&gt;参数的初始化&lt;/h3&gt;
&lt;p&gt;通常我们使用随机策略来时空行参数初始化。肯定现在大模型用的都是预训练模型了。&lt;/p&gt;
&lt;p&gt;参数的随机化举一个例子： W = 0.01* np.random.randn(D, H)&lt;/p&gt;
&lt;h3 id=&#34;drop-out&#34;&gt;drop out&lt;/h3&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/38200980&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/38200980&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;通过忽略一半的特征检测器（让一半的隐层节点值为 0），可以明显地减少过拟合现象。这种方式可以减少特征检测器（隐层节点）间的相互作用，检测器相互作用是指某些检测器依赖其他检测器才能发挥作用。&lt;/p&gt;
&lt;h3 id=&#34;语言模型-nlp&#34;&gt;语言模型 NLP&lt;/h3&gt;
&lt;p&gt;必读论文，emacs 读论文是最好用的。
&lt;a class=&#34;link&#34; href=&#34;https://browse.arxiv.org/pdf/1411.2738.pdf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://browse.arxiv.org/pdf/1411.2738.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;读论文的技巧可以：
&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/xing901022/p/10161727.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.cnblogs.com/xing901022/p/10161727.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;重中之重-cnn&#34;&gt;重中之重，CNN&lt;/h2&gt;
&lt;p&gt;ILSVRC ：  ILSVRC（ImageNet Large Scale Visual Recognition Challenge）是近年来机器视觉领域最受追捧也是最具权威的学术竞赛之一，代表了图像领域的最高水平。&lt;/p&gt;
&lt;p&gt;在 2014 年到 2015 年，机器识别图片的准确性首次超过了人类。现在是 2023 年了，过去了 8 年了。2015 年的时候我刚毕业。没想到人老了，科技发展好似坐上了火箭。&lt;/p&gt;
&lt;p&gt;检测、分类与检索、超分辨率重构，医学任务，无人驾驶，人脸识别都用到了 CNN 。&lt;/p&gt;
&lt;h3 id=&#34;整体架构&#34;&gt;整体架构&lt;/h3&gt;
&lt;p&gt;分为输入层、卷积层、池化层、全连接层&lt;/p&gt;
&lt;h3 id=&#34;卷积做了一件什么事&#34;&gt;卷积做了一件什么事&lt;/h3&gt;
&lt;p&gt;从 low-level feature 到 mid-level feature 到 high-level feature 再到 trainable classifier （可训练分类器）。&lt;/p&gt;
&lt;p&gt;堆叠的卷积层。&lt;/p&gt;
&lt;p&gt;卷积层涉及的参数：滑动窗口步长，卷积核尺寸，边缘填充，卷积核个数&lt;/p&gt;
&lt;p&gt;卷积结果的计算公式：&lt;/p&gt;
&lt;p&gt;长度： \(H_{2}=\frac{H_{1}-F_{H}+2P}{S}+1\)&lt;/p&gt;
&lt;p&gt;宽度： \(W_{2}=\frac{W_{1}-F_{W}+2P}{S}+1\)&lt;/p&gt;
&lt;p&gt;举例：输入数据是 32*32*3 的图像，用 10 个 5*5*3 的 filter 来进行卷积操作，指定步长为 1 ，边界填充为 2 ，最终输入的规模为？&lt;/p&gt;
&lt;p&gt;(32-5+2*2)/1 + 1 = 32 ，所以输出规模为 32*32*10 ，经过卷积操作后也可以保持特征图长度、宽度不变。&lt;/p&gt;
&lt;p&gt;卷积参数个数的计算：&lt;/p&gt;
&lt;p&gt;还是上面的例子，用 10 个 5*5*3 的 filter 来进行卷积操作，总共需要多少个参数？需要： 5*5*3*10 + 10 = 760 个参数。&lt;/p&gt;
&lt;h3 id=&#34;池化层&#34;&gt;池化层&lt;/h3&gt;
&lt;p&gt;池化的意思就是压缩，也就是下采样。做的事情是什么样的呢？类似于把一张图片缩小的操作。常见的一种操作是最大池化。就是用 \(n \times n\) 的 filter ，用英文是 max pool with 2x2 filters and stride 2 。&lt;/p&gt;
&lt;p&gt;一个典型的结构是下面这个样子的：&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231127_174858.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 1: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;CNN 举例&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;特征图变化是： 卷积 -&amp;gt; 卷积 -&amp;gt; 池化 -&amp;gt; 卷积 -&amp;gt; 池化 -&amp;gt; 转换 -&amp;gt; 全连接&lt;/p&gt;
&lt;h3 id=&#34;经典的-cnn-网络-alexnet&#34;&gt;经典的 CNN 网络—— Alexnet&lt;/h3&gt;
&lt;p&gt;这个网络做了 13 层。&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231127_175419.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 2: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;LeNet 和 AlexNet 网络&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id=&#34;经典网络-vgg&#34;&gt;经典网络—— Vgg&lt;/h3&gt;
&lt;p&gt;敢想敢干，专注，坚持。如果没有走一条错误的路，那么最终的结果一定不会太差。事上无难事，只怕有心人，加油！&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/41423739&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/41423739&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231128_150056.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;600&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 3: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;VGG 增加了感受野的概念。最后的 7x7x512 拉平成 1x1x4096&lt;/p&gt;
&lt;p&gt;VGG 优点&lt;/p&gt;
&lt;p&gt;VGGNet 的结构非常简洁，整个网络都使用了同样大小的卷积核尺寸（3x3）和最大池化尺寸（2x2）。几个小滤波器（3x3）卷积层的组合比一个大滤波器（5x5 或 7x7）卷积层好：验证了通过不断加深网络结构可以提升性能。&lt;/p&gt;
&lt;p&gt;VGG 缺点&lt;/p&gt;
&lt;p&gt;VGG 耗费更多计算资源，并且使用了更多的参数（这里不是 3x3 卷积的锅），导致更多的内存占用（140M）。其中绝大多数的参数都是来自于第一个全连接层。VGG 可是有 3 个全连接层啊！&lt;/p&gt;
&lt;p&gt;PS：有的文章称：发现这些全连接层即使被去除，对于性能也没有什么影响，这样就显著降低了参数数量。&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231128_145411.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;700&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 4: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;还有最下面的一层是 soft-max 层，输出的是一千个类别的后验概率。是 0 到 1 之前的求和概率，并且这些概率求和为 1 。&lt;/p&gt;
&lt;p&gt;卷积的作用是用于特征提取，训练出来的卷积就会按某种规则提取出来一种特征。但是结果是训练出来的。&lt;/p&gt;
&lt;p&gt;信号处理中的卷积和数字图像处理中的卷积完全是不同的：&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/chaipp0607/article/details/72236892&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/chaipp0607/article/details/72236892&lt;/a&gt;
计算的方法有相似之处。卷积的定义是：卷积是两个变量在某范围内相乘后求和的结果。缩小范围，产生影响的结果。这个就是 CNN 本质的东西。从数学上来说的本质是相同的，只不过一个空间中包含时域，另一个空间中只包含视野。&lt;/p&gt;
&lt;p&gt;全连接层起到的是“分类器”的作用。但是作用不限于分类器，FC 的意义还是非常地复杂的：
&lt;a class=&#34;link&#34; href=&#34;https://www.zhihu.com/question/41037974&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.zhihu.com/question/41037974&lt;/a&gt; ，但是粗略的讲，就是分类器。网上讲的东西非常地好，我其实不太用花钱学习。&lt;/p&gt;
&lt;p&gt;我感觉学完了经典的 CNN 网络模型，ai 的知识不学完了一半了。当然，这是我瞎扯的，来源于一个初学者的抖激零。&lt;/p&gt;
&lt;p&gt;更深的网络模型需要用残差等设计。学院派模型最深，就是到了 VGG 19 这种了。了解其原理之后。好的东西会保留。坏的东西会扬弃。最后感觉是殊途同归。ai 真的很有趣。值得一生学习和钻研。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1fU4y1E7bY/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.bilibili.com/video/BV1fU4y1E7bY/&lt;/a&gt; ，这里有精读 VGG 论文的课程。 &lt;code&gt;= 我最感兴趣的地方是 AI 情绪化 =&lt;/code&gt;
这种东西可以让 AI 变得更加有趣，可以应用在游戏里，还能用在电影和有趣的视频制做上面。这个好的想法一旦能实现，以后肯定有很多人会喜欢。&lt;/p&gt;
&lt;p&gt;同济子豪兄的视频非常的好，只有学到了一定的阶段才知道自己要学一些什么东西。&lt;a class=&#34;link&#34; href=&#34;https://space.bilibili.com/1900783&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://space.bilibili.com/1900783&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;VGG-16 当年获得了识别的第二名，定位的第一名。&lt;/p&gt;
&lt;p&gt;它是把像素空间的信息转化成语义空间的信息。&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231128_171503.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 5: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231128_171845.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 6: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;这部分的空间只是算了前向传播的，反向传播的空间占用没有算，梯度参数需要占用内存。&lt;/p&gt;
&lt;p&gt;两个 3x3 的卷积核可以代替一个 5x5 的卷积。想像一下，5x5 的一个图像被 3x3 的卷积核做一次运算，只剩下一个 1x1
的了。而同样的，用一个 5x5 的卷积核，只需要做一次，就可以变成 1x1 的。从这个角度来等价的。&lt;/p&gt;
&lt;p&gt;优点，参数的个数由 25 个变成了 9 个。表示的线性。三层 3x3 代替一层 7x7 的卷积核。还有一个好处，它是最小的包含左，右，上，下等概念的一个单元。&lt;/p&gt;
&lt;p&gt;在 inception 模型中也有这样的做法。还把 3x3 的卷积分解为了 1x3 的卷积和 3x1 的两个卷积。&lt;/p&gt;
&lt;p&gt;后面出现的 inception-v3 ，v4 和 Resnet 都超过了它。下面是 2017 年的对比图。之前的都称之为古典时期的了。&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231128_174149.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 7: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;圆圈大小是参数的数量。&lt;/p&gt;
&lt;figure class=&#34;fancy&#34;&gt;&lt;a href=&#34;t&#34; target=&#34;_blank&#34;&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231128_174447.jpg&#34;
         alt=&#34;Caption not used as alt text&#34; width=&#34;900&#34;/&gt;&lt;/a&gt;&lt;figcaption&gt;
            &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Figure 8: &lt;!-- raw HTML omitted --&gt;&lt;em&gt;&amp;ldquo;caption&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
        &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;vgg 的参数效率是非常差的。好的是下面的三个：SqueezeNet ， ShuffleNet ， MobileNet 这些轻量化网络。性能好，参数好。&lt;/p&gt;
&lt;p&gt;vgg 原版的报告在： &lt;a class=&#34;link&#34; href=&#34;http:/www.robots.ox.ac.uk/~karen/pdf/ILSVRC_2014.pdf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http:/www.robots.ox.ac.uk/~karen/pdf/ILSVRC_2014.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;人工智能是一门实验的科学。在辅以粗犷的理论加以解释。但是这种直觉有其科学性，可以说它是一门精确的玄学科学。需要极悟之道。&lt;/p&gt;
&lt;p&gt;更多的论文精讲可以选择先不看。等到有兴趣的时候再仔细研究。它使用的 ReLU 激活函数。它会引入更多的非线性，这句话放在论文当中没有数学证明，岂不是玄学吗？&lt;/p&gt;
&lt;p&gt;原论文的细节很多，涉及随机初始化，还有一堆其它的东西。东西有点小多，我想先不顾及其细节。&lt;/p&gt;
&lt;p&gt;很明显,堆叠小的卷积核所需的参数更少一些,并且卷积过程越多,特征提取也会越细致,加入的非线性变换也随着增多,还不会增大权重参数个数,这就是 VGG 网络的基本出发点,用小的卷积核来完成体特征提取操作。&lt;/p&gt;
&lt;h3 id=&#34;经典网络-resnet&#34;&gt;经典网络—— Resnet&lt;/h3&gt;
&lt;p&gt;不同损失函数的选择有什么道理？ResNet 的作者何恺明也因此摘得 CVPR2016 最佳论文奖。也就是我刚毕业那会儿，人工智能的早期发展正如火如荼的进行中。&lt;/p&gt;
&lt;p&gt;我们知道深层网络存在着梯度消失或者爆炸的问题，这使得深度学习模型很难训练。但是现在已经存在一些技术手段如 BatchNorm 来缓解这个问题。因此，出现深度网络的退化问题是非常令人诧异的。&lt;/p&gt;
&lt;p&gt;基本假设：现在你有一个浅层网络，你想通过向上堆积新层来建立深层网络，一个极端情况是这些增加的层什么也不学习，仅仅复制浅层网络的特征，即这样新层是恒等映射（Identity mapping）。在这种情况下，深层网络应该至少和浅层网络性能一样，也不应该出现退化现象。好吧，你不得不承认肯定是目前的训练方法有问题，才使得深层网络很难去找到一个好的参数。&lt;/p&gt;
&lt;p&gt;ResNet 的一个重要设计原则是：当 feature map 大小降低一半时，feature map 的数量增加一倍，这保持了网络层的复杂度。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/31852747&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/31852747&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;讲完了 Resnet 就剩下 DenseNet 等了。何凯明大佬厉害啊。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://kaiminghe.github.io/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://kaiminghe.github.io/&lt;/a&gt; ，这是人类的数据科学家啊，智力与运气并存，牛人。这人是广东 04 年的状元。&lt;/p&gt;
&lt;p&gt;什么是残差网络，这个从 b 站上找一些东西，直接搜就有很多。&lt;/p&gt;
&lt;p&gt;知乎上讲残差网络： &lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/42706477&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/42706477&lt;/a&gt; ，这个人收集的其它的一些文章也是非常地好的。数学公式很多，可能刚开始也不一定理解，但是后面还是要深入去啃一下的。&lt;/p&gt;
&lt;p&gt;b 站上对上面知乎的讲解：&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1rZ4y1m7d9/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.bilibili.com/video/BV1rZ4y1m7d9/&lt;/a&gt; ，此人是范仁义。多跟随一些大牛的脚步，人类的发展是随机的一种行为。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.zhihu.com/collection/277253986&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.zhihu.com/collection/277253986&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;\(X_{l+1}=X_{l}+F(x_{1},W_{l})\) 这个核心公式的意思是，下一层是输入是上一层的输入加上一个东西。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20231129_151648.jpg&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;BN 就是批归一化。这样会让每一层的信息在传递过程中不会丢失掉太多。 feature map 。上面就是一个残差块的过程。可以叠加两个残差块。&lt;/p&gt;
&lt;p&gt;为什么 1x1 的卷积可以减少计算量，又不损失太多的信息。用多个卷积核提取到多个特征，对应的特征比较少，少部分的可以提取到特征，大部分无法提取到特征。这个是一个稀梳的东西，就可以进行降维并且不损失太多的信息了。&lt;/p&gt;
&lt;p&gt;b 站上搜 ResNet 代码实战，就有找到很多很好的视频啊。&lt;/p&gt;
&lt;h3 id=&#34;经典网络-densenet&#34;&gt;经典网络—— DenseNet&lt;/h3&gt;
&lt;p&gt;人工智能网上的教程太多了，想学的话一定会有无数的方法可以把它们学好。我现在仅仅看到第二部分，就已经感觉收获了很多的知识，如果看完后面的几部分。再多学习几遍，一定可以搞清楚大部分浅显的内容。至于深刻的内容，可能要有了足够的经验，并且对数学有了更清楚的更解之后才行。&lt;/p&gt;
&lt;p&gt;这些经典的网络模型可以用 python 来跑一跑。打开代码看一看。大模型的答案越是像人，无限的接近就是等于。虽然说看起来它并有思想，只是把人类的思想以某种形式固化了下来。随着时间的发展，这个世界绝对会越来越精彩的。&lt;/p&gt;
&lt;h3 id=&#34;经典网络-rnn-网络&#34;&gt;经典网络—— RNN 网络&lt;/h3&gt;
&lt;p&gt;与 CNN 不一样的是 RNN 主要用于 NLP 领域。RNN 主要用于处理序列数据，如文本、音频和时间序列数据，它们具有循环结构，可以考虑数据之间的时序关系。&lt;/p&gt;
&lt;p&gt;CNN 可以用于文本分类。&lt;/p&gt;
&lt;h3 id=&#34;lstm-长知时记忆网络&#34;&gt;LSTM ——长知时记忆网络&lt;/h3&gt;
&lt;h3 id=&#34;hierarchical-softmax&#34;&gt;Hierarchical Softmax&lt;/h3&gt;
&lt;h3 id=&#34;gan&#34;&gt;GAN&lt;/h3&gt;
&lt;h2 id=&#34;支持向量机-svm&#34;&gt;支持向量机（svm）&lt;/h2&gt;
&lt;p&gt;支持向量机和深度学习有什么区别？&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://worktile.com/kb/p/62894&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://worktile.com/kb/p/62894&lt;/a&gt; ，&lt;/p&gt;
&lt;p&gt;现在工业上最先进的是 GBDT 了。GBDT（Gradient Boosting Decision Tree）是一种基于决策树的集成学习算法，也被称为梯度提升树。它通过逐步迭代地训练多个决策树模型，每次迭代都在之前模型的残差上训练新的模型，最终将所有模型的预测结果加权求和得到最终结果。由于 GBDT 具有很强的泛化能力和鲁棒性，因此在各种机器学习任务中广泛应用，如分类、回归等。&lt;/p&gt;
&lt;p&gt;逻辑回归与 SVM 的损失函数不同，逻辑回归采用的是平方损失函数，SVM 采用的是合页损失函数。但是两种损失函数的目的是相同的，都是增加对分类影响较大的数据点的权重，减少与分类关系较小的数据点的权重。SVM 的合页损失函数有一块“平坦”的零区域，使得支持向量的解具有稀疏性，而逻辑回归的损失函数是光滑的单调函数，没有支持向量的概念，逻辑回归更依赖于更多的数据，受数据分布的影响。逻辑回归的输出具有自然的概率意义，即给出预测标记的同时也给出了概率，而支持向量机不具有概率意义。SVM 依赖数据表达的距离测度，所以需要对数据先做 normalization；逻辑回归不受其影响。&lt;/p&gt;
&lt;p&gt;什么是支持向量？&lt;/p&gt;
&lt;p&gt;支持向量是支持向量机（SVM）算法中的概念。在 SVM 中，支持向量指的是训练数据中对决策边界（或者称为超平面）位置有影响的样本点。这些样本点恰好位于各自类别的边界上，它们决定了最终的决策边界的位置。在 SVM 算法中，只有这些支持向量才对最终的分类决策起作用，其他样本点则不会对决策边界产生影响。&lt;/p&gt;
&lt;p&gt;支持向量机通过找到能够正确划分不同类别样本的决策边界，并且使得支持向量到决策边界的距离尽可能远，从而实现对数据的有效分类。这种方法使得支持向量机在处理高维数据和复杂数据特征时具有很好的性能表现。&lt;/p&gt;
&lt;p&gt;svm 本质上还是“浅度学习”，不带核函数的 svm 只能线性分类。带核函数也本质上是把线性不可分问题映射到一个可分问题上，本质还是线性分类。然而这个映射函数的构造并不容易，多数问题即使映射到高维它还是线性不可分。svm 本质上只有一层，所以是“浅度学习”。&lt;/p&gt;
&lt;p&gt;逻辑回归不是深度学习算法，它属于传统的机器学习算法。深度学习是一种基于神经网络的机器学习方法，它通过多层的神经网络结构来学习和提取数据的高阶特征表示。&lt;/p&gt;
&lt;p&gt;逻辑回归是一种用于二分类问题的线性模型，它通过将输入特征与权重相乘并加上偏置项，然后将结果通过一个 sigmoid 函数进行映射，得到样本属于正类的概率。逻辑回归主要用于处理线性可分的二分类问题，并且可以通过最大似然估计等方法进行参数的优化。&lt;/p&gt;
&lt;p&gt;相比之下，深度学习是一种更为复杂的模型，它可以通过多个隐藏层来学习和表示非线性的数据特征，具有更强大的表达能力和学习能力。深度学习在处理大规模数据和复杂任务时通常表现出色，但也需要更多的计算资源和训练时间。&lt;/p&gt;
&lt;h2 id=&#34;杂谈&#34;&gt;杂谈&lt;/h2&gt;
&lt;p&gt;中国人喜欢说打好基本功，小学和初等教肓做的还是那么一回事。但是中国人是最浮躁的，企业的短视和降本增效，个人的追求功名利禄。大学教肓课本缺少由来的讲解，只讲如何做题和做运算。追求真理和本质是对的，可是中国人，外行领导内行。聪明人因为文化也大都急功近利。国人的人性既然有缺点，那这社会就应该吃下这份苦果。也不只是中国人，人本来就是有劣性的。人的高尚的一面只有在少数情况下才会显现出来，大多数情况下很难做好。这是正常的。&lt;/p&gt;
&lt;p&gt;只是自己能做好一点吗？自己能比多数我说到的人做的好就行了。但行好事，莫问前程。管你想活与否，一个人也就这几十年，怎么过，自己能做出很多的决定，按照自己的目标过好每一天。&lt;/p&gt;
&lt;p&gt;人工智能是以线性的计算模拟非线性的意识，因为非线性的问题不好求解，有求解的方法，但是人没有找到统一的方法。人类可以依靠对世界的感知，综合，创造新的工具，并借助新的东西，拓宽认知的边界。如果机器可以做到这一点，那就可以说它成为了一种强人工智能了。&lt;/p&gt;
&lt;h2 id=&#34;一个可以找代码片段的网站&#34;&gt;一个可以找代码片段的网站&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zh.d2l.ai/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zh.d2l.ai/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这个真心是很不错的，看一些代码，用 emacs 跑一跑，调试一下，理解一下。paddle 这个框架也是可以的，他好就是好在是国内的一个 AI 框架。这个 AI 框架起码下载和调试起来是比较方便的。框架大体是类似的，都是可用的，还有国内的文档，这么好的学习路径，赶紧能用起来才是最重要的。&lt;/p&gt;
&lt;h2 id=&#34;学习路径&#34;&gt;学习路径&lt;/h2&gt;
&lt;p&gt;先安装 conda ，再安装 CPU 版本的 paddle 。&lt;/p&gt;
&lt;p&gt;再 emacs 打开 python 项目。&lt;/p&gt;
&lt;p&gt;尝试用 paddle 来写一些经典的网络模型，找一些开源的数据集做一些测试。&lt;/p&gt;
&lt;p&gt;就这么办，哪怕是一些简单的代码，能做单元测试，能 run 起来，理解原理就足够了。好，也不好。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>AI roadmap</title>
        <link>https://guolongji.xyz/post/ai-leaning-plan/</link>
        <pubDate>Thu, 21 Sep 2023 09:56:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/ai-leaning-plan/</guid>
        <description>&lt;p&gt;目录渲染不要设置为 pandoc，gitlab ci 可以不用 pandoc 了吧。否则目录不显示 3 级以上的标题。还有，也不知道是 ox-hugo 的问题还是 hugo 本身的问题，orgmode 转 md，orgmode 的不要使用二级的标题，否则生成的 md 标题层次不对。2，3级同层。&lt;/p&gt;
&lt;h2 id=&#34;ai-必备基础与机器学习&#34;&gt;AI 必备基础与机器学习&lt;/h2&gt;
&lt;h3 id=&#34;python-基础及其工具包实战&#34;&gt;Python 基础及其工具包实战&lt;/h3&gt;
&lt;h4 id=&#34;python-快速入&#34;&gt;Python 快速入⻔&lt;/h4&gt;
&lt;h4 id=&#34;科学计算库-numpy&#34;&gt;科学计算库-Numpy&lt;/h4&gt;
&lt;h4 id=&#34;数据分析处理库-pandas&#34;&gt;数据分析处理库-Pandas&lt;/h4&gt;
&lt;h4 id=&#34;可视化库-matplotlib&#34;&gt;可视化库-Matplotlib&lt;/h4&gt;
&lt;h4 id=&#34;可视化库-seaborn&#34;&gt;可视化库-Seaborn&lt;/h4&gt;
&lt;h3 id=&#34;人工智能必备数学基础&#34;&gt;人工智能必备数学基础&lt;/h3&gt;
&lt;h4 id=&#34;高等数学基础&#34;&gt;高等数学基础&lt;/h4&gt;
&lt;h4 id=&#34;微积分&#34;&gt;微积分&lt;/h4&gt;
&lt;h4 id=&#34;泰勒公式与拉格朗日&#34;&gt;泰勒公式与拉格朗日&lt;/h4&gt;
&lt;h4 id=&#34;线性代数基础&#34;&gt;线性代数基础&lt;/h4&gt;
&lt;h4 id=&#34;特征值与矩阵分解&#34;&gt;特征值与矩阵分解&lt;/h4&gt;
&lt;h4 id=&#34;随机变量&#34;&gt;随机变量&lt;/h4&gt;
&lt;h4 id=&#34;概率论基础&#34;&gt;概率论基础&lt;/h4&gt;
&lt;h4 id=&#34;数据科学你得知道的几种分布&#34;&gt;数据科学你得知道的几种分布&lt;/h4&gt;
&lt;h4 id=&#34;核函数变换&#34;&gt;核函数变换&lt;/h4&gt;
&lt;h4 id=&#34;熵与激活函数&#34;&gt;熵与激活函数&lt;/h4&gt;
&lt;h4 id=&#34;回归分析&#34;&gt;回归分析&lt;/h4&gt;
&lt;h4 id=&#34;假设检验&#34;&gt;假设检验&lt;/h4&gt;
&lt;h4 id=&#34;相关分析&#34;&gt;相关分析&lt;/h4&gt;
&lt;h4 id=&#34;方差分析&#34;&gt;方差分析&lt;/h4&gt;
&lt;h4 id=&#34;聚类分析&#34;&gt;聚类分析&lt;/h4&gt;
&lt;h4 id=&#34;叶斯分析&#34;&gt;⻉叶斯分析&lt;/h4&gt;
&lt;h3 id=&#34;第三模块机器学习算法精讲及其案例应用&#34;&gt;第三模块机器学习算法精讲及其案例应用&lt;/h3&gt;
&lt;h4 id=&#34;线性回归原理推导&#34;&gt;线性回归原理推导&lt;/h4&gt;
&lt;h4 id=&#34;线性回归代码实现&#34;&gt;线性回归代码实现&lt;/h4&gt;
&lt;h4 id=&#34;模型评估方法&#34;&gt;模型评估方法&lt;/h4&gt;
&lt;h4 id=&#34;线性回归实验分析&#34;&gt;线性回归实验分析&lt;/h4&gt;
&lt;h4 id=&#34;逻辑回归代码实现&#34;&gt;逻辑回归代码实现&lt;/h4&gt;
&lt;h4 id=&#34;逻辑回归实验分析&#34;&gt;逻辑回归实验分析&lt;/h4&gt;
&lt;h4 id=&#34;聚类算法-kmeans-and-dbscan-原理&#34;&gt;聚类算法-Kmeans&amp;amp;Dbscan 原理&lt;/h4&gt;
&lt;h4 id=&#34;kmeans-代码实现&#34;&gt;Kmeans 代码实现&lt;/h4&gt;
&lt;h4 id=&#34;聚类算法实验分析&#34;&gt;聚类算法实验分析&lt;/h4&gt;
&lt;h4 id=&#34;决策树原理&#34;&gt;决策树原理&lt;/h4&gt;
&lt;h4 id=&#34;决策树代码实现&#34;&gt;决策树代码实现&lt;/h4&gt;
&lt;h4 id=&#34;决策树实验分析&#34;&gt;决策树实验分析&lt;/h4&gt;
&lt;h4 id=&#34;集成算法原理&#34;&gt;集成算法原理&lt;/h4&gt;
&lt;h4 id=&#34;集成算法实验分析&#34;&gt;集成算法实验分析&lt;/h4&gt;
&lt;h4 id=&#34;支持向量机原理推导&#34;&gt;支持向量机原理推导&lt;/h4&gt;
&lt;h4 id=&#34;支持向量机实验分析&#34;&gt;支持向量机实验分析&lt;/h4&gt;
&lt;h4 id=&#34;神经网络算法原理&#34;&gt;神经网络算法原理&lt;/h4&gt;
&lt;h4 id=&#34;神经网络代码实现&#34;&gt;神经网络代码实现&lt;/h4&gt;
&lt;h4 id=&#34;叶斯算法原理&#34;&gt;⻉叶斯算法原理&lt;/h4&gt;
&lt;h4 id=&#34;叶斯代码实现&#34;&gt;⻉叶斯代码实现&lt;/h4&gt;
&lt;h4 id=&#34;关联规则实战分析&#34;&gt;关联规则实战分析&lt;/h4&gt;
&lt;h4 id=&#34;关联规则代码实现&#34;&gt;关联规则代码实现&lt;/h4&gt;
&lt;h4 id=&#34;词向量-word2vec-通俗解读&#34;&gt;词向量 word2vec 通俗解读&lt;/h4&gt;
&lt;h4 id=&#34;代码实现-word2vec-词向量模型&#34;&gt;代码实现 word2vec 词向量模型&lt;/h4&gt;
&lt;h4 id=&#34;推荐系统原理&#34;&gt;推荐系统原理&lt;/h4&gt;
&lt;h4 id=&#34;打造音乐推荐系统&#34;&gt;打造音乐推荐系统&lt;/h4&gt;
&lt;h4 id=&#34;主成分分析&#34;&gt;主成分分析&lt;/h4&gt;
&lt;h4 id=&#34;线性判别分析&#34;&gt;线性判别分析&lt;/h4&gt;
&lt;h4 id=&#34;主成分分析降维算法解读&#34;&gt;主成分分析降维算法解读&lt;/h4&gt;
&lt;h4 id=&#34;隐-尔科夫模型&#34;&gt;隐⻢尔科夫模型&lt;/h4&gt;
&lt;h4 id=&#34;hiim-应用实例&#34;&gt;HIIM 应用实例&lt;/h4&gt;
&lt;h3 id=&#34;机器学习-and-数据挖掘项目实战&#34;&gt;机器学习&amp;amp;数据挖掘项目实战&lt;/h3&gt;
&lt;h4 id=&#34;机器学习&#34;&gt;机器学习&lt;/h4&gt;
&lt;h4 id=&#34;python-实战关联规则&#34;&gt;Python 实战关联规则&lt;/h4&gt;
&lt;h4 id=&#34;爱彼迎数据集分析与建模&#34;&gt;爱彼迎数据集分析与建模&lt;/h4&gt;
&lt;h4 id=&#34;基于相似度的酒店推荐系统&#34;&gt;基于相似度的酒店推荐系统&lt;/h4&gt;
&lt;h4 id=&#34;商品销售额回归分析&#34;&gt;商品销售额回归分析&lt;/h4&gt;
&lt;h4 id=&#34;绝地求生数据集探索分析与建模&#34;&gt;绝地求生数据集探索分析与建模&lt;/h4&gt;
&lt;h4 id=&#34;机器学习-模型解释方法实战&#34;&gt;机器学习-模型解释方法实战&lt;/h4&gt;
&lt;h4 id=&#34;nlp-常用工具包&#34;&gt;NLP 常用工具包&lt;/h4&gt;
&lt;h4 id=&#34;nlp-核心模型-word2vec&#34;&gt;NLP 核心模型-word2vec&lt;/h4&gt;
&lt;h4 id=&#34;自然语言处理特征提取方式对比&#34;&gt;自然语言处理特征提取方式对比&lt;/h4&gt;
&lt;h4 id=&#34;数据特征预处理&#34;&gt;数据特征预处理&lt;/h4&gt;
&lt;h4 id=&#34;银行客戶还款可能性预测&#34;&gt;银行客戶还款可能性预测&lt;/h4&gt;
&lt;h4 id=&#34;图像特征聚类分析实践&#34;&gt;图像特征聚类分析实践&lt;/h4&gt;
&lt;h4 id=&#34;数据挖掘&#34;&gt;数据挖掘&lt;/h4&gt;
&lt;h4 id=&#34;快手用戶活跃度预测&#34;&gt;快手用戶活跃度预测&lt;/h4&gt;
&lt;h4 id=&#34;工业化生产预测&#34;&gt;工业化生产预测&lt;/h4&gt;
&lt;h4 id=&#34;智慧城市道路通行时间预测&#34;&gt;智慧城市道路通行时间预测&lt;/h4&gt;
&lt;h4 id=&#34;特征工程建模可解释工具包&#34;&gt;特征工程建模可解释工具包&lt;/h4&gt;
&lt;h4 id=&#34;医学糖尿病数据命名实体识别&#34;&gt;医学糖尿病数据命名实体识别&lt;/h4&gt;
&lt;h4 id=&#34;贷款平台-控模型-特征工程&#34;&gt;贷款平台⻛控模型-特征工程&lt;/h4&gt;
&lt;h4 id=&#34;新闻关键词抽取模型&#34;&gt;新闻关键词抽取模型&lt;/h4&gt;
&lt;h4 id=&#34;数据特征常用构建方法&#34;&gt;数据特征常用构建方法&lt;/h4&gt;
&lt;h4 id=&#34;用电敏感客戶分类&#34;&gt;用电敏感客戶分类&lt;/h4&gt;
&lt;h4 id=&#34;机器学习项目实战模板&#34;&gt;机器学习项目实战模板&lt;/h4&gt;
&lt;h3 id=&#34;python-金融分析与量化交易实战&#34;&gt;python 金融分析与量化交易实战&lt;/h3&gt;
&lt;h4 id=&#34;金融时间序列分析&#34;&gt;金融时间序列分析&lt;/h4&gt;
&lt;h4 id=&#34;双均线交易策略实例&#34;&gt;双均线交易策略实例&lt;/h4&gt;
&lt;h4 id=&#34;策略评估指标&#34;&gt;策略评估指标&lt;/h4&gt;
&lt;h4 id=&#34;量化交易解读&#34;&gt;量化交易解读&lt;/h4&gt;
&lt;h4 id=&#34;ricequant-回测选股分析实战&#34;&gt;Ricequant 回测选股分析实战&lt;/h4&gt;
&lt;h4 id=&#34;因子数据预处理&#34;&gt;因子数据预处理&lt;/h4&gt;
&lt;h4 id=&#34;因子策略选股实例&#34;&gt;因子策略选股实例&lt;/h4&gt;
&lt;h4 id=&#34;因子分析实战&#34;&gt;因子分析实战&lt;/h4&gt;
&lt;h4 id=&#34;因子打分选股实例&#34;&gt;因子打分选股实例&lt;/h4&gt;
&lt;h4 id=&#34;基于回归的策略分析&#34;&gt;基于回归的策略分析&lt;/h4&gt;
&lt;h4 id=&#34;聚类与统计策略分析&#34;&gt;聚类与统计策略分析&lt;/h4&gt;
&lt;h4 id=&#34;fbprophet-时间测序预测神器&#34;&gt;Fbprophet 时间测序预测神器&lt;/h4&gt;
&lt;h4 id=&#34;深度学习时间序列预测&#34;&gt;深度学习时间序列预测&lt;/h4&gt;
&lt;h4 id=&#34;matplotlib-工具包实战&#34;&gt;Matplotlib 工具包实战&lt;/h4&gt;
&lt;h4 id=&#34;seaborn&#34;&gt;Seaborn&lt;/h4&gt;
&lt;h2 id=&#34;计算机视觉算法及其项目实战&#34;&gt;计算机视觉算法及其项目实战&lt;/h2&gt;
&lt;h3 id=&#34;深度学习必备核心算法&#34;&gt;深度学习必备核心算法&lt;/h3&gt;
&lt;h4 id=&#34;神经网络必备基础知识点&#34;&gt;神经网络必备基础知识点&lt;/h4&gt;
&lt;h4 id=&#34;神经网络前向传播与反向传播&#34;&gt;神经网络前向传播与反向传播&lt;/h4&gt;
&lt;h4 id=&#34;网络模型整体架构分析实例&#34;&gt;网络模型整体架构分析实例&lt;/h4&gt;
&lt;h4 id=&#34;神经网络建模效果分析&#34;&gt;神经网络建模效果分析&lt;/h4&gt;
&lt;h4 id=&#34;激活函数与过拟合问题解决&#34;&gt;激活函数与过拟合问题解决&lt;/h4&gt;
&lt;h4 id=&#34;卷积神经网络核心知识点&#34;&gt;卷积神经网络核心知识点&lt;/h4&gt;
&lt;h4 id=&#34;卷积建模流程与各参数作用分析&#34;&gt;卷积建模流程与各参数作用分析&lt;/h4&gt;
&lt;h4 id=&#34;池化层的作用与效果&#34;&gt;池化层的作用与效果&lt;/h4&gt;
&lt;h4 id=&#34;经典卷积神经网络架构分析&#34;&gt;经典卷积神经网络架构分析&lt;/h4&gt;
&lt;h4 id=&#34;感受野的作用与效果解读&#34;&gt;感受野的作用与效果解读&lt;/h4&gt;
&lt;h4 id=&#34;递归神经网络模型原理分析&#34;&gt;递归神经网络模型原理分析&lt;/h4&gt;
&lt;h4 id=&#34;rnn-系列网络结构优缺点分析&#34;&gt;RNN 系列网络结构优缺点分析&lt;/h4&gt;
&lt;h4 id=&#34;词向量模型与-lstm-应用实例&#34;&gt;词向量模型与 LSTM 应用实例&lt;/h4&gt;
&lt;h3 id=&#34;深度学习核心框架-pytorch-与-tensorflow&#34;&gt;深度学习核心框架 PyTorch 与 Tensorflow&lt;/h3&gt;
&lt;h4 id=&#34;深度学习框架-pytorch&#34;&gt;深度学习框架 PyTorch&lt;/h4&gt;
&lt;h4 id=&#34;pytorch-框架基本处理操作&#34;&gt;PyTorch 框架基本处理操作&lt;/h4&gt;
&lt;h4 id=&#34;神经网络实战分类与回归任务&#34;&gt;神经网络实战分类与回归任务&lt;/h4&gt;
&lt;h4 id=&#34;卷积神经网络原理与参数解读&#34;&gt;卷积神经网络原理与参数解读&lt;/h4&gt;
&lt;h4 id=&#34;图像识别核心模块实战解读&#34;&gt;图像识别核心模块实战解读&lt;/h4&gt;
&lt;h4 id=&#34;迁移学习的作用与应用实例&#34;&gt;迁移学习的作用与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;计算机视觉模型通用训练策略&#34;&gt;计算机视觉模型通用训练策略&lt;/h4&gt;
&lt;h4 id=&#34;dataloader-构建自己的数据集&#34;&gt;Dataloader 构建自己的数据集&lt;/h4&gt;
&lt;h4 id=&#34;torch-框架自定义类与数据模块&#34;&gt;Torch 框架自定义类与数据模块&lt;/h4&gt;
&lt;h4 id=&#34;递归神经网络与词向量原理解读&#34;&gt;递归神经网络与词向量原理解读&lt;/h4&gt;
&lt;h4 id=&#34;新闻数据集文本分类实战&#34;&gt;新闻数据集文本分类实战&lt;/h4&gt;
&lt;h4 id=&#34;深度学习框架-tensorflow&#34;&gt;深度学习框架 Tensorflow&lt;/h4&gt;
&lt;h4 id=&#34;tensorflow-安装与简介&#34;&gt;tensorflow 安装与简介&lt;/h4&gt;
&lt;h4 id=&#34;神经网络原理解读与整体架构&#34;&gt;神经网络原理解读与整体架构&lt;/h4&gt;
&lt;h4 id=&#34;搭建神经网络进行分类与回归任务&#34;&gt;搭建神经网络进行分类与回归任务&lt;/h4&gt;
&lt;h4 id=&#34;卷积神经网络原理与参数解读&#34;&gt;卷积神经网络原理与参数解读&lt;/h4&gt;
&lt;h4 id=&#34;猫狗识别实战&#34;&gt;猫狗识别实战&lt;/h4&gt;
&lt;h4 id=&#34;图像数据增强实例&#34;&gt;图像数据增强实例&lt;/h4&gt;
&lt;h4 id=&#34;训练策略-迁移学习实战&#34;&gt;训练策略-迁移学习实战&lt;/h4&gt;
&lt;h4 id=&#34;递归神经网络与词向量原理解读&#34;&gt;递归神经网络与词向量原理解读&lt;/h4&gt;
&lt;h4 id=&#34;基于-tensorflow-实现-word2vec&#34;&gt;基于 TensorFlow 实现 word2vec&lt;/h4&gt;
&lt;h4 id=&#34;基于-rnn-模型进行文本分类任务&#34;&gt;基于 RNN 模型进行文本分类任务&lt;/h4&gt;
&lt;h4 id=&#34;将-cnn-网络应用于文本分类实战&#34;&gt;将 CNN 网络应用于文本分类实战&lt;/h4&gt;
&lt;h4 id=&#34;时间序列预测&#34;&gt;时间序列预测&lt;/h4&gt;
&lt;h4 id=&#34;经典网络架构-resnet-实战&#34;&gt;经典网络架构 Resnet 实战&lt;/h4&gt;
&lt;h3 id=&#34;opencv-图像处理框架实战&#34;&gt;Opencv 图像处理框架实战&lt;/h3&gt;
&lt;h4 id=&#34;课程简介与环境配置&#34;&gt;课程简介与环境配置&lt;/h4&gt;
&lt;h4 id=&#34;图像基本操作&#34;&gt;图像基本操作&lt;/h4&gt;
&lt;h4 id=&#34;阈值与平滑处理&#34;&gt;阈值与平滑处理&lt;/h4&gt;
&lt;h4 id=&#34;图像形态学操作&#34;&gt;图像形态学操作&lt;/h4&gt;
&lt;h4 id=&#34;图像梯度计算&#34;&gt;图像梯度计算&lt;/h4&gt;
&lt;h4 id=&#34;边缘检测&#34;&gt;边缘检测&lt;/h4&gt;
&lt;h4 id=&#34;图像金字塔与轮廓检测&#34;&gt;图像金字塔与轮廓检测&lt;/h4&gt;
&lt;h4 id=&#34;直方图与傅里叶变换&#34;&gt;直方图与傅里叶变换&lt;/h4&gt;
&lt;h4 id=&#34;信用卡数字识别&#34;&gt;信用卡数字识别&lt;/h4&gt;
&lt;h4 id=&#34;文档扫描-ocr-识别&#34;&gt;文档扫描 OCR 识别&lt;/h4&gt;
&lt;h4 id=&#34;图像特征-harris&#34;&gt;图像特征-harris&lt;/h4&gt;
&lt;h4 id=&#34;图像特征-sift&#34;&gt;图像特征-sift&lt;/h4&gt;
&lt;h4 id=&#34;全景图像拼接&#34;&gt;全景图像拼接&lt;/h4&gt;
&lt;h4 id=&#34;停-场-位识别&#34;&gt;停⻋场⻋位识别&lt;/h4&gt;
&lt;h4 id=&#34;答题卡识别判卷&#34;&gt;答题卡识别判卷&lt;/h4&gt;
&lt;h4 id=&#34;背景建模&#34;&gt;背景建模&lt;/h4&gt;
&lt;h4 id=&#34;光流估计&#34;&gt;光流估计&lt;/h4&gt;
&lt;h4 id=&#34;opencv-的-dnn-模块&#34;&gt;Opencv 的 DNN 模块&lt;/h4&gt;
&lt;h4 id=&#34;目标追踪&#34;&gt;目标追踪&lt;/h4&gt;
&lt;h4 id=&#34;卷积原理与操作&#34;&gt;卷积原理与操作&lt;/h4&gt;
&lt;h4 id=&#34;疲劳检测&#34;&gt;疲劳检测&lt;/h4&gt;
&lt;h3 id=&#34;综合项目-物体检测经典算法实战&#34;&gt;综合项目-物体检测经典算法实战&lt;/h3&gt;
&lt;h4 id=&#34;深度学习经典检测方法概述&#34;&gt;深度学习经典检测方法概述&lt;/h4&gt;
&lt;h4 id=&#34;yolo-v1-整体思想与网络架构&#34;&gt;YOLO-V1 整体思想与网络架构&lt;/h4&gt;
&lt;h4 id=&#34;yolo-v2-改进细节详解&#34;&gt;YOLO-V2 改进细节详解&lt;/h4&gt;
&lt;h4 id=&#34;yolo-v3-核心网络模型&#34;&gt;YOLO-V3 核心网络模型&lt;/h4&gt;
&lt;h4 id=&#34;基于-v3-版本进行源码解读&#34;&gt;基于 V3 版本进行源码解读&lt;/h4&gt;
&lt;h4 id=&#34;基于-yolo-v3-训练自己的数据集与任务&#34;&gt;基于 YOLO-V3 训练自己的数据集与任务&lt;/h4&gt;
&lt;h4 id=&#34;yolo-v4-版本算法解读&#34;&gt;YOLO-V4 版本算法解读&lt;/h4&gt;
&lt;h4 id=&#34;v5-版本项目配置&#34;&gt;V5 版本项目配置&lt;/h4&gt;
&lt;h4 id=&#34;v5-项目工程源码解读&#34;&gt;V5 项目工程源码解读&lt;/h4&gt;
&lt;h4 id=&#34;efficient-net-模块解读&#34;&gt;Efficient net 模块解读&lt;/h4&gt;
&lt;h4 id=&#34;efficient-det-目标检测框架算法分析&#34;&gt;Efficient Det 目标检测框架算法分析&lt;/h4&gt;
&lt;h4 id=&#34;efficient-det-源码分析与应用&#34;&gt;Efficient Det 源码分析与应用&lt;/h4&gt;
&lt;h4 id=&#34;detr-目标检测算法解读&#34;&gt;Detr 目标检测算法解读&lt;/h4&gt;
&lt;h4 id=&#34;detr-源码分析与应用实战&#34;&gt;Detr 源码分析与应用实战&lt;/h4&gt;
&lt;h4 id=&#34;deformable-detr-算法改进解读&#34;&gt;Deformable DETR 算法改进解读&lt;/h4&gt;
&lt;h4 id=&#34;deformable-detr-源码解读与架构分析&#34;&gt;Deformable DETR 源码解读与架构分析&lt;/h4&gt;
&lt;h4 id=&#34;fcos-算法如何提升检测速度&#34;&gt;Fcos 算法如何提升检测速度&lt;/h4&gt;
&lt;h4 id=&#34;可变形卷积效果分析与行人检测实例&#34;&gt;可变形卷积效果分析与行人检测实例&lt;/h4&gt;
&lt;h3 id=&#34;图像分割实战&#34;&gt;图像分割实战&lt;/h3&gt;
&lt;h4 id=&#34;图像分割及其损失函数概述&#34;&gt;图像分割及其损失函数概述&lt;/h4&gt;
&lt;h4 id=&#34;卷积神经网络原理与参数解读&#34;&gt;卷积神经网络原理与参数解读&lt;/h4&gt;
&lt;h4 id=&#34;unet-系列算法讲解&#34;&gt;Unet 系列算法讲解&lt;/h4&gt;
&lt;h4 id=&#34;unet-医学细胞分割实战&#34;&gt;unet 医学细胞分割实战&lt;/h4&gt;
&lt;h4 id=&#34;u2net-显著性检测实战&#34;&gt;U2NET 显著性检测实战&lt;/h4&gt;
&lt;h4 id=&#34;deeplab-系列算法&#34;&gt;deeplab 系列算法&lt;/h4&gt;
&lt;h4 id=&#34;基于-deeplabv3-plus-版本进行-voc-分割实战&#34;&gt;基于 deeplabV3+版本进行 VOC 分割实战&lt;/h4&gt;
&lt;h4 id=&#34;医学心脏视频数据集分割建模实战&#34;&gt;医学心脏视频数据集分割建模实战&lt;/h4&gt;
&lt;h4 id=&#34;medical-transformer-分割实战&#34;&gt;Medical Transformer 分割实战&lt;/h4&gt;
&lt;h4 id=&#34;medical-transformer-源码实现与应用实例&#34;&gt;Medical Transformer 源码实现与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;可学习位置编码模块对分割算法的作用分析&#34;&gt;可学习位置编码模块对分割算法的作用分析&lt;/h4&gt;
&lt;h4 id=&#34;分割任务如何标注与训练自己的项目&#34;&gt;分割任务如何标注与训练自己的项目&lt;/h4&gt;
&lt;h3 id=&#34;走向-ai-论文实验与项目实战的捷径-mmlab-实战系列&#34;&gt;走向 AI 论文实验与项目实战的捷径-MMLAB 实战系列&lt;/h3&gt;
&lt;h4 id=&#34;mmlab-系列环境搭建方法--以不变应万变&#34;&gt;MMLAB 系列环境搭建方法(以不变应万变)&lt;/h4&gt;
&lt;h4 id=&#34;mmcls-分类模块核心功能解读&#34;&gt;MMCLS 分类模块核心功能解读&lt;/h4&gt;
&lt;h4 id=&#34;图像识别配置文件作用与功能解读&#34;&gt;图像识别配置文件作用与功能解读&lt;/h4&gt;
&lt;h4 id=&#34;图像识别任务标注方法与实例&#34;&gt;图像识别任务标注方法与实例&lt;/h4&gt;
&lt;h4 id=&#34;如何使用-mmcls-构建自己分类数据集&#34;&gt;如何使用 MMCLS 构建自己分类数据集&lt;/h4&gt;
&lt;h4 id=&#34;基于配置文件进行模型训练与测试任务&#34;&gt;基于配置文件进行模型训练与测试任务&lt;/h4&gt;
&lt;h4 id=&#34;可视化分析与评估指标生成方法&#34;&gt;可视化分析与评估指标生成方法&lt;/h4&gt;
&lt;h4 id=&#34;mmseg-图像分割模块核心功能解读&#34;&gt;MMSEG 图像分割模块核心功能解读&lt;/h4&gt;
&lt;h4 id=&#34;图像分割配置文件作用与功能解读&#34;&gt;图像分割配置文件作用与功能解读&lt;/h4&gt;
&lt;h4 id=&#34;图像分割标注方法与实例&#34;&gt;图像分割标注方法与实例&lt;/h4&gt;
&lt;h4 id=&#34;如何使用-mmseg-构建自己的分割数据集&#34;&gt;如何使用 MMSEG 构建自己的分割数据集&lt;/h4&gt;
&lt;h4 id=&#34;替换配置文件核心组件开启自己的实验任务&#34;&gt;替换配置文件核心组件开启自己的实验任务&lt;/h4&gt;
&lt;h4 id=&#34;cvpr-最新分割模块核心-backbone-解读&#34;&gt;CVPR 最新分割模块核心 backbone 解读&lt;/h4&gt;
&lt;h4 id=&#34;源码分析-mmseg-核心项目模块&#34;&gt;源码分析 MMSEG 核心项目模块&lt;/h4&gt;
&lt;h4 id=&#34;mmdet-物体检测模块核心功能解读&#34;&gt;MMDET 物体检测模块核心功能解读&lt;/h4&gt;
&lt;h4 id=&#34;物体检测配置文件作用与功能实例&#34;&gt;物体检测配置文件作用与功能实例&lt;/h4&gt;
&lt;h4 id=&#34;物体检测标注方法与应用实例&#34;&gt;物体检测标注方法与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;使用-mmdet-训练自己的数据集与任务&#34;&gt;使用 MMDET 训练自己的数据集与任务&lt;/h4&gt;
&lt;h4 id=&#34;deformable-detr-算法与论文分析&#34;&gt;Deformable DETR 算法与论文分析&lt;/h4&gt;
&lt;h4 id=&#34;deformable-detr-源码解读实战&#34;&gt;Deformable DETR 源码解读实战&lt;/h4&gt;
&lt;h4 id=&#34;mmocr-核心模块解读&#34;&gt;MMOCR 核心模块解读&lt;/h4&gt;
&lt;h4 id=&#34;ocr-中三大核心任务-检测-识别-抽取&#34;&gt;OCR 中三大核心任务:检测,识别,抽取&lt;/h4&gt;
&lt;h4 id=&#34;dbnet-文字检测算法与项目实战&#34;&gt;DBNET 文字检测算法与项目实战&lt;/h4&gt;
&lt;h4 id=&#34;aninet-文字识别算法与项目实战&#34;&gt;ANINET 文字识别算法与项目实战&lt;/h4&gt;
&lt;h4 id=&#34;kie-基于图模型的关键信息抽取算法及其实战&#34;&gt;KIE 基于图模型的关键信息抽取算法及其实战&lt;/h4&gt;
&lt;h4 id=&#34;mmgan-对抗生成网络核心模块解读&#34;&gt;MMGAN 对抗生成网络核心模块解读&lt;/h4&gt;
&lt;h4 id=&#34;stylegan-系列算法架构分析&#34;&gt;StyleGan 系列算法架构分析&lt;/h4&gt;
&lt;h4 id=&#34;stylegan-源码解读与应用&#34;&gt;StyleGan 源码解读与应用&lt;/h4&gt;
&lt;h4 id=&#34;mmedit-核心模块解读&#34;&gt;MMEDIT 核心模块解读&lt;/h4&gt;
&lt;h4 id=&#34;basicvsr-plus-plus-视频超分辨重构算法与论文分析&#34;&gt;BasicVSR++视频超分辨重构算法与论文分析&lt;/h4&gt;
&lt;h4 id=&#34;basucvsr-plus-plus-源码分析与网络架构解读&#34;&gt;BasucVSR++源码分析与网络架构解读&lt;/h4&gt;
&lt;h4 id=&#34;mmrazor-模型蒸馏与剪枝模块解读&#34;&gt;MMRAZOR 模型蒸馏与剪枝模块解读&lt;/h4&gt;
&lt;h4 id=&#34;模型蒸馏算法及其应用实例&#34;&gt;模型蒸馏算法及其应用实例&lt;/h4&gt;
&lt;h4 id=&#34;模型剪枝算法及其应用实例&#34;&gt;模型剪枝算法及其应用实例&lt;/h4&gt;
&lt;h3 id=&#34;行为识别实战&#34;&gt;行为识别实战&lt;/h3&gt;
&lt;h4 id=&#34;slowfast-算法知识点通俗解读&#34;&gt;slowfast 算法知识点通俗解读&lt;/h4&gt;
&lt;h4 id=&#34;slowfast-项目环境配置与配置文件&#34;&gt;slowfast 项目环境配置与配置文件&lt;/h4&gt;
&lt;h4 id=&#34;slowfast-源码详细解读&#34;&gt;slowfast 源码详细解读&lt;/h4&gt;
&lt;h4 id=&#34;基于-3d-卷积的视频分析与动作识别&#34;&gt;基于 3D 卷积的视频分析与动作识别&lt;/h4&gt;
&lt;h4 id=&#34;视频异常检测算法与元学习&#34;&gt;视频异常检测算法与元学习&lt;/h4&gt;
&lt;h4 id=&#34;cvpr2021-视频异常检测论文及其源码解读&#34;&gt;CVPR2021 视频异常检测论文及其源码解读&lt;/h4&gt;
&lt;h3 id=&#34;于-2022-论文必备-transformer-实战系列&#34;&gt;于 2022 论文必备-Transformer 实战系列&lt;/h3&gt;
&lt;h4 id=&#34;transformer-基本架构解读&#34;&gt;Transformer 基本架构解读&lt;/h4&gt;
&lt;h4 id=&#34;注意力机制的作用与效果分析&#34;&gt;注意力机制的作用与效果分析&lt;/h4&gt;
&lt;h4 id=&#34;源码解读-transformer-整体架构实现&#34;&gt;源码解读 Transformer 整体架构实现&lt;/h4&gt;
&lt;h4 id=&#34;transformer-在视觉中的应用-vit-算法&#34;&gt;Transformer 在视觉中的应用 VIT 算法&lt;/h4&gt;
&lt;h4 id=&#34;vit-分类-backbone-算法模型源码解读&#34;&gt;VIT 分类 Backbone 算法模型源码解读&lt;/h4&gt;
&lt;h4 id=&#34;swintransformer-算法原理解析&#34;&gt;SwinTransformer 算法原理解析&lt;/h4&gt;
&lt;h4 id=&#34;swintransformer-源码解读&#34;&gt;SwinTransformer 源码解读&lt;/h4&gt;
&lt;h4 id=&#34;基于-transformer-的-detr-目标检测算法&#34;&gt;基于 Transformer 的 Detr 目标检测算法&lt;/h4&gt;
&lt;h4 id=&#34;物体检测新型框架-detr-源码解读&#34;&gt;物体检测新型框架 Detr 源码解读&lt;/h4&gt;
&lt;h4 id=&#34;deformable-detr-算法与论文分析&#34;&gt;Deformable DETR 算法与论文分析&lt;/h4&gt;
&lt;h4 id=&#34;deformable-detr-源码分析与架构实现&#34;&gt;Deformable DETR 源码分析与架构实现&lt;/h4&gt;
&lt;h4 id=&#34;基于-transformer-的关键点匹配-loftr&#34;&gt;基于 Transformer 的关键点匹配 Loftr&lt;/h4&gt;
&lt;h4 id=&#34;商汤-loftr-源码解读与应用实例&#34;&gt;商汤 Loftr 源码解读与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;medical-transformer-应用于分割任务实例&#34;&gt;Medical Transformer 应用于分割任务实例&lt;/h4&gt;
&lt;h4 id=&#34;medical-transformer-源码分析与应用实例&#34;&gt;Medical Transformer 源码分析与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;informer-时间序列预测任务解读&#34;&gt;Informer 时间序列预测任务解读&lt;/h4&gt;
&lt;h4 id=&#34;informer-源码解读与应用实战&#34;&gt;Informer 源码解读与应用实战&lt;/h4&gt;
&lt;h4 id=&#34;基于-transformer-的-aninet-文字识别&#34;&gt;基于 Transformer 的 ANINET 文字识别&lt;/h4&gt;
&lt;h4 id=&#34;文字识别项目源码分析与应用实例&#34;&gt;文字识别项目源码分析与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;谷歌开源项目-bert-源码解读与应用实例&#34;&gt;谷歌开源项目 BERT 源码解读与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;bert-的中文情感分析实战&#34;&gt;BERT 的中文情感分析实战&lt;/h4&gt;
&lt;h4 id=&#34;最新热-transformer-论文与实战解读&#34;&gt;最新热⻔Transformer 论文与实战解读&lt;/h4&gt;
&lt;h3 id=&#34;图神经网络实战&#34;&gt;图神经网络实战&lt;/h3&gt;
&lt;h4 id=&#34;图模型应用领域分析概述&#34;&gt;图模型应用领域分析概述&lt;/h4&gt;
&lt;h4 id=&#34;图神经网络-gnn-原理与架构解读&#34;&gt;图神经网络 GNN 原理与架构解读&lt;/h4&gt;
&lt;h4 id=&#34;图卷积-gcn-模块构建与效果&#34;&gt;图卷积 GCN 模块构建与效果&lt;/h4&gt;
&lt;h4 id=&#34;图神经网络框架-pytorch-geometric-安装与配置&#34;&gt;图神经网络框架 PyTorch-Geometric 安装与配置&lt;/h4&gt;
&lt;h4 id=&#34;图神经网络框架-pytorch-geometric-应用实战&#34;&gt;图神经网络框架 PyTorch-Geometric 应用实战&lt;/h4&gt;
&lt;h4 id=&#34;使用-pytorch-geometric-搭建自己的图数据集&#34;&gt;使用 PyTorch-Geometric 搭建自己的图数据集&lt;/h4&gt;
&lt;h4 id=&#34;图注意力机制与图序列网络模型解读&#34;&gt;图注意力机制与图序列网络模型解读&lt;/h4&gt;
&lt;h4 id=&#34;图神经网络时间序列预测实战&#34;&gt;图神经网络时间序列预测实战&lt;/h4&gt;
&lt;h4 id=&#34;图相似度计算与匹配算法解读&#34;&gt;图相似度计算与匹配算法解读&lt;/h4&gt;
&lt;h4 id=&#34;化学分子相似度计算匹配实战&#34;&gt;化学分子相似度计算匹配实战&lt;/h4&gt;
&lt;h4 id=&#34;基于图模型的-vectornet-轨迹估计算法&#34;&gt;基于图模型的 VectorNet 轨迹估计算法&lt;/h4&gt;
&lt;h4 id=&#34;vectornet-应用实例与源码分析&#34;&gt;VectorNet 应用实例与源码分析&lt;/h4&gt;
&lt;h4 id=&#34;基于图模型的-kie-关键信息抽取&#34;&gt;基于图模型的 KIE 关键信息抽取&lt;/h4&gt;
&lt;h4 id=&#34;kie-算法与图模型构建实战解读&#34;&gt;KIE 算法与图模型构建实战解读&lt;/h4&gt;
&lt;h3 id=&#34;3d-点云实战&#34;&gt;3D 点云实战&lt;/h3&gt;
&lt;h4 id=&#34;3d-点云应用领域分析&#34;&gt;3D 点云应用领域分析&lt;/h4&gt;
&lt;h4 id=&#34;3d-点云-pointnet-算法&#34;&gt;3D 点云 PointNet 算法&lt;/h4&gt;
&lt;h4 id=&#34;pointnet-plus-plus-算法解读&#34;&gt;PointNet++算法解读&lt;/h4&gt;
&lt;h4 id=&#34;pointnet-plus-plus-项目实战&#34;&gt;Pointnet++项目实战&lt;/h4&gt;
&lt;h4 id=&#34;点云补全-pf-net-论文解读&#34;&gt;点云补全 PF-Net 论文解读&lt;/h4&gt;
&lt;h4 id=&#34;点云补全实战解读&#34;&gt;点云补全实战解读&lt;/h4&gt;
&lt;h4 id=&#34;点云配准及其案例实战&#34;&gt;点云配准及其案例实战&lt;/h4&gt;
&lt;h3 id=&#34;目标追踪与姿态估计实战&#34;&gt;目标追踪与姿态估计实战&lt;/h3&gt;
&lt;h4 id=&#34;姿态估计算法经典套路分析&#34;&gt;姿态估计算法经典套路分析&lt;/h4&gt;
&lt;h4 id=&#34;姿态估计-openpose-论文分析&#34;&gt;姿态估计 OpenPose 论文分析&lt;/h4&gt;
&lt;h4 id=&#34;姿态估计算法输出模块解读&#34;&gt;姿态估计算法输出模块解读&lt;/h4&gt;
&lt;h4 id=&#34;openpose-算法源码实战解读&#34;&gt;OpenPose 算法源码实战解读&lt;/h4&gt;
&lt;h4 id=&#34;目标追踪要完成的任务分析&#34;&gt;目标追踪要完成的任务分析&lt;/h4&gt;
&lt;h4 id=&#34;deepsort-算法知识点解读&#34;&gt;deepsort 算法知识点解读&lt;/h4&gt;
&lt;h4 id=&#34;卡尔曼滤波与状态估计实例&#34;&gt;卡尔曼滤波与状态估计实例&lt;/h4&gt;
&lt;h4 id=&#34;reid-在追踪任务中的作用&#34;&gt;REID 在追踪任务中的作用&lt;/h4&gt;
&lt;h4 id=&#34;deepsort-项目源码解读&#34;&gt;deepsort 项目源码解读&lt;/h4&gt;
&lt;h4 id=&#34;yolov5-与-deepsort-追踪实战&#34;&gt;YOLOV5 与 Deepsort 追踪实战&lt;/h4&gt;
&lt;h3 id=&#34;面向深度学习的无人驾驶实战&#34;&gt;面向深度学习的无人驾驶实战&lt;/h3&gt;
&lt;h4 id=&#34;深度估计算法及其原理解读&#34;&gt;深度估计算法及其原理解读&lt;/h4&gt;
&lt;h4 id=&#34;深度估计项目实战源码解读&#34;&gt;深度估计项目实战源码解读&lt;/h4&gt;
&lt;h4 id=&#34;道线检测论文及其算法实现&#34;&gt;⻋道线检测论文及其算法实现&lt;/h4&gt;
&lt;h4 id=&#34;基于深度学习的-道线检测项目实战&#34;&gt;基于深度学习的⻋道线检测项目实战&lt;/h4&gt;
&lt;h4 id=&#34;轨迹预测实例与特征空间解读&#34;&gt;轨迹预测实例与特征空间解读&lt;/h4&gt;
&lt;h4 id=&#34;基于-vectornet-进行估计估计实战&#34;&gt;基于 VectorNet 进行估计估计实战&lt;/h4&gt;
&lt;h4 id=&#34;特征点匹配方法原理与论文分析&#34;&gt;特征点匹配方法原理与论文分析&lt;/h4&gt;
&lt;h4 id=&#34;商汤最新特征点匹配算法实战&#34;&gt;商汤最新特征点匹配算法实战&lt;/h4&gt;
&lt;h4 id=&#34;三维重建算法原理分析&#34;&gt;三维重建算法原理分析&lt;/h4&gt;
&lt;h4 id=&#34;tsdf-方法应用与解读&#34;&gt;TSDF 方法应用与解读&lt;/h4&gt;
&lt;h4 id=&#34;商汤最新三维重建项目原理与源码解读&#34;&gt;商汤最新三维重建项目原理与源码解读&lt;/h4&gt;
&lt;h4 id=&#34;特斯拉无人驾驶项目分析与技术细节解读&#34;&gt;特斯拉无人驾驶项目分析与技术细节解读&lt;/h4&gt;
&lt;h3 id=&#34;对比学习与多模态任务实战&#34;&gt;对比学习与多模态任务实战&lt;/h3&gt;
&lt;h4 id=&#34;对比学习核心思想与应用领域分析&#34;&gt;对比学习核心思想与应用领域分析&lt;/h4&gt;
&lt;h4 id=&#34;对比学习经典算法原理与架构解读&#34;&gt;对比学习经典算法原理与架构解读&lt;/h4&gt;
&lt;h4 id=&#34;对比学习与多模态融合方法&#34;&gt;对比学习与多模态融合方法&lt;/h4&gt;
&lt;h4 id=&#34;clip-算法流程分析与应用实例&#34;&gt;Clip 算法流程分析与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;多模态-clip-算法模型源码解读&#34;&gt;多模态 Clip 算法模型源码解读&lt;/h4&gt;
&lt;h4 id=&#34;文本与视觉多模态任务结合分析&#34;&gt;文本与视觉多模态任务结合分析&lt;/h4&gt;
&lt;h4 id=&#34;abinet-文本与视觉融合-ocr-论文解读&#34;&gt;Abinet 文本与视觉融合 OCR 论文解读&lt;/h4&gt;
&lt;h4 id=&#34;文本视觉融合模型源码实战&#34;&gt;文本视觉融合模型源码实战&lt;/h4&gt;
&lt;h4 id=&#34;3d-点云与图像数据融合论文解读&#34;&gt;3D 点云与图像数据融合论文解读&lt;/h4&gt;
&lt;h4 id=&#34;3d-目标检测多模态融合源码解读与实例&#34;&gt;3D 目标检测多模态融合源码解读与实例&lt;/h4&gt;
&lt;h3 id=&#34;缺陷检测实战&#34;&gt;缺陷检测实战&lt;/h3&gt;
&lt;h4 id=&#34;物体检测框架-yolo-v4-版本算法解读&#34;&gt;物体检测框架 YOLO-V4 版本算法解读&lt;/h4&gt;
&lt;h4 id=&#34;物体检测框架-yolo-v5-版本项目配置&#34;&gt;物体检测框架 YOLO-V5 版本项目配置&lt;/h4&gt;
&lt;h4 id=&#34;物体检测框架-yolo-v5-项目工程源码解读&#34;&gt;物体检测框架 YOLO-V5 项目工程源码解读&lt;/h4&gt;
&lt;h4 id=&#34;基于-yolov5-的钢材缺陷检测实战&#34;&gt;基于 YOLOV5 的钢材缺陷检测实战&lt;/h4&gt;
&lt;h4 id=&#34;semi-supervised-布料缺陷检测实战&#34;&gt;Semi-supervised 布料缺陷检测实战&lt;/h4&gt;
&lt;h4 id=&#34;opnecv-图像常用处理方法实例&#34;&gt;Opnecv 图像常用处理方法实例&lt;/h4&gt;
&lt;h4 id=&#34;opnecv-梯度计算与边缘检测实例&#34;&gt;Opnecv 梯度计算与边缘检测实例&lt;/h4&gt;
&lt;h4 id=&#34;opnecv-轮廓检测与直方图&#34;&gt;Opnecv 轮廓检测与直方图&lt;/h4&gt;
&lt;h4 id=&#34;基于-opnecv-缺陷检测项目实战&#34;&gt;基于 Opnecv 缺陷检测项目实战&lt;/h4&gt;
&lt;h4 id=&#34;基于视频流水线的-opnecv-缺陷检测项目&#34;&gt;基于视频流水线的 Opnecv 缺陷检测项目&lt;/h4&gt;
&lt;h4 id=&#34;图像分割-deeplab-系列算法&#34;&gt;图像分割 deeplab 系列算法&lt;/h4&gt;
&lt;h4 id=&#34;基于-deeplabv3-plus-版本进行-voc-分割实战&#34;&gt;基于 deeplabV3+版本进行 VOC 分割实战&lt;/h4&gt;
&lt;h4 id=&#34;deeplab-铁质材料缺陷检测与开源项目应用流程&#34;&gt;Deeplab 铁质材料缺陷检测与开源项目应用流程&lt;/h4&gt;
&lt;h3 id=&#34;行人重识别实战&#34;&gt;行人重识别实战&lt;/h3&gt;
&lt;h4 id=&#34;行人重识别原理及其应用&#34;&gt;行人重识别原理及其应用&lt;/h4&gt;
&lt;h4 id=&#34;基于注意力机制的-reid-模型论文解读&#34;&gt;基于注意力机制的 ReId 模型论文解读&lt;/h4&gt;
&lt;h4 id=&#34;基于-attention-的行人重识别项目实战&#34;&gt;基于 Attention 的行人重识别项目实战&lt;/h4&gt;
&lt;h4 id=&#34;aaai-顶会算法与论文精讲&#34;&gt;AAAI 顶会算法与论文精讲&lt;/h4&gt;
&lt;h4 id=&#34;基于行人局部特征融合的再识别实战&#34;&gt;基于行人局部特征融合的再识别实战&lt;/h4&gt;
&lt;h4 id=&#34;旷视研究院最新算法解读--基于图模型&#34;&gt;旷视研究院最新算法解读(基于图模型)&lt;/h4&gt;
&lt;h4 id=&#34;基于拓扑图的行人重识别项目实战&#34;&gt;基于拓扑图的行人重识别项目实战&lt;/h4&gt;
&lt;h4 id=&#34;cvpr-最新行人搜索算法与应用实例&#34;&gt;CVPR 最新行人搜索算法与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;行人搜索项目源码解读与效果分析&#34;&gt;行人搜索项目源码解读与效果分析&lt;/h4&gt;
&lt;h3 id=&#34;对抗生成网络实战&#34;&gt;对抗生成网络实战&lt;/h3&gt;
&lt;h4 id=&#34;对抗生成网络架构原理与实战解析&#34;&gt;对抗生成网络架构原理与实战解析&lt;/h4&gt;
&lt;h4 id=&#34;基于-cyclegan-开源项目实战图像合成&#34;&gt;基于 CycleGan 开源项目实战图像合成&lt;/h4&gt;
&lt;h4 id=&#34;stargan-论文架构解析&#34;&gt;stargan 论文架构解析&lt;/h4&gt;
&lt;h4 id=&#34;stargan-项目实战及其源码解读&#34;&gt;stargan 项目实战及其源码解读&lt;/h4&gt;
&lt;h4 id=&#34;基于-starganvc2-的变声器论文原理解读&#34;&gt;基于 starganvc2 的变声器论文原理解读&lt;/h4&gt;
&lt;h4 id=&#34;starganvc2-变声器项目实战及其源码解读&#34;&gt;starganvc2 变声器项目实战及其源码解读&lt;/h4&gt;
&lt;h4 id=&#34;图像超分辨率重构实战&#34;&gt;图像超分辨率重构实战&lt;/h4&gt;
&lt;h4 id=&#34;基于-gan-的图像补全实战&#34;&gt;基于 GAN 的图像补全实战&lt;/h4&gt;
&lt;h4 id=&#34;stylegan-人脸合成算法解读&#34;&gt;StyleGan 人脸合成算法解读&lt;/h4&gt;
&lt;h4 id=&#34;stylegan-项目源码解读实例&#34;&gt;StyleGan 项目源码解读实例&lt;/h4&gt;
&lt;h4 id=&#34;basicvsr-plus-plus-视频超分辨重构算法解读&#34;&gt;BasicVSR++视频超分辨重构算法解读&lt;/h4&gt;
&lt;h4 id=&#34;basicvsr-plus-plus-项目源码实战&#34;&gt;BasicVSR++项目源码实战&lt;/h4&gt;
&lt;h3 id=&#34;强化学习实战系列&#34;&gt;强化学习实战系列&lt;/h3&gt;
&lt;h4 id=&#34;强化学习简介及其应用&#34;&gt;强化学习简介及其应用&lt;/h4&gt;
&lt;h4 id=&#34;ppo-算法与公式推导&#34;&gt;PPO 算法与公式推导&lt;/h4&gt;
&lt;h4 id=&#34;ppo-实战-月球登陆器训练实例&#34;&gt;PPO 实战-月球登陆器训练实例&lt;/h4&gt;
&lt;h4 id=&#34;q-learning-与-dqn-算法&#34;&gt;Q-learning 与 DQN 算法&lt;/h4&gt;
&lt;h4 id=&#34;dqn-算法实例演示&#34;&gt;DQN 算法实例演示&lt;/h4&gt;
&lt;h4 id=&#34;dqn-改进与应用技巧&#34;&gt;DQN 改进与应用技巧&lt;/h4&gt;
&lt;h4 id=&#34;actor-critic-算法分析--a3c&#34;&gt;Actor-Critic 算法分析(A3C)&lt;/h4&gt;
&lt;h4 id=&#34;用-a3c-玩转超级-里奥&#34;&gt;用 A3C 玩转超级⻢里奥&lt;/h4&gt;
&lt;h3 id=&#34;openai-顶级黑科技算法及其项目实战&#34;&gt;Openai 顶级黑科技算法及其项目实战&lt;/h3&gt;
&lt;h4 id=&#34;openai-生成模型-gpt-系列算法解读&#34;&gt;Openai 生成模型 GPT 系列算法解读&lt;/h4&gt;
&lt;h4 id=&#34;gpt-架构实现与生成模型训练源码分析&#34;&gt;GPT 架构实现与生成模型训练源码分析&lt;/h4&gt;
&lt;h4 id=&#34;文本与视觉融合模型-clip-原理架构分析&#34;&gt;文本与视觉融合模型 CLIP 原理架构分析&lt;/h4&gt;
&lt;h4 id=&#34;diffusion-扩散模型算法思想解读&#34;&gt;Diffusion 扩散模型算法思想解读&lt;/h4&gt;
&lt;h4 id=&#34;扩散模型与-gan-对比分析及其公式推导&#34;&gt;扩散模型与 GAN 对比分析及其公式推导&lt;/h4&gt;
&lt;h4 id=&#34;扩散模型源码实现与效果分析&#34;&gt;扩散模型源码实现与效果分析&lt;/h4&gt;
&lt;h4 id=&#34;黑科技算法-dalle-系列基本原理与架构分析&#34;&gt;黑科技算法 Dalle 系列基本原理与架构分析&lt;/h4&gt;
&lt;h4 id=&#34;dalle2-源码解读及其应用流程实现&#34;&gt;Dalle2 源码解读及其应用流程实现&lt;/h4&gt;
&lt;h3 id=&#34;面向医学领域的深度学习实战&#34;&gt;面向医学领域的深度学习实战&lt;/h3&gt;
&lt;h4 id=&#34;卷积神经网络原理与参数解读&#34;&gt;卷积神经网络原理与参数解读&lt;/h4&gt;
&lt;h4 id=&#34;pytorch-框架基本处理操作&#34;&gt;PyTorch 框架基本处理操作&lt;/h4&gt;
&lt;h4 id=&#34;pytorch-框架必备核心模块解读&#34;&gt;PyTorch 框架必备核心模块解读&lt;/h4&gt;
&lt;h4 id=&#34;基于-resnet-的医学数据集分类实战&#34;&gt;基于 Resnet 的医学数据集分类实战&lt;/h4&gt;
&lt;h4 id=&#34;图像分割及其损失函数概述&#34;&gt;图像分割及其损失函数概述&lt;/h4&gt;
&lt;h4 id=&#34;unet-系列算法讲解&#34;&gt;Unet 系列算法讲解&lt;/h4&gt;
&lt;h4 id=&#34;unet-医学细胞分割实战&#34;&gt;Unet 医学细胞分割实战&lt;/h4&gt;
&lt;h4 id=&#34;deeplab-系列算法&#34;&gt;deeplab 系列算法&lt;/h4&gt;
&lt;h4 id=&#34;基于-deeplabv3-plus-版本进行-voc-分割实战&#34;&gt;基于 deeplabV3+版本进行 VOC 分割实战&lt;/h4&gt;
&lt;h4 id=&#34;基于-deeplab-的心脏视频数据诊断分析&#34;&gt;基于 deeplab 的心脏视频数据诊断分析&lt;/h4&gt;
&lt;h4 id=&#34;yolo-系列物体检测算法原理解读&#34;&gt;YOLO 系列物体检测算法原理解读&lt;/h4&gt;
&lt;h4 id=&#34;基于-yolo5-细胞检测实战&#34;&gt;基于 YOLO5 细胞检测实战&lt;/h4&gt;
&lt;h4 id=&#34;知识图谱原理解读&#34;&gt;知识图谱原理解读&lt;/h4&gt;
&lt;h4 id=&#34;neo4j-数据库实战&#34;&gt;Neo4j 数据库实战&lt;/h4&gt;
&lt;h4 id=&#34;基于知识图谱的医药问答系统实战&#34;&gt;基于知识图谱的医药问答系统实战&lt;/h4&gt;
&lt;h4 id=&#34;词向量模型与-rnn-网络架构&#34;&gt;词向量模型与 RNN 网络架构&lt;/h4&gt;
&lt;h4 id=&#34;医学糖尿病数据命名实体识别&#34;&gt;医学糖尿病数据命名实体识别&lt;/h4&gt;
&lt;h3 id=&#34;深度学习模型部署与剪枝优化实战&#34;&gt;深度学习模型部署与剪枝优化实战&lt;/h3&gt;
&lt;h4 id=&#34;pytorch-框架部署实践&#34;&gt;PyTorch 框架部署实践&lt;/h4&gt;
&lt;h4 id=&#34;yolo-物体检测部署实例&#34;&gt;YOLO 物体检测部署实例&lt;/h4&gt;
&lt;h4 id=&#34;docker-实例演示&#34;&gt;docker 实例演示&lt;/h4&gt;
&lt;h4 id=&#34;tensorflflow-serving-实战&#34;&gt;tensorflflow-serving 实战&lt;/h4&gt;
&lt;h4 id=&#34;模型减枝-networkslimming-算法分析&#34;&gt;模型减枝-NetworkSlimming 算法分析&lt;/h4&gt;
&lt;h4 id=&#34;模型减枝-networkslimming-实战解读&#34;&gt;模型减枝-NetworkSlimming 实战解读&lt;/h4&gt;
&lt;h4 id=&#34;轻量化模型-mobilenet-三代网络模型架构&#34;&gt;轻量化模型 Mobilenet 三代网络模型架构&lt;/h4&gt;
&lt;h4 id=&#34;mobilenet-系列源码与应用实例&#34;&gt;Mobilenet 系列源码与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;模型蒸馏算法与应用实例&#34;&gt;模型蒸馏算法与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;模型蒸馏在分割任务中的实战&#34;&gt;模型蒸馏在分割任务中的实战&lt;/h4&gt;
&lt;h4 id=&#34;模型加速与格式转换实战&#34;&gt;模型加速与格式转换实战&lt;/h4&gt;
&lt;h4 id=&#34;cv-各领域经典项目部署实例&#34;&gt;CV 各领域经典项目部署实例&lt;/h4&gt;
&lt;h2 id=&#34;自然语言处理算法及其项目实战&#34;&gt;自然语言处理算法及其项目实战&lt;/h2&gt;
&lt;h3 id=&#34;自然语言处理经典案例实战&#34;&gt;自然语言处理经典案例实战&lt;/h3&gt;
&lt;h4 id=&#34;nlp-常用工具包实战&#34;&gt;NLP 常用工具包实战&lt;/h4&gt;
&lt;h4 id=&#34;商品信息可视化与文本分析&#34;&gt;商品信息可视化与文本分析&lt;/h4&gt;
&lt;h4 id=&#34;叶斯算法&#34;&gt;⻉叶斯算法&lt;/h4&gt;
&lt;h4 id=&#34;新闻分类任务实战&#34;&gt;新闻分类任务实战&lt;/h4&gt;
&lt;h4 id=&#34;hmm-隐-尔科夫模型&#34;&gt;HMM 隐⻢尔科夫模型&lt;/h4&gt;
&lt;h4 id=&#34;hmm-工具包实战&#34;&gt;HMM 工具包实战&lt;/h4&gt;
&lt;h4 id=&#34;语言模型&#34;&gt;语言模型&lt;/h4&gt;
&lt;h4 id=&#34;使用-gemsim-构建词向量&#34;&gt;使用 Gemsim 构建词向量&lt;/h4&gt;
&lt;h4 id=&#34;基于-word2vec-的分类任务&#34;&gt;基于 word2vec 的分类任务&lt;/h4&gt;
&lt;h4 id=&#34;nlp-文本特征方法对比&#34;&gt;NLP-文本特征方法对比&lt;/h4&gt;
&lt;h4 id=&#34;nlp-相似度模型&#34;&gt;NLP-相似度模型&lt;/h4&gt;
&lt;h4 id=&#34;lstm-情感分析&#34;&gt;LSTM 情感分析&lt;/h4&gt;
&lt;h4 id=&#34;机器人写唐诗&#34;&gt;机器人写唐诗&lt;/h4&gt;
&lt;h4 id=&#34;对话机器人&#34;&gt;对话机器人&lt;/h4&gt;
&lt;h3 id=&#34;自然语言处理必备神器-huggingface-系列实战&#34;&gt;自然语言处理必备神器 Huggingface 系列实战&lt;/h3&gt;
&lt;h4 id=&#34;huggingface-为-nlp-领域带来的变革与价值&#34;&gt;Huggingface 为 NLP 领域带来的变革与价值&lt;/h4&gt;
&lt;h4 id=&#34;huggingface-各核心模块使用方法及其应用流程&#34;&gt;Huggingface 各核心模块使用方法及其应用流程&lt;/h4&gt;
&lt;h4 id=&#34;mlm-完形填空任务解读及其训练应用实例&#34;&gt;MLM 完形填空任务解读及其训练应用实例&lt;/h4&gt;
&lt;h4 id=&#34;文本摘要任务构建流程及其训练测试实例&#34;&gt;文本摘要任务构建流程及其训练测试实例&lt;/h4&gt;
&lt;h4 id=&#34;预训练模型的作用及其下游任务微调方法&#34;&gt;预训练模型的作用及其下游任务微调方法&lt;/h4&gt;
&lt;h4 id=&#34;文本标注工具应用与各领域-nlp-任务标注实例&#34;&gt;文本标注工具应用与各领域 NLP 任务标注实例&lt;/h4&gt;
&lt;h4 id=&#34;谷歌-bert-系列经典模型架构及其应用分析&#34;&gt;谷歌 BERT 系列经典模型架构及其应用分析&lt;/h4&gt;
&lt;h4 id=&#34;openai-系列经典模型架构及其应用分析&#34;&gt;Openai 系列经典模型架构及其应用分析&lt;/h4&gt;
&lt;h4 id=&#34;文本生成模型-gpt-算法应用实例&#34;&gt;文本生成模型 GPT 算法应用实例&lt;/h4&gt;
&lt;h4 id=&#34;作文与小说生成模型源码解读及其项目实战&#34;&gt;作文与小说生成模型源码解读及其项目实战&lt;/h4&gt;
&lt;h4 id=&#34;ner-命名实体识别项目流程及其应用实例&#34;&gt;NER 命名实体识别项目流程及其应用实例&lt;/h4&gt;
&lt;h4 id=&#34;如何训练自己的标注数据-格式转换实例&#34;&gt;如何训练自己的标注数据,格式转换实例&lt;/h4&gt;
&lt;h4 id=&#34;文本实体抽取与关系抽取算法与模型解读&#34;&gt;文本实体抽取与关系抽取算法与模型解读&lt;/h4&gt;
&lt;h4 id=&#34;实体与关系抽取项目源码解读分析&#34;&gt;实体与关系抽取项目源码解读分析&lt;/h4&gt;
&lt;h3 id=&#34;自然语言处理通用框架-bert-实战&#34;&gt;自然语言处理通用框架-BERT 实战&lt;/h3&gt;
&lt;h4 id=&#34;自然语言处理通用框架-bert-原理解读&#34;&gt;自然语言处理通用框架 BERT 原理解读&lt;/h4&gt;
&lt;h4 id=&#34;谷歌开源项目-bert-源码解读与应用实例&#34;&gt;谷歌开源项目 BERT 源码解读与应用实例&lt;/h4&gt;
&lt;h4 id=&#34;项目实战-基于-bert-的中文情感分析实战&#34;&gt;项目实战-基于 BERT 的中文情感分析实战&lt;/h4&gt;
&lt;h4 id=&#34;项目实战-基于-bert-的中文命名实体识别实战&#34;&gt;项目实战-基于 BERT 的中文命名实体识别实战&lt;/h4&gt;
&lt;h4 id=&#34;必备基知识点-word2vec-模型通俗解读&#34;&gt;必备基知识点-word2vec 模型通俗解读&lt;/h4&gt;
&lt;h4 id=&#34;必备基础-掌握-tensorflow-如何&#34;&gt;必备基础-掌握 Tensorflow 如何&lt;/h4&gt;
&lt;h4 id=&#34;必备基础知识点-rnn-网络架构与情感&#34;&gt;必备基础知识点-RNN 网络架构与情感&lt;/h4&gt;
&lt;h4 id=&#34;医学糖尿病数据命名实体识别&#34;&gt;医学糖尿病数据命名实体识别&lt;/h4&gt;
&lt;h3 id=&#34;知识图谱实战系列&#34;&gt;知识图谱实战系列&lt;/h3&gt;
&lt;h4 id=&#34;知识图谱介绍及其应用领域分析&#34;&gt;知识图谱介绍及其应用领域分析&lt;/h4&gt;
&lt;h4 id=&#34;知识图谱涉及技术点分析&#34;&gt;知识图谱涉及技术点分析&lt;/h4&gt;
&lt;h4 id=&#34;neo4j-数据库实战&#34;&gt;Neo4j 数据库实战&lt;/h4&gt;
&lt;h4 id=&#34;使用-python-操作-neo4j-实例&#34;&gt;使用 python 操作 neo4j 实例&lt;/h4&gt;
&lt;h4 id=&#34;基于知识图谱的医药问答系统实战&#34;&gt;基于知识图谱的医药问答系统实战&lt;/h4&gt;
&lt;h4 id=&#34;文本关系抽取实践&#34;&gt;文本关系抽取实践&lt;/h4&gt;
&lt;h4 id=&#34;金融平台-控模型实践&#34;&gt;金融平台⻛控模型实践&lt;/h4&gt;
&lt;h4 id=&#34;医学糖尿病数据命名实体识别&#34;&gt;医学糖尿病数据命名实体识别&lt;/h4&gt;
&lt;h3 id=&#34;语音识别实战系列&#34;&gt;语音识别实战系列&lt;/h3&gt;
&lt;h4 id=&#34;seq2seq-序列网络模型&#34;&gt;seq2seq 序列网络模型&lt;/h4&gt;
&lt;h4 id=&#34;las-模型语音识别实战&#34;&gt;LAS 模型语音识别实战&lt;/h4&gt;
&lt;h4 id=&#34;starganvc2-变声器论文原理解读&#34;&gt;starganvc2 变声器论文原理解读&lt;/h4&gt;
&lt;h4 id=&#34;starganvc2-变声器源码实战&#34;&gt;starganvc2 变声器源码实战&lt;/h4&gt;
&lt;h4 id=&#34;语音分离-convtasnet-模型&#34;&gt;语音分离 ConvTasnet 模型&lt;/h4&gt;
&lt;h4 id=&#34;convtasnet-语音分离实战&#34;&gt;ConvTasnet 语音分离实战&lt;/h4&gt;
&lt;h4 id=&#34;语音合成-tacotron-最新版实战&#34;&gt;语音合成 tacotron 最新版实战&lt;/h4&gt;
&lt;h3 id=&#34;推荐系统实战系列&#34;&gt;推荐系统实战系列&lt;/h3&gt;
&lt;h4 id=&#34;推荐系统介绍及其应用&#34;&gt;推荐系统介绍及其应用&lt;/h4&gt;
&lt;h4 id=&#34;协同过滤与矩阵分解&#34;&gt;协同过滤与矩阵分解&lt;/h4&gt;
&lt;h4 id=&#34;音乐推荐系统实战&#34;&gt;音乐推荐系统实战&lt;/h4&gt;
&lt;h4 id=&#34;知识图谱与-neo4j-数据库实例&#34;&gt;知识图谱与 Neo4j 数据库实例&lt;/h4&gt;
&lt;h4 id=&#34;基于知识图谱的电影推荐实战&#34;&gt;基于知识图谱的电影推荐实战&lt;/h4&gt;
&lt;h4 id=&#34;点击率估计-fm-与-deepfm-算法&#34;&gt;点击率估计 FM 与 DeepFM 算法&lt;/h4&gt;
&lt;h4 id=&#34;deepfm-算法实战&#34;&gt;DeepFM 算法实战&lt;/h4&gt;
&lt;h4 id=&#34;推荐系统常用工具包演示&#34;&gt;推荐系统常用工具包演示&lt;/h4&gt;
&lt;h4 id=&#34;基于文本数据的推荐实例&#34;&gt;基于文本数据的推荐实例&lt;/h4&gt;
&lt;h4 id=&#34;基于统计分析的电影推荐&#34;&gt;基于统计分析的电影推荐&lt;/h4&gt;
&lt;h4 id=&#34;基于相似度的酒店推荐系统&#34;&gt;基于相似度的酒店推荐系统&lt;/h4&gt;
</description>
        </item>
        <item>
        <title>2023年软考报名</title>
        <link>https://guolongji.xyz/post/ruankao-sign-up/</link>
        <pubDate>Wed, 20 Sep 2023 15:56:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/ruankao-sign-up/</guid>
        <description>&lt;h2 id=&#34;软考报名&#34;&gt;软考报名&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://rsj.beijing.gov.cn/ywsite/bjpta/zcwj/2023zc/202309/P020230919491905692213.pdf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://rsj.beijing.gov.cn/ywsite/bjpta/zcwj/2023zc/202309/P020230919491905692213.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;9 月 21 日到 27 日报名缴费。报名费 57 元。&lt;/p&gt;
&lt;p&gt;10 月 24 日到 27 日打印准考证。&lt;/p&gt;
&lt;p&gt;11 月 4 日到 5 日考试。&lt;/p&gt;
&lt;p&gt;12 月中旬登录中国计算机技术职业资格网查询考试成绩。&lt;/p&gt;
&lt;p&gt;其中我比较想考的是“系统架构设计师”和“网络规划设计师”，另外一个是管理类的垃圾科目。&lt;/p&gt;
&lt;p&gt;其中网络规划设计师比较难考：
&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/561423876&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/561423876&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;但是有人说网规的含金量是最低的：
&lt;a class=&#34;link&#34; href=&#34;https://blog.51cto.com/cisco2600/235833&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.51cto.com/cisco2600/235833&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;需要买的书：&lt;/p&gt;
&lt;p&gt;拼多多上“系统架构设计师”，只需要 80 元，包含所有的内容。基本是可以考过的。而且可以免税 3600 元。这是鼓励我学习啊。可以。这个名我决定要报了。&lt;/p&gt;
&lt;p&gt;还有补贴，考过了就是真金白银的赚到了。所以，学一学肯定是没有啥坏处的。一次考过终生有效。&lt;/p&gt;
&lt;p&gt;考试大纲和书籍从这里面找：
&lt;a class=&#34;link&#34; href=&#34;https://www.ruankao.org.cn&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.ruankao.org.cn&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;看了一下其中的内容，大部分还是多少感些兴趣的内容。综上所述，这个试一定要考。和工作居住证一样，考比不考强。就是这么个结论。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>linux上用docker搭建opengrok</title>
        <link>https://guolongji.xyz/post/linux-opengrok-read-kernel/</link>
        <pubDate>Wed, 20 Sep 2023 14:05:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/linux-opengrok-read-kernel/</guid>
        <description>&lt;p&gt;之前在 21 年底用 latex 写了这篇文章，导出了 pdf，后觉得有用，移到博客当中，方便以后查看。
23 年了 opengrok 可能有新的版本了，但是 21 年的版本也不算旧。折腾一次花的时间也挺长的。&lt;/p&gt;
&lt;h2 id=&#34;主机搭建&#34;&gt;主机搭建&lt;/h2&gt;
&lt;p&gt;在物理机上搭建 opengrok 的过程比较简单。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install openjdk-11-jdk
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; ~
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir opengrok-install
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; opengrok-install
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install universal-ctags
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install git
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 加速下载:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget http://shrill-pond-3e81.hunsh.workers.dev/https://github.com/oracle/opengro
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;k/releases/download/1.7.26/opengrok-1.7.26.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tar zxvf opengrok-1.7.26.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://dlcdn.apache.org/tomcat/tomcat-10/v10.0.14/bin/apache-tomcat-10.0.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;4.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tar zxvf apache-tomcat-10.0.14.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo -s
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cp -r apache-tomcat-10.0.14 /tomcat
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cp -r opengrok-1.7.26 /opengrok
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;chown -R uos:uos tomcat/ opengrok/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir /opengrok/&lt;span style=&#34;color:#ff79c6&#34;&gt;{&lt;/span&gt;src,data,dist,etc,log&lt;span style=&#34;color:#ff79c6&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 使用默认日志配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cp /opengrok/doc/logging.properties /opengrok/etc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 使用修改的日志配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat&amp;gt;/opengrok/etc/logging.properties&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;handlers= java.util.logging.FileHandler, java.util.logging.ConsoleHandler
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;java.util.logging.FileHandler.pattern = /opengrok/log/opengrok%g.%u.log
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;java.util.logging.FileHandler.append = false
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;java.util.logging.FileHandler.limit = 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;java.util.logging.FileHandler.count = 30
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;java.util.logging.FileHandler.level = ALL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;java.util.logging.FileHandler.formatter = org.opengrok.indexer.logger.formatter.SimpleFileLogFormatter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;java.util.logging.ConsoleHandler.level = WARNING
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;java.util.logging.ConsoleHandler.formatter = org.opengrok.indexer.logger.formatter.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;SimpleFileLogFormatter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;org.opengrok.level = FINE
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;EOF&lt;/span&gt;cd /opengrok/lib
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cp source.war /tomcat/webapps/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; /tomcat/bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sh startup.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 此时,打开浏览器输入 http://ip:8080/source 会显示报错。但是已安装完成,需要索引项目代码。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; /opengrok/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat&amp;gt;index.sh&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;java -Xmx8g \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;-Djava.util.logging.config.file=/opengrok/etc/logging.properties \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;-DSYNC_PERIOD_MINUTES=&amp;#34;60&amp;#34; \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;-DOPENGROK_SCAN_REPOS=false \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;-DOPENGROK_GENERATE_HISTORY=off \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;-jar /opengrok/lib/opengrok.jar \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;-c /usr/bin/ctags \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;-s /opengrok/src/ -d /opengrok/data -H -P -S -G \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;-W /opengrok/etc/configuration.xml -U http://localhost:8080/source \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;-m 512
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# SYNC_PERIOD_MINUTES这个环境变量是opengrok docker镜像的,上述命令中无用,可以去掉&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# -Xmx8g:配置Java 最大堆内存为8g,防止内存溢出。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# -jar:指定opengrok.jar包。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# -c:指定universal-ctags的路径&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# -s:指定源码路径,就是上面的新建的src。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# -d:指定索引文件存放路径,就是上面新建的data。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# -W:指定configuration.xml的路径,就是上面新建的etc。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# -m:指定opengrok索引时的缓存大小,默认只有16M。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;### 注意此步骤需要手动修改后执行&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# ln -s 内核代码目录 /opengrok/src/项目名称&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# ...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 多个项目必需使用符号链接,否则出错。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;###&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;chmod u+x index.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./index.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 等待若干时间后(日志记录在/opengrok/log/中,出现finish结束),打开浏览器输入&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;http://ip:8080/source
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;强烈建议有兴趣的同事研究以下 opengrok 这个项目的架构和实现。&lt;/p&gt;
&lt;h2 id=&#34;docker-搭建&#34;&gt;docker 搭建&lt;/h2&gt;
&lt;p&gt;使用 docker 搭建,opengrok 官网在 dockerhub(&lt;a class=&#34;link&#34; href=&#34;https://hub.docker.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://hub.docker.com/&lt;/a&gt;)提供了简化版本的镜像工具,可以通过:docker pull opengrok/docker 来拉取,实际上对于 linux kernel 和 AOSP(Android Open Source Project)不可用。&lt;/p&gt;
&lt;p&gt;需要自己实现镜像,使用 dockerfile 或者 compose 编排工具。&lt;/p&gt;
&lt;p&gt;有两个实现可以参考,但是这两个都是几年前的实现。&lt;/p&gt;
&lt;p&gt;实现一:&lt;a class=&#34;link&#34; href=&#34;https://github.com/ffgiff/opengrok-docker&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/ffgiff/opengrok-docker&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;实现二:&lt;a class=&#34;link&#34; href=&#34;https://github.com/thombashi/docker-opengrok&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/thombashi/docker-opengrok&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;另外,docker 的相关知识和 dockerfile 的多阶段构建可以参考:&lt;a class=&#34;link&#34; href=&#34;https://yeasy.gitbook.io/docker_practice,%E5%81%9A%E5%A5%BD&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://yeasy.gitbook.io/docker_practice,%E5%81%9A%E5%A5%BD&lt;/a&gt;
后可以镜像上传到 docker 仓库。&lt;/p&gt;
&lt;p&gt;原材料是 tomcat:10.0-jre11-temurin-focal,安装 universal-ctags,git,opengrok 通用二进制包,配置 dockerfile
中的 CMD 和 VOLUME。docker build 生成镜像。拉取镜像,放入项目符号链接。启动 docker 容器,等待一段时间。完成。&lt;/p&gt;
&lt;p&gt;安装 docker:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo groupadd docker
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo gpasswd -a &lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;USER&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt; docker
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo service docker restart
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo chmod a+rw /var/run/docker.sock
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo -s
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat&amp;gt;/etc/docker/daemon.json&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;registry-mirrors&amp;#34; : [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;https://registry.docker-cn.com&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;https://docker.mirrors.ustc.edu.cn&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;http://hub-mirror.c.163.com&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;https://cr.console.aliyun.com/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 重启docker服务使配置生效&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart docker.service
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 验证&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# docker pull tomcat:10.0-jre11-temurin-focal&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# docker run -it tomcat:10.0-jre11-temurin-focal /bin/bash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;docker 中的 EXPOSE 和 LABEL 分别是什么含义。&lt;/p&gt;
&lt;p&gt;LABEL:添加元数据。&lt;/p&gt;
&lt;p&gt;EXPOSE:暴露端口,只是声名。&lt;/p&gt;
&lt;p&gt;WORKING:使用 WORKDIR 指令可以来指定工作目录(或者称为当前目录),以后各层的当前目录就被改为指定的目录,如该目录不存在,WORKDIR 会帮你建立目录。&lt;/p&gt;
&lt;p&gt;universal_ctags_installer.sh 如下:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#!/usr/bin/env shset -ex
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;dist&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;curr_dir&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;pwd&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;work_dir&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;$(&lt;/span&gt;mktemp --directory&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$work_dir&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git clone https://github.com.cnpmjs.org/universal-ctags/ctags.git
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; ctags
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./autogen.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$dist&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt;; &lt;span style=&#34;color:#ff79c6&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./configure
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./configure --prefix&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$dist&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;make -j2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;make install
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;cd&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$curr_dir&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rm -rf &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$work_dir&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;dockerfile 如下:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;FROM buildpack-deps:stretch-scm AS ctags-builder
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;LABEL &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;maintainer&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;Allinaent &amp;lt;1909943253@qq.com&amp;gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;LABEL &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;envrefresh_date&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;2021-01-24&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN mv /etc/apt/sources.list /etc/apt/sources.list.bak &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/debian/ stretch main non-free contrib&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/apt/sources.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/debian/ stretch main non-free contrib&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/apt/sources.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/debian-security stretch/updates main&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/apt/sources.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/debian-security stretch/updates main&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/apt/sources.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/debian/ stretch-updates main non-free contrib&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/apt/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/debian/ stretch-updates main non-free contrib&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/apt/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/debian/ stretch-backports main non-free contrib&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/apt/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/debian/ stretch-backports main non-free contrib&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apt/sources.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN apt-get update &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get install -y --no-install-recommends &lt;span style=&#34;color:#f1fa8c&#34;&gt;\a&lt;/span&gt;utoconf &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;automake &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;gcc &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;libc6-dev &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;make &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;pkg-config &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; rm -rf /var/lib/apt/lists/*
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;COPY universal_ctags_installer.sh /usr/local/bin/universal_ctags_installer
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN chmod &lt;span style=&#34;color:#bd93f9&#34;&gt;544&lt;/span&gt; /usr/local/bin/universal_ctags_installer
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# CMD [&amp;#34;universal_ctags_installer&amp;#34;, &amp;#34;/dist&amp;#34;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# dockerfile中的CMD命令 CMD [&amp;#34;&amp;lt;可执行文件或命令&amp;gt;&amp;#34;,&amp;#34;&amp;lt;param1&amp;gt;&amp;#34;,&amp;#34;&amp;lt;param2&amp;gt;&amp;#34;,...]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;universal_ctags_installer&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;/dist&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# build universal ctags --------------------------------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# FROM thombashi/universal-ctags-installer:latest AS ctags-builder&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# WORKDIR /dist&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# RUN universal_ctags_installer /dist&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# launch opengrok --------------------------------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;From tomcat:jre11-temurin-focal
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# LABEL maintainer=&amp;#34;Allinaent &amp;lt;1909943253@qq.com&amp;gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;COPY --from&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;ctags-builder /dist/bin/ctags /usr/local/bin/ctags
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ENV OPENGROK_VERSION 1.7.26
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ENV OPENGROK_INSTANCE_BASE /opengrok
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ENV OPENGROK_SRC_ROOT /opengrok/src
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ENV OPENGROK_TOMCAT_BASE /usr/local/tomcat
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ENV CATALINA_BASE /usr/local/tomcat
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ENV CATALINA_HOME /usr/local/tomcat
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ENV CATALINA_TMPDIR /usr/local/tomcat/temp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# ENV JRE_HOME /usr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ENV CLASSPATH /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# RUN sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 换源&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN mv /etc/apt/sources.list /etc/apt/sources.list.bak &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/apt/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apt/sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;&amp;gt;/etc/apt/sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/apt/sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;etc/apt/sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;&amp;gt;/etc/apt/sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;&amp;gt;/etc/apt/sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;&amp;gt;/etc/apt/sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;&amp;gt;/etc/apt/sources.list &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;multiverse&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt;/etc/apt/sources.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# RUN apt-get clean&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN apt-get update &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get install --no-install-recommends -y &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;git &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;inotify-tools &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;wget &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; rm -rf /var/lib/apt/lists/*
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# https://download.fastgit.org/ 这个下载镜像&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 正式使用&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# wget --quiet -O - $OPENGROK_ARCHIVE_URL | tar zxf - ; \&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;WORKDIR &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$OPENGROK_INSTANCE_BASE&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;set&lt;/span&gt; -eux ; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;mkdir data etc ; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;OPENGROK_ARCHIVE_FILE&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;opengrok-&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;OPENGROK_VERSION&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;.tar.gz ; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;OPENGROK_ARCHIVE_URL&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;https://download.fastgit.org/oracle/opengrok/releases/download/1.7.26/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;opengrok-1.7.26.tar.gz;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 测试使用&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;COPY opengrok-1.7.26.tar.gz /opengrok
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN tar zxvf opengrok-1.7.26.tar.gz ; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;mv opengrok-&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;OPENGROK_VERSION&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;/* . ;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./bin/OpenGrok deploy ;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN rm -rf opengrok-1.7.26.tar.gz opengrok-1.7.26 ;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 下面的步骤需要修改&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# RUN mkdir /opengrok/{src,data,dist,etc,log} ; \&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN bash -c ’mkdir -p /opengrok/&lt;span style=&#34;color:#ff79c6&#34;&gt;{&lt;/span&gt;src,data,dist,etc,log&lt;span style=&#34;color:#ff79c6&#34;&gt;}&lt;/span&gt;’ ; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;cp /opengrok/lib/source.war &lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;OPENGROK_TOMCAT_BASE&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;/webapps/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;COPY logging.properties /opengrok/etc/logging.properties
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;COPY index.sh /opengrok/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN chmod u+x /opengrok/index.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;COPY run_opengrok.sh /usr/local/bin/run_opengrok
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RUN chmod &lt;span style=&#34;color:#bd93f9&#34;&gt;544&lt;/span&gt; /usr/local/bin/run_opengrokENTRYPOINT &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;/usr/local/bin/run_opengrok&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;EXPOSE &lt;span style=&#34;color:#bd93f9&#34;&gt;8080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 使用:docker run -d -v &amp;lt;directory with files to be indexed&amp;gt;:/src -v &amp;lt;...&amp;gt;:&amp;lt;...&amp;gt; -p &amp;lt;PORT&amp;gt;:8080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;thombashi/opengrok
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 用小项目测试&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# docker查看日志:docker logs -f -t --tail 10 972a542ceb21&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# docker run -d -v /home/uos/gg/abi/kabi-dw-src/kabi-dw:/opengrok/src -p 8080:8080 lj-opengrok:v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;index.sh 如下:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;java -Xmx8g &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;-Djava.util.logging.config.file&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;/opengrok/etc/logging.properties &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;-DOPENGROK_SCAN_REPOS&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;false&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;-DOPENGROK_GENERATE_HISTORY&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;off &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;-jar /opengrok/lib/opengrok.jar &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;-c /usr/local/bin/ctags &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;-s /opengrok/src/ -d /opengrok/data -H -P -S -G &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;-W /opengrok/etc/configuration.xml -U http://127.0.0.1:8080/source &lt;span style=&#34;color:#f1fa8c&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&lt;/span&gt;-m &lt;span style=&#34;color:#bd93f9&#34;&gt;512&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;docker 启动的 ENTRY_POINT 如下(需要额外注意 tomcat 启动之后必须 sleep 几秒,否则后面 index 报错)：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;#!/bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;set&lt;/span&gt; -x
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;INOTIFY_CMD&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;inotifywait --recursive --event close_write /opengrok/src&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;REINDEX_GRACE_PERIOD&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color:#6272a4&#34;&gt;# [secs]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;REINDEX_INTERVAL&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#bd93f9&#34;&gt;20&lt;/span&gt; &lt;span style=&#34;color:#6272a4&#34;&gt;# [secs]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;DATE_CMD&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;date --rfc-3339=seconds&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sh /usr/local/tomcat/bin/startup.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sleep &lt;span style=&#34;color:#bd93f9&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;----- &lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DATE_CMD&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;: source code indexing -----&amp;#34;&lt;/span&gt; 1&amp;gt;&amp;amp;&lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sh /opengrok/index.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;while&lt;/span&gt; true; &lt;span style=&#34;color:#ff79c6&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$INOTIFY_CMD&lt;/span&gt; ; &lt;span style=&#34;color:#ff79c6&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;----- &lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DATE_CMD&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;: reindex grace period: &lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$REINDEX_GRACE_PERIOD&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt; secs -----&amp;#34;&lt;/span&gt; 1&amp;gt;&amp;amp;&lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sleep &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$REINDEX_GRACE_PERIOD&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;----- &lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DATE_CMD&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;: reindexing -----&amp;#34;&lt;/span&gt; 1&amp;gt;&amp;amp;&lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sh /opengrok/index.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# discard changes during the grace period and the reindexing&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;breakdone
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;----- &lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$DATE_CMD&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;: reindex interval: &lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$REINDEX_INTERVAL&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt; secs -----&amp;#34;&lt;/span&gt; 1&amp;gt;&amp;amp;&lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sleep &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;$REINDEX_INTERVAL&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;docker 镜像的制作和上传如下:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker build -t lj-opengrok:v1 .
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker tag 24d63cd01336 allinaent/lj-opengrok:v1.0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker login
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker push allinaent/lj-opengrok:v1.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;启动 opengrok 的命令如下(注意-v 多个可以索引多个项目):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -d -v host-src-path:/opengrok/src/project-name -p 8080:8080 allinaent/lj-opengrok:v1.0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 查看日志&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker logs -f -t --tail &lt;span style=&#34;color:#bd93f9&#34;&gt;200&lt;/span&gt; c4c57efb939871d3840a271741b1f9ea9bf454519b8e412e08a4aad513c9ee78
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;总结&#34;&gt;总结&lt;/h2&gt;
&lt;p&gt;阅读代码工具认识操作系统的开始,docker 值得一用。对于使用者而言只需要三个步骤:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;安装 docker 工具。&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo groupadd docker
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo gpasswd -a &lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;USER&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt; docker
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo service docker restart
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo chmod a+rw /var/run/docker.sock
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo -s
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat&amp;gt;/etc/docker/daemon.json&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;registry-mirrors&amp;#34; : [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;https://registry.docker-cn.com&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;https://docker.mirrors.ustc.edu.cn&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;http://hub-mirror.c.163.com&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;https://cr.console.aliyun.com/&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#6272a4&#34;&gt;# 重启docker服务使配置生效&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart docker.service
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;pull&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker pull allinaent/lj-opengrok:v1.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;运行&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -d -v &lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;host&lt;/span&gt;-src-path&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt;:/opengrok/src/&lt;span style=&#34;color:#f1fa8c&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;project&lt;/span&gt;-name&lt;span style=&#34;color:#f1fa8c&#34;&gt;}&lt;/span&gt; -p 8080:8080 allinaent/lj-opengrok:v1.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        <item>
        <title>内核一次日志问题的分析</title>
        <link>https://guolongji.xyz/post/kernel-debug-method/</link>
        <pubDate>Mon, 18 Sep 2023 21:01:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/kernel-debug-method/</guid>
        <description>&lt;h2 id=&#34;文韬分享-一次日志分析问题-20230810&#34;&gt;文韬分享，一次日志分析问题，20230810&lt;/h2&gt;
&lt;figure&gt;&lt;img src=&#34;https://guolongji.xyz/ox-hugo/img_20230918_210808.png&#34;/&gt;
&lt;/figure&gt;

&lt;p&gt;这次分享呢我认为可能有一点收获。&lt;/p&gt;
&lt;p&gt;关抢占，原子上下文。在 kernel/sched/core.c 当中。不允许别人打断我的执行。关抢占之后不允许调度。但是中断是可以的。关抢占之后不用在加锁。不能防止 cpu 之间的并行。必须要执行完。不能够托太久。&lt;/p&gt;
&lt;p&gt;关中断则不再允许中断的执行。preempt_count。&lt;/p&gt;
&lt;p&gt;CONFIG_PREEMPT_RCU，这个是个配置导致的一个 bug。内核不会有缺页异常。内核页表在 0 号进程。所有的更改都是改 0 号如果改进程的第一个页，其它进程会对比一下和 0 号进程页表第一个页，这时会报 do_page_fault。但是新的内核好像这个
case 取消了。好像增加了一个新的 case，改权限位。不是因为真正的缺页，只是改一些 flag，做一些同步的事。和用户态的缺页异常是不一样的。不会像用户态的缺页异常从硬盘获取到内存当中去。内核段是不会交换出去的。内核和用户态是不太一样的。这一点要清楚，让我理解了更底层的一些东西。&lt;/p&gt;
&lt;p&gt;首先，page 的大数组去找，不会出现在可回收的链表里面。vm 的也不可以交换出去。&lt;/p&gt;
&lt;p&gt;通过 path_openat 这一行。看到了什么？+0xC0，而另一个 do_flip_open+0x78/0xf0，这一行，这个个指令是 core 指令的位置吗？不是，是 core 的下一行指令，函数调用约定，这个和架构相关。从数字到汇编到源代码来看一下。&lt;/p&gt;
&lt;p&gt;用 gdb 进去。gdb vmlinux。gdb 下的 ptype 函数。用 p &amp;amp;(((struct nameidata *)0)-&amp;gt;flags)。&lt;/p&gt;
&lt;p&gt;用 p &amp;amp;(((struct nameidata *)0)-&amp;gt;last_type)。&lt;/p&gt;
&lt;p&gt;python3 中直接输入：0x30，可以直接显示出来十进制的数。&lt;/p&gt;
&lt;p&gt;这是流程化的，工业化的一套流程。挺好用的哈。negitive 的 dentry 的话，dir-&amp;gt;d_inode 就是空的。有正面分析的能力，本来此处就可能是空的。这块这文件系统的子系统，比较熟悉。lru，之类的东西。&lt;/p&gt;
&lt;p&gt;去一个网站 bootlin，看 4.19 最新的代码。对比一下 fs/namei.c，上游的代码是个什么样子的状态。和我们的代码不一样，再切到 5.4。上游的代码是最新的。去 linux stable git。github 中的 gregkh/linux 切到 4.19 分支。直接开一下
blame。直接找到了 patch。上游的代码有新的 patch 修复一些的问题。&lt;/p&gt;
&lt;p&gt;./scripts/faddr2line vmlinux path_openat+0xc0/0x13c0，非常非常的准，基于 gdb 的反汇编，这个工具是非常的准的。厉害啊。直接复制进去，从 log 直接定位到出错的代码的位置。正向分析其实就没有什么用处了。&lt;/p&gt;
&lt;p&gt;disa 命令，0x78，开一个 python，这个是十进制的 120。从汇编反汇编：disa /s path_openat，看到了吧，gdb 就是这么的强大。help disa，可以看到 gdb 的好多用法。这个函数被内联了，有时候 call_trace 显示的是不同的函数名。&lt;/p&gt;
&lt;p&gt;调用 might_sleep，mutex_lock()，也会检查这个。这个是个预警的机制。通过一些好用的工具。&lt;/p&gt;
&lt;p&gt;assert(!in_atomic*())，空指针引发缺页。balabala。rcu 为什么不等于零呢？在 do_flip_open 当中，确保在查的时候不会有人把他删掉。path_init 中就会用 rcu 的读锁。vmlinux 的解析是一个很复杂的东西。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>在cloudfare中搭建hugo博客</title>
        <link>https://guolongji.xyz/post/hugo-on-cloudflare/</link>
        <pubDate>Mon, 18 Sep 2023 16:35:00 +0800</pubDate>
        
        <guid>https://guolongji.xyz/post/hugo-on-cloudflare/</guid>
        <description>&lt;h2 id=&#34;hugo-on-cloudflare&#34;&gt;hugo on cloudflare&lt;/h2&gt;
&lt;p&gt;我的博客就要开通了，codeberg pages + orgmode + hugo + stack theme，&lt;/p&gt;
&lt;p&gt;Codeberg 是一个快速开源 GitHub 替代品，是一个面向开源社区的非营利性代码托管平台。它提供了与 GitHub 相似的功能，包括版本控制、问题跟踪和 Pull Request。不同的是，Codeberg 专注于保护用户的隐私和数据安全，并提供了更加开放和透明的运营方式。&lt;/p&gt;
&lt;p&gt;以下是 Codeberg 的三个核心优势：&lt;/p&gt;
&lt;p&gt;快速响应：Codeberg 采用了先进的硬件和软件配置，提供了更快的响应速度和更高的稳定性，让用户在开发过程中更加流畅。
数据安全：Codeberg 可以保护用户的隐私和数据安全，不会监视、分析或出售用户的数据。同时，Codeberg 也提供了备份和灾难恢复机制，确保用户数据的安全性和完整性。开源透明：Codeberg 的运营方式更加开放和透明，用户可以随时查看平台的运营状态和财务报告。Codeberg 通过社区捐赠和赞助等方式进行运营，保证了平台的独立和自主性。&lt;/p&gt;
&lt;p&gt;体验了一下 codeberg，简直是完美。没有任何的博客能比得过 hugo 加 codeberg 了。当然了，博客都是记录一些精华的东西，可以不发布。但是手稿 draft 我也可以随便写。我终于可以成神了。我很喜欢 stack 的风格。曾经我以为
orgmode.org/worg 这个网站的风格适合做为博客，但是不好做。现在我更喜欢 stack 这个风格的博客，我一定要成功。未来是属于我的。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://sdl.moe/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://sdl.moe/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/CaiJimmy/hugo-theme-stack&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/CaiJimmy/hugo-theme-stack&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;他用的是 cloudflare pages 和 gitlab。&lt;/p&gt;
&lt;p&gt;完美主义者一点也不完美！最傻的就是完美主义者，没有人能第一种事就能把事情做好。关键是做了，而不是想了。这太重要了。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://sdl.moe/post/hexo-transfer-to-hugo/#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83%E4%B8%8E%E9%83%A8%E7%BD%B2&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://sdl.moe/post/hexo-transfer-to-hugo/#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83%E4%B8%8E%E9%83%A8%E7%BD%B2&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;开始干吧！！！！！！&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;安装好 go，因为 hugo 的程序是依赖 go 的，源码安装需要安装 go。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;git clone &lt;a class=&#34;link&#34; href=&#34;mailto:git@github.com&#34; &gt;git@github.com&lt;/a&gt;:SDLMoe/hugo.git&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;安装这个经过 mod 的版本。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;进入目录 go build，将 hugo cp 到/usr/local/bin/ 下面去即可。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;新建一个目录，肯定是个 git 项目，目录选一个好用一点的目录。就选 gh 目录下的 hugo-blog，作为目录吧。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;即：hugo new site hugo-blog&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;修改 config.yaml，这个配置文件。mv config.toml config.yaml&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;加入 stack 这个主题&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;git submodule add &lt;a class=&#34;link&#34; href=&#34;mailto:git@github.com&#34; &gt;git@github.com&lt;/a&gt;:CaiJimmy/hugo-theme-stack.git themes/hugo-theme-stack，注意不要加 themes，目录对不上。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;先放到本地仓库，以后有时间了再将本地主题的分支 glj 上传到自己的代码仓库。都放到 codeberg 或者是 Cloudflare&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;当中去。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;现在写一个文档吧，用 orgmode 写，并且上传到 codeberg 上面去。遇到了一个问题，就是 ox-hugo 导出的文章没有标题。之前以为是 hugo 配置文件的问题，后来发现是没有标题。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;emacs 是结合 yasnnipt 来实现写 org，用 ox-hugo 实现将 org 转化为 md，然后 commit 的动作使得博客的内容改变。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;出了一点小问题，yaml 的配置如果不对就不能显示出来 toc。好在 github 上搜到了 hugo 的一些配置。参考着写就可以。挺好用的 hugo。只是像 emacs 一样。开始的时候没有 toc。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/J-shiro/J-shiro.github.io&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/J-shiro/J-shiro.github.io&lt;/a&gt; ，参考这个实现，就有了。&lt;/p&gt;
&lt;p&gt;现在的问题是我对 github 的 action，或者是 codeberg 的 CI 了解的不清楚。现在就是要了解这些方面的东西了，这些了解清楚了之后，我就能完成闭环，想清楚每一个环节比较好的作法。直到把有用的记录写到我的博客当中去。希望这个的时间不要太长，我等不及了。&lt;/p&gt;
&lt;h3 id=&#34;github-actions&#34;&gt;github Actions&lt;/h3&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这篇文章写的很好。我理解了什么是 github Actions。就像 java 用 yml 一样。yaml 的一些优点和缺点：
&lt;a class=&#34;link&#34; href=&#34;https://segmentfault.com/a/1190000039969764&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://segmentfault.com/a/1190000039969764&lt;/a&gt; ，yaml 并不是什么高级的东西，反而它是比较低级的，好处是符号少，能满足一定的需求。&lt;/p&gt;
&lt;h3 id=&#34;codeberg-的-ci&#34;&gt;codeberg 的 CI&lt;/h3&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://codeberg.org/Codeberg-CI/request-access&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://codeberg.org/Codeberg-CI/request-access&lt;/a&gt;
&lt;a class=&#34;link&#34; href=&#34;https://codeberg.org/Codeberg-e.V./requests&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://codeberg.org/Codeberg-e.V./requests&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;gitee-也是有-pages&#34;&gt;gitee 也是有 pages&lt;/h3&gt;
&lt;p&gt;文档是中文的，这一点比较爽。但是啥呢。&lt;/p&gt;
&lt;h3 id=&#34;自己的随笔也保留&#34;&gt;自己的随笔也保留&lt;/h3&gt;
&lt;p&gt;自己乱七八糟的笔记和整理好的博客，显然，是要分开的。最好的做法是笔记也保留在私有仓库，博客也保留在私有仓库，然后通过 CI，只发布 blog 指定目录到另一个项目当中。现在我对项目的组织结构还有没有什么经验。一定要把关系理清楚，时机成熟了之后再开始做。否则不能长远。后面一旦换了机器，或者有些什么其它的问题也是解决不了的。&lt;/p&gt;
&lt;p&gt;好的好的。现在查看一下目录的情况吧。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;uos@guolongji:~/gh/hugo-blog$ tree -L &lt;span style=&#34;color:#bd93f9&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── archetypes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── default.md
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── assets
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── jsconfig.json
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── config.yaml~
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── content
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── post
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── data
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── hugo-theme-stack
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── archetypes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── assets
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── config.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── data
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── debug.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── exampleSite
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── go.mod
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── i18n
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── images
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── layouts
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── LICENSE
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── netlify.toml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── README.md
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── theme.toml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── layouts
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── org
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── &lt;span style=&#34;color:#bd93f9&#34;&gt;2023&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── public
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── 404.html
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── categories
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── img
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── index.html
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── index.xml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── page
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── post
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── scss
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── sitemap.xml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── tags
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── ts
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── resources
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── _gen
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── static
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;└── themes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    └── hugo-theme-stack
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我和其它的 hugo 用户不同的是我用了 emacs。看了这一篇文章：
&lt;a class=&#34;link&#34; href=&#34;https://juejin.cn/post/7120474763910676488&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://juejin.cn/post/7120474763910676488&lt;/a&gt; ，现在明白了，现在核心就是这个私有的仓库。还有几个有问题的点需要思考。&lt;/p&gt;
&lt;p&gt;首先，用 github 的 Action 我用的是经过 mod 的 hugo 版本。经过 mod 的 hugo 版本应该如何让 github 调用编译命令呢，这是一个值得思考的问题。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.lixueduan.com/posts/blog/01-github-action-deploy-hugo/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.lixueduan.com/posts/blog/01-github-action-deploy-hugo/&lt;/a&gt;
这篇文章写清楚了 hugo 的 Action 的原理。&lt;/p&gt;
&lt;p&gt;什么是高级工程师呢？&lt;a class=&#34;link&#34; href=&#34;https://www.lixueduan.com/posts/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.lixueduan.com/posts/&lt;/a&gt; ，看看别人大神搞的东西，发现人的落后真的是非常的大的。你还在研究的事情，可能是别人早就已经用的很明白的东西了。不过也无可厚非，毕境，一个人的精力是有限的。祈祷吧。今天已经够累的了。&lt;/p&gt;
&lt;p&gt;可不可以理解，智商高的人不是不累，而是承受能力强呢？是的，他们不是说做什么事情都轻松，只是经常性的全力以赴而已，所以不要相信别人能很容易的就达到什么样子的成就。就算是买彩票中奖，也是因为人家付出来买的动作，种豆得瓜。普通人会没事买一张彩票吗？&lt;/p&gt;
&lt;p&gt;垃圾太多了。说我兴趣广泛，和真正的博士相比，我还是懂得太少了。就算学会了，其实也没有什么大用处。又回顾了一下：
&lt;a class=&#34;link&#34; href=&#34;https://sdl.moe/post/hexo-transfer-to-hugo/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://sdl.moe/post/hexo-transfer-to-hugo/&lt;/a&gt; ，发现用 cloudflare 挺好的。密码必须最后加一个英文感叹号。要什么特殊字符，烦人。&lt;/p&gt;
&lt;p&gt;看一下 cloudflare 的文档，官方文档不说写的多好，起码是有用的。cloudflare 加 gitlab，这两个组合有人用。那就应该挺好用的。&lt;/p&gt;
&lt;p&gt;越做就越接近于成功，行动胜过千言。虽然说话也很重要，但是对于一个人自己的进步，还是行动起到真正的作用。人的工作是实践出来的，而不是说出来的。&lt;/p&gt;
&lt;p&gt;astro，也是一个博客框架： &lt;a class=&#34;link&#34; href=&#34;https://docs.astro.build/zh-cn/guides/deploy/cloudflare/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://docs.astro.build/zh-cn/guides/deploy/cloudflare/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;没必要了解那么多不相关的东西。我还是需要明确目标，分散精力有时并不太好。想弄漂亮的静态博客还是很容易的。&lt;/p&gt;
&lt;p&gt;编码能力强只是写的代码多而已，也写的很快，所以不要觉得万事很难。&lt;/p&gt;
&lt;p&gt;cloudflare 的 CDN，简直是写自己博客的不二选择。参见另一个使用原生 stack 主题的大佬的博客：
&lt;a class=&#34;link&#34; href=&#34;https://tutuis.me/deploy-blog-to-cloudflare-pages/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://tutuis.me/deploy-blog-to-cloudflare-pages/&lt;/a&gt; ，每个月的构建时长是 500 分钟，也就是 8 个小时，这么长的时间，你能用光，那是这辈子都不可能的一件事。&lt;/p&gt;
&lt;p&gt;为了绐我的 emacs 找个好一点的展示的家，我真的是不容易啊。选一个漂亮的博客，而后再用 latex 或者 orgmode 来做笔记。&lt;a class=&#34;link&#34; href=&#34;https://shaohanyun.top/posts/tech/transformer/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://shaohanyun.top/posts/tech/transformer/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;今天把这个弄完吧。&lt;/p&gt;
&lt;p&gt;我的选型是 cloudfare + gitlab。&lt;/p&gt;
&lt;p&gt;现在步骤到了将 hugo 的项目上传到 gitlab 当中，这个项目的上传很有学问，要小心要细致。我有一个干净的 gitlab 帐号，不要浪费了这么干净的一个号。gitlab 设置了和 github 一样的一个密码。&lt;/p&gt;
&lt;p&gt;我要编辑一下.gitignore，不要管理 &lt;strong&gt;*~&lt;/strong&gt; 这种 emacs 生成的文件。不要管理最外面的 org、content 两个文件夹。这样应该就行了吧。哪里有那么复杂，只是我过于谨慎了而已。记住 gitignore 不要加点。因为这些语法的细节，会让你的项目变的非常地好用，而不是一团乱麻。计算机这个工作是十分看重经验的一项工作。大多数时候，脑子笨一点都是无所谓的，有所谓的只是如何把问题解决掉。另外 resources 这个文件夹下面的东西也是没有什么用处的。也加到 gitignore 当中就可以了。&lt;/p&gt;
&lt;p&gt;这个步骤是这个样子的。公有项目只显示发布的内容。而私有的项目只存 md 和 org 的源文件。而我用 emacs 只修改的是
org 的源文件，md 的源文件是通过 emacs 的命令来生成的。&lt;/p&gt;
&lt;p&gt;got it！ 就是这个样子，ok。现在没有什么问题了吧。&lt;/p&gt;
&lt;p&gt;好的，现在这个思路没有问题了。还有就是你把头像什么的都改一下，别弄一个半成品的第一次的提交，让自己费力多搞几次，那就很烦。第一步选一个头像。好看的头像，或者就用我的 QQ 头像就可以了。&lt;/p&gt;
&lt;p&gt;convert lbxx.jpg -resize 150x150 avatar.jpg&lt;/p&gt;
&lt;p&gt;直接重新运行就可以了，牛逼。这款博客的主题广为流行，真的是很好用的。&lt;/p&gt;
&lt;p&gt;git remote add origin &lt;a class=&#34;link&#34; href=&#34;https://gitlab.com/Allinaent/blog&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://gitlab.com/Allinaent/blog&lt;/a&gt;
git branch -M main
git push -u origin main&lt;/p&gt;
&lt;p&gt;git config &amp;ndash;global url.&amp;quot;&lt;a class=&#34;link&#34; href=&#34;https://oauth2:glpat-wkuWyshujRmsmGxEgFxL@gitlab.com/Allinaent/blog%22.insteadof&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://oauth2:glpat-wkuWyshujRmsmGxEgFxL@gitlab.com/Allinaent/blog%22.insteadof&lt;/a&gt;
&amp;ldquo;&lt;a class=&#34;link&#34; href=&#34;https://gitlab.com/Allinaent/blog&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://gitlab.com/Allinaent/blog&lt;/a&gt;&amp;rdquo;&lt;/p&gt;
&lt;p&gt;git push &amp;ndash;set-upstream origin main，这个命令成功了。&lt;/p&gt;
&lt;p&gt;多次上传会导致错误，需要手动修改~/.gitconfig 文件来完成更新。&lt;/p&gt;
&lt;p&gt;一定要先 initial commit 一次。&lt;/p&gt;
&lt;p&gt;现在上传成功了。好吧，cloudflare 不能用 submodule，这个真的是有一点烦。那还有什么呢？现在我的博客一篇文章也没得，需要上传一些文章。&lt;/p&gt;
&lt;p&gt;gitlab 的 CI，持续集成。看这篇文章：&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/2a5c77b4d683&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.jianshu.com/p/2a5c77b4d683&lt;/a&gt; ，这个人用的是 github 做的，应该和
gitlab 是差不多的。CI 没什么神秘的：&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/282958129&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/282958129&lt;/a&gt;， 你可以看出来，CI 只是一些运维脚本的组合，ymal 只是把这些元素做一些规范化的定义而已。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://m.hswh.org.cn/wzzx/llyd/ls/2023-08-09/83253.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://m.hswh.org.cn/wzzx/llyd/ls/2023-08-09/83253.html&lt;/a&gt; ，树的影，人的名。毛主席还见过李政道，并且创建了中科大的少年班。这是一段佳话。每一个在科学上有成就的人都是那么的强壮，现在杨振宁和李政道都一百岁左右了。然而还都活着。人与人相比，差距真的是太大了。想从人修炼成神真的是要付出超出常人的努力。还有不要对自己失去信心，我就算是什么也做不成了，30 多岁了，可是做些学术上的研究，总归不是什么不良爱好。迟早有一天我会因为我自己的坚持让后人受益。&lt;/p&gt;
&lt;p&gt;我的博客发布流程，大概是这样的。本地写 org 博客。一键生成 md 的博客文件。org 的内容要不要建立一个项目呢？要！你的博客要让别人不方便复制吗？可能是有必要的。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.xheldon.com/tech/the-using-of-github-pages.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.xheldon.com/tech/the-using-of-github-pages.html&lt;/a&gt; ，这篇文章的思路和我自己的思路是完全一致的。甚至如果是 github 的 pages 你都不需要修改，直接用人家的方案就可以了。但是他用的是 jekyll，稍微有一些区别。&lt;/p&gt;
&lt;p&gt;更高层次的认知，并能付诸于实践，这太重要了。当然，其实我写的博客应该不会有什么人来看，一是别人看一懂，二是看的懂的可能也不屑于看吧。&lt;/p&gt;
&lt;p&gt;用 orgmode 来写 hugo 博客。&lt;/p&gt;
&lt;p&gt;hugo 的目录组织结构，按时间来组织是最合适的。没有问题。在 gitlab 中创建一个私有的子项目。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.knightli.com/2022/03/25/hugo-md-%E7%9B%AE%E5%BD%95%E7%BB%84%E7%BB%87/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.knightli.com/2022/03/25/hugo-md-%E7%9B%AE%E5%BD%95%E7%BB%84%E7%BB%87/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;git subtree 这个和 git 的 submodule 不太一样，但是十分的类似，可以看看下面的文章：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tangxusc.github.io/blog/2019/03/git-subtree-%E6%95%99%E7%A8%8B/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://tangxusc.github.io/blog/2019/03/git-subtree-%E6%95%99%E7%A8%8B/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我要怎么做呢？&lt;/p&gt;
&lt;p&gt;gitlab 和 github 的 ci 本质都是一种编程了。首先要认识这个过程是什么，然后用语法写出来。github actions 稍微有一点博大精深了啊。github 的 action market 上搜一下，看是不是有别人写好的 ci 工具？大概是有的。&lt;/p&gt;
&lt;p&gt;本质就是用到了 git push -f，可以在不同的项目之间做推送。github 还是 gitlab 都是暂时使用的一个虚拟机，直的是挺神奇的。也不知道具体的实现方式。&lt;/p&gt;
&lt;p&gt;选 gitlab 是一个非常好的选择，因为我在手机上也可以访问 gitlab 个人的主页，关键是一点也不卡，不用翻墙也能访问。这非常的棒。以后就用这个 gitlab 了，简直是最棒的一个选择。&lt;/p&gt;
&lt;p&gt;现在我理解了完全使用私有的 md 可能很麻烦，而且得不偿失。因为我写的东西大多数情况也不是什么机密的内容。而且本来就是为了分享的。&lt;/p&gt;
&lt;p&gt;还是回归到本质，用：
&lt;a class=&#34;link&#34; href=&#34;https://sdl.moe/post/hexo-transfer-to-hugo/#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83%E4%B8%8E%E9%83%A8%E7%BD%B2&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://sdl.moe/post/hexo-transfer-to-hugo/#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83%E4%B8%8E%E9%83%A8%E7%BD%B2&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这个来做博客吧。cloudfare 是最好的选择，是否需要隐私。经过我慎重的考虑，不是一个关键的问题。今天差不多可以弄完，Ok，你又要完成一个重要的工作了，加油。人工智能时代，在博客中记录学习过程，终于可以走上正轨了。&lt;/p&gt;
&lt;p&gt;写完之后发现没有滚动条，怎么回事？在配置文件里面把代码有行号的配置绐注释掉就好了。墨语的博客优化的很好看：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://moyu.ee/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://moyu.ee/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://moyu.ee/p/hugo-stack/#%E6%BB%9A%E5%8A%A8%E6%9D%A1%E7%BE%8E%E5%8C%96&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://moyu.ee/p/hugo-stack/#%E6%BB%9A%E5%8A%A8%E6%9D%A1%E7%BE%8E%E5%8C%96&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这个人页面优化的也不错：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://xrg.fj.cn/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://xrg.fj.cn/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;原来 hugo 和 hugo 的各种主题早就广为流传了。之前还想自己写一个博客框架或都完全把博客搞成一个自己的项目。现在感觉不是特别地有必要了。人生也有涯，没用人是无涯子。give up and turn to learn AI！&lt;/p&gt;
&lt;h2 id=&#34;修改了-katex-dot-min-dot-css-和-js-的-cdn&#34;&gt;修改了 katex.min.css 和 js 的 cdn&lt;/h2&gt;
&lt;p&gt;e themes/hugo-theme-stack/data/external.yaml，选用了七牛云的 CDN。&lt;/p&gt;
&lt;p&gt;现在网页显示公式基本上是秒出了，这就很棒。以后多理解多学习吧。&lt;/p&gt;
&lt;h2 id=&#34;hugo-stack-theme-不支持灯箱&#34;&gt;hugo stack theme 不支持灯箱&lt;/h2&gt;
&lt;p&gt;广大的开源用户是有实力的，别人已经有了很好的方案，我可以直接抄过来。参考下面这个，效果是真的好用啊。&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.l3zc.com/2023/10/theme-stack-tweaks/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.l3zc.com/2023/10/theme-stack-tweaks/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;另外这个大佬用到的评论系统是：Twikoo ，这个有时间也试试吧。&lt;/p&gt;
&lt;p&gt;创建./layouts/partials/comments/provider/twikoo.html，修改文件第一行：&lt;/p&gt;
&lt;p&gt;&amp;lt;script src=&amp;quot;//lib.baomitu.com/twikoo/1.6.21/twikoo.all.min.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;&lt;/p&gt;
&lt;p&gt;原主题的 Twikoo 版本是 1.16.115，这里也顺便升级成匹配我部署的后端版本 1.16.21。&lt;/p&gt;
&lt;p&gt;其他的评论系统也以此类推，折腾的同学有很多，我应该也会帮助到一些人吧。时间长了就逐渐理解这些开源的项目了。&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Chinese Test</title>
        <link>https://guolongji.xyz/post/index.zh-cn/</link>
        <pubDate>Wed, 09 Sep 2020 00:00:00 +0000</pubDate>
        
        <guid>https://guolongji.xyz/post/index.zh-cn/</guid>
        <description>&lt;img src="https://guolongji.xyz/post/index.zh-cn/helena-hertz-wWZzXlDpMog-unsplash.jpg" alt="Featured image of post Chinese Test" /&gt;&lt;h2 id=&#34;正文测试&#34;&gt;正文测试&lt;/h2&gt;
&lt;p&gt;而这些并不是完全重要，更加重要的问题是， 带着这些问题，我们来审视一下学生会退会。 既然如何， 对我个人而言，学生会退会不仅仅是一个重大的事件，还可能会改变我的人生。 我们不得不面对一个非常尴尬的事实，那就是， 可是，即使是这样，学生会退会的出现仍然代表了一定的意义。 学生会退会，发生了会如何，不发生又会如何。 经过上述讨论， 生活中，若学生会退会出现了，我们就不得不考虑它出现了的事实。 学生会退会，到底应该如何实现。 这样看来， 在这种困难的抉择下，本人思来想去，寝食难安。 对我个人而言，学生会退会不仅仅是一个重大的事件，还可能会改变我的人生。 就我个人来说，学生会退会对我的意义，不能不说非常重大。 莎士比亚曾经提到过，人的一生是短的，但如果卑劣地过这一生，就太长了。这似乎解答了我的疑惑。 莫扎特说过一句富有哲理的话，谁和我一样用功，谁就会和我一样成功。这启发了我， 对我个人而言，学生会退会不仅仅是一个重大的事件，还可能会改变我的人生。 学生会退会，到底应该如何实现。 一般来说， 从这个角度来看， 这种事实对本人来说意义重大，相信对这个世界也是有一定意义的。 在这种困难的抉择下，本人思来想去，寝食难安。 了解清楚学生会退会到底是一种怎么样的存在，是解决一切问题的关键。 一般来说， 生活中，若学生会退会出现了，我们就不得不考虑它出现了的事实。 问题的关键究竟为何？ 而这些并不是完全重要，更加重要的问题是。&lt;/p&gt;
&lt;p&gt;奥斯特洛夫斯基曾经说过，共同的事业，共同的斗争，可以使人们产生忍受一切的力量。　带着这句话，我们还要更加慎重的审视这个问题： 一般来讲，我们都必须务必慎重的考虑考虑。 既然如此， 这种事实对本人来说意义重大，相信对这个世界也是有一定意义的。 带着这些问题，我们来审视一下学生会退会。 我认为， 我认为， 在这种困难的抉择下，本人思来想去，寝食难安。 问题的关键究竟为何？ 每个人都不得不面对这些问题。 在面对这种问题时， 要想清楚，学生会退会，到底是一种怎么样的存在。 我认为， 既然如此， 每个人都不得不面对这些问题。 在面对这种问题时， 那么， 我认为， 学生会退会因何而发生。&lt;/p&gt;
&lt;h2 id=&#34;引用&#34;&gt;引用&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;思念是最暖的忧伤像一双翅膀&lt;br&gt;
让我停不了飞不远在过往游荡&lt;br&gt;
不告而别的你 就算为了我着想&lt;br&gt;
这么沉痛的呵护 我怎么能翱翔&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.youtube.com/watch?v=3aypp_YlBzI&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;最暖的憂傷 - 田馥甄&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;图片&#34;&gt;图片&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://guolongji.xyz/post/index.zh-cn/florian-klauer-nptLmg6jqDo-unsplash.jpg&#34;
	width=&#34;667&#34;
	height=&#34;1000&#34;
	srcset=&#34;https://guolongji.xyz/post/index.zh-cn/florian-klauer-nptLmg6jqDo-unsplash_hu595aaf3b3dbbb41af5aed8d3958cc9f9_13854_480x0_resize_q75_box.jpg 480w, https://guolongji.xyz/post/index.zh-cn/florian-klauer-nptLmg6jqDo-unsplash_hu595aaf3b3dbbb41af5aed8d3958cc9f9_13854_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;66&#34;
		data-flex-basis=&#34;160px&#34;
	
&gt;

  &lt;img src=&#34;https://guolongji.xyz/post/index.zh-cn/luca-bravo-alS7ewQ41M8-unsplash.jpg&#34;
	width=&#34;1000&#34;
	height=&#34;667&#34;
	srcset=&#34;https://guolongji.xyz/post/index.zh-cn/luca-bravo-alS7ewQ41M8-unsplash_hu0a3f1163de68d0b9471979ebf0ecf11e_32400_480x0_resize_q75_box.jpg 480w, https://guolongji.xyz/post/index.zh-cn/luca-bravo-alS7ewQ41M8-unsplash_hu0a3f1163de68d0b9471979ebf0ecf11e_32400_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;

&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://guolongji.xyz/post/index.zh-cn/helena-hertz-wWZzXlDpMog-unsplash.jpg&#34;
	width=&#34;1000&#34;
	height=&#34;750&#34;
	srcset=&#34;https://guolongji.xyz/post/index.zh-cn/helena-hertz-wWZzXlDpMog-unsplash_hu45a5e3ad5e058da6a00650ed8fd40bea_15530_480x0_resize_q75_box.jpg 480w, https://guolongji.xyz/post/index.zh-cn/helena-hertz-wWZzXlDpMog-unsplash_hu45a5e3ad5e058da6a00650ed8fd40bea_15530_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;133&#34;
		data-flex-basis=&#34;320px&#34;
	
&gt;

  &lt;img src=&#34;https://guolongji.xyz/post/index.zh-cn/hudai-gayiran-3Od_VKcDEAA-unsplash.jpg&#34;
	width=&#34;667&#34;
	height=&#34;1000&#34;
	srcset=&#34;https://guolongji.xyz/post/index.zh-cn/hudai-gayiran-3Od_VKcDEAA-unsplash_hub241c2a9c7a2caf7e16a2a5bbc7141ff_18711_480x0_resize_q75_box.jpg 480w, https://guolongji.xyz/post/index.zh-cn/hudai-gayiran-3Od_VKcDEAA-unsplash_hub241c2a9c7a2caf7e16a2a5bbc7141ff_18711_1024x0_resize_q75_box.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;66&#34;
		data-flex-basis=&#34;160px&#34;
	
&gt;

&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-markdown&#34; data-lang=&#34;markdown&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;![&lt;span style=&#34;color:#ff79c6&#34;&gt;Photo by Florian Klauer on Unsplash&lt;/span&gt;](&lt;span style=&#34;color:#50fa7b&#34;&gt;florian-klauer-nptLmg6jqDo-unsplash.jpg&lt;/span&gt;)  ![&lt;span style=&#34;color:#ff79c6&#34;&gt;Photo by Luca Bravo on Unsplash&lt;/span&gt;](&lt;span style=&#34;color:#50fa7b&#34;&gt;luca-bravo-alS7ewQ41M8-unsplash.jpg&lt;/span&gt;) 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;![&lt;span style=&#34;color:#ff79c6&#34;&gt;Photo by Helena Hertz on Unsplash&lt;/span&gt;](&lt;span style=&#34;color:#50fa7b&#34;&gt;helena-hertz-wWZzXlDpMog-unsplash.jpg&lt;/span&gt;)  ![&lt;span style=&#34;color:#ff79c6&#34;&gt;Photo by Hudai Gayiran on Unsplash&lt;/span&gt;](&lt;span style=&#34;color:#50fa7b&#34;&gt;hudai-gayiran-3Od_VKcDEAA-unsplash.jpg&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;相册语法来自 &lt;a class=&#34;link&#34; href=&#34;https://typlog.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Typlog&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Markdown Syntax Guide</title>
        <link>https://guolongji.xyz/post/markdown-syntax/</link>
        <pubDate>Mon, 11 Mar 2019 00:00:00 +0000</pubDate>
        
        <guid>https://guolongji.xyz/post/markdown-syntax/</guid>
        <description>&lt;img src="https://guolongji.xyz/post/markdown-syntax/pawel-czerwinski-8uZPynIu-rQ-unsplash.jpg" alt="Featured image of post Markdown Syntax Guide" /&gt;&lt;p&gt;This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.&lt;/p&gt;
&lt;h2 id=&#34;headings&#34;&gt;Headings&lt;/h2&gt;
&lt;p&gt;The following HTML &lt;code&gt;&amp;lt;h1&amp;gt;&lt;/code&gt;—&lt;code&gt;&amp;lt;h6&amp;gt;&lt;/code&gt; elements represent six levels of section headings. &lt;code&gt;&amp;lt;h1&amp;gt;&lt;/code&gt; is the highest section level while &lt;code&gt;&amp;lt;h6&amp;gt;&lt;/code&gt; is the lowest.&lt;/p&gt;
&lt;h1 id=&#34;h1&#34;&gt;H1&lt;/h1&gt;
&lt;h2 id=&#34;h2&#34;&gt;H2&lt;/h2&gt;
&lt;h3 id=&#34;h3&#34;&gt;H3&lt;/h3&gt;
&lt;h4 id=&#34;h4&#34;&gt;H4&lt;/h4&gt;
&lt;h5 id=&#34;h5&#34;&gt;H5&lt;/h5&gt;
&lt;h6 id=&#34;h6&#34;&gt;H6&lt;/h6&gt;
&lt;h2 id=&#34;paragraph&#34;&gt;Paragraph&lt;/h2&gt;
&lt;p&gt;Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.&lt;/p&gt;
&lt;p&gt;Itatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.&lt;/p&gt;
&lt;h2 id=&#34;blockquotes&#34;&gt;Blockquotes&lt;/h2&gt;
&lt;p&gt;The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a &lt;code&gt;footer&lt;/code&gt; or &lt;code&gt;cite&lt;/code&gt; element, and optionally with in-line changes such as annotations and abbreviations.&lt;/p&gt;
&lt;h4 id=&#34;blockquote-without-attribution&#34;&gt;Blockquote without attribution&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;Tiam, ad mint andaepu dandae nostion secatur sequo quae.
&lt;strong&gt;Note&lt;/strong&gt; that you can use &lt;em&gt;Markdown syntax&lt;/em&gt; within a blockquote.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;blockquote-with-attribution&#34;&gt;Blockquote with attribution&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;Don&amp;rsquo;t communicate by sharing memory, share memory by communicating.&lt;!-- raw HTML omitted --&gt;
— &lt;!-- raw HTML omitted --&gt;Rob Pike&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;tables&#34;&gt;Tables&lt;/h2&gt;
&lt;p&gt;Tables aren&amp;rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Age&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Bob&lt;/td&gt;
&lt;td&gt;27&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Alice&lt;/td&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;inline-markdown-within-tables&#34;&gt;Inline Markdown within tables&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Italics&lt;/th&gt;
&lt;th&gt;Bold&lt;/th&gt;
&lt;th&gt;Code&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;italics&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;bold&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;code&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;A&lt;/th&gt;
&lt;th&gt;B&lt;/th&gt;
&lt;th&gt;C&lt;/th&gt;
&lt;th&gt;D&lt;/th&gt;
&lt;th&gt;E&lt;/th&gt;
&lt;th&gt;F&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit.&lt;/td&gt;
&lt;td&gt;Phasellus ultricies, sapien non euismod aliquam, dui ligula tincidunt odio, at accumsan nulla sapien eget ex.&lt;/td&gt;
&lt;td&gt;Proin eleifend dictum ipsum, non euismod ipsum pulvinar et. Vivamus sollicitudin, quam in pulvinar aliquam, metus elit pretium purus&lt;/td&gt;
&lt;td&gt;Proin sit amet velit nec enim imperdiet vehicula.&lt;/td&gt;
&lt;td&gt;Ut bibendum vestibulum quam, eu egestas turpis gravida nec&lt;/td&gt;
&lt;td&gt;Sed scelerisque nec turpis vel viverra. Vivamus vitae pretium sapien&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;code-blocks&#34;&gt;Code Blocks&lt;/h2&gt;
&lt;h4 id=&#34;code-block-with-backticks&#34;&gt;Code block with backticks&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;html&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;lang&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;en&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;head&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;meta&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;charset&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;utf-8&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;title&lt;/span&gt;&amp;gt;Example HTML5 Document&amp;lt;/&lt;span style=&#34;color:#ff79c6&#34;&gt;title&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;color:#ff79c6&#34;&gt;head&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;body&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;p&lt;/span&gt;&amp;gt;Test&amp;lt;/&lt;span style=&#34;color:#ff79c6&#34;&gt;p&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;color:#ff79c6&#34;&gt;body&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;color:#ff79c6&#34;&gt;html&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;code-block-indented-with-four-spaces&#34;&gt;Code block indented with four spaces&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;!doctype html&amp;gt;
&amp;lt;html lang=&amp;quot;en&amp;quot;&amp;gt;
&amp;lt;head&amp;gt;
  &amp;lt;meta charset=&amp;quot;utf-8&amp;quot;&amp;gt;
  &amp;lt;title&amp;gt;Example HTML5 Document&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
  &amp;lt;p&amp;gt;Test&amp;lt;/p&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;code-block-with-hugos-internal-highlight-shortcode&#34;&gt;Code block with Hugo&amp;rsquo;s internal highlight shortcode&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;html&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;lang&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;en&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;head&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;meta&lt;/span&gt; &lt;span style=&#34;color:#50fa7b&#34;&gt;charset&lt;/span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;utf-8&amp;#34;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;title&lt;/span&gt;&amp;gt;Example HTML5 Document&amp;lt;/&lt;span style=&#34;color:#ff79c6&#34;&gt;title&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;color:#ff79c6&#34;&gt;head&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;body&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;lt;&lt;span style=&#34;color:#ff79c6&#34;&gt;p&lt;/span&gt;&amp;gt;Test&amp;lt;/&lt;span style=&#34;color:#ff79c6&#34;&gt;p&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;color:#ff79c6&#34;&gt;body&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;color:#ff79c6&#34;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&#34;diff-code-block&#34;&gt;Diff code block&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[dependencies.bevy]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git = &amp;#34;https://github.com/bevyengine/bevy&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rev = &amp;#34;11f52b8c72fc3a568e8bb4a4cd1f3eb025ac2e13&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f55&#34;&gt;- features = [&amp;#34;dynamic&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f55&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#50fa7b;font-weight:bold&#34;&gt;+ features = [&amp;#34;jpeg&amp;#34;, &amp;#34;dynamic&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;list-types&#34;&gt;List Types&lt;/h2&gt;
&lt;h4 id=&#34;ordered-list&#34;&gt;Ordered List&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;First item&lt;/li&gt;
&lt;li&gt;Second item&lt;/li&gt;
&lt;li&gt;Third item&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;unordered-list&#34;&gt;Unordered List&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;List item&lt;/li&gt;
&lt;li&gt;Another item&lt;/li&gt;
&lt;li&gt;And another item&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;nested-list&#34;&gt;Nested list&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Fruit
&lt;ul&gt;
&lt;li&gt;Apple&lt;/li&gt;
&lt;li&gt;Orange&lt;/li&gt;
&lt;li&gt;Banana&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Dairy
&lt;ul&gt;
&lt;li&gt;Milk&lt;/li&gt;
&lt;li&gt;Cheese&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;other-elements--abbr-sub-sup-kbd-mark&#34;&gt;Other Elements — abbr, sub, sup, kbd, mark&lt;/h2&gt;
&lt;p&gt;&lt;!-- raw HTML omitted --&gt;GIF&lt;!-- raw HTML omitted --&gt; is a bitmap image format.&lt;/p&gt;
&lt;p&gt;H&lt;!-- raw HTML omitted --&gt;2&lt;!-- raw HTML omitted --&gt;O&lt;/p&gt;
&lt;p&gt;X&lt;!-- raw HTML omitted --&gt;n&lt;!-- raw HTML omitted --&gt; + Y&lt;!-- raw HTML omitted --&gt;n&lt;!-- raw HTML omitted --&gt; = Z&lt;!-- raw HTML omitted --&gt;n&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;Press &lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt;CTRL&lt;!-- raw HTML omitted --&gt;+&lt;!-- raw HTML omitted --&gt;ALT&lt;!-- raw HTML omitted --&gt;+&lt;!-- raw HTML omitted --&gt;Delete&lt;!-- raw HTML omitted --&gt;&lt;!-- raw HTML omitted --&gt; to end the session.&lt;/p&gt;
&lt;p&gt;Most &lt;!-- raw HTML omitted --&gt;salamanders&lt;!-- raw HTML omitted --&gt; are nocturnal, and hunt for insects, worms, and other small creatures.&lt;/p&gt;
&lt;h2 id=&#34;hyperlinked-image&#34;&gt;Hyperlinked image&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://google.com&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;img src=&#34;https://www.google.com/images/branding/googlelogo/1x/googlelogo_light_color_272x92dp.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		data-action=&#34;zoom&#34;
	
&gt;

&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;The above quote is excerpted from Rob Pike&amp;rsquo;s &lt;a class=&#34;link&#34; href=&#34;https://www.youtube.com/watch?v=PAAkCSZUG1c&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;talk&lt;/a&gt; during Gopherfest, November 18, 2015.&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
        </item>
        <item>
        <title>مثال نص</title>
        <link>https://guolongji.xyz/post/index.ar/</link>
        <pubDate>Sat, 09 Mar 2019 00:00:00 +0000</pubDate>
        
        <guid>https://guolongji.xyz/post/index.ar/</guid>
        <description>&lt;img src="https://guolongji.xyz/post/index.ar/matt-le-SJSpo9hQf7s-unsplash.jpg" alt="Featured image of post مثال نص" /&gt;&lt;h2 id=&#34;فقرة-1&#34;&gt;فقرة 1&lt;/h2&gt;
&lt;p&gt;هذا النص هو مثال لنص يمكن أن يستبدل في نفس المساحة، لقد تم توليد هذا النص من &lt;a class=&#34;link&#34; href=&#34;https://colorslab.com/textgator/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;مولد النص العربى&lt;/a&gt;، حيث يمكنك أن تولد مثل هذا النص أو العديد من النصوص الأخرى إضافة إلى زيادة عدد الحروف التى يولدها التطبيق.
إذا كنت تحتاج إلى عدد أكبر من الفقرات يتيح لك مولد النص العربى زيادة عدد الفقرات كما تريد، النص لن يبدو مقسما ولا يحوي أخطاء لغوية، مولد النص العربى مفيد لمصممي المواقع على وجه الخصوص، حيث يحتاج العميل فى كثير من الأحيان أن يطلع على صورة حقيقية لتصميم الموقع.
ومن هنا وجب على المصمم أن يضع نصوصا مؤقتة على التصميم ليظهر للعميل الشكل كاملاً،دور مولد النص العربى أن يوفر على المصمم عناء البحث عن نص بديل لا علاقة له بالموضوع الذى يتحدث عنه التصميم فيظهر بشكل لا يليق.
هذا النص يمكن أن يتم تركيبه على أي تصميم دون مشكلة فلن يبدو وكأنه نص منسوخ، غير منظم، غير منسق، أو حتى غير مفهوم. لأنه مازال نصاً بديلاً ومؤقتاً.&lt;/p&gt;
&lt;h2 id=&#34;فقرة-2&#34;&gt;فقرة 2&lt;/h2&gt;
&lt;p&gt;هذا النص هو مثال لنص يمكن أن يستبدل في نفس المساحة، لقد تم توليد هذا النص من &lt;a class=&#34;link&#34; href=&#34;https://colorslab.com/textgator/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;مولد النص العربى&lt;/a&gt;، حيث يمكنك أن تولد مثل هذا النص أو العديد من النصوص الأخرى إضافة إلى زيادة عدد الحروف التى يولدها التطبيق.
إذا كنت تحتاج إلى عدد أكبر من الفقرات يتيح لك مولد النص العربى زيادة عدد الفقرات كما تريد، النص لن يبدو مقسما ولا يحوي أخطاء لغوية، مولد النص العربى مفيد لمصممي المواقع على وجه الخصوص، حيث يحتاج العميل فى كثير من الأحيان أن يطلع على صورة حقيقية لتصميم الموقع.
ومن هنا وجب على المصمم أن يضع نصوصا مؤقتة على التصميم ليظهر للعميل الشكل كاملاً،دور مولد النص العربى أن يوفر على المصمم عناء البحث عن نص بديل لا علاقة له بالموضوع الذى يتحدث عنه التصميم فيظهر بشكل لا يليق.
هذا النص يمكن أن يتم تركيبه على أي تصميم دون مشكلة فلن يبدو وكأنه نص منسوخ، غير منظم، غير منسق، أو حتى غير مفهوم. لأنه مازال نصاً بديلاً ومؤقتاً.&lt;/p&gt;
&lt;h2 id=&#34;تجربة-rtl&#34;&gt;تجربة RTL&lt;/h2&gt;
&lt;p&gt;كلمة 1 Text كلمة 2&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Math Typesetting</title>
        <link>https://guolongji.xyz/post/math-typesetting/</link>
        <pubDate>Fri, 08 Mar 2019 00:00:00 +0000</pubDate>
        
        <guid>https://guolongji.xyz/post/math-typesetting/</guid>
        <description>&lt;p&gt;Mathematical notation in a Hugo project can be enabled by using third party JavaScript libraries.&lt;/p&gt;
&lt;p&gt;In this example we will be using &lt;a class=&#34;link&#34; href=&#34;https://katex.org/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;KaTeX&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a partial under &lt;code&gt;/layouts/partials/math.html&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Within this partial reference the &lt;a class=&#34;link&#34; href=&#34;https://katex.org/docs/autorender.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Auto-render Extension&lt;/a&gt; or host these scripts locally.&lt;/li&gt;
&lt;li&gt;Include the partial in your templates like so:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;{{&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;if&lt;/span&gt; or .Params.math .Site.Params.math &lt;span style=&#34;color:#ff79c6&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;{{&lt;/span&gt; partial &lt;span style=&#34;color:#f1fa8c&#34;&gt;&amp;#34;math.html&amp;#34;&lt;/span&gt; . &lt;span style=&#34;color:#ff79c6&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;{{&lt;/span&gt; end &lt;span style=&#34;color:#ff79c6&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;To enable KaTex globally set the parameter &lt;code&gt;math&lt;/code&gt; to &lt;code&gt;true&lt;/code&gt; in a project&amp;rsquo;s configuration&lt;/li&gt;
&lt;li&gt;To enable KaTex on a per page basis include the parameter &lt;code&gt;math: true&lt;/code&gt; in content files&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Use the online reference of &lt;a class=&#34;link&#34; href=&#34;https://katex.org/docs/supported.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Supported TeX Functions&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;examples&#34;&gt;Examples&lt;/h3&gt;

&lt;p&gt;Block math:
$$
\varphi = 1+\frac{1} {1+\frac{1} {1+\frac{1} {1+\cdots} } }
$$&lt;/p&gt;</description>
        </item>
        <item>
        <title>Emoji Support</title>
        <link>https://guolongji.xyz/post/emoji-support/</link>
        <pubDate>Tue, 05 Mar 2019 00:00:00 +0000</pubDate>
        
        <guid>https://guolongji.xyz/post/emoji-support/</guid>
        <description>&lt;img src="https://guolongji.xyz/post/emoji-support/the-creative-exchange-d2zvqp3fpro-unsplash.jpg" alt="Featured image of post Emoji Support" /&gt;&lt;p&gt;Emoji can be enabled in a Hugo project in a number of ways.&lt;/p&gt;
&lt;p&gt;The &lt;a class=&#34;link&#34; href=&#34;https://gohugo.io/functions/emojify/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;emojify&lt;/code&gt;&lt;/a&gt; function can be called directly in templates or &lt;a class=&#34;link&#34; href=&#34;https://gohugo.io/templates/shortcode-templates/#inline-shortcodes&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Inline Shortcodes&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To enable emoji globally, set &lt;code&gt;enableEmoji&lt;/code&gt; to &lt;code&gt;true&lt;/code&gt; in your site&amp;rsquo;s &lt;a class=&#34;link&#34; href=&#34;https://gohugo.io/getting-started/configuration/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;configuration&lt;/a&gt; and then you can type emoji shorthand codes directly in content files; e.g.&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;p&gt;The &lt;a class=&#34;link&#34; href=&#34;http://www.emoji-cheat-sheet.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Emoji cheat sheet&lt;/a&gt; is a useful reference for emoji shorthand codes.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;N.B.&lt;/strong&gt; The above steps enable Unicode Standard emoji characters and sequences in Hugo, however the rendering of these glyphs depends on the browser and the platform. To style the emoji you can either use a third party emoji font or a font stack; e.g.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;.emoji {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  font-family: Apple Color Emoji, Segoe UI Emoji, NotoColorEmoji, Segoe UI Symbol, Android Emoji, EmojiSymbols;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        
    </channel>
</rss>
